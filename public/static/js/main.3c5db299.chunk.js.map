{"version":3,"sources":["dispatcher.js","stores/ModelStore.js","conf.jsx","actions/MyActions.js","init-fcm.js","janus.js","Dict.jsx","containers/layouts/PanelRightPage.jsx","containers/rooms/urlimage.jsx","containers/rooms/board.jsx","containers/rooms/doc.jsx","containers/rooms/screen.jsx","containers/rooms/videos.jsx","containers/rooms/show.jsx","containers/rooms/saved.jsx","containers/rooms/player.jsx","components/right.jsx","components/left.jsx","components/login.jsx","containers/home/index.jsx","components/home/index.jsx","containers/profiles/show.jsx","components/profiles/show.jsx","containers/profiles/list.jsx","containers/profiles/index.jsx","components/profiles/index.jsx","containers/profiles/form.jsx","components/profiles/create.jsx","components/profiles/update.jsx","components/rooms/janus-tools.js","components/rooms/show.jsx","containers/users/Login.jsx","components/users/Login.jsx","components/users/LoginJwt.jsx","containers/users/SignUp.jsx","components/users/SignUp.jsx","containers/users/Verification.jsx","routes.js","components/users/Verification.jsx","containers/layouts/NotFoundPage.jsx","components/janus-tools.js","janus-2021.js","components/socket.js","components/janus-videoroom.js","components/ion-tools.js","components/App.jsx","serviceWorker.js","index.js"],"names":["Dispatcher","modelStore","list","multipleList","instance","klass","this","i","len","data","length","push","emit","console","log","action","type","listModel","listMultipleModel","showIntance","deleteIntance","setIntance","postFile","EventEmitter","dispatcher","register","handleActions","bind","conf","server","getList","model","page","params","token","queryString","Object","keys","map","key","join","axios","get","headers","then","response","dispatch","catch","error","fileUpload","id","file","url","formData","FormData","append","config","put","getInstance","setInstance","post","updateInstance","initializedFirebaseApp","firebase","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","isSupported","messaging","usePublicVapidKey","RTCRtpTransceiver","window","Janus","sessions","isExtensionEnabled","navigator","mediaDevices","getDisplayMedia","userAgent","match","chromever","parseInt","maxver","extension","isInstalled","defaultExtension","extensionId","document","querySelector","getScreen","callback","pending","setTimeout","Error","name","cache","postMessage","init","addEventListener","event","origin","location","sourceId","clearTimeout","gatewayCallbacks","success","noop","destroyed","initDone","isWebrtcSupported","websockets","ws","wsHandlers","wsKeepaliveTimeoutId","servers","serversIndex","isArray","debug","indexOf","iceServers","urls","iceTransportPolicy","bundlePolicy","ipv6Support","ipv6","withCredentials","undefined","maxev","max_poll_events","apisecret","destroyOnUnload","keepAlivePeriod","isNaN","longPollTimeout","getMaxBitrates","simulcastMaxBitrates","maxBitrates","high","medium","low","connected","sessionId","pluginHandles","that","retries","transactions","eventHandler","longpoll","Date","getTime","encodeURIComponent","httpAPICall","verb","handleEvent","timeout","textStatus","errorThrown","warn","json","skipTimeout","sender","pluginHandle","candidate","webrtcStuff","pc","remoteSdp","completed","addIceCandidate","endOfCandidates","candidates","webrtcState","hangup","detached","ondetached","detach","mediaState","slowLink","transaction","reportSuccess","code","reason","plugindata","jsep","onmessage","close","vdebug","keepAlive","request","randomString","send","JSON","stringify","createSession","callbacks","onopen","onerror","onclose","eventName","newWebSocket","parse","body","sendMessage","handleId","message","sdp","e2ee","rid_order","sendTrickleCandidate","createDataChannel","dclabel","dcprotocol","incoming","pendingData","onDataChannelStateChange","label","target","protocol","dcState","dataChannel","readyState","ondataopen","dcoptions","ordered","ondata","sendData","text","dataChanDefaultLabel","sendDtmf","dtmfSender","audioSender","getSenders","find","track","kind","dtmf","ontonechange","tone","tones","duration","gap","insertDTMF","destroyHandle","noRequest","cleanupWebrtc","streamsDone","media","stream","stopAllTracks","getAudioTracks","getVideoTracks","addTracks","myStream","update","streamExternal","isAudioSendEnabled","addAudio","replaceAudio","addTrack","unifiedPlan","audioTransceiver","transceivers","getTransceivers","t","receiver","replaceTrack","isVideoSendEnabled","addVideo","replaceVideo","videoTransceiver","pc_config","webRTCAdapter","browserDetails","browser","version","pc_constraints","optional","rtcConstraints","RTCRtpSender","prototype","createEncodedStreams","createEncodedAudioStreams","createEncodedVideoStreams","senderTransforms","receiverTransforms","RTCPeerConnection","getStats","volume","bitrate","value","trickle","oniceconnectionstatechange","e","iceState","iceConnectionState","onicecandidate","iceDone","mySdp","localDescription","sdpSent","sendSDP","sdpMid","sdpMLineIndex","ontrack","streams","remoteStream","onremotestream","onended","receiverStreams","createAudioEncodedStreams","readableStream","writableStream","pipeThrough","pipeTo","readable","writable","trackMutedTimeoutId","ev","removeTrack","onmute","onunmute","simulcast2","getTracks","forEach","tr","addTransceiver","direction","sendEncodings","rid","active","maxBitrate","scaleResolutionDownBy","senderStreams","isDataEnabled","ondatachannel","channel","onlocalstream","setRemoteDescription","customizeSdp","simulcast","mediaConstraints","audioSend","audioRecv","isAudioRecvEnabled","setDirection","removeAudio","videoSend","videoRecv","isVideoRecvEnabled","removeVideo","offerToReceiveAudio","offerToReceiveVideo","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","sendVideo","parameters","getParameters","setParameters","encodings","createAnswer","answer","setLocalDescription","iceRestart","s","createOffer","offer","lines","split","video","ssrc","ssrc_fid","cname","msid","mslabel","insertAt","mline","fid","splice","Math","floor","random","endsWith","mungeSdpForSimulcasting","prepareWebrtc","webrtcError","audio","keepAudio","keepVideo","addData","consentDialog","at","stop","ra","asnd","vt","rv","vsnd","isGetUserMediaAvailable","constraints","audioSupport","videoSupport","width","height","callbackUserMedia","getScreenMedia","gsmCallback","useAudio","getUserMedia","audioStream","screenshareFrameRate","frameRate","screenshareHeight","screenshareWidth","captureDesktopAudio","googLeakyBucket","maxWidth","screen","maxHeight","minFrameRate","maxFrameRate","chromeMediaSource","googTemporalLayeredScreencast","chromeMediaSourceId","mozMediaSource","mediaSource","err","lastTime","currentTime","polly","setInterval","clearInterval","enumerateDevices","devices","audioExist","some","device","videoExist","isScreenSendEnabled","needAudioDevice","failIfNoAudio","isAudioSendRequired","needVideoDevice","failIfNoVideo","isVideoSendRequired","haveAudioDevice","haveVideoDevice","gumConstraints","prepareWebrtcPeer","getVolume","remote","timer","stats","res","remoteSource","audioLevel","isMuted","enabled","mute","getBitrate","inStats","mediaType","toLowerCase","bytesReceived","googCodecName","bsnow","tsnow","timestamp","bsbefore","tsbefore","timePassed","bitRate","round","hangupRequest","oncleanup","getServer","isConnected","reconnect","getSessionId","getInfo","destroy","unload","notifyDestroyed","cleanupHandles","sendBeacon","unbindWebSocket","removeEventListener","onUnbindMessage","onUnbindError","session_id","destroySession","attach","plugin","opaqueId","handleToken","session","started","getId","getPlugin","getRemoteVolume","getLocalVolume","isAudioMuted","muteAudio","unmuteAudio","isVideoMuted","muteVideo","unmuteVideo","handleRemoteJsep","sendRequest","createHandle","useDefaultDependencies","deps","f","fetch","p","Promise","socketCls","WebSocket","proto","arr","Array","adapter","options","fetchOptions","method","credentials","fetching","reject","resolve","timerId","race","ok","parsed","useOldDependencies","jq","jQuery","payload","contentType","xhrFields","ajax","extend","dataType","async","result","xhr","status","tracks","mst","trace","d","usedDependencies","dependencies","listDevices","attachMediaStream","element","srcObject","src","URL","createObjectURL","reattachMediaStream","to","from","platform","oldOBF","safariVp8","getCapabilities","codecs","codec","mimeType","testpc","tempPc","charSet","randomPoz","substring","dict","Component","URLImage","state","image","handleLoad","setState","loadImage","oldProps","props","Image","crossOrigin","x","y","ref","node","imageNode","React","Board","handleMouseDown","isDrawing","pos","getRelativePointerPosition","getStage","tool","vectorId","toString","c","color","points","concat","throttle","handleMouseMove","pointerEnabled","isAdmin","isPresenter","isWriter","point","pointer","uuid","userUUID","updateMovement","lastLine","handleMouseUp","fitStageIntoParentContainer","stage","createRef","layer","imageLayer","handleClick","handleChange","handleClose","undo","removeLatestLine","trash","togglePointer","recorder","stopRecording","recordBtn","boardControl","arrows","baseWidth","baseHeight","scale","scaleX","scaleY","now","currentPage","displayColorPicker","upload","pointers","uploadedHeigth","ratio","db","recording","prevProps","line","participants","participant","exisiting","filter","item","userColor","undoVector","revertUndo","applyTrash","revertTrash","converted","dimensions","h","w","uploadedRecently","uploadedRecentlyReset","recentUpload","currentPoint","newState","assign","wsSend","radius","fill","current","getCanvas","_canvas","Dexie","stores","videos","$$","css","cardWidth","cardHeight","min","innerWidth","draw","transform","getAbsoluteTransform","copy","invert","getPointerPosition","progressShow","class","for","style","float","xmlns","viewBox","stroke-width","stroke","stroke-linecap","stroke-linejoin","x1","y1","x2","y2","className","accept","onInput","uploader","files","enumerator","Fragment","onClick","previousPage","marginTop","pages","nextPage","hex","last","v","canvas","audioMixer","MultiStreamsMixer","localStream","combined","MediaStream","captureStream","getMixedStream","MediaRecorder","chunks","ondataavailable","size","onstop","blob","Blob","add","alert","stack","start","rx","marginLeft","cx","cy","r","record","popover","cover","onChange","position","zIndex","top","right","bottom","left","progress","alignItems","onMouseDown","onMousemove","onMouseup","strokeWidth","tension","lineCap","globalCompositeOperation","RoomShow","title","home","panelOpen","f7","ionActive","vActive","display","background","borderRadius","minHeight","flexWrap","ionVideos","videoCard","screenActive","textAlign","screenVideos","Right","raise","handRaised","raiserUUID","handRaise","isRaised","isActive","role","participantRole","onPageAfterIn","pageAfterIn","chatActive","chatDeactive","textOverflow","logout","marginBottom","currentSlot","roomNumber","talking","isSpeaker","muted","toggleMicrophone","microphone","vPublishBtn","screenPublishBtn","toggleRole","presenter","write","enableMicrophone","propagateVideo","Left","chatItems","content","chats","appendChat","val","obj","slice","reverse","chat","fontSize","moment","time","fromNow","overflow","noHairlinesMd","inputId","placeholder","write_here","uuidv4","mediaList","Login","isSigningUp","block","signingUp","handleChangeValue","password_confirmation","passwordConfirmation","loginScreen","form","email","password","login","sign_up","loginActive","you_can_login","signUp","you_can_sign_up","href","animate","ignoreCache","cas","HomeIndex","tabbar","tabLink","tabLinkActive","ProfileShow","profile","fullname","after","slot","avatar","Layout","localStorage","getItem","actuals","metas","channels","ModelStore","on","removeListener","MyActions","$f7route","getIntance","getKlass","ios","aurora","md","profiles","backLink","back","fab","ProfileList","crypto","lib","WordArray","link","subtitle","ProfileIndex","inner","disableButtonText","cancel","search","query","loadData","q","ProfileForm","profile_info","firstname","defaultValue","surename","submit","withIcon","buttonText","choose_image","onDrop","buttonClassName","imgExtension","maxFileSize","ProfileCreate","handleChangeValueFields","removeActual","submitFields","fields","pictures","picture","meta_id","metaId","$f7router","navigate","profile_form","editing","sessionCreate","self","janus","mixertest","registerUsername","msg","myid","addParticipant","webrtcUp","echoCancellation","setup","leaving","getElementById","reload","room","exisitingParticipant","participantId","shortners","janusServer","sfutest","roomId","myusername","mystream","pin","isOwner","notification","unPublishData","app","$f7","panel","activity","room_id","user_fullname","is_owner","submitParticipation","participation","publishedMicrophone","publishedCamera","publishedDesktop","feeds","lowFeeds","requests","LoginForm","autofocus","enter_your_email","replace","username","user","setItem","SignUpForm","enter_your_name","enter_your_surename","validate","if_registered","hide","submitting","dialog","incomplete_data","show","SignUp","verification","verification_code","enter_verification_code","verificationCode","path","component","App","Verification","LoginJwt","ProfileUpdate","RoomIndex","strong","participantChangeStatus","removeParticipant","myId","participantDisplay","prevState","participantChangeRoom","participantRoom","toggleMute","forceMute","exitAudioRoom","socket","io","connect","socketIOServer","transports","secure","rejectUnauthorized","vsessionCreate","vregisterUsername","myVroomId","vJoined","vNewRemoteFeed","rfid","remoteFeed","shift","unpublished","vStreamDettacher","videoTracks","vparticipants","vStreamAttacher","simulcastStarted","subscribe","ptype","feed","private_id","mypvtid","toUpperCase","propagate","propagates","availableFeeds","rfdisplay","vremoveParticipant","vChangeUsername","localVideo","createElement","autoplay","$","publishCamera","publish","bitrate_cap","unPublishCamera","videoState","paddingTop","ionRequestRoom","ionSessionCreate","signal","IonSFUJSONRPCSignal","ionSignalServer","credential","client","Client","clients","cl","onremovetrack","remove","ionStart","LocalStream","resolution","facingMode","max","ionUnPublish","remoteVideo","unpublish","prepend","leaveRoom","ionPublishBtn","ionDisplay","leave","screenSessionCreate","screenSignal","screenConfig","screenClientLocal","screenStreams","screenMedia","screenStart","screenUnPublish","scrollTo","W3CWebSocket","socketServer","setParticipants","getJsonFromUrl","newComerReset","extractAction","appendLink","socketHandle","togglePresenter","connectSocketRoom","currentTab","quillDelta","cursorRange","newCursor","typing","loginScreenOpened","pass","newComerLength","contentSync","wsConnected","randomColor","luminosity","hue","alpha","clientLocal","srcLink","converterCounter","presenters","roles","handRaisings","validationState","domain","roleBlock","raiseBlock","flag","view","history","onunload","onbeforeunload","removeItem","onUploadProgress","progressEvent","percentCompleted","loaded","total","el","offset","scrollTop","exist","l","part","decodeURIComponent","is_admin","f7params","theme","rightBreakpoint","routes","resizable","themeDark","pushState","main","opened","onLoginScreenClosed","Boolean","hostname","serviceWorker","registration","scope","Framework7","use","Framework7React","ReactDOM","render"],"mappings":"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","file":"static/js/main.3c5db299.chunk.js","sourcesContent":["import { Dispatcher } from \"flux\";\n\nexport default new Dispatcher;\n","import { EventEmitter } from \"events\";\n\nimport dispatcher from \"../dispatcher\";\n\nclass ModelStore extends EventEmitter {\n  constructor() {\n    super()\n    this.list = [];\n    this.multipleList = [];\n    this.instance = null;\n    this.klass= null;\n  }\n\n  listModel(list){\n    this.list = [];\n    this.klass = list.klass\n    for (var i = 0, len = list.data.length; i < len; ++i) {\n      this.list.push(list.data[i]);\n      if (i === len - 1 ) {\n        this.emit(\"got_list\");\n      }\n    }\n    if(list.data.length == 0){\n      this.emit(\"got_list\");\n    }\n\n  }\n\n  listMultipleModel(list){\n    console.log(list)\n    this.multipleList = list.data;\n    this.klass = list.klass\n    this.emit(\"got_multiple_list\");\n  }\n\n  showIntance(instance){\n    this.klass = instance.klass\n    this.instance = instance.data\n    this.emit(\"got_instance\");\n  }\n\n  setIntance(instance){\n    this.klass = instance.klass\n    this.instance = instance.data\n    this.emit(\"set_instance\");\n  }\n\n\n  deleteIntance(instance){\n    this.klass = instance.klass\n    this.instance = instance.data\n    this.emit(\"deleted_instance\");\n  }\n\n  postFile(instance){\n    console.log(instance)\n    this.klass = instance.klass\n    this.instance = instance.data\n    this.emit(\"file_posted\");\n  }\n\n  getIntance() {\n    return this.instance\n  }\n\n  getList(){\n    return this.list\n  }\n\n  getMutipleList(){\n    return this.multipleList\n  }\n\n  getListnKlass(){\n    return [this.list, this.klass]\n  }\n\n  getKlass(){\n    return this.klass\n  }\n\n  handleActions(action) {\n    switch(action.type) {\n      case \"LIST_MODEL_SUCCESS\": {\n        this.listModel(action.list);\n        break;\n      }\n      case \"MULTIPLE_LIST_MODEL_SUCCESS\": {\n        this.listMultipleModel(action.list);\n        break;\n      }\n      case \"GET_INSTANCE_SUCCESS\": {\n        this.showIntance(action.instance);\n        break;\n      }\n      case \"DELETE_INSTANCE_SUCCESS\": {\n        this.deleteIntance(action.instance);\n        break;\n      }\n      case \"SET_INSTANCE_SUCCESS\": {\n        this.setIntance(action.instance);\n        break;\n      }\n      case \"POST_FILE_SUCCESS\": {\n        this.postFile(action.instance);\n        break;\n      }\n\n      \n    }\n  }\n}\n\n\nconst modelStore = new ModelStore;\ndispatcher.register(modelStore.handleActions.bind(modelStore));\n\nexport default modelStore;\n","export const conf = { \n//'server' : 'http://localhost:3001/v1',\n'server' : '/v1',\n'socketIOServer': 'https://connect.ut.ac.ir/',\n//'socketIOServer': 'http://localhost:8081/',\n'socketServer' : 'wss://kaarafarinan.ir/ws',\n//'socketServer' : 'ws://localhost:8080',\n//'ionSignalServer' : 'wss://kaarafarinan.ir:7000/ws',\n'ionSignalServer' : 'wss://sync.ut.ac.ir:7000/ws',\n//'janusServer' : 'https://kaarafarinan.ir:8089/janus',\n'janusServer' : 'https://sync.ut.ac.ir:8089/janus'\n};\n","import dispatcher from \"../dispatcher\";\nimport axios, {put} from 'axios';\nimport { conf } from '../conf';\n\nconst server= conf.server;\n//const server='http://localhost:3001/v1';\n//const server='/v1';\n//const server='http://95.156.255.115/api';\n\n\nexport function getList(model, page=1, params={}, token) {\n  var queryString = Object.keys(params).map(key => key + '=' + params[key]).join('&');\n  axios.get(server + '/'+ model +'?page='+page+'&'+queryString, { headers: {'Content-Type': 'application/json', 'Authorization': \"bearer \" + token } })\n  .then(function (response) {\n    dispatcher.dispatch({\n      type: \"LIST_MODEL_SUCCESS\",\n      list: response.data,\n    });\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n}\n\nexport function getMultipleList(model, page=1, params={}, token) {\n  var queryString = Object.keys(params).map(key => key + '=' + params[key]).join('&');\n  axios.get(server + '/'+ model +'?page='+page+'&'+queryString, { headers: {'Content-Type': 'application/json', 'Authorization': \"bearer \" + token } })\n  .then(function (response) {\n    console.log(response)\n    dispatcher.dispatch({\n      type: \"MULTIPLE_LIST_MODEL_SUCCESS\",\n      list: response.data,\n    });\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n}\n\nexport function fileUpload(model, id , file, token){\n  const url = server + '/'+ model +'/'+id;\n  const formData = new FormData();\n  formData.append('profile[avatar]',file)\n  formData.append('profile[id]',id)\n  const config = {\n      headers: {\n          'content-type': 'multipart/form-data',\n          'Authorization': \"bearer \" + token \n      }\n  }\n  put(url, formData,config).then(function (response) {\n    dispatcher.dispatch({\n      type: \"POST_FILE_SUCCESS\",\n      instance: response.data,\n    });\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n}\n\nexport function getInstance(model, id, token) {\n  axios.get(server + '/'+ model +'/'+id, { headers: {'Content-Type': 'application/json', 'Authorization': \"bearer \" + token } })\n  .then(function (response) {\n    dispatcher.dispatch({\n      type: \"GET_INSTANCE_SUCCESS\",\n      instance: response.data,\n    });\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n}\n\nexport function removeInstance(model, params={}, token ) {\n  var queryString = Object.keys(params).map(key => key + '=' + params[key]).join('&');\n  axios.get(server + '/'+ model +'/delete?'+queryString, { headers: {'Content-Type': 'application/json', 'Authorization': \"bearer \" + token } })\n  .then(function (response) {\n    dispatcher.dispatch({\n      type: \"DELETE_INSTANCE_SUCCESS\",\n      instance: response.data,\n    });\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n}\n\nexport function setInstance(model, data, token) {\n  axios.post(server + '/'+ model +'/', data, { headers: {'Content-Type': 'application/json', 'Authorization': \"bearer \" + token } })\n  .then(function (response) {\n    dispatcher.dispatch({\n      type: \"SET_INSTANCE_SUCCESS\",\n      instance: response.data,\n    });\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n}\n\nexport function updateInstance(model, data, token) {\n  axios.put(server + '/'+ model +'/'+data.id, data, { headers: {'Content-Type': 'application/json', 'Authorization': \"bearer \" + token } })\n  .then(function (response) {\n    dispatcher.dispatch({\n      type: \"SET_INSTANCE_SUCCESS\",\n      instance: response.data,\n    });\n  })\n  .catch(function (error) {\n    console.log(error);\n  });\n}\n","import * as firebase from \"firebase/app\";\nimport \"firebase/messaging\";\nconst initializedFirebaseApp = firebase.initializeApp({\n    apiKey: \"AIzaSyAbQ1NDkKB_E_SbfgHY3w-esVWhjwj9DeE\",\n    authDomain: \"tavan-e768d.firebaseapp.com\",\n    databaseURL: \"https://tavan-e768d.firebaseio.com\",\n    projectId: \"tavan-e768d\",\n    storageBucket: \"tavan-e768d.appspot.com\",\n    messagingSenderId: \"498708095861\",\n    appId: \"1:498708095861:web:00428b1330b24e1eece93c\",\n    measurementId: \"G-55DLXZ4VZY\"\n \n});\n//const messaging = initializedFirebaseApp.messaging();\nvar messaging = null;\nif (firebase.messaging.isSupported()){\n  messaging = initializedFirebaseApp.messaging();\n  messaging.usePublicVapidKey(\n    // Project Settings => Cloud Messaging => Web Push certificates\n    \"BGtSQdySGVQOeOwFha6rSVdmtfIUo_V33Eq-RTRb5kUNLvvwM7AVGCLtChjnGlD50fudRx8D4Aw-7br71Qfefrc\"\n  );\n  \n} else {\n \n}\nexport { messaging }; ","/*\n\tThe MIT License (MIT)\n\n\tCopyright (c) 2016 Meetecho\n\n\tPermission is hereby granted, free of charge, to any person obtaining\n\ta copy of this software and associated documentation files (the \"Software\"),\n\tto deal in the Software without restriction, including without limitation\n\tthe rights to use, copy, modify, merge, publish, distribute, sublicense,\n\tand/or sell copies of the Software, and to permit persons to whom the\n\tSoftware is furnished to do so, subject to the following conditions:\n\n\tThe above copyright notice and this permission notice shall be included\n\tin all copies or substantial portions of the Software.\n\n\tTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n\tOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\tFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n\tTHE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\n\tOTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n\tARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n\tOTHER DEALINGS IN THE SOFTWARE.\n */\n\n// List of sessions\nimport jQuery from 'jquery';\nimport adapter from 'webrtc-adapter';\n\nconst RTCRtpTransceiver = window.RTCRtpTransceiver;\nJanus.sessions = {};\n\nJanus.isExtensionEnabled = function() {\n\tif(navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n\t\t// No need for the extension, getDisplayMedia is supported\n\t\treturn true;\n\t}\n\tif(window.navigator.userAgent.match('Chrome')) {\n\t\tvar chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\n\t\tvar maxver = 33;\n\t\tif(window.navigator.userAgent.match('Linux'))\n\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\n\t\tif(chromever >= 26 && chromever <= maxver) {\n\t\t\t// Older versions of Chrome don't support this extension-based approach, so lie\n\t\t\treturn true;\n\t\t}\n\t\treturn Janus.extension.isInstalled();\n\t} else {\n\t\t// Firefox and others, no need for the extension (but this doesn't mean it will work)\n\t\treturn true;\n\t}\n};\n\nvar defaultExtension = {\n\t// Screensharing Chrome Extension ID\n\textensionId: 'hapfgfdkleiggjjpfpenajgdnfckjpaj',\n\tisInstalled: function() { return document.querySelector('#janus-extension-installed') !== null; },\n\tgetScreen: function (callback) {\n\t\tvar pending = window.setTimeout(function () {\n\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\terror.name = 'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\n\t\t\treturn callback(error);\n\t\t}, 1000);\n\t\tthis.cache[pending] = callback;\n\t\twindow.postMessage({ type: 'janusGetScreen', id: pending }, '*');\n\t},\n\tinit: function () {\n\t\tvar cache = {};\n\t\tthis.cache = cache;\n\t\t// Wait for events from the Chrome Extension\n\t\twindow.addEventListener('message', function (event) {\n\t\t\tif(event.origin != window.location.origin)\n\t\t\t\treturn;\n\t\t\tif(event.data.type == 'janusGotScreen' && cache[event.data.id]) {\n\t\t\t\tvar callback = cache[event.data.id];\n\t\t\t\tdelete cache[event.data.id];\n\n\t\t\t\tif (event.data.sourceId === '') {\n\t\t\t\t\t// user canceled\n\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\t\t\terror.name = 'You cancelled the request for permission, giving up...';\n\t\t\t\t\tcallback(error);\n\t\t\t\t} else {\n\t\t\t\t\tcallback(null, event.data.sourceId);\n\t\t\t\t}\n\t\t\t} else if (event.data.type == 'janusGetScreenPending') {\n\t\t\t\tconsole.log('clearing ', event.data.id);\n\t\t\t\twindow.clearTimeout(event.data.id);\n\t\t\t}\n\t\t});\n\t}\n};\n\nJanus.useDefaultDependencies = function (deps) {\n\tvar f = (deps && deps.fetch) || fetch;\n\tvar p = (deps && deps.Promise) || Promise;\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\n\n\treturn {\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\n\t\textension: (deps && deps.extension) || defaultExtension,\n\t\tisArray: function(arr) { return Array.isArray(arr); },\n\t\twebRTCAdapter: (deps && deps.adapter) || adapter,\n\t\thttpAPICall: function(url, options) {\n\t\t\tvar fetchOptions = {\n\t\t\t\tmethod: options.verb,\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json, text/plain, */*'\n\t\t\t\t},\n\t\t\t\tcache: 'no-cache'\n\t\t\t};\n\t\t\tif(options.verb === \"POST\") {\n\t\t\t\tfetchOptions.headers['Content-Type'] = 'application/json';\n\t\t\t}\n\t\t\tif(options.withCredentials !== undefined) {\n\t\t\t\tfetchOptions.credentials = options.withCredentials === true ? 'include' : (options.withCredentials ? options.withCredentials : 'omit');\n\t\t\t}\n\t\t\tif(options.body) {\n\t\t\t\tfetchOptions.body = JSON.stringify(options.body);\n\t\t\t}\n\n\t\t\tvar fetching = f(url, fetchOptions).catch(function(error) {\n\t\t\t\treturn p.reject({message: 'Probably a network error, is the server down?', error: error});\n\t\t\t});\n\n\t\t\t/*\n\t\t\t * fetch() does not natively support timeouts.\n\t\t\t * Work around this by starting a timeout manually, and racing it agains the fetch() to see which thing resolves first.\n\t\t\t */\n\n\t\t\tif(options.timeout) {\n\t\t\t\tvar timeout = new p(function(resolve, reject) {\n\t\t\t\t\tvar timerId = setTimeout(function() {\n\t\t\t\t\t\tclearTimeout(timerId);\n\t\t\t\t\t\treturn reject({message: 'Request timed out', timeout: options.timeout});\n\t\t\t\t\t}, options.timeout);\n\t\t\t\t});\n\t\t\t\tfetching = p.race([fetching, timeout]);\n\t\t\t}\n\n\t\t\tfetching.then(function(response) {\n\t\t\t\tif(response.ok) {\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\n\t\t\t\t\t\treturn response.json().then(function(parsed) {\n\t\t\t\t\t\t\toptions.success(parsed);\n\t\t\t\t\t\t}).catch(function(error) {\n\t\t\t\t\t\t\treturn p.reject({message: 'Failed to parse response body', error: error, response: response});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn p.reject({message: 'API call failed', response: response});\n\t\t\t\t}\n\t\t\t}).catch(function(error) {\n\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\n\t\t\t\t\toptions.error(error.message || '<< internal error >>', error);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn fetching;\n\t\t}\n\t}\n};\n\nJanus.useOldDependencies = function (deps) {\n\tvar jq = (deps && deps.jQuery) || jQuery;\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\n\treturn {\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\n\t\tisArray: function(arr) { return jq.isArray(arr); },\n\t\textension: (deps && deps.extension) || defaultExtension,\n\t\twebRTCAdapter: (deps && deps.adapter) || adapter,\n\t\thttpAPICall: function(url, options) {\n\t\t\tvar payload = options.body !== undefined ? {\n\t\t\t\tcontentType: 'application/json',\n\t\t\t\tdata: JSON.stringify(options.body)\n\t\t\t} : {};\n\t\t\tvar credentials = options.withCredentials !== undefined ? {xhrFields: {withCredentials: options.withCredentials}} : {};\n\n\t\t\treturn jq.ajax(jq.extend(payload, credentials, {\n\t\t\t\turl: url,\n\t\t\t\ttype: options.verb,\n\t\t\t\tcache: false,\n\t\t\t\tdataType: 'json',\n\t\t\t\tasync: options.async,\n\t\t\t\ttimeout: options.timeout,\n\t\t\t\tsuccess: function(result) {\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\n\t\t\t\t\t\toptions.success(result);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, err) {\n\t\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\n\t\t\t\t\t\toptions.error(status, err);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t};\n};\n\nJanus.noop = function() {};\n\nJanus.dataChanDefaultLabel = \"JanusDataChannel\";\n\n// Note: in the future we may want to change this, e.g., as was\n// attempted in https://github.com/meetecho/janus-gateway/issues/1670\nJanus.endOfCandidates = null;\n\n// Stop all tracks from a given stream\nJanus.stopAllTracks = function(stream) {\n\ttry {\n\t\t// Try a MediaStreamTrack.stop() for each track\n\t\tvar tracks = stream.getTracks();\n\t\tfor(var mst of tracks) {\n\t\t\tJanus.log(mst);\n\t\t\tif(mst) {\n\t\t\t\tmst.stop();\n\t\t\t}\n\t\t}\n\t} catch(e) {\n\t\t// Do nothing if this fails\n\t}\n}\n\n// Initialization\nJanus.init = function(options) {\n\toptions = options || {};\n\toptions.callback = (typeof options.callback == \"function\") ? options.callback : Janus.noop;\n\tif(Janus.initDone) {\n\t\t// Already initialized\n\t\toptions.callback();\n\t} else {\n\t\tif(typeof console == \"undefined\" || typeof console.log == \"undefined\") {\n\t\t\tconsole = { log: function() {} };\n\t\t}\n\t\t// Console logging (all debugging disabled by default)\n\t\tJanus.trace = Janus.noop;\n\t\tJanus.debug = Janus.noop;\n\t\tJanus.vdebug = Janus.noop;\n\t\tJanus.log = Janus.noop;\n\t\tJanus.warn = Janus.noop;\n\t\tJanus.error = Janus.noop;\n\t\tif(options.debug === true || options.debug === \"all\") {\n\t\t\t// Enable all debugging levels\n\t\t\tJanus.trace = console.trace.bind(console);\n\t\t\tJanus.debug = console.debug.bind(console);\n\t\t\tJanus.vdebug = console.debug.bind(console);\n\t\t\tJanus.log = console.log.bind(console);\n\t\t\tJanus.warn = console.warn.bind(console);\n\t\t\tJanus.error = console.error.bind(console);\n\t\t} else if(Array.isArray(options.debug)) {\n\t\t\tfor(var d of options.debug) {\n\t\t\t\tswitch(d) {\n\t\t\t\t\tcase \"trace\":\n\t\t\t\t\t\tJanus.trace = console.trace.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"debug\":\n\t\t\t\t\t\tJanus.debug = console.debug.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"vdebug\":\n\t\t\t\t\t\tJanus.vdebug = console.debug.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\tJanus.log = console.log.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"warn\":\n\t\t\t\t\t\tJanus.warn = console.warn.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"error\":\n\t\t\t\t\t\tJanus.error = console.error.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error(\"Unknown debugging option '\" + d + \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\");\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tJanus.log(\"Initializing library\");\n\n\t\tvar usedDependencies = options.dependencies || Janus.useDefaultDependencies();\n\t\tJanus.isArray = usedDependencies.isArray;\n\t\tJanus.webRTCAdapter = usedDependencies.webRTCAdapter;\n\t\tJanus.httpAPICall = usedDependencies.httpAPICall;\n\t\tJanus.newWebSocket = usedDependencies.newWebSocket;\n\t\tJanus.extension = usedDependencies.extension;\n\t\tJanus.extension.init();\n\n\t\t// Helper method to enumerate devices\n\t\tJanus.listDevices = function(callback, config) {\n\t\t\tcallback = (typeof callback == \"function\") ? callback : Janus.noop;\n\t\t\tif (config == null) config = { audio: true, video: true };\n\t\t\tif(Janus.isGetUserMediaAvailable()) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia(config)\n\t\t\t\t.then(function(stream) {\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\n\t\t\t\t\t\tJanus.debug(devices);\n\t\t\t\t\t\tcallback(devices);\n\t\t\t\t\t\t// Get rid of the now useless stream\n\t\t\t\t\t\tJanus.stopAllTracks(stream)\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err) {\n\t\t\t\t\tJanus.error(err);\n\t\t\t\t\tcallback([]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tJanus.warn(\"navigator.mediaDevices unavailable\");\n\t\t\t\tcallback([]);\n\t\t\t}\n\t\t};\n\t\t// Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\n\t\tJanus.attachMediaStream = function(element, stream) {\n\t\t\ttry {\n\t\t\t\telement.srcObject = stream;\n\t\t\t} catch (e) {\n\t\t\t\ttry {\n\t\t\t\t\telement.src = URL.createObjectURL(stream);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tJanus.error(\"Error attaching stream to element\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tJanus.reattachMediaStream = function(to, from) {\n\t\t\ttry {\n\t\t\t\tto.srcObject = from.srcObject;\n\t\t\t} catch (e) {\n\t\t\t\ttry {\n\t\t\t\t\tto.src = from.src;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tJanus.error(\"Error reattaching stream to element\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Detect tab close: make sure we don't loose existing onbeforeunload handlers\n\t\t// (note: for iOS we need to subscribe to a different event, 'pagehide', see\n\t\t// https://gist.github.com/thehunmonkgroup/6bee8941a49b86be31a787fe8f4b8cfe)\n\t\tvar iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n\t\tvar eventName = iOS ? 'pagehide' : 'beforeunload';\n\t\tvar oldOBF = window[\"on\" + eventName];\n\t\twindow.addEventListener(eventName, function(event) {\n\t\t\tJanus.log(\"Closing window\");\n\t\t\tfor(var s in Janus.sessions) {\n\t\t\t\tif(Janus.sessions[s] && Janus.sessions[s].destroyOnUnload) {\n\t\t\t\t\tJanus.log(\"Destroying session \" + s);\n\t\t\t\t\tJanus.sessions[s].destroy({unload: true, notifyDestroyed: false});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(oldOBF && typeof oldOBF == \"function\") {\n\t\t\t\toldOBF();\n\t\t\t}\n\t\t});\n\t\t// If this is a Safari Technology Preview, check if VP8 is supported\n\t\tJanus.safariVp8 = false;\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'safari' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 605) {\n\t\t\t// Let's see if RTCRtpSender.getCapabilities() is there\n\t\t\tif(RTCRtpSender && RTCRtpSender.getCapabilities && RTCRtpSender.getCapabilities(\"video\") &&\n\t\t\t\t\tRTCRtpSender.getCapabilities(\"video\").codecs && RTCRtpSender.getCapabilities(\"video\").codecs.length) {\n\t\t\t\tfor(var codec of RTCRtpSender.getCapabilities(\"video\").codecs) {\n\t\t\t\t\tif(codec && codec.mimeType && codec.mimeType.toLowerCase() === \"video/vp8\") {\n\t\t\t\t\t\tJanus.safariVp8 = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(Janus.safariVp8) {\n\t\t\t\t\tJanus.log(\"This version of Safari supports VP8\");\n\t\t\t\t} else {\n\t\t\t\t\tJanus.warn(\"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n\t\t\t\t\t\t\"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We do it in a very ugly way, as there's no alternative...\n\t\t\t\t// We create a PeerConnection to see if VP8 is in an offer\n\t\t\t\tvar testpc = new RTCPeerConnection({});\n\t\t\t\ttestpc.createOffer({offerToReceiveVideo: true}).then(function(offer) {\n\t\t\t\t\tJanus.safariVp8 = offer.sdp.indexOf(\"VP8\") !== -1;\n\t\t\t\t\tif(Janus.safariVp8) {\n\t\t\t\t\t\tJanus.log(\"This version of Safari supports VP8\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.warn(\"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n\t\t\t\t\t\t\t\"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\");\n\t\t\t\t\t}\n\t\t\t\t\ttestpc.close();\n\t\t\t\t\ttestpc = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// Check if this browser supports Unified Plan and transceivers\n\t\t// Based on https://codepen.io/anon/pen/ZqLwWV?editors=0010\n\t\tJanus.unifiedPlan = false;\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'firefox' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 59) {\n\t\t\t// Firefox definitely does, starting from version 59\n\t\t\tJanus.unifiedPlan = true;\n\t\t} else if(Janus.webRTCAdapter.browserDetails.browser === 'chrome' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 72) {\n\t\t\t// Chrome does, but it's only usable from version 72 on\n\t\t\tJanus.unifiedPlan = true;\n\t\t} else if(!window.RTCRtpTransceiver || !('currentDirection' in RTCRtpTransceiver.prototype)) {\n\t\t\t// Safari supports addTransceiver() but not Unified Plan when\n\t\t\t// currentDirection is not defined (see codepen above).\n\t\t\tJanus.unifiedPlan = false;\n\t\t} else {\n\t\t\t// Check if addTransceiver() throws an exception\n\t\t\tvar tempPc = new RTCPeerConnection();\n\t\t\ttry {\n\t\t\t\ttempPc.addTransceiver('audio');\n\t\t\t\tJanus.unifiedPlan = true;\n\t\t\t} catch (e) {}\n\t\t\ttempPc.close();\n\t\t}\n\t\tJanus.initDone = true;\n\t\toptions.callback();\n\t}\n};\n\n// Helper method to check whether WebRTC is supported by this browser\nJanus.isWebrtcSupported = function() {\n\treturn !!window.RTCPeerConnection;\n};\n// Helper method to check whether devices can be accessed by this browser (e.g., not possible via plain HTTP)\nJanus.isGetUserMediaAvailable = function() {\n\treturn navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\n};\n\n// Helper method to create random identifiers (e.g., transaction)\nJanus.randomString = function(len) {\n\tvar charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\tvar randomString = '';\n\tfor (var i = 0; i < len; i++) {\n\t\tvar randomPoz = Math.floor(Math.random() * charSet.length);\n\t\trandomString += charSet.substring(randomPoz,randomPoz+1);\n\t}\n\treturn randomString;\n};\n\nfunction Janus(gatewayCallbacks) {\n\tgatewayCallbacks = gatewayCallbacks || {};\n\tgatewayCallbacks.success = (typeof gatewayCallbacks.success == \"function\") ? gatewayCallbacks.success : Janus.noop;\n\tgatewayCallbacks.error = (typeof gatewayCallbacks.error == \"function\") ? gatewayCallbacks.error : Janus.noop;\n\tgatewayCallbacks.destroyed = (typeof gatewayCallbacks.destroyed == \"function\") ? gatewayCallbacks.destroyed : Janus.noop;\n\tif(!Janus.initDone) {\n\t\tgatewayCallbacks.error(\"Library not initialized\");\n\t\treturn {};\n\t}\n\tif(!Janus.isWebrtcSupported()) {\n\t\tgatewayCallbacks.error(\"WebRTC not supported by this browser\");\n\t\treturn {};\n\t}\n\tJanus.log(\"Library initialized: \" + Janus.initDone);\n\tif(!gatewayCallbacks.server) {\n\t\tgatewayCallbacks.error(\"Invalid server url\");\n\t\treturn {};\n\t}\n\tvar websockets = false;\n\tvar ws = null;\n\tvar wsHandlers = {};\n\tvar wsKeepaliveTimeoutId = null;\n\tvar servers = null;\n\tvar serversIndex = 0;\n\tvar server = gatewayCallbacks.server;\n\tif(Janus.isArray(server)) {\n\t\tJanus.log(\"Multiple servers provided (\" + server.length + \"), will use the first that works\");\n\t\tserver = null;\n\t\tservers = gatewayCallbacks.server;\n\t\tJanus.debug(servers);\n\t} else {\n\t\tif(server.indexOf(\"ws\") === 0) {\n\t\t\twebsockets = true;\n\t\t\tJanus.log(\"Using WebSockets to contact Janus: \" + server);\n\t\t} else {\n\t\t\twebsockets = false;\n\t\t\tJanus.log(\"Using REST API to contact Janus: \" + server);\n\t\t}\n\t}\n\tvar iceServers = gatewayCallbacks.iceServers || [{urls: \"stun:stun.l.google.com:19302\"}];\n\tvar iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\n\tvar bundlePolicy = gatewayCallbacks.bundlePolicy;\n\t// Whether IPv6 candidates should be gathered\n\tvar ipv6Support = (gatewayCallbacks.ipv6 === true);\n\t// Whether we should enable the withCredentials flag for XHR requests\n\tvar withCredentials = false;\n\tif(gatewayCallbacks.withCredentials !== undefined && gatewayCallbacks.withCredentials !== null)\n\t\twithCredentials = gatewayCallbacks.withCredentials === true;\n\t// Optional max events\n\tvar maxev = 10;\n\tif(gatewayCallbacks.max_poll_events !== undefined && gatewayCallbacks.max_poll_events !== null)\n\t\tmaxev = gatewayCallbacks.max_poll_events;\n\tif(maxev < 1)\n\t\tmaxev = 1;\n\t// Token to use (only if the token based authentication mechanism is enabled)\n\tvar token = null;\n\tif(gatewayCallbacks.token !== undefined && gatewayCallbacks.token !== null)\n\t\ttoken = gatewayCallbacks.token;\n\t// API secret to use (only if the shared API secret is enabled)\n\tvar apisecret = null;\n\tif(gatewayCallbacks.apisecret !== undefined && gatewayCallbacks.apisecret !== null)\n\t\tapisecret = gatewayCallbacks.apisecret;\n\t// Whether we should destroy this session when onbeforeunload is called\n\tthis.destroyOnUnload = true;\n\tif(gatewayCallbacks.destroyOnUnload !== undefined && gatewayCallbacks.destroyOnUnload !== null)\n\t\tthis.destroyOnUnload = (gatewayCallbacks.destroyOnUnload === true);\n\t// Some timeout-related values\n\tvar keepAlivePeriod = 25000;\n\tif(gatewayCallbacks.keepAlivePeriod !== undefined && gatewayCallbacks.keepAlivePeriod !== null)\n\t\tkeepAlivePeriod = gatewayCallbacks.keepAlivePeriod;\n\tif(isNaN(keepAlivePeriod))\n\t\tkeepAlivePeriod = 25000;\n\tvar longPollTimeout = 60000;\n\tif(gatewayCallbacks.longPollTimeout !== undefined && gatewayCallbacks.longPollTimeout !== null)\n\t\tlongPollTimeout = gatewayCallbacks.longPollTimeout;\n\tif(isNaN(longPollTimeout))\n\t\tlongPollTimeout = 60000;\n\n\t// overrides for default maxBitrate values for simulcasting\n\tfunction getMaxBitrates(simulcastMaxBitrates) {\n\t\tvar maxBitrates = {\n\t\t\thigh: 900000,\n\t\t\tmedium: 300000,\n\t\t\tlow: 100000,\n\t\t};\n\n\t\tif (simulcastMaxBitrates !== undefined && simulcastMaxBitrates !== null) {\n\t\t\tif (simulcastMaxBitrates.high)\n\t\t\t\tmaxBitrates.high = simulcastMaxBitrates.high;\n\t\t\tif (simulcastMaxBitrates.medium)\n\t\t\t\tmaxBitrates.medium = simulcastMaxBitrates.medium;\n\t\t\tif (simulcastMaxBitrates.low)\n\t\t\t\tmaxBitrates.low = simulcastMaxBitrates.low;\n\t\t}\n\n\t\treturn maxBitrates;\n\t}\n\n\tvar connected = false;\n\tvar sessionId = null;\n\tvar pluginHandles = {};\n\tvar that = this;\n\tvar retries = 0;\n\tvar transactions = {};\n\tcreateSession(gatewayCallbacks);\n\n\t// Public methods\n\tthis.getServer = function() { return server; };\n\tthis.isConnected = function() { return connected; };\n\tthis.reconnect = function(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks[\"reconnect\"] = true;\n\t\tcreateSession(callbacks);\n\t};\n\tthis.getSessionId = function() { return sessionId; };\n\tthis.getInfo = function(callbacks) { getInfo(callbacks); };\n\tthis.destroy = function(callbacks) { destroySession(callbacks); };\n\tthis.attach = function(callbacks) { createHandle(callbacks); };\n\n\tfunction eventHandler() {\n\t\tif(sessionId == null)\n\t\t\treturn;\n\t\tJanus.debug('Long poll...');\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar longpoll = server + \"/\" + sessionId + \"?rid=\" + new Date().getTime();\n\t\tif(maxev)\n\t\t\tlongpoll = longpoll + \"&maxev=\" + maxev;\n\t\tif(token)\n\t\t\tlongpoll = longpoll + \"&token=\" + encodeURIComponent(token);\n\t\tif(apisecret)\n\t\t\tlongpoll = longpoll + \"&apisecret=\" + encodeURIComponent(apisecret);\n\t\tJanus.httpAPICall(longpoll, {\n\t\t\tverb: 'GET',\n\t\t\twithCredentials: withCredentials,\n\t\t\tsuccess: handleEvent,\n\t\t\ttimeout: longPollTimeout,\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\n\t\t\t\tretries++;\n\t\t\t\tif(retries > 3) {\n\t\t\t\t\t// Did we just lose the server? :-(\n\t\t\t\t\tconnected = false;\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the server (is it down?)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\teventHandler();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private event handler: this will trigger plugin callbacks, if set\n\tfunction handleEvent(json, skipTimeout) {\n\t\tretries = 0;\n\t\tif(!websockets && sessionId !== undefined && sessionId !== null && skipTimeout !== true)\n\t\t\teventHandler();\n\t\tif(!websockets && Janus.isArray(json)) {\n\t\t\t// We got an array: it means we passed a maxev > 1, iterate on all objects\n\t\t\tfor(var i=0; i<json.length; i++) {\n\t\t\t\thandleEvent(json[i], true);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif(json[\"janus\"] === \"keepalive\") {\n\t\t\t// Nothing happened\n\t\t\tJanus.vdebug(\"Got a keepalive on session \" + sessionId);\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"server_info\") {\n\t\t\t// Just info on the Janus instance\n\t\t\tJanus.debug(\"Got info on the Janus instance\");\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess)\n\t\t\t\t\treportSuccess(json);\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"ack\") {\n\t\t\t// Just an ack, we can probably ignore\n\t\t\tJanus.debug(\"Got an ack on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess)\n\t\t\t\t\treportSuccess(json);\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"success\") {\n\t\t\t// Success!\n\t\t\tJanus.debug(\"Got a success on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess)\n\t\t\t\t\treportSuccess(json);\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"trickle\") {\n\t\t\t// We got a trickle candidate from Janus\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar candidate = json[\"candidate\"];\n\t\t\tJanus.debug(\"Got a trickled candidate on session \" + sessionId);\n\t\t\tJanus.debug(candidate);\n\t\t\tvar config = pluginHandle.webrtcStuff;\n\t\t\tif(config.pc && config.remoteSdp) {\n\t\t\t\t// Add candidate right now\n\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t// end-of-candidates\n\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t} else {\n\t\t\t\t\t// New candidate\n\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We didn't do setRemoteDescription (trickle got here before the offer?)\n\t\t\t\tJanus.debug(\"We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate\");\n\t\t\t\tif(!config.candidates)\n\t\t\t\t\tconfig.candidates = [];\n\t\t\t\tconfig.candidates.push(candidate);\n\t\t\t\tJanus.debug(config.candidates);\n\t\t\t}\n\t\t} else if(json[\"janus\"] === \"webrtcup\") {\n\t\t\t// The PeerConnection with the server is up! Notify this\n\t\t\tJanus.debug(\"Got a webrtcup event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.webrtcState(true);\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"hangup\") {\n\t\t\t// A plugin asked the core to hangup a PeerConnection on one of our handles\n\t\t\tJanus.debug(\"Got a hangup event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.webrtcState(false, json[\"reason\"]);\n\t\t\tpluginHandle.hangup();\n\t\t} else if(json[\"janus\"] === \"detached\") {\n\t\t\t// A plugin asked the core to detach one of our handles\n\t\t\tJanus.debug(\"Got a detached event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\t// Don't warn here because destroyHandle causes this situation.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.detached = true;\n\t\t\tpluginHandle.ondetached();\n\t\t\tpluginHandle.detach();\n\t\t} else if(json[\"janus\"] === \"media\") {\n\t\t\t// Media started/stopped flowing\n\t\t\tJanus.debug(\"Got a media event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.mediaState(json[\"type\"], json[\"receiving\"]);\n\t\t} else if(json[\"janus\"] === \"slowlink\") {\n\t\t\tJanus.debug(\"Got a slowlink event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\t// Trouble uplink or downlink\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.slowLink(json[\"uplink\"], json[\"lost\"]);\n\t\t} else if(json[\"janus\"] === \"error\") {\n\t\t\t// Oops, something wrong happened\n\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess) {\n\t\t\t\t\treportSuccess(json);\n\t\t\t\t}\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"event\") {\n\t\t\tJanus.debug(\"Got a plugin event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\tif(!plugindata) {\n\t\t\t\tJanus.warn(\"Missing plugindata...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tJanus.debug(\"  -- Event is coming from \" + sender + \" (\" + plugindata[\"plugin\"] + \")\");\n\t\t\tvar data = plugindata[\"data\"];\n\t\t\tJanus.debug(data);\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.warn(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar jsep = json[\"jsep\"];\n\t\t\tif(jsep) {\n\t\t\t\tJanus.debug(\"Handling SDP as well...\");\n\t\t\t\tJanus.debug(jsep);\n\t\t\t}\n\t\t\tvar callback = pluginHandle.onmessage;\n\t\t\tif(callback) {\n\t\t\t\tJanus.debug(\"Notifying application...\");\n\t\t\t\t// Send to callback specified when attaching plugin handle\n\t\t\t\tcallback(data, jsep);\n\t\t\t} else {\n\t\t\t\t// Send to generic callback (?)\n\t\t\t\tJanus.debug(\"No provided notification callback\");\n\t\t\t}\n\t\t} else if(json[\"janus\"] === \"timeout\") {\n\t\t\tJanus.error(\"Timeout on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tif (websockets) {\n\t\t\t\tws.close(3504, \"Gateway timeout\");\n\t\t\t}\n\t\t\treturn;\n\t\t} else {\n\t\t\tJanus.warn(\"Unknown message/event  '\" + json[\"janus\"] + \"' on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t}\n\t}\n\n\t// Private helper to send keep-alive messages on WebSockets\n\tfunction keepAlive() {\n\t\tif(!server || !websockets || !connected)\n\t\t\treturn;\n\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n\t\tvar request = { \"janus\": \"keepalive\", \"session_id\": sessionId, \"transaction\": Janus.randomString(12) };\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tws.send(JSON.stringify(request));\n\t}\n\n\t// Private method to create a session\n\tfunction createSession(callbacks) {\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"create\", \"transaction\": transaction };\n\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t// We're reconnecting, claim the session\n\t\t\tconnected = false;\n\t\t\trequest[\"janus\"] = \"claim\";\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\t// If we were using websockets, ignore the old connection\n\t\t\tif(ws) {\n\t\t\t\tws.onopen = null;\n\t\t\t\tws.onerror = null;\n\t\t\t\tws.onclose = null;\n\t\t\t\tif(wsKeepaliveTimeoutId) {\n\t\t\t\t\tclearTimeout(wsKeepaliveTimeoutId);\n\t\t\t\t\twsKeepaliveTimeoutId = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(!server && Janus.isArray(servers)) {\n\t\t\t// We still need to find a working server from the list we were given\n\t\t\tserver = servers[serversIndex];\n\t\t\tif(server.indexOf(\"ws\") === 0) {\n\t\t\t\twebsockets = true;\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying WebSockets to contact Janus (\" + server + \")\");\n\t\t\t} else {\n\t\t\t\twebsockets = false;\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying REST API to contact Janus (\" + server + \")\");\n\t\t\t}\n\t\t}\n\t\tif(websockets) {\n\t\t\tws = Janus.newWebSocket(server, 'janus-protocol');\n\t\t\twsHandlers = {\n\t\t\t\t'error': function() {\n\t\t\t\t\tJanus.error(\"Error connecting to the Janus WebSockets server... \" + server);\n\t\t\t\t\tif (Janus.isArray(servers) && !callbacks[\"reconnect\"]) {\n\t\t\t\t\t\tserversIndex++;\n\t\t\t\t\t\tif (serversIndex === servers.length) {\n\t\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\n\t\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the server down?\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Let's try the next server\n\t\t\t\t\t\tserver = null;\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tcreateSession(callbacks);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcallbacks.error(\"Error connecting to the Janus WebSockets server: Is the server down?\");\n\t\t\t\t},\n\n\t\t\t\t'open': function() {\n\t\t\t\t\t// We need to be notified about the success\n\t\t\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\t\t\tJanus.debug(json);\n\t\t\t\t\t\tif (json[\"janus\"] !== \"success\") {\n\t\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n\t\t\t\t\t\tconnected = true;\n\t\t\t\t\t\tsessionId = json[\"session_id\"] ? json[\"session_id\"] : json.data[\"id\"];\n\t\t\t\t\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t\t\t\t\tJanus.log(\"Claimed session: \" + sessionId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tJanus.log(\"Created session: \" + sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.sessions[sessionId] = that;\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t};\n\t\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t\t},\n\n\t\t\t\t'message': function(event) {\n\t\t\t\t\thandleEvent(JSON.parse(event.data));\n\t\t\t\t},\n\n\t\t\t\t'close': function() {\n\t\t\t\t\tif (!server || !connected) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconnected = false;\n\t\t\t\t\t// FIXME What if this is called when the page is closed?\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the server (is it down?)\");\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfor(var eventName in wsHandlers) {\n\t\t\t\tws.addEventListener(eventName, wsHandlers[eventName]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconnected = true;\n\t\t\t\tsessionId = json[\"session_id\"] ? json[\"session_id\"] : json.data[\"id\"];\n\t\t\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t\t\tJanus.log(\"Claimed session: \" + sessionId);\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log(\"Created session: \" + sessionId);\n\t\t\t\t}\n\t\t\t\tJanus.sessions[sessionId] = that;\n\t\t\t\teventHandler();\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tif(Janus.isArray(servers) && !callbacks[\"reconnect\"]) {\n\t\t\t\t\tserversIndex++;\n\t\t\t\t\tif(serversIndex === servers.length) {\n\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\n\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the server down?\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Let's try the next server\n\t\t\t\t\tserver = null;\n\t\t\t\t\tsetTimeout(function() { createSession(callbacks); }, 200);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(errorThrown === \"\")\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the server down?\");\n\t\t\t\telse\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to get info on the server\n\tfunction getInfo(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\t// FIXME This method triggers a success even when we fail\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tJanus.log(\"Getting info on Janus instance\");\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\t// We just need to send an \"info\" request\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"info\", \"transaction\": transaction };\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.log(\"Server info:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"server_info\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tcallbacks.success(json);\n\t\t\t}\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Server info:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"server_info\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tcallbacks.success(json);\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tif(errorThrown === \"\")\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the server down?\");\n\t\t\t\telse\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to destroy a session\n\tfunction destroySession(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\t// FIXME This method triggers a success even when we fail\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar unload = (callbacks.unload === true);\n\t\tvar notifyDestroyed = true;\n\t\tif(callbacks.notifyDestroyed !== undefined && callbacks.notifyDestroyed !== null)\n\t\t\tnotifyDestroyed = (callbacks.notifyDestroyed === true);\n\t\tvar cleanupHandles = (callbacks.cleanupHandles === true);\n\t\tJanus.log(\"Destroying session \" + sessionId + \" (unload=\" + unload + \")\");\n\t\tif(!sessionId) {\n\t\t\tJanus.warn(\"No session to destroy\");\n\t\t\tcallbacks.success();\n\t\t\tif(notifyDestroyed)\n\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\treturn;\n\t\t}\n\t\tif(cleanupHandles) {\n\t\t\tfor(var handleId in pluginHandles)\n\t\t\t\tdestroyHandle(handleId, { noRequest: true });\n\t\t}\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tsessionId = null;\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\t// No need to destroy all handles first, Janus will do that itself\n\t\tvar request = { \"janus\": \"destroy\", \"transaction\": Janus.randomString(12) };\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(unload) {\n\t\t\t// We're unloading the page: use sendBeacon for HTTP instead,\n\t\t\t// or just close the WebSocket connection if we're using that\n\t\t\tif(websockets) {\n\t\t\t\tws.onclose = null;\n\t\t\t\tws.close();\n\t\t\t\tws = null;\n\t\t\t} else {\n\t\t\t\tnavigator.sendBeacon(server + \"/\" + sessionId, JSON.stringify(request));\n\t\t\t}\n\t\t\tJanus.log(\"Destroyed session:\");\n\t\t\tsessionId = null;\n\t\t\tconnected = false;\n\t\t\tcallbacks.success();\n\t\t\tif(notifyDestroyed)\n\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\treturn;\n\t\t}\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\n\t\t\tvar unbindWebSocket = function() {\n\t\t\t\tfor(var eventName in wsHandlers) {\n\t\t\t\t\tws.removeEventListener(eventName, wsHandlers[eventName]);\n\t\t\t\t}\n\t\t\t\tws.removeEventListener('message', onUnbindMessage);\n\t\t\t\tws.removeEventListener('error', onUnbindError);\n\t\t\t\tif(wsKeepaliveTimeoutId) {\n\t\t\t\t\tclearTimeout(wsKeepaliveTimeoutId);\n\t\t\t\t}\n\t\t\t\tws.close();\n\t\t\t};\n\n\t\t\tvar onUnbindMessage = function(event){\n\t\t\t\tvar data = JSON.parse(event.data);\n\t\t\t\tif(data.session_id == request.session_id && data.transaction == request.transaction) {\n\t\t\t\t\tunbindWebSocket();\n\t\t\t\t\tcallbacks.success();\n\t\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar onUnbindError = function(event) {\n\t\t\t\tunbindWebSocket();\n\t\t\t\tcallbacks.error(\"Failed to destroy the server: Is the server down?\");\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t};\n\n\t\t\tws.addEventListener('message', onUnbindMessage);\n\t\t\tws.addEventListener('error', onUnbindError);\n\n\t\t\tif (ws.readyState === 1) {\n\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t} else {\n\t\t\t\tonUnbindError();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Destroyed session:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tsessionId = null;\n\t\t\t\tconnected = false;\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tcallbacks.success();\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\t// Reset everything anyway\n\t\t\t\tsessionId = null;\n\t\t\t\tconnected = false;\n\t\t\t\tcallbacks.success();\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to create a plugin handle\n\tfunction createHandle(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.consentDialog = (typeof callbacks.consentDialog == \"function\") ? callbacks.consentDialog : Janus.noop;\n\t\tcallbacks.iceState = (typeof callbacks.iceState == \"function\") ? callbacks.iceState : Janus.noop;\n\t\tcallbacks.mediaState = (typeof callbacks.mediaState == \"function\") ? callbacks.mediaState : Janus.noop;\n\t\tcallbacks.webrtcState = (typeof callbacks.webrtcState == \"function\") ? callbacks.webrtcState : Janus.noop;\n\t\tcallbacks.slowLink = (typeof callbacks.slowLink == \"function\") ? callbacks.slowLink : Janus.noop;\n\t\tcallbacks.onmessage = (typeof callbacks.onmessage == \"function\") ? callbacks.onmessage : Janus.noop;\n\t\tcallbacks.onlocalstream = (typeof callbacks.onlocalstream == \"function\") ? callbacks.onlocalstream : Janus.noop;\n\t\tcallbacks.onremotestream = (typeof callbacks.onremotestream == \"function\") ? callbacks.onremotestream : Janus.noop;\n\t\tcallbacks.ondata = (typeof callbacks.ondata == \"function\") ? callbacks.ondata : Janus.noop;\n\t\tcallbacks.ondataopen = (typeof callbacks.ondataopen == \"function\") ? callbacks.ondataopen : Janus.noop;\n\t\tcallbacks.oncleanup = (typeof callbacks.oncleanup == \"function\") ? callbacks.oncleanup : Janus.noop;\n\t\tcallbacks.ondetached = (typeof callbacks.ondetached == \"function\") ? callbacks.ondetached : Janus.noop;\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar plugin = callbacks.plugin;\n\t\tif(!plugin) {\n\t\t\tJanus.error(\"Invalid plugin\");\n\t\t\tcallbacks.error(\"Invalid plugin\");\n\t\t\treturn;\n\t\t}\n\t\tvar opaqueId = callbacks.opaqueId;\n\t\tvar handleToken = callbacks.token ? callbacks.token : token;\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"attach\", \"plugin\": plugin, \"opaque_id\": opaqueId, \"transaction\": transaction };\n\t\tif(handleToken)\n\t\t\trequest[\"token\"] = handleToken;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar handleId = json.data[\"id\"];\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\n\t\t\t\tvar pluginHandle =\n\t\t\t\t\t{\n\t\t\t\t\t\tsession : that,\n\t\t\t\t\t\tplugin : plugin,\n\t\t\t\t\t\tid : handleId,\n\t\t\t\t\t\ttoken : handleToken,\n\t\t\t\t\t\tdetached : false,\n\t\t\t\t\t\twebrtcStuff : {\n\t\t\t\t\t\t\tstarted : false,\n\t\t\t\t\t\t\tmyStream : null,\n\t\t\t\t\t\t\tstreamExternal : false,\n\t\t\t\t\t\t\tremoteStream : null,\n\t\t\t\t\t\t\tmySdp : null,\n\t\t\t\t\t\t\tmediaConstraints : null,\n\t\t\t\t\t\t\tpc : null,\n\t\t\t\t\t\t\tdataChannel : {},\n\t\t\t\t\t\t\tdtmfSender : null,\n\t\t\t\t\t\t\ttrickle : true,\n\t\t\t\t\t\t\ticeDone : false,\n\t\t\t\t\t\t\tvolume : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbitrate : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\tbsnow : null,\n\t\t\t\t\t\t\t\tbsbefore : null,\n\t\t\t\t\t\t\t\ttsnow : null,\n\t\t\t\t\t\t\t\ttsbefore : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetId : function() { return handleId; },\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetRemoteVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetLocalVolume : function() { return getVolume(handleId, false); },\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\n\t\t\t\t\t\ticeState : callbacks.iceState,\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, true, callbacks); },\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, false, callbacks); },\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\n\t\t\t\t\t\tondata : callbacks.ondata,\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\n\t\t\t\t\t\tondetached : callbacks.ondetached,\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\n\t\t\t\t\t};\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\n\t\t\t\tcallbacks.success(pluginHandle);\n\t\t\t};\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar handleId = json.data[\"id\"];\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\n\t\t\t\tvar pluginHandle =\n\t\t\t\t\t{\n\t\t\t\t\t\tsession : that,\n\t\t\t\t\t\tplugin : plugin,\n\t\t\t\t\t\tid : handleId,\n\t\t\t\t\t\ttoken : handleToken,\n\t\t\t\t\t\tdetached : false,\n\t\t\t\t\t\twebrtcStuff : {\n\t\t\t\t\t\t\tstarted : false,\n\t\t\t\t\t\t\tmyStream : null,\n\t\t\t\t\t\t\tstreamExternal : false,\n\t\t\t\t\t\t\tremoteStream : null,\n\t\t\t\t\t\t\tmySdp : null,\n\t\t\t\t\t\t\tmediaConstraints : null,\n\t\t\t\t\t\t\tpc : null,\n\t\t\t\t\t\t\tdataChannel : {},\n\t\t\t\t\t\t\tdtmfSender : null,\n\t\t\t\t\t\t\ttrickle : true,\n\t\t\t\t\t\t\ticeDone : false,\n\t\t\t\t\t\t\tvolume : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbitrate : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\tbsnow : null,\n\t\t\t\t\t\t\t\tbsbefore : null,\n\t\t\t\t\t\t\t\ttsnow : null,\n\t\t\t\t\t\t\t\ttsbefore : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetId : function() { return handleId; },\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetRemoteVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetLocalVolume : function() { return getVolume(handleId, false); },\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\n\t\t\t\t\t\ticeState : callbacks.iceState,\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, true, callbacks); },\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, false, callbacks); },\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\n\t\t\t\t\t\tondata : callbacks.ondata,\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\n\t\t\t\t\t\tondetached : callbacks.ondetached,\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\n\t\t\t\t\t}\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\n\t\t\t\tcallbacks.success(pluginHandle);\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tif(errorThrown === \"\")\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the server down?\");\n\t\t\t\telse\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to send a message\n\tfunction sendMessage(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar message = callbacks.message;\n\t\tvar jsep = callbacks.jsep;\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"message\", \"body\": message, \"transaction\": transaction };\n\t\tif(pluginHandle.token)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(jsep) {\n\t\t\trequest.jsep = {\n\t\t\t\ttype: jsep.type,\n\t\t\t\tsdp: jsep.sdp\n\t\t\t};\n\t\t\tif(jsep.e2ee)\n\t\t\t\trequest.jsep.e2ee = true;\n\t\t\tif(jsep.rid_order === \"hml\" || jsep.rid_order === \"lmh\")\n\t\t\t\trequest.jsep.rid_order = jsep.rid_order;\n\t\t}\n\t\tJanus.debug(\"Sending message to plugin (handle=\" + handleId + \"):\");\n\t\tJanus.debug(request);\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.debug(\"Message sent!\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] === \"success\") {\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\t\t\tif(!plugindata) {\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\n\t\t\t\t\tvar data = plugindata[\"data\"];\n\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\tcallbacks.success(data);\n\t\t\t\t\treturn;\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\t// Not a success and not an ack, must be an error\n\t\t\t\t\tif(json[\"error\"]) {\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\n\t\t\t\tcallbacks.success();\n\t\t\t};\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(\"Message sent!\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] === \"success\") {\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\t\t\tif(!plugindata) {\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\n\t\t\t\t\tvar data = plugindata[\"data\"];\n\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\tcallbacks.success(data);\n\t\t\t\t\treturn;\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\t// Not a success and not an ack, must be an error\n\t\t\t\t\tif(json[\"error\"]) {\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to send a trickle candidate\n\tfunction sendTrickleCandidate(handleId, candidate) {\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar request = { \"janus\": \"trickle\", \"candidate\": candidate, \"transaction\": Janus.randomString(12) };\n\t\tif(pluginHandle.token)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tJanus.vdebug(\"Sending trickle candidate (handle=\" + handleId + \"):\");\n\t\tJanus.vdebug(request);\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.vdebug(\"Candidate sent!\");\n\t\t\t\tJanus.vdebug(json);\n\t\t\t\tif(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to create a data channel\n\tfunction createDataChannel(handleId, dclabel, dcprotocol, incoming, pendingData) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn;\n\t\t}\n\t\tvar onDataChannelMessage = function(event) {\n\t\t\tJanus.log('Received message on data channel:', event);\n\t\t\tvar label = event.target.label;\n\t\t\tpluginHandle.ondata(event.data, label);\n\t\t};\n\t\tvar onDataChannelStateChange = function(event) {\n\t\t\tJanus.log('Received state change on data channel:', event);\n\t\t\tvar label = event.target.label;\n\t\t\tvar protocol = event.target.protocol;\n\t\t\tvar dcState = config.dataChannel[label] ? config.dataChannel[label].readyState : \"null\";\n\t\t\tJanus.log('State change on <' + label + '> data channel: ' + dcState);\n\t\t\tif(dcState === 'open') {\n\t\t\t\t// Any pending messages to send?\n\t\t\t\tif(config.dataChannel[label].pending && config.dataChannel[label].pending.length > 0) {\n\t\t\t\t\tJanus.log(\"Sending pending messages on <\" + label + \">:\", config.dataChannel[label].pending.length);\n\t\t\t\t\tfor(var data of config.dataChannel[label].pending) {\n\t\t\t\t\t\tJanus.log(\"Sending data on data channel <\" + label + \">\");\n\t\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\t\tconfig.dataChannel[label].send(data);\n\t\t\t\t\t}\n\t\t\t\t\tconfig.dataChannel[label].pending = [];\n\t\t\t\t}\n\t\t\t\t// Notify the open data channel\n\t\t\t\tpluginHandle.ondataopen(label, protocol);\n\t\t\t}\n\t\t};\n\t\tvar onDataChannelError = function(error) {\n\t\t\tJanus.error('Got error on data channel:', error);\n\t\t\t// TODO\n\t\t};\n\t\tif(!incoming) {\n\t\t\t// FIXME Add options (ordered, maxRetransmits, etc.)\n\t\t\tvar dcoptions = { ordered: true };\n\t\t\tif(dcprotocol)\n\t\t\t\tdcoptions.protocol = dcprotocol;\n\t\t\tconfig.dataChannel[dclabel] = config.pc.createDataChannel(dclabel, dcoptions);\n\t\t} else {\n\t\t\t// The channel was created by Janus\n\t\t\tconfig.dataChannel[dclabel] = incoming;\n\t\t}\n\t\tconfig.dataChannel[dclabel].onmessage = onDataChannelMessage;\n\t\tconfig.dataChannel[dclabel].onopen = onDataChannelStateChange;\n\t\tconfig.dataChannel[dclabel].onclose = onDataChannelStateChange;\n\t\tconfig.dataChannel[dclabel].onerror = onDataChannelError;\n\t\tconfig.dataChannel[dclabel].pending = [];\n\t\tif(pendingData)\n\t\t\tconfig.dataChannel[dclabel].pending.push(pendingData);\n\t}\n\n\t// Private method to send a data channel message\n\tfunction sendData(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar data = callbacks.text || callbacks.data;\n\t\tif(!data) {\n\t\t\tJanus.warn(\"Invalid data\");\n\t\t\tcallbacks.error(\"Invalid data\");\n\t\t\treturn;\n\t\t}\n\t\tvar label = callbacks.label ? callbacks.label : Janus.dataChanDefaultLabel;\n\t\tif(!config.dataChannel[label]) {\n\t\t\t// Create new data channel and wait for it to open\n\t\t\tcreateDataChannel(handleId, label, callbacks.protocol, false, data, callbacks.protocol);\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(config.dataChannel[label].readyState !== \"open\") {\n\t\t\tconfig.dataChannel[label].pending.push(data);\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tJanus.log(\"Sending data on data channel <\" + label + \">\");\n\t\tJanus.debug(data);\n\t\tconfig.dataChannel[label].send(data);\n\t\tcallbacks.success();\n\t}\n\n\t// Private method to send a DTMF tone\n\tfunction sendDtmf(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.dtmfSender) {\n\t\t\t// Create the DTMF sender the proper way, if possible\n\t\t\tif(config.pc) {\n\t\t\t\tvar senders = config.pc.getSenders();\n\t\t\t\tvar audioSender = senders.find(function(sender) {\n\t\t\t\t\treturn sender.track && sender.track.kind === 'audio';\n\t\t\t\t});\n\t\t\t\tif(!audioSender) {\n\t\t\t\t\tJanus.warn(\"Invalid DTMF configuration (no audio track)\");\n\t\t\t\t\tcallbacks.error(\"Invalid DTMF configuration (no audio track)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconfig.dtmfSender = audioSender.dtmf;\n\t\t\t\tif(config.dtmfSender) {\n\t\t\t\t\tJanus.log(\"Created DTMF Sender\");\n\t\t\t\t\tconfig.dtmfSender.ontonechange = function(tone) { Janus.debug(\"Sent DTMF tone: \" + tone.tone); };\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(!config.dtmfSender) {\n\t\t\t\tJanus.warn(\"Invalid DTMF configuration\");\n\t\t\t\tcallbacks.error(\"Invalid DTMF configuration\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tvar dtmf = callbacks.dtmf;\n\t\tif(!dtmf) {\n\t\t\tJanus.warn(\"Invalid DTMF parameters\");\n\t\t\tcallbacks.error(\"Invalid DTMF parameters\");\n\t\t\treturn;\n\t\t}\n\t\tvar tones = dtmf.tones;\n\t\tif(!tones) {\n\t\t\tJanus.warn(\"Invalid DTMF string\");\n\t\t\tcallbacks.error(\"Invalid DTMF string\");\n\t\t\treturn;\n\t\t}\n\t\tvar duration = (typeof dtmf.duration === 'number') ? dtmf.duration : 500; // We choose 500ms as the default duration for a tone\n\t\tvar gap = (typeof dtmf.gap === 'number') ? dtmf.gap : 50; // We choose 50ms as the default gap between tones\n\t\tJanus.debug(\"Sending DTMF string \" + tones + \" (duration \" + duration + \"ms, gap \" + gap + \"ms)\");\n\t\tconfig.dtmfSender.insertDTMF(tones, duration, gap);\n\t\tcallbacks.success();\n\t}\n\n\t// Private method to destroy a plugin handle\n\tfunction destroyHandle(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar noRequest = (callbacks.noRequest === true);\n\t\tJanus.log(\"Destroying handle \" + handleId + \" (only-locally=\" + noRequest + \")\");\n\t\tcleanupWebrtc(handleId);\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || pluginHandle.detached) {\n\t\t\t// Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(noRequest) {\n\t\t\t// We're only removing the handle locally\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar request = { \"janus\": \"detach\", \"transaction\": Janus.randomString(12) };\n\t\tif(pluginHandle.token)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Destroyed handle:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tdelete pluginHandles[handleId];\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\t// We cleanup anyway\n\t\t\t\tdelete pluginHandles[handleId];\n\t\t\t\tcallbacks.success();\n\t\t\t}\n\t\t});\n\t}\n\n\t// WebRTC stuff\n\tfunction streamsDone(handleId, jsep, media, callbacks, stream) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\t// Close all tracks if the given stream has been created internally\n\t\t\tif(!callbacks.stream) {\n\t\t\t\tJanus.stopAllTracks(stream);\n\t\t\t}\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tJanus.debug(\"streamsDone:\", stream);\n\t\tif(stream) {\n\t\t\tJanus.debug(\"  -- Audio tracks:\", stream.getAudioTracks());\n\t\t\tJanus.debug(\"  -- Video tracks:\", stream.getVideoTracks());\n\t\t}\n\t\t// We're now capturing the new stream: check if we're updating or if it's a new thing\n\t\tvar addTracks = false;\n\t\tif(!config.myStream || !media.update || config.streamExternal) {\n\t\t\tconfig.myStream = stream;\n\t\t\taddTracks = true;\n\t\t} else {\n\t\t\t// We only need to update the existing stream\n\t\t\tif(((!media.update && isAudioSendEnabled(media)) || (media.update && (media.addAudio || media.replaceAudio))) &&\n\t\t\t\t\tstream.getAudioTracks() && stream.getAudioTracks().length) {\n\t\t\t\tconfig.myStream.addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tif(Janus.unifiedPlan) {\n\t\t\t\t\t// Use Transceivers\n\t\t\t\t\tJanus.log((media.replaceAudio ? \"Replacing\" : \"Adding\") + \" audio track:\", stream.getAudioTracks()[0]);\n\t\t\t\t\tvar audioTransceiver = null;\n\t\t\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(audioTransceiver && audioTransceiver.sender) {\n\t\t\t\t\t\taudioTransceiver.sender.replaceTrack(stream.getAudioTracks()[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfig.pc.addTrack(stream.getAudioTracks()[0], stream);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log((media.replaceAudio ? \"Replacing\" : \"Adding\") + \" audio track:\", stream.getAudioTracks()[0]);\n\t\t\t\t\tconfig.pc.addTrack(stream.getAudioTracks()[0], stream);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(((!media.update && isVideoSendEnabled(media)) || (media.update && (media.addVideo || media.replaceVideo))) &&\n\t\t\t\t\tstream.getVideoTracks() && stream.getVideoTracks().length) {\n\t\t\t\tconfig.myStream.addTrack(stream.getVideoTracks()[0]);\n\t\t\t\tif(Janus.unifiedPlan) {\n\t\t\t\t\t// Use Transceivers\n\t\t\t\t\tJanus.log((media.replaceVideo ? \"Replacing\" : \"Adding\") + \" video track:\", stream.getVideoTracks()[0]);\n\t\t\t\t\tvar videoTransceiver = null;\n\t\t\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(videoTransceiver && videoTransceiver.sender) {\n\t\t\t\t\t\tvideoTransceiver.sender.replaceTrack(stream.getVideoTracks()[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfig.pc.addTrack(stream.getVideoTracks()[0], stream);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log((media.replaceVideo ? \"Replacing\" : \"Adding\") + \" video track:\", stream.getVideoTracks()[0]);\n\t\t\t\t\tconfig.pc.addTrack(stream.getVideoTracks()[0], stream);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// If we still need to create a PeerConnection, let's do that\n\t\tif(!config.pc) {\n\t\t\tvar pc_config = {\"iceServers\": iceServers, \"iceTransportPolicy\": iceTransportPolicy, \"bundlePolicy\": bundlePolicy};\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\n\t\t\t\t// For Chrome versions before 72, we force a plan-b semantic, and unified-plan otherwise\n\t\t\t\tpc_config[\"sdpSemantics\"] = (Janus.webRTCAdapter.browserDetails.version < 72) ? \"plan-b\" : \"unified-plan\";\n\t\t\t}\n\t\t\tvar pc_constraints = {\n\t\t\t\t\"optional\": [{\"DtlsSrtpKeyAgreement\": true}]\n\t\t\t};\n\t\t\tif(ipv6Support) {\n\t\t\t\tpc_constraints.optional.push({\"googIPv6\":true});\n\t\t\t}\n\t\t\t// Any custom constraint to add?\n\t\t\tif(callbacks.rtcConstraints && typeof callbacks.rtcConstraints === 'object') {\n\t\t\t\tJanus.debug(\"Adding custom PeerConnection constraints:\", callbacks.rtcConstraints);\n\t\t\t\tfor(var i in callbacks.rtcConstraints) {\n\t\t\t\t\tpc_constraints.optional.push(callbacks.rtcConstraints[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\n\t\t\t\t// This is Edge, enable BUNDLE explicitly\n\t\t\t\tpc_config.bundlePolicy = \"max-bundle\";\n\t\t\t}\n\t\t\t// Check if a sender or receiver transform has been provided\n\t\t\tif(RTCRtpSender && (RTCRtpSender.prototype.createEncodedStreams ||\n\t\t\t\t\t(RTCRtpSender.prototype.createEncodedAudioStreams &&\n\t\t\t\t\tRTCRtpSender.prototype.createEncodedVideoStreams)) &&\n\t\t\t\t\t(callbacks.senderTransforms || callbacks.receiverTransforms)) {\n\t\t\t\tconfig.senderTransforms = callbacks.senderTransforms;\n\t\t\t\tconfig.receiverTransforms = callbacks.receiverTransforms;\n\t\t\t\tpc_config[\"forceEncodedAudioInsertableStreams\"] = true;\n\t\t\t\tpc_config[\"forceEncodedVideoInsertableStreams\"] = true;\n\t\t\t\tpc_config[\"encodedInsertableStreams\"] = true;\n\t\t\t}\n\t\t\tJanus.log(\"Creating PeerConnection\");\n\t\t\tJanus.debug(pc_constraints);\n\t\t\tconfig.pc = new RTCPeerConnection(pc_config, pc_constraints);\n\t\t\tJanus.debug(config.pc);\n\t\t\tif(config.pc.getStats) {\t// FIXME\n\t\t\t\tconfig.volume = {};\n\t\t\t\tconfig.bitrate.value = \"0 kbits/sec\";\n\t\t\t}\n\t\t\tJanus.log(\"Preparing local SDP and gathering candidates (trickle=\" + config.trickle + \")\");\n\t\t\tconfig.pc.oniceconnectionstatechange = function(e) {\n\t\t\t\tif(config.pc)\n\t\t\t\t\tpluginHandle.iceState(config.pc.iceConnectionState);\n\t\t\t};\n\t\t\tconfig.pc.onicecandidate = function(event) {\n\t\t\t\tif (!event.candidate ||\n\t\t\t\t\t\t(Janus.webRTCAdapter.browserDetails.browser === 'edge' && event.candidate.candidate.indexOf('endOfCandidates') > 0)) {\n\t\t\t\t\tJanus.log(\"End of candidates.\");\n\t\t\t\t\tconfig.iceDone = true;\n\t\t\t\t\tif(config.trickle === true) {\n\t\t\t\t\t\t// Notify end of candidates\n\t\t\t\t\t\tsendTrickleCandidate(handleId, {\"completed\": true});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// No trickle, time to send the complete SDP (including all candidates)\n\t\t\t\t\t\tsendSDP(handleId, callbacks);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\t\tvar candidate = {\n\t\t\t\t\t\t\"candidate\": event.candidate.candidate,\n\t\t\t\t\t\t\"sdpMid\": event.candidate.sdpMid,\n\t\t\t\t\t\t\"sdpMLineIndex\": event.candidate.sdpMLineIndex\n\t\t\t\t\t};\n\t\t\t\t\tif(config.trickle === true) {\n\t\t\t\t\t\t// Send candidate\n\t\t\t\t\t\tsendTrickleCandidate(handleId, candidate);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tconfig.pc.ontrack = function(event) {\n\t\t\t\tJanus.log(\"Handling Remote Track\");\n\t\t\t\tJanus.debug(event);\n\t\t\t\tif(!event.streams)\n\t\t\t\t\treturn;\n\t\t\t\tconfig.remoteStream = event.streams[0];\n\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\tif(event.track.onended)\n\t\t\t\t\treturn;\n\t\t\t\tif(config.receiverTransforms) {\n\t\t\t\t\tvar receiverStreams = null;\n\t\t\t\t\tif(RTCRtpSender.prototype.createEncodedStreams) {\n\t\t\t\t\t\treceiverStreams = event.receiver.createEncodedStreams();\n\t\t\t\t\t} else if(RTCRtpSender.prototype.createAudioEncodedStreams || RTCRtpSender.prototype.createEncodedVideoStreams) {\n\t\t\t\t\t\tif(event.track.kind === \"audio\" && config.receiverTransforms[\"audio\"]) {\n\t\t\t\t\t\t\treceiverStreams = event.receiver.createEncodedAudioStreams();\n\t\t\t\t\t\t} else if(event.track.kind === \"video\" && config.receiverTransforms[\"video\"]) {\n\t\t\t\t\t\t\treceiverStreams = event.receiver.createEncodedVideoStreams();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(receiverStreams) {\n\t\t\t\t\t\tconsole.log(receiverStreams);\n\t\t\t\t\t\tif(receiverStreams.readableStream && receiverStreams.writableStream) {\n\t\t\t\t\t\t\treceiverStreams.readableStream\n\t\t\t\t\t\t\t\t.pipeThrough(config.receiverTransforms[event.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(receiverStreams.writableStream);\n\t\t\t\t\t\t} else if(receiverStreams.readable && receiverStreams.writable) {\n\t\t\t\t\t\t\treceiverStreams.readable\n\t\t\t\t\t\t\t\t.pipeThrough(config.receiverTransforms[event.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(receiverStreams.writable);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar trackMutedTimeoutId = null;\n\t\t\t\tJanus.log(\"Adding onended callback to track:\", event.track);\n\t\t\t\tevent.track.onended = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track removed:\", ev);\n\t\t\t\t\tif(config.remoteStream) {\n\t\t\t\t\t\tclearTimeout(trackMutedTimeoutId);\n\t\t\t\t\t\tconfig.remoteStream.removeTrack(ev.target);\n\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tevent.track.onmute = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track muted:\", ev);\n\t\t\t\t\tif(config.remoteStream && trackMutedTimeoutId == null) {\n\t\t\t\t\t\ttrackMutedTimeoutId = setTimeout(function() {\n\t\t\t\t\t\t\tJanus.log(\"Removing remote track\");\n\t\t\t\t\t\t\tif (config.remoteStream) {\n\t\t\t\t\t\t\t\tconfig.remoteStream.removeTrack(ev.target);\n\t\t\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttrackMutedTimeoutId = null;\n\t\t\t\t\t\t// Chrome seems to raise mute events only at multiples of 834ms;\n\t\t\t\t\t\t// we set the timeout to three times this value (rounded to 840ms)\n\t\t\t\t\t\t}, 3 * 840);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tevent.track.onunmute = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track flowing again:\", ev);\n\t\t\t\t\tif(trackMutedTimeoutId != null) {\n\t\t\t\t\t\tclearTimeout(trackMutedTimeoutId);\n\t\t\t\t\t\ttrackMutedTimeoutId = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconfig.remoteStream.addTrack(ev.target);\n\t\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t\tif(addTracks && stream) {\n\t\t\tJanus.log('Adding local stream');\n\t\t\tvar simulcast2 = (callbacks.simulcast2 === true);\n\t\t\tstream.getTracks().forEach(function(track) {\n\t\t\t\tJanus.log('Adding local track:', track);\n\t\t\t\tvar sender = null;\n\t\t\t\tif(!simulcast2 || track.kind === 'audio') {\n\t\t\t\t\tsender = config.pc.addTrack(track, stream);\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log('Enabling rid-based simulcasting:', track);\n\t\t\t\t\tvar maxBitrates = getMaxBitrates(callbacks.simulcastMaxBitrates);\n\t\t\t\t\tvar tr = config.pc.addTransceiver(track, {\n\t\t\t\t\t\tdirection: \"sendrecv\",\n\t\t\t\t\t\tstreams: [stream],\n\t\t\t\t\t\tsendEncodings: callbacks.sendEncodings || [\n\t\t\t\t\t\t\t{ rid: \"h\", active: true, maxBitrate: maxBitrates.high },\n\t\t\t\t\t\t\t{ rid: \"m\", active: true, maxBitrate: maxBitrates.medium, scaleResolutionDownBy: 2 },\n\t\t\t\t\t\t\t{ rid: \"l\", active: true, maxBitrate: maxBitrates.low, scaleResolutionDownBy: 4 }\n\t\t\t\t\t\t]\n\t\t\t\t\t});\n\t\t\t\t\tif(tr)\n\t\t\t\t\t\tsender = tr.sender;\n\t\t\t\t}\n\t\t\t\t// Check if insertable streams are involved\n\t\t\t\tif(sender && config.senderTransforms) {\n\t\t\t\t\tvar senderStreams = null;\n\t\t\t\t\tif(RTCRtpSender.prototype.createEncodedStreams) {\n\t\t\t\t\t\tsenderStreams = sender.createEncodedStreams();\n\t\t\t\t\t} else if(RTCRtpSender.prototype.createAudioEncodedStreams || RTCRtpSender.prototype.createEncodedVideoStreams) {\n\t\t\t\t\t\tif(sender.track.kind === \"audio\" && config.senderTransforms[\"audio\"]) {\n\t\t\t\t\t\t\tsenderStreams = sender.createEncodedAudioStreams();\n\t\t\t\t\t\t} else if(sender.track.kind === \"video\" && config.senderTransforms[\"video\"]) {\n\t\t\t\t\t\t\tsenderStreams = sender.createEncodedVideoStreams();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(senderStreams) {\n\t\t\t\t\t\tconsole.log(senderStreams);\n\t\t\t\t\t\tif(senderStreams.readableStream && senderStreams.writableStream) {\n\t\t\t\t\t\t\tsenderStreams.readableStream\n\t\t\t\t\t\t\t\t.pipeThrough(config.senderTransforms[sender.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(senderStreams.writableStream);\n\t\t\t\t\t\t} else if(senderStreams.readable && senderStreams.writable) {\n\t\t\t\t\t\t\tsenderStreams.readable\n\t\t\t\t\t\t\t\t.pipeThrough(config.senderTransforms[sender.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(senderStreams.writable);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Any data channel to create?\n\t\tif(isDataEnabled(media) && !config.dataChannel[Janus.dataChanDefaultLabel]) {\n\t\t\tJanus.log(\"Creating default data channel\");\n\t\t\tcreateDataChannel(handleId, Janus.dataChanDefaultLabel, null, false);\n\t\t\tconfig.pc.ondatachannel = function(event) {\n\t\t\t\tJanus.log(\"Data channel created by Janus:\", event);\n\t\t\t\tcreateDataChannel(handleId, event.channel.label, event.channel.protocol, event.channel);\n\t\t\t};\n\t\t}\n\t\t// If there's a new local stream, let's notify the application\n\t\tif(config.myStream) {\n\t\t\tpluginHandle.onlocalstream(config.myStream);\n\t\t}\n\t\t// Create offer/answer now\n\t\tif(!jsep) {\n\t\t\tcreateOffer(handleId, media, callbacks);\n\t\t} else {\n\t\t\tconfig.pc.setRemoteDescription(jsep)\n\t\t\t\t.then(function() {\n\t\t\t\t\tJanus.log(\"Remote description accepted!\");\n\t\t\t\t\tconfig.remoteSdp = jsep.sdp;\n\t\t\t\t\t// Any trickle candidate we cached?\n\t\t\t\t\tif(config.candidates && config.candidates.length > 0) {\n\t\t\t\t\t\tfor(var i = 0; i< config.candidates.length; i++) {\n\t\t\t\t\t\t\tvar candidate = config.candidates[i];\n\t\t\t\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t\t\t\t// end-of-candidates\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// New candidate\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconfig.candidates = [];\n\t\t\t\t\t}\n\t\t\t\t\t// Create the answer now\n\t\t\t\t\tcreateAnswer(handleId, media, callbacks);\n\t\t\t\t}, callbacks.error);\n\t\t}\n\t}\n\n\tfunction prepareWebrtc(handleId, offer, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\n\t\tvar jsep = callbacks.jsep;\n\t\tif(offer && jsep) {\n\t\t\tJanus.error(\"Provided a JSEP to a createOffer\");\n\t\t\tcallbacks.error(\"Provided a JSEP to a createOffer\");\n\t\t\treturn;\n\t\t} else if(!offer && (!jsep || !jsep.type || !jsep.sdp)) {\n\t\t\tJanus.error(\"A valid JSEP is required for createAnswer\");\n\t\t\tcallbacks.error(\"A valid JSEP is required for createAnswer\");\n\t\t\treturn;\n\t\t}\n\t\t/* Check that callbacks.media is a (not null) Object */\n\t\tcallbacks.media = (typeof callbacks.media === 'object' && callbacks.media) ? callbacks.media : { audio: true, video: true };\n\t\tvar media = callbacks.media;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tconfig.trickle = isTrickleEnabled(callbacks.trickle);\n\t\t// Are we updating a session?\n\t\tif(!config.pc) {\n\t\t\t// Nope, new PeerConnection\n\t\t\tmedia.update = false;\n\t\t\tmedia.keepAudio = false;\n\t\t\tmedia.keepVideo = false;\n\t\t} else {\n\t\t\tJanus.log(\"Updating existing media session\");\n\t\t\tmedia.update = true;\n\t\t\t// Check if there's anything to add/remove/replace, or if we\n\t\t\t// can go directly to preparing the new SDP offer or answer\n\t\t\tif(callbacks.stream) {\n\t\t\t\t// External stream: is this the same as the one we were using before?\n\t\t\t\tif(callbacks.stream !== config.myStream) {\n\t\t\t\t\tJanus.log(\"Renegotiation involves a new external stream\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Check if there are changes on audio\n\t\t\t\tif(media.addAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\tmedia.removeAudio = false;\n\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n\t\t\t\t\t\tJanus.error(\"Can't add audio stream, there already is one\");\n\t\t\t\t\t\tcallbacks.error(\"Can't add audio stream, there already is one\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if(media.removeAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\tmedia.addAudio = false;\n\t\t\t\t\tmedia.audioSend = false;\n\t\t\t\t} else if(media.replaceAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.addAudio = false;\n\t\t\t\t\tmedia.removeAudio = false;\n\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t}\n\t\t\t\tif(!config.myStream) {\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\tif(media.replaceAudio) {\n\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\t}\n\t\t\t\t\tif(isAudioSendEnabled(media)) {\n\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n\t\t\t\t\t\t// No audio track: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\t\tif(media.replaceAudio) {\n\t\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(isAudioSendEnabled(media)) {\n\t\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We have an audio track: should we keep it as it is?\n\t\t\t\t\t\tif(isAudioSendEnabled(media) &&\n\t\t\t\t\t\t\t\t!media.removeAudio && !media.replaceAudio) {\n\t\t\t\t\t\t\tmedia.keepAudio = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Check if there are changes on video\n\t\t\t\tif(media.addVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\tmedia.removeVideo = false;\n\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n\t\t\t\t\t\tJanus.error(\"Can't add video stream, there already is one\");\n\t\t\t\t\t\tcallbacks.error(\"Can't add video stream, there already is one\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if(media.removeVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\tmedia.addVideo = false;\n\t\t\t\t\tmedia.videoSend = false;\n\t\t\t\t} else if(media.replaceVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.addVideo = false;\n\t\t\t\t\tmedia.removeVideo = false;\n\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t}\n\t\t\t\tif(!config.myStream) {\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\tif(media.replaceVideo) {\n\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\t}\n\t\t\t\t\tif(isVideoSendEnabled(media)) {\n\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n\t\t\t\t\t\t// No video track: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\t\tif(media.replaceVideo) {\n\t\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(isVideoSendEnabled(media)) {\n\t\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We have a video track: should we keep it as it is?\n\t\t\t\t\t\tif(isVideoSendEnabled(media) && !media.removeVideo && !media.replaceVideo) {\n\t\t\t\t\t\t\tmedia.keepVideo = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Data channels can only be added\n\t\t\t\tif(media.addData) {\n\t\t\t\t\tmedia.data = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If we're updating and keeping all tracks, let's skip the getUserMedia part\n\t\t\tif((isAudioSendEnabled(media) && media.keepAudio) &&\n\t\t\t\t\t(isVideoSendEnabled(media) && media.keepVideo)) {\n\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, config.myStream);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t// If we're updating, check if we need to remove/replace one of the tracks\n\t\tif(media.update && !config.streamExternal) {\n\t\t\tif(media.removeAudio || media.replaceAudio) {\n\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n\t\t\t\t\tvar at = config.myStream.getAudioTracks()[0];\n\t\t\t\t\tJanus.log(\"Removing audio track:\", at);\n\t\t\t\t\tconfig.myStream.removeTrack(at);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tat.stop();\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t}\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\n\t\t\t\t\tvar ra = true;\n\t\t\t\t\tif(media.replaceAudio && Janus.unifiedPlan) {\n\t\t\t\t\t\t// We can use replaceTrack\n\t\t\t\t\t\tra = false;\n\t\t\t\t\t}\n\t\t\t\t\tif(ra) {\n\t\t\t\t\t\tfor(var asnd of config.pc.getSenders()) {\n\t\t\t\t\t\t\tif(asnd && asnd.track && asnd.track.kind === \"audio\") {\n\t\t\t\t\t\t\t\tJanus.log(\"Removing audio sender:\", asnd);\n\t\t\t\t\t\t\t\tconfig.pc.removeTrack(asnd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(media.removeVideo || media.replaceVideo) {\n\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n\t\t\t\t\tvar vt = config.myStream.getVideoTracks()[0];\n\t\t\t\t\tJanus.log(\"Removing video track:\", vt);\n\t\t\t\t\tconfig.myStream.removeTrack(vt);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvt.stop();\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t}\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\n\t\t\t\t\tvar rv = true;\n\t\t\t\t\tif(media.replaceVideo && Janus.unifiedPlan) {\n\t\t\t\t\t\t// We can use replaceTrack\n\t\t\t\t\t\trv = false;\n\t\t\t\t\t}\n\t\t\t\t\tif(rv) {\n\t\t\t\t\t\tfor(var vsnd of config.pc.getSenders()) {\n\t\t\t\t\t\t\tif(vsnd && vsnd.track && vsnd.track.kind === \"video\") {\n\t\t\t\t\t\t\t\tJanus.log(\"Removing video sender:\", vsnd);\n\t\t\t\t\t\t\t\tconfig.pc.removeTrack(vsnd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Was a MediaStream object passed, or do we need to take care of that?\n\t\tif(callbacks.stream) {\n\t\t\tvar stream = callbacks.stream;\n\t\t\tJanus.log(\"MediaStream provided by the application\");\n\t\t\tJanus.debug(stream);\n\t\t\t// If this is an update, let's check if we need to release the previous stream\n\t\t\tif(media.update) {\n\t\t\t\tif(config.myStream && config.myStream !== callbacks.stream && !config.streamExternal) {\n\t\t\t\t\t// We're replacing a stream we captured ourselves with an external one\n\t\t\t\t\tJanus.stopAllTracks(config.myStream);\n\t\t\t\t\tconfig.myStream = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Skip the getUserMedia part\n\t\t\tconfig.streamExternal = true;\n\t\t\tpluginHandle.consentDialog(false);\n\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\treturn;\n\t\t}\n\t\tif(isAudioSendEnabled(media) || isVideoSendEnabled(media)) {\n\t\t\tif(!Janus.isGetUserMediaAvailable()) {\n\t\t\t\tcallbacks.error(\"getUserMedia not available\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar constraints = { mandatory: {}, optional: []};\n\t\t\tpluginHandle.consentDialog(true);\n\t\t\tvar audioSupport = isAudioSendEnabled(media);\n\t\t\tif(audioSupport && media && typeof media.audio === 'object')\n\t\t\t\taudioSupport = media.audio;\n\t\t\tvar videoSupport = isVideoSendEnabled(media);\n\t\t\tif(videoSupport && media) {\n\t\t\t\tvar simulcast = (callbacks.simulcast === true);\n\t\t\t\tvar simulcast2 = (callbacks.simulcast2 === true);\n\t\t\t\tif((simulcast || simulcast2) && !jsep && !media.video)\n\t\t\t\t\tmedia.video = \"hires\";\n\t\t\t\tif(media.video && media.video != 'screen' && media.video != 'window') {\n\t\t\t\t\tif(typeof media.video === 'object') {\n\t\t\t\t\t\tvideoSupport = media.video;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar width = 0;\n\t\t\t\t\t\tvar height = 0, maxHeight = 0;\n\t\t\t\t\t\tif(media.video === 'lowres') {\n\t\t\t\t\t\t\t// Small resolution, 4:3\n\t\t\t\t\t\t\theight = 240;\n\t\t\t\t\t\t\tmaxHeight = 240;\n\t\t\t\t\t\t\twidth = 320;\n\t\t\t\t\t\t} else if(media.video === 'lowres-16:9') {\n\t\t\t\t\t\t\t// Small resolution, 16:9\n\t\t\t\t\t\t\theight = 180;\n\t\t\t\t\t\t\tmaxHeight = 180;\n\t\t\t\t\t\t\twidth = 320;\n\t\t\t\t\t\t} else if(media.video === 'hires' || media.video === 'hires-16:9' || media.video === 'hdres') {\n\t\t\t\t\t\t\t// High(HD) resolution is only 16:9\n\t\t\t\t\t\t\theight = 720;\n\t\t\t\t\t\t\tmaxHeight = 720;\n\t\t\t\t\t\t\twidth = 1280;\n\t\t\t\t\t\t} else if(media.video === 'fhdres') {\n\t\t\t\t\t\t\t// Full HD resolution is only 16:9\n\t\t\t\t\t\t\theight = 1080;\n\t\t\t\t\t\t\tmaxHeight = 1080;\n\t\t\t\t\t\t\twidth = 1920;\n\t\t\t\t\t\t} else if(media.video === '4kres') {\n\t\t\t\t\t\t\t// 4K resolution is only 16:9\n\t\t\t\t\t\t\theight = 2160;\n\t\t\t\t\t\t\tmaxHeight = 2160;\n\t\t\t\t\t\t\twidth = 3840;\n\t\t\t\t\t\t} else if(media.video === 'stdres') {\n\t\t\t\t\t\t\t// Normal resolution, 4:3\n\t\t\t\t\t\t\theight = 480;\n\t\t\t\t\t\t\tmaxHeight = 480;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t} else if(media.video === 'stdres-16:9') {\n\t\t\t\t\t\t\t// Normal resolution, 16:9\n\t\t\t\t\t\t\theight = 360;\n\t\t\t\t\t\t\tmaxHeight = 360;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tJanus.log(\"Default video setting is stdres 4:3\");\n\t\t\t\t\t\t\theight = 480;\n\t\t\t\t\t\t\tmaxHeight = 480;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Adding media constraint:\", media.video);\n\t\t\t\t\t\tvideoSupport = {\n\t\t\t\t\t\t\t'height': {'ideal': height},\n\t\t\t\t\t\t\t'width': {'ideal': width}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tJanus.log(\"Adding video constraint:\", videoSupport);\n\t\t\t\t\t}\n\t\t\t\t} else if(media.video === 'screen' || media.video === 'window') {\n\t\t\t\t\tif(navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n\t\t\t\t\t\t// The new experimental getDisplayMedia API is available, let's use that\n\t\t\t\t\t\t// https://groups.google.com/forum/#!topic/discuss-webrtc/Uf0SrR4uxzk\n\t\t\t\t\t\t// https://webrtchacks.com/chrome-screensharing-getdisplaymedia/\n\t\t\t\t\t\tconstraints.video = {};\n\t\t\t\t\t\tif(media.screenshareFrameRate) {\n\t\t\t\t\t\t\tconstraints.video.frameRate = media.screenshareFrameRate;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(media.screenshareHeight) {\n\t\t\t\t\t\t\tconstraints.video.height = media.screenshareHeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(media.screenshareWidth) {\n\t\t\t\t\t\t\tconstraints.video.width = media.screenshareWidth;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconstraints.audio = media.captureDesktopAudio;\n\t\t\t\t\t\tnavigator.mediaDevices.getDisplayMedia(constraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tif(isAudioSendEnabled(media) && !media.keepAudio) {\n\t\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false })\n\t\t\t\t\t\t\t\t\t.then(function (audioStream) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// We're going to try and use the extension for Chrome 34+, the old approach\n\t\t\t\t\t// for older versions of Chrome, or the experimental support in Firefox 33+\n\t\t\t\t\tfunction callbackUserMedia (error, stream) {\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\tif(error) {\n\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfunction getScreenMedia(constraints, gsmCallback, useAudio) {\n\t\t\t\t\t\tJanus.log(\"Adding media constraint (screen capture)\");\n\t\t\t\t\t\tJanus.debug(constraints);\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tif(useAudio) {\n\t\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false })\n\t\t\t\t\t\t\t\t\t.then(function (audioStream) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(function(error) { pluginHandle.consentDialog(false); gsmCallback(error); });\n\t\t\t\t\t}\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\n\t\t\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\n\t\t\t\t\t\tvar maxver = 33;\n\t\t\t\t\t\tif(window.navigator.userAgent.match('Linux'))\n\t\t\t\t\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\n\t\t\t\t\t\tif(chromever >= 26 && chromever <= maxver) {\n\t\t\t\t\t\t\t// Chrome 26->33 requires some awkward chrome://flags manipulation\n\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\t\tgoogLeakyBucket: true,\n\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\n\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\n\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'screen'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media) && !media.keepAudio\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tgetScreenMedia(constraints, callbackUserMedia);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Chrome 34+ requires an extension\n\t\t\t\t\t\t\tJanus.extension.getScreen(function (error, sourceId) {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\t\treturn callbacks.error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\n\t\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\n\t\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\toptional: [\n\t\t\t\t\t\t\t\t\t\t\t{googLeakyBucket: true},\n\t\t\t\t\t\t\t\t\t\t\t{googTemporalLayeredScreencast: true}\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tconstraints.video.mandatory.chromeMediaSourceId = sourceId;\n\t\t\t\t\t\t\t\tgetScreenMedia(constraints, callbackUserMedia,\n\t\t\t\t\t\t\t\t\tisAudioSendEnabled(media) && !media.keepAudio);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.version >= 33) {\n\t\t\t\t\t\t\t// Firefox 33+ has experimental support for screen sharing\n\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\tmozMediaSource: media.video,\n\t\t\t\t\t\t\t\t\tmediaSource: media.video\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media) && !media.keepAudio\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tgetScreenMedia(constraints, function (err, stream) {\n\t\t\t\t\t\t\t\tcallbackUserMedia(err, stream);\n\t\t\t\t\t\t\t\t// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=1045810\n\t\t\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\t\tvar lastTime = stream.currentTime;\n\t\t\t\t\t\t\t\t\tvar polly = window.setInterval(function () {\n\t\t\t\t\t\t\t\t\t\tif(!stream)\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\n\t\t\t\t\t\t\t\t\t\tif(stream.currentTime == lastTime) {\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\n\t\t\t\t\t\t\t\t\t\t\tif(stream.onended) {\n\t\t\t\t\t\t\t\t\t\t\t\tstream.onended();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tlastTime = stream.currentTime;\n\t\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\t\t\t\t\terror.name = 'Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)';\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If we got here, we're not screensharing\n\t\t\tif(!media || media.video !== 'screen') {\n\t\t\t\t// Check whether all media sources are actually available or not\n\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\n\t\t\t\t\tvar audioExist = devices.some(function(device) {\n\t\t\t\t\t\treturn device.kind === 'audioinput';\n\t\t\t\t\t}),\n\t\t\t\t\tvideoExist = isScreenSendEnabled(media) || devices.some(function(device) {\n\t\t\t\t\t\treturn device.kind === 'videoinput';\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check whether a missing device is really a problem\n\t\t\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\t\t\tvar needAudioDevice = isAudioSendRequired(media);\n\t\t\t\t\tvar needVideoDevice = isVideoSendRequired(media);\n\t\t\t\t\tif(audioSend || videoSend || needAudioDevice || needVideoDevice) {\n\t\t\t\t\t\t// We need to send either audio or video\n\t\t\t\t\t\tvar haveAudioDevice = audioSend ? audioExist : false;\n\t\t\t\t\t\tvar haveVideoDevice = videoSend ? videoExist : false;\n\t\t\t\t\t\tif(!haveAudioDevice && !haveVideoDevice) {\n\t\t\t\t\t\t\t// FIXME Should we really give up, or just assume recvonly for both?\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('No capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else if(!haveAudioDevice && needAudioDevice) {\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('Audio capture is required, but no capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else if(!haveVideoDevice && needVideoDevice) {\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('Video capture is required, but no capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar gumConstraints = {\n\t\t\t\t\t\taudio: (audioExist && !media.keepAudio) ? audioSupport : false,\n\t\t\t\t\t\tvideo: (videoExist && !media.keepVideo) ? videoSupport : false\n\t\t\t\t\t};\n\t\t\t\t\tJanus.debug(\"getUserMedia constraints\", gumConstraints);\n\t\t\t\t\tif (!gumConstraints.audio && !gumConstraints.video) {\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(gumConstraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t}).catch(function(error) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tcallbacks.error({code: error.code, name: error.name, message: error.message});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t// No need to do a getUserMedia, create offer/answer right away\n\t\t\tstreamsDone(handleId, jsep, media, callbacks);\n\t\t}\n\t}\n\n\tfunction prepareWebrtcPeer(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\n\t\tvar jsep = callbacks.jsep;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(jsep) {\n\t\t\tif(!config.pc) {\n\t\t\t\tJanus.warn(\"Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep\");\n\t\t\t\tcallbacks.error(\"No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconfig.pc.setRemoteDescription(jsep)\n\t\t\t\t.then(function() {\n\t\t\t\t\tJanus.log(\"Remote description accepted!\");\n\t\t\t\t\tconfig.remoteSdp = jsep.sdp;\n\t\t\t\t\t// Any trickle candidate we cached?\n\t\t\t\t\tif(config.candidates && config.candidates.length > 0) {\n\t\t\t\t\t\tfor(var i = 0; i< config.candidates.length; i++) {\n\t\t\t\t\t\t\tvar candidate = config.candidates[i];\n\t\t\t\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t\t\t\t// end-of-candidates\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// New candidate\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconfig.candidates = [];\n\t\t\t\t\t}\n\t\t\t\t\t// Done\n\t\t\t\t\tcallbacks.success();\n\t\t\t\t}, callbacks.error);\n\t\t} else {\n\t\t\tcallbacks.error(\"Invalid JSEP\");\n\t\t}\n\t}\n\n\tfunction createOffer(handleId, media, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.customizeSdp = (typeof callbacks.customizeSdp == \"function\") ? callbacks.customizeSdp : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar simulcast = (callbacks.simulcast === true);\n\t\tif(!simulcast) {\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \")\");\n\t\t} else {\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\n\t\t}\n\t\t// https://code.google.com/p/webrtc/issues/detail?id=3508\n\t\tvar mediaConstraints = {};\n\t\tif(Janus.unifiedPlan) {\n\t\t\t// We can use Transceivers\n\t\t\tvar audioTransceiver = null, videoTransceiver = null;\n\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\tif(!audioTransceiver) {\n\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\tif(!videoTransceiver) {\n\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle audio (and related changes, if any)\n\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\tvar audioRecv = isAudioRecvEnabled(media);\n\t\t\tif(!audioSend && !audioRecv) {\n\t\t\t\t// Audio disabled: have we removed it?\n\t\t\t\tif(media.removeAudio && audioTransceiver) {\n\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\taudioTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\taudioTransceiver.direction = \"inactive\";\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Setting audio transceiver to inactive:\", audioTransceiver);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of audio m-line\n\t\t\t\tif(audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendrecv:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(audioSend && !audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendonly:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(!audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to recvonly:\", audioTransceiver);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\taudioTransceiver = config.pc.addTransceiver(\"audio\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly audio transceiver:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle video (and related changes, if any)\n\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\tvar videoRecv = isVideoRecvEnabled(media);\n\t\t\tif(!videoSend && !videoRecv) {\n\t\t\t\t// Video disabled: have we removed it?\n\t\t\t\tif(media.removeVideo && videoTransceiver) {\n\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\tvideoTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvideoTransceiver.direction = \"inactive\";\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Setting video transceiver to inactive:\", videoTransceiver);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of video m-line\n\t\t\t\tif(videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendrecv:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(videoSend && !videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendonly:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(!videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to recvonly:\", videoTransceiver);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\tvideoTransceiver = config.pc.addTransceiver(\"video\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly video transceiver:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tmediaConstraints[\"offerToReceiveAudio\"] = isAudioRecvEnabled(media);\n\t\t\tmediaConstraints[\"offerToReceiveVideo\"] = isVideoRecvEnabled(media);\n\t\t}\n\t\tvar iceRestart = (callbacks.iceRestart === true);\n\t\tif(iceRestart) {\n\t\t\tmediaConstraints[\"iceRestart\"] = true;\n\t\t}\n\t\tJanus.debug(mediaConstraints);\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\n\t\tvar sendVideo = isVideoSendEnabled(media);\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\n\t\t\tvar sender = config.pc.getSenders().find(function(s) {return s.track.kind === \"video\"});\n\t\t\tif(sender) {\n\t\t\t\tvar parameters = sender.getParameters();\n\t\t\t\tif(!parameters) {\n\t\t\t\t\tparameters = {};\n\t\t\t\t}\n\t\t\t\tvar maxBitrates = getMaxBitrates(callbacks.simulcastMaxBitrates);\n\t\t\t\tparameters.encodings = callbacks.sendEncodings || [\n\t\t\t\t\t{ rid: \"h\", active: true, maxBitrate: maxBitrates.high },\n\t\t\t\t\t{ rid: \"m\", active: true, maxBitrate: maxBitrates.medium, scaleResolutionDownBy: 2 },\n\t\t\t\t\t{ rid: \"l\", active: true, maxBitrate: maxBitrates.low, scaleResolutionDownBy: 4 }\n\t\t\t\t];\n\t\t\t\tsender.setParameters(parameters);\n\t\t\t}\n\t\t}\n\t\tconfig.pc.createOffer(mediaConstraints)\n\t\t\t.then(function(offer) {\n\t\t\t\tJanus.debug(offer);\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\tvar jsep = {\n\t\t\t\t\t\"type\": offer.type,\n\t\t\t\t\t\"sdp\": offer.sdp\n\t\t\t\t};\n\t\t\t\tcallbacks.customizeSdp(jsep);\n\t\t\t\toffer.sdp = jsep.sdp;\n\t\t\t\tJanus.log(\"Setting local description\");\n\t\t\t\tif(sendVideo && simulcast) {\n\t\t\t\t\t// This SDP munging only works with Chrome (Safari STP may support it too)\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\" ||\n\t\t\t\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"safari\") {\n\t\t\t\t\t\tJanus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\n\t\t\t\t\t\toffer.sdp = mungeSdpForSimulcasting(offer.sdp);\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconfig.mySdp = offer.sdp;\n\t\t\t\tconfig.pc.setLocalDescription(offer)\n\t\t\t\t\t.catch(callbacks.error);\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\n\t\t\t\tif(!config.iceDone && !config.trickle) {\n\t\t\t\t\t// Don't do anything until we have all candidates\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If transforms are present, notify Janus that the media is end-to-end encrypted\n\t\t\t\tif(config.senderTransforms || config.receiverTransforms) {\n\t\t\t\t\toffer[\"e2ee\"] = true;\n\t\t\t\t}\n\t\t\t\tcallbacks.success(offer);\n\t\t\t}, callbacks.error);\n\t}\n\n\tfunction createAnswer(handleId, media, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.customizeSdp = (typeof callbacks.customizeSdp == \"function\") ? callbacks.customizeSdp : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar simulcast = (callbacks.simulcast === true);\n\t\tif(!simulcast) {\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \")\");\n\t\t} else {\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\n\t\t}\n\t\tvar mediaConstraints = null;\n\t\tif(Janus.unifiedPlan) {\n\t\t\t// We can use Transceivers\n\t\t\tmediaConstraints = {};\n\t\t\tvar audioTransceiver = null, videoTransceiver = null;\n\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\tif(!audioTransceiver)\n\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\tif(!videoTransceiver)\n\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle audio (and related changes, if any)\n\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\tvar audioRecv = isAudioRecvEnabled(media);\n\t\t\tif(!audioSend && !audioRecv) {\n\t\t\t\t// Audio disabled: have we removed it?\n\t\t\t\tif(media.removeAudio && audioTransceiver) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"inactive\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to inactive:\", audioTransceiver);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of audio m-line\n\t\t\t\tif(audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendrecv:\", audioTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(audioSend && !audioRecv) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendonly:\", audioTransceiver);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t} else if(!audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to recvonly:\", audioTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\taudioTransceiver = config.pc.addTransceiver(\"audio\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly audio transceiver:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle video (and related changes, if any)\n\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\tvar videoRecv = isVideoRecvEnabled(media);\n\t\t\tif(!videoSend && !videoRecv) {\n\t\t\t\t// Video disabled: have we removed it?\n\t\t\t\tif(media.removeVideo && videoTransceiver) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"inactive\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to inactive:\", videoTransceiver);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of video m-line\n\t\t\t\tif(videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendrecv:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(videoSend && !videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendonly:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(!videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to recvonly:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\tvideoTransceiver = config.pc.addTransceiver(\"video\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly video transceiver:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"firefox\" || Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\n\t\t\t\tmediaConstraints = {\n\t\t\t\t\tofferToReceiveAudio: isAudioRecvEnabled(media),\n\t\t\t\t\tofferToReceiveVideo: isVideoRecvEnabled(media)\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tmediaConstraints = {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tOfferToReceiveAudio: isAudioRecvEnabled(media),\n\t\t\t\t\t\tOfferToReceiveVideo: isVideoRecvEnabled(media)\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tJanus.debug(mediaConstraints);\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\n\t\tvar sendVideo = isVideoSendEnabled(media);\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\n\t\t\tvar sender = config.pc.getSenders()[1];\n\t\t\tJanus.log(sender);\n\t\t\tvar parameters = sender.getParameters();\n\t\t\tJanus.log(parameters);\n\n\t\t\tvar maxBitrates = getMaxBitrates(callbacks.simulcastMaxBitrates);\n\t\t\tsender.setParameters({encodings: callbacks.sendEncodings || [\n\t\t\t\t{ rid: \"h\", active: true, maxBitrate: maxBitrates.high },\n\t\t\t\t{ rid: \"m\", active: true, maxBitrate: maxBitrates.medium, scaleResolutionDownBy: 2},\n\t\t\t\t{ rid: \"l\", active: true, maxBitrate: maxBitrates.low, scaleResolutionDownBy: 4}\n\t\t\t]});\n\t\t}\n\t\tconfig.pc.createAnswer(mediaConstraints)\n\t\t\t.then(function(answer) {\n\t\t\t\tJanus.debug(answer);\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\tvar jsep = {\n\t\t\t\t\t\"type\": answer.type,\n\t\t\t\t\t\"sdp\": answer.sdp\n\t\t\t\t};\n\t\t\t\tcallbacks.customizeSdp(jsep);\n\t\t\t\tanswer.sdp = jsep.sdp;\n\t\t\t\tJanus.log(\"Setting local description\");\n\t\t\t\tif(sendVideo && simulcast) {\n\t\t\t\t\t// This SDP munging only works with Chrome\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\n\t\t\t\t\t\t// FIXME Apparently trying to simulcast when answering breaks video in Chrome...\n\t\t\t\t\t\t//~ Janus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\n\t\t\t\t\t\t//~ answer.sdp = mungeSdpForSimulcasting(answer.sdp);\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is an answer, and video breaks in Chrome if we enable it\");\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconfig.mySdp = answer.sdp;\n\t\t\t\tconfig.pc.setLocalDescription(answer)\n\t\t\t\t\t.catch(callbacks.error);\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\n\t\t\t\tif(!config.iceDone && !config.trickle) {\n\t\t\t\t\t// Don't do anything until we have all candidates\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If transforms are present, notify Janus that the media is end-to-end encrypted\n\t\t\t\tif(config.senderTransforms || config.receiverTransforms) {\n\t\t\t\t\tanswer[\"e2ee\"] = true;\n\t\t\t\t}\n\t\t\t\tcallbacks.success(answer);\n\t\t\t}, callbacks.error);\n\t}\n\n\tfunction sendSDP(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle, not sending anything\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tJanus.log(\"Sending offer/answer SDP...\");\n\t\tif(!config.mySdp) {\n\t\t\tJanus.warn(\"Local SDP instance is invalid, not sending anything...\");\n\t\t\treturn;\n\t\t}\n\t\tconfig.mySdp = {\n\t\t\t\"type\": config.pc.localDescription.type,\n\t\t\t\"sdp\": config.pc.localDescription.sdp\n\t\t};\n\t\tif(config.trickle === false)\n\t\t\tconfig.mySdp[\"trickle\"] = false;\n\t\tJanus.debug(callbacks);\n\t\tconfig.sdpSent = true;\n\t\tcallbacks.success(config.mySdp);\n\t}\n\n\tfunction getVolume(handleId, remote) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn 0;\n\t\t}\n\t\tvar stream = remote ? \"remote\" : \"local\";\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.volume[stream])\n\t\t\tconfig.volume[stream] = { value: 0 };\n\t\t// Start getting the volume, if audioLevel in getStats is supported (apparently\n\t\t// they're only available in Chrome/Safari right now: https://webrtc-stats.callstats.io/)\n\t\tif(config.pc.getStats && (Janus.webRTCAdapter.browserDetails.browser === \"chrome\" ||\n\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"safari\")) {\n\t\t\tif(remote && !config.remoteStream) {\n\t\t\t\tJanus.warn(\"Remote stream unavailable\");\n\t\t\t\treturn 0;\n\t\t\t} else if(!remote && !config.myStream) {\n\t\t\t\tJanus.warn(\"Local stream unavailable\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(!config.volume[stream].timer) {\n\t\t\t\tJanus.log(\"Starting \" + stream + \" volume monitor\");\n\t\t\t\tconfig.volume[stream].timer = setInterval(function() {\n\t\t\t\t\tconfig.pc.getStats()\n\t\t\t\t\t\t.then(function(stats) {\n\t\t\t\t\t\t\tstats.forEach(function (res) {\n\t\t\t\t\t\t\t\tif(!res || res.kind !== \"audio\")\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\tif((remote && !res.remoteSource) || (!remote && res.type !== \"media-source\"))\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\tconfig.volume[stream].value = (res.audioLevel ? res.audioLevel : 0);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}, 200);\n\t\t\t\treturn 0;\t// We don't have a volume to return yet\n\t\t\t}\n\t\t\treturn config.volume[stream].value;\n\t\t} else {\n\t\t\t// audioInputLevel and audioOutputLevel seem only available in Chrome? audioLevel\n\t\t\t// seems to be available on Chrome and Firefox, but they don't seem to work\n\t\t\tJanus.warn(\"Getting the \" + stream + \" volume unsupported by browser\");\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tfunction isMuted(handleId, video) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn true;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn true;\n\t\t}\n\t\tif(!config.myStream) {\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\n\t\t\treturn true;\n\t\t}\n\t\tif(video) {\n\t\t\t// Check video track\n\t\t\tif(!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No video track\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn !config.myStream.getVideoTracks()[0].enabled;\n\t\t} else {\n\t\t\t// Check audio track\n\t\t\tif(!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No audio track\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn !config.myStream.getAudioTracks()[0].enabled;\n\t\t}\n\t}\n\n\tfunction mute(handleId, video, mute) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn false;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn false;\n\t\t}\n\t\tif(!config.myStream) {\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\n\t\t\treturn false;\n\t\t}\n\t\tif(video) {\n\t\t\t// Mute/unmute video track\n\t\t\tif(!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No video track\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconfig.myStream.getVideoTracks()[0].enabled = !mute;\n\t\t\treturn true;\n\t\t} else {\n\t\t\t// Mute/unmute audio track\n\t\t\tif(!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No audio track\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconfig.myStream.getAudioTracks()[0].enabled = !mute;\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tfunction getBitrate(handleId) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn \"Invalid handle\";\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc)\n\t\t\treturn \"Invalid PeerConnection\";\n\t\t// Start getting the bitrate, if getStats is supported\n\t\tif(config.pc.getStats) {\n\t\t\tif(!config.bitrate.timer) {\n\t\t\t\tJanus.log(\"Starting bitrate timer (via getStats)\");\n\t\t\t\tconfig.bitrate.timer = setInterval(function() {\n\t\t\t\t\tconfig.pc.getStats()\n\t\t\t\t\t\t.then(function(stats) {\n\t\t\t\t\t\t\tstats.forEach(function (res) {\n\t\t\t\t\t\t\t\tif(!res)\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\tvar inStats = false;\n\t\t\t\t\t\t\t\t// Check if these are statistics on incoming media\n\t\t\t\t\t\t\t\tif((res.mediaType === \"video\" || res.id.toLowerCase().indexOf(\"video\") > -1) &&\n\t\t\t\t\t\t\t\t\t\tres.type === \"inbound-rtp\" && res.id.indexOf(\"rtcp\") < 0) {\n\t\t\t\t\t\t\t\t\t// New stats\n\t\t\t\t\t\t\t\t\tinStats = true;\n\t\t\t\t\t\t\t\t} else if(res.type == 'ssrc' && res.bytesReceived &&\n\t\t\t\t\t\t\t\t\t\t(res.googCodecName === \"VP8\" || res.googCodecName === \"\")) {\n\t\t\t\t\t\t\t\t\t// Older Chromer versions\n\t\t\t\t\t\t\t\t\tinStats = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Parse stats now\n\t\t\t\t\t\t\t\tif(inStats) {\n\t\t\t\t\t\t\t\t\tconfig.bitrate.bsnow = res.bytesReceived;\n\t\t\t\t\t\t\t\t\tconfig.bitrate.tsnow = res.timestamp;\n\t\t\t\t\t\t\t\t\tif(config.bitrate.bsbefore === null || config.bitrate.tsbefore === null) {\n\t\t\t\t\t\t\t\t\t\t// Skip this round\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Calculate bitrate\n\t\t\t\t\t\t\t\t\t\tvar timePassed = config.bitrate.tsnow - config.bitrate.tsbefore;\n\t\t\t\t\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"safari\")\n\t\t\t\t\t\t\t\t\t\t\ttimePassed = timePassed/1000;\t// Apparently the timestamp is in microseconds, in Safari\n\t\t\t\t\t\t\t\t\t\tvar bitRate = Math.round((config.bitrate.bsnow - config.bitrate.bsbefore) * 8 / timePassed);\n\t\t\t\t\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"safari\")\n\t\t\t\t\t\t\t\t\t\t\tbitRate = parseInt(bitRate/1000);\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.value = bitRate + ' kbits/sec';\n\t\t\t\t\t\t\t\t\t\t//~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t\treturn \"0 kbits/sec\";\t// We don't have a bitrate value yet\n\t\t\t}\n\t\t\treturn config.bitrate.value;\n\t\t} else {\n\t\t\tJanus.warn(\"Getting the video bitrate unsupported by browser\");\n\t\t\treturn \"Feature unsupported by browser\";\n\t\t}\n\t}\n\n\tfunction webrtcError(error) {\n\t\tJanus.error(\"WebRTC error:\", error);\n\t}\n\n\tfunction cleanupWebrtc(handleId, hangupRequest) {\n\t\tJanus.log(\"Cleaning WebRTC stuff\");\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle) {\n\t\t\t// Nothing to clean\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(config) {\n\t\t\tif(hangupRequest === true) {\n\t\t\t\t// Send a hangup request (we don't really care about the response)\n\t\t\t\tvar request = { \"janus\": \"hangup\", \"transaction\": Janus.randomString(12) };\n\t\t\t\tif(pluginHandle.token)\n\t\t\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\t\t\tif(apisecret)\n\t\t\t\t\trequest[\"apisecret\"] = apisecret;\n\t\t\t\tJanus.debug(\"Sending hangup request (handle=\" + handleId + \"):\");\n\t\t\t\tJanus.debug(request);\n\t\t\t\tif(websockets) {\n\t\t\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t\t} else {\n\t\t\t\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\t\t\t\tverb: 'POST',\n\t\t\t\t\t\twithCredentials: withCredentials,\n\t\t\t\t\t\tbody: request\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Cleanup stack\n\t\t\tconfig.remoteStream = null;\n\t\t\tif(config.volume) {\n\t\t\t\tif(config.volume[\"local\"] && config.volume[\"local\"].timer)\n\t\t\t\t\tclearInterval(config.volume[\"local\"].timer);\n\t\t\t\tif(config.volume[\"remote\"] && config.volume[\"remote\"].timer)\n\t\t\t\t\tclearInterval(config.volume[\"remote\"].timer);\n\t\t\t}\n\t\t\tconfig.volume = {};\n\t\t\tif(config.bitrate.timer)\n\t\t\t\tclearInterval(config.bitrate.timer);\n\t\t\tconfig.bitrate.timer = null;\n\t\t\tconfig.bitrate.bsnow = null;\n\t\t\tconfig.bitrate.bsbefore = null;\n\t\t\tconfig.bitrate.tsnow = null;\n\t\t\tconfig.bitrate.tsbefore = null;\n\t\t\tconfig.bitrate.value = null;\n\t\t\tif(!config.streamExternal && config.myStream) {\n\t\t\t\tJanus.log(\"Stopping local stream tracks\");\n\t\t\t\tJanus.stopAllTracks(config.myStream);\n\t\t\t}\n\t\t\tconfig.streamExternal = false;\n\t\t\tconfig.myStream = null;\n\t\t\t// Close PeerConnection\n\t\t\ttry {\n\t\t\t\tconfig.pc.close();\n\t\t\t} catch(e) {\n\t\t\t\t// Do nothing\n\t\t\t}\n\t\t\tconfig.pc = null;\n\t\t\tconfig.candidates = null;\n\t\t\tconfig.mySdp = null;\n\t\t\tconfig.remoteSdp = null;\n\t\t\tconfig.iceDone = false;\n\t\t\tconfig.dataChannel = {};\n\t\t\tconfig.dtmfSender = null;\n\t\t\tconfig.senderTransforms = null;\n\t\t\tconfig.receiverTransforms = null;\n\t\t}\n\t\tpluginHandle.oncleanup();\n\t}\n\n\t// Helper method to munge an SDP to enable simulcasting (Chrome only)\n\tfunction mungeSdpForSimulcasting(sdp) {\n\t\t// Let's munge the SDP to add the attributes for enabling simulcasting\n\t\t// (based on https://gist.github.com/ggarber/a19b4c33510028b9c657)\n\t\tvar lines = sdp.split(\"\\r\\n\");\n\t\tvar video = false;\n\t\tvar ssrc = [ -1 ], ssrc_fid = [ -1 ];\n\t\tvar cname = null, msid = null, mslabel = null, label = null;\n\t\tvar insertAt = -1;\n\t\tfor(var i=0; i<lines.length; i++) {\n\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\n\t\t\tif(mline) {\n\t\t\t\tvar medium = mline[1];\n\t\t\t\tif(medium === \"video\") {\n\t\t\t\t\t// New video m-line: make sure it's the first one\n\t\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\t\tvideo = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\n\t\t\t\t\tif(ssrc[0] > -1) {\n\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(!video)\n\t\t\t\tcontinue;\n\t\t\tvar fid = lines[i].match(/a=ssrc-group:FID (\\d+) (\\d+)/);\n\t\t\tif(fid) {\n\t\t\t\tssrc[0] = fid[1];\n\t\t\t\tssrc_fid[0] = fid[2];\n\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(ssrc[0]) {\n\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tcname = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tmsid = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tmslabel = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' label:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tlabel = match[1];\n\t\t\t\t}\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid[0]) === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(lines[i].length == 0) {\n\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\tif(ssrc[0] < 0) {\n\t\t\t// Couldn't find a FID attribute, let's just take the first video SSRC we find\n\t\t\tinsertAt = -1;\n\t\t\tvideo = false;\n\t\t\tfor(var i=0; i<lines.length; i++) {\n\t\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\n\t\t\t\tif(mline) {\n\t\t\t\t\tvar medium = mline[1];\n\t\t\t\t\tif(medium === \"video\") {\n\t\t\t\t\t\t// New video m-line: make sure it's the first one\n\t\t\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\t\t\tvideo = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\n\t\t\t\t\t\tif(ssrc[0] > -1) {\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(!video)\n\t\t\t\t\tcontinue;\n\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\tvar value = lines[i].match(/a=ssrc:(\\d+)/);\n\t\t\t\t\tif(value) {\n\t\t\t\t\t\tssrc[0] = value[1];\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tcname = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tmsid = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tmslabel = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' label:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tlabel = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid[0]) === 0) {\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(lines[i].length === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(ssrc[0] < 0) {\n\t\t\t// Still nothing, let's just return the SDP we were asked to munge\n\t\t\tJanus.warn(\"Couldn't find the video SSRC, simulcasting NOT enabled\");\n\t\t\treturn sdp;\n\t\t}\n\t\tif(insertAt < 0) {\n\t\t\t// Append at the end\n\t\t\tinsertAt = lines.length;\n\t\t}\n\t\t// Generate a couple of SSRCs (for retransmissions too)\n\t\t// Note: should we check if there are conflicts, here?\n\t\tssrc[1] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc[2] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc_fid[1] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc_fid[2] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\t// Add attributes to the SDP\n\t\tfor(var i=0; i<ssrc.length; i++) {\n\t\t\tif(cname) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' cname:' + cname);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(msid) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' msid:' + msid);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(mslabel) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' mslabel:' + mslabel);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(label) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' label:' + label);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\t// Add the same info for the retransmission SSRC\n\t\t\tif(cname) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' cname:' + cname);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(msid) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' msid:' + msid);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(mslabel) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' mslabel:' + mslabel);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(label) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' label:' + label);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t}\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[2] + ' ' + ssrc_fid[2]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[1] + ' ' + ssrc_fid[1]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[0] + ' ' + ssrc_fid[0]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:SIM ' + ssrc[0] + ' ' + ssrc[1] + ' ' + ssrc[2]);\n\t\tsdp = lines.join(\"\\r\\n\");\n\t\tif(!sdp.endsWith(\"\\r\\n\"))\n\t\t\tsdp += \"\\r\\n\";\n\t\treturn sdp;\n\t}\n\n\t// Helper methods to parse a media object\n\tfunction isAudioSendEnabled(media) {\n\t\tJanus.debug(\"isAudioSendEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.audio === false)\n\t\t\treturn false;\t// Generic audio has precedence\n\t\tif(media.audioSend === undefined || media.audioSend === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.audioSend === true);\n\t}\n\n\tfunction isAudioSendRequired(media) {\n\t\tJanus.debug(\"isAudioSendRequired:\", media);\n\t\tif(!media)\n\t\t\treturn false;\t// Default\n\t\tif(media.audio === false || media.audioSend === false)\n\t\t\treturn false;\t// If we're not asking to capture audio, it's not required\n\t\tif(media.failIfNoAudio === undefined || media.failIfNoAudio === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.failIfNoAudio === true);\n\t}\n\n\tfunction isAudioRecvEnabled(media) {\n\t\tJanus.debug(\"isAudioRecvEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.audio === false)\n\t\t\treturn false;\t// Generic audio has precedence\n\t\tif(media.audioRecv === undefined || media.audioRecv === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.audioRecv === true);\n\t}\n\n\tfunction isVideoSendEnabled(media) {\n\t\tJanus.debug(\"isVideoSendEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.video === false)\n\t\t\treturn false;\t// Generic video has precedence\n\t\tif(media.videoSend === undefined || media.videoSend === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.videoSend === true);\n\t}\n\n\tfunction isVideoSendRequired(media) {\n\t\tJanus.debug(\"isVideoSendRequired:\", media);\n\t\tif(!media)\n\t\t\treturn false;\t// Default\n\t\tif(media.video === false || media.videoSend === false)\n\t\t\treturn false;\t// If we're not asking to capture video, it's not required\n\t\tif(media.failIfNoVideo === undefined || media.failIfNoVideo === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.failIfNoVideo === true);\n\t}\n\n\tfunction isVideoRecvEnabled(media) {\n\t\tJanus.debug(\"isVideoRecvEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.video === false)\n\t\t\treturn false;\t// Generic video has precedence\n\t\tif(media.videoRecv === undefined || media.videoRecv === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.videoRecv === true);\n\t}\n\n\tfunction isScreenSendEnabled(media) {\n\t\tJanus.debug(\"isScreenSendEnabled:\", media);\n\t\tif (!media)\n\t\t\treturn false;\n\t\tif (typeof media.video !== 'object' || typeof media.video.mandatory !== 'object')\n\t\t\treturn false;\n\t\tvar constraints = media.video.mandatory;\n\t\tif (constraints.chromeMediaSource)\n\t\t\treturn constraints.chromeMediaSource === 'desktop' || constraints.chromeMediaSource === 'screen';\n\t\telse if (constraints.mozMediaSource)\n\t\t\treturn constraints.mozMediaSource === 'window' || constraints.mozMediaSource === 'screen';\n\t\telse if (constraints.mediaSource)\n\t\t\treturn constraints.mediaSource === 'window' || constraints.mediaSource === 'screen';\n\t\treturn false;\n\t}\n\n\tfunction isDataEnabled(media) {\n\t\tJanus.debug(\"isDataEnabled:\", media);\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\n\t\t\tJanus.warn(\"Edge doesn't support data channels yet\");\n\t\t\treturn false;\n\t\t}\n\t\tif(media === undefined || media === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.data === true);\n\t}\n\n\tfunction isTrickleEnabled(trickle) {\n\t\tJanus.debug(\"isTrickleEnabled:\", trickle);\n\t\treturn (trickle === false) ? false : true;\n\t}\n}\n\nexport default Janus;","export const dict = {\n  'home' : '',\n  'name' : '    ',\n  'login' : '',\n  'username' :  '  ',\n  'password' : '  ',\n  'password_confirmation': '  ',\n  'mobile' : '  ',\n  'error': '',\n  'sign_in' : ' ',\n  'sign_up' : ' ',\n  'back' : '',\n  'signed_up_already': '     ',\n  'new_advert': '  ',\n  'title': '',\n  'abstract': '',\n  'content': '',\n  'submit': ' ',\n  'upload_from_gallery': '  ',\n  'welcome': ' ',\n  'sign_out': '',\n  'phone_number': ' ',\n  'telegram_channel': ' ',\n  'instagram_page': ' ',\n  'address': ' ',\n  'email': ' ',\n  'contact_information':'  ',\n  'search': ' ',\n  'cancel' : '',\n  'view': '',\n  'edit': '',\n  'delete': '',\n  'adverts_nes': '      ',\n  'my_pins': '   ',\n  'pin' : ' ',\n  'pinned': ' ',\n  'message_to_seller': ' ',\n  'messages': '  ',\n  'send_message': '   ',\n  'province': '',\n  'city': '',\n  'website': '',\n  'call': ' ',\n  'ago': ' ',\n  'all_above': '   ',\n  'no_result': '   ',\n  'category': '  ',\n  'leg':'',\n  'date':'',\n  'time': '',\n  'numberOfPassngers': '  ',\n  'surename': ' ',\n  'fathername':' ',\n  'ssn':'',\n  'birthplace':' ',\n  'pass_no': ' ',\n  'birthdate': ' ',\n  'place_of_birth': ' ',\n  'required_fields': ' ',\n  'en_father_name': '  ',\n  'en_name': ' ',\n  'en_surename': '   ',\n  'passport_no': ' ',\n  'final_confirm' : '  ',\n  'document_form': '  ',\n  'save': '',\n  'documents':' ',\n  'type' : '',\n  'string': ' ',\n  'text': ' ',\n  'select': '',\n  'multiSelect': ' ',\n  'table': '',\n  'date':'',\n  'refundable': ' ',\n  'yes':'',\n  'no':'',\n  'commentable':' ',\n  'end_point':' ',\n  'start_point':' ',\n  'votable':' ',\n  'publishable':' ',\n  'field_name': ' ',\n  'add': ' ',\n  'remove': '',\n  'auxiliary_tables': ' ',\n  'create_by':'  ',\n  'list': '',\n  'workflows': ' ',\n  'auxiliary_records': ' ',\n  'basic_table': ' ',\n  'relation_table': ' ',\n  'auxiliary_table_form': '   ' ,\n  'Basic': '',\n  'Relation': ' ',\n  'Divan': '',\n  'workflow_form':'  ',\n  'submitting':'   ... ',\n  'settings':'',\n  'receiving':'   ...',\n  'workflow_tables': '    ',\n  'auxiliary_table': ' ',\n  'workflow':' ',\n  'actions' : '',\n  'roles': ' ',\n  'divan': '',\n  'enter_your_email': '    ',\n  'enter_your_password': '     ',\n  'enter_your_password_confirmation': '     ',\n  'profiles': ' ',\n  'firstname': '',\n  'if_registered': '     ',\n  'you_can_login':'       ',\n  'if_not_registered': '    ',\n  'you_can_sign_up': '       .',\n  'new_assignment': '  ',\n  'posts': ' ',\n  'bookmark': '',\n  'like':'',\n  'follow':'',\n  'share':'',\n  'social_acts':'  ',\n  'channels': ' ',\n  'close': '',\n  'channel':' ',\n  'details': '',\n  'Shoa': ' ',\n  'role': '',\n  'Default': ' ',\n  'NonDefault':'   ',\n  'value': ' ',\n  'true': '',\n  'false': '',\n  'access_control_list':'  ',\n  'access_control_form':'  ',\n  'assignment_form':'  ',\n  'comment_form': ' ',\n  'post_form': ' ',\n  'metas':' ',\n  'shoa': '',\n  'form' : ' ',\n  'choose_image': ' ',\n  'logout': '',\n  'more': ' ...',\n  'social': '',\n  'courses':'',\n  'discussions':' ',\n  'exams':'  ',\n  'public':'',\n  'private':' ',\n  'course_type':' ',\n  'select_appropriate_title': '   ',\n  'write_appropriate_description':'      ',\n  'description':' ',\n  'drag_or_browse': '        ',\n  'attachment' : '  ',\n  'tasks': '',\n  'start_date': ' ',\n  'deadline' : ' ',\n  'select_a_date' : '   ',\n  'incomplete_data': '     ',\n  'alert': '',\n  'deadline_time': '',\n  'start_time':'',\n  'select_a_time':' ',\n  'coworkers': '',\n  'works': ' ',\n  'dashboard':'',\n  'tavan':'',\n  'statuses': ' ',\n  'status' : '',\n  'add_stauts': ' ',\n  'select' : '',\n  'new': '',\n  'task' : '',\n  'attachments': ' ',\n  'reports': '  ',\n  'tags':' ',\n  'new_tag': '  ',\n  'recent_tasks': ' ',\n  'public_tasks': ' ',\n  'sort_by' : ' ',\n  'by_title':'',\n  'by_events':'',\n  'deadline_near': '  ',\n  'new_report': ' ',\n  'new_comments': ' ',\n  'Admin':'',\n  'Colleague':'',\n  'Observer':'',\n  'Creator':'',\n  'verification_code':' ',\n  'enter_verification_code':  '    ',\n  'your_tasks':'   ',\n  'your_newest_works':'    ',\n  'todo_list': '  ',\n  'todo_participants': '',\n  'new_todo_participants': ' ',\n  'not_found': '  ',\n  'are_you_sure': ' ',\n  'Confirmer': ' ',\n  'time_sheets': '',\n  'morning_report':'   ',\n  'afternoon_report':'   ',\n  'extra_report':'  ',\n  'write_appropriate_details':'  ',\n  'associations':' ',\n  'sheet_date':' ',\n  'recipients':' ',\n  'sent_by_me': '  ',\n  'sent_to_me':'  ',\n  'priority':'',\n  'normal':'',\n  'high':'',\n  'urgent':' ',\n  'archived': ' ',\n  'write_archive_note' : '       ',\n  'user_groups': '  ',\n  'user_settings': ' ',\n  'add_involvement_to_tasks':'   ',\n  'remove_involvement_from_tasks':'   ',\n  'change_status_tasks':'  ',\n  'add_works_to_tasks':'   ',\n  'add_reports_to_tasks':'   ',\n  'add_comments_to_tasks':'   ',\n  'add_involvement_to_works':'   ',\n  'remove_involvement_from_works':'   ',\n  'change_status_works':'  ',\n  'add_todos_to_works':'    ',\n  'add_reports_to_works':'   ',\n  'add_comments_to_works':'   ',\n  'add_involvement_to_todos':'    ',\n  'remove_involvement_from_todos':'    ',\n  'add_involvement_to_time_sheets':'   ',\n  'remove_involvement_from_timesheets':'   ',\n  'notification_type':'  ',\n  'mail_notification':'',\n  'push_notification':' ',\n  'sms':'',\n  'if_someone_adds_you_youll_be_asked': '           .',\n  'previous_attachments':'    ',\n  'cas': '  ' ,\n  'profile': '',\n  'groups' : ' ',\n  'confirmed':' ',\n  'not_confirmed': ' ',\n  'blocked_list': '  ',\n  'notifications': ' ',\n  'privacy':' ',\n  'add_comments_to_reports':'   ',\n  'new_notifications' : '  ',\n  'new_reports': ' ',\n  'events_calendar': ' ',\n  'to': '',\n  'statusChanges': '  ',\n  'in_reply_to': '  ',\n  'avarage' : '  ',\n  'number_of_meetings': '  ',\n  'duration': ' ',\n  'kian': '',\n  'attendances': '',\n  'attendance_duration':' ',\n  'utid':'',\n  'attendance_percentage': ' ',\n  'faculties': ' ',\n  'total_assets': ' ',\n  'id': '',\n  'courses_most_quiz':'   ',\n  'courses_most_resource':'   ',\n  'courses_most_assignment':'    ',\n  'teacher': '',\n  'courses_most_occ': '     ',\n  'courses_most_ocd': '     ',\n  'courses_most_activity':'    ',\n  'bb_meetings': '  ',\n  'adobe_meetings': ' ',\n  'number_of_bb_meetings': '   ',\n  'courses_most_bocc': '      ',\n  'courses_most_bocd': '      ',\n  'person_session': '/',\n  'session': '',\n  'bb_avarage': '   ',\n  'link': '   ',\n  'sections': '    ',\n  'facultyId': '  ',\n  'is_typing': '  ',\n  'pass': '',\n  'new_slide':' ',\n  'unshare': ' ',\n  'start_camera': ' ',\n  'end_camera': ' ',\n  'record': ' ',\n  'recording': '  ',\n  'stop': '',\n  'send': '',\n  'chat': '',\n  'write_here': ' ...',\n  'frame_link': '',\n}\n","import React, { Component } from 'react';\nimport { Link, NavRight, Row, Button, Page, Navbar, Block, BlockTitle, List, ListItem, Popup, ListInput, Col, Icon } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\n\nexport default class PanelRightPage extends Component {\n  constructor() {\n    super();\n    this.logout = this.logout.bind(this);\n    this.getInstance = this.getInstance.bind(this);\n    this.check_ability = this.check_ability.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n\n    this.login = this.login.bind(this);\n    this.signUp = this.signUp.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n    this.logged_in = this.logged_in.bind(this);\n\n\n\n    this.state = {\n      token: window.localStorage.getItem('token'),\n      ability: null,\n      popupOpened: false,\n      password: null,\n      email: null,\n      domains: null,\n    }\n  }\n\n  logout() {\n    this.setState({ token: null });\n    window.localStorage.removeItem('token');\n    window.location.replace('/')\n  }\n\n  componentWillMount() {\n    ModelStore.on(\"got_instance\", this.getInstance);\n    ModelStore.on(\"set_instance\", this.setInstance);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"got_instance\", this.getInstance);\n    ModelStore.removeListener(\"set_instance\", this.setInstance);\n  }\n\n  componentDidMount() {\n    if (this.state.token && this.state.token.length > 10) {\n      MyActions.getInstance('users', 'role', this.state.token);\n    }\n    console.log('>>>>>>>>>>>>>>>>>', this.props)\n  }\n\n  getInstance() {\n    var user = ModelStore.getIntance()\n    var klass = ModelStore.getKlass()\n    if (user && klass === 'UserRole') {\n      console.log(user)\n      this.setState({\n        ability: user.the_ability\n      });\n    }\n\n  }\n\n\n  setInstance() {\n    var klass = ModelStore.getKlass()\n    if (klass === 'Login') {\n      this.$f7router.navigate('/');\n      window.location.reload()\n    }\n    if (klass === 'SignUp') {\n      this.$f7router.navigate('/');\n      window.location.reload()\n    }\n    //console.log(klass)\n  }\n\n  check_ability(a, link, icon) {\n    var result = []\n    if (this.state.ability) {\n      this.state.ability.map((ab) => {\n        if (ab.title === a && ab.value) {\n          result.push(\n            <ListItem link={\"/\" + link + \"/\"} ignoreCache={true} key={'panel' + link} view=\"#main-view\" panelClose>\n              <i className={\"va ml-5 fa fa-\" + icon}></i>\n              <span>{dict[link]}</span>\n            </ListItem>\n          )\n        }\n      })\n    }\n    return result\n  }\n\n  handleChange(obj) {\n    this.setState(obj);\n  }\n\n  login() {\n    var data = { email: this.state.email, password: this.state.password }\n    MyActions.setInstance('users/login', data);\n  }\n\n  signUp() {\n    var data = { email: this.state.email, password: this.state.password, domains: this.state.domains }\n    MyActions.setInstance('users/sign_up', data);\n  }\n\n  logged_in(token) {\n    if (token) {\n      return (\n        <List className='fs-13 z-1'>\n          <ListItem link=\"/courses/\" view=\"#main-view\" panelClose>\n            <i className=\"va ml-5 fa fa-list\"></i>\n            <span>{dict.courses}</span>\n          </ListItem>\n\n\n          <ListItem link=\"/sections/\" view=\"#main-view\" panelClose>\n            <i className=\"va ml-5 fa fa-list\"></i>\n            <span>{dict.sections}</span>\n          </ListItem>\n        </List>\n      )\n    }\n  }\n\n  loginBtn(token) {\n    console.log(token)\n    if (!token) {\n      return (<Button fill className=\"br-0 external f-color-black bg-teal\" href=\"https://auth.ut.ac.ir:8443/cas/login?service=https%3A%2F%2Fkian.ut.ac.ir%2Fusers%2Fservice\">{dict.login}</Button>)\n    } else {\n      return (<Button fill className=\"br-0\" onClick={() => this.logout()}>{dict.logout}</Button>)\n    }\n  }\n\n  participants() {\n    console.log('>>>>>>>', this.props.participants)\n    if(this.props.participants) {\n      var array = []\n      this.props.participants.map((participant) => {\n        array.push(<ListItem link=\"/\" view=\"#main-view\" panelClose>\n        <i className=\"va ml-5 fa fa-home\"></i>\n        <span>{participant.display}</span>\n      </ListItem>)\n      })\n    }\n  }\n\n\n  render() {\n    const { token, email, password } = this.state;\n    return (\n      <Page >\n        <div className='icon-bar '>\n          <div className='icon-circle'>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M7 7h10v6a3 3 0 0 1 -3 3h-4a3 3 0 0 1 -3 -3v-6\" /><line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"7\" /><line x1=\"15\" y1=\"3\" x2=\"15\" y2=\"7\" /><path d=\"M12 16v2a2 2 0 0 0 2 2h3\" /></svg>\n          </div>\n        </div>\n\n        <React.Fragment>\n          <BlockTitle className=\"mr-\"> <i className=\"va ml-5 fa fa-tachometer\"></i>{dict.dashboard}</BlockTitle>\n          <List className='fs-13 z-1'>\n            <ListItem link=\"/\" view=\"#main-view\" panelClose>\n              <i className=\"va ml-5 fa fa-home\"></i>\n              <span>{dict.home}</span>\n            </ListItem>\n            {this.participants()}\n          </List>\n\n          {this.logged_in(this.state.token)}\n          <Button panelOpen=\"left\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1\" /><line x1=\"12\" y1=\"12\" x2=\"12\" y2=\"12.01\" /><line x1=\"8\" y1=\"12\" x2=\"8\" y2=\"12.01\" /><line x1=\"16\" y1=\"12\" x2=\"16\" y2=\"12.01\" /></svg>\n          </Button>\n\n\n        </React.Fragment>\n        {this.loginBtn(this.state.token)}\n\n      </Page>\n    );\n  }\n}","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Stage, Layer, Image } from 'react-konva';\nimport useImage from 'use-image';\n\nclass URLImage extends React.Component {\n    state = {\n      image: null\n    };\n    componentDidMount() {\n      this.loadImage();\n    }\n    componentDidUpdate(oldProps) {\n      if (oldProps.src !== this.props.src) {\n        this.loadImage();\n      }\n      if (oldProps.width !== this.props.width) {\n        this.loadImage();\n      }\n      if (oldProps.height !== this.props.height) {\n        this.loadImage();\n      }\n      //console.log(this.props)\n    }\n    componentWillUnmount() {\n      this.image.removeEventListener('load', this.handleLoad);\n    }\n    loadImage() {\n      // save to \"this\" to remove \"load\" handler on unmount\n      this.image = new window.Image();\n      this.image.src = this.props.src;\n      this.image.crossOrigin = 'anonymous';\n      this.image.addEventListener('load', this.handleLoad);\n    }\n    handleLoad = () => {\n      // after setState react-konva will update canvas and redraw the layer\n      // because \"image\" property is changed\n      this.setState({\n        image: this.image\n      });\n      // if you keep same image object during source updates\n      // you will have to update layer manually:\n      // this.imageNode.getLayer().batchDraw();\n    };\n    render() {\n      return (\n        <Image\n          x={this.props.x}\n          y={this.props.y}\n          width={this.props.width}\n          height={this.props.height}\n          image={this.state.image}\n          ref={node => {\n            this.imageNode = node;\n          }}\n        />\n      );\n    }\n  }\n\n  export default URLImage;","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Stage, Layer, Line, Circle, Image } from 'react-konva';\nimport { Row, Col, List, BlockTitle, Card, Fab, Icon, Preloader, Progressbar, CardContent, CardHeader, CardFooter } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport { CompactPicker } from 'react-color';\nimport URLImage from './urlimage.jsx';\nimport Dexie from 'dexie'\nimport MultiStreamsMixer from 'multistreamsmixer';\n\n\nclass Board extends Component {\n    constructor(props) {\n        super(props);\n        this.handleMouseDown = this.handleMouseDown.bind(this);\n        this.handleMouseMove = this.handleMouseMove.bind(this);\n        this.handleMouseUp = this.handleMouseUp.bind(this);\n        this.fitStageIntoParentContainer = this.fitStageIntoParentContainer.bind(this);\n        this.getRelativePointerPosition = this.getRelativePointerPosition.bind(this)\n        this.stage = React.createRef();\n        this.layer = React.createRef();\n        this.imageLayer = React.createRef();\n\n\n        this.throttle = this.throttle.bind(this)\n        this.pointer = this.pointer.bind(this)\n        this.handleClick = this.handleClick.bind(this)\n        this.handleChange = this.handleChange.bind(this)\n        this.handleClose = this.handleClose.bind(this)\n        this.undo = this.undo.bind(this)\n        this.removeLatestLine = this.removeLatestLine.bind(this)\n        this.trash = this.trash.bind(this)\n        this.updateMovement = this.updateMovement.bind(this)\n\n        this.togglePointer = this.togglePointer.bind(this)\n\n        this.loadImage = this.loadImage.bind(this)\n        this.recorder = this.recorder.bind(this)\n        this.stopRecording = this.stopRecording.bind(this)\n        this.recordBtn = this.recordBtn.bind(this)\n\n        this.boardControl = this.boardControl.bind(this)\n\n\n\n        this.arrows = this.arrows.bind(this)\n        this.state = {\n            tool: 'pen',\n            lines: [],\n            isDrawing: false,\n            baseWidth: 800,\n            baseHeight: 600,\n            width: 800,\n            height: 600,\n            scale: 4 / 3,\n            scaleX: 1,\n            scaleY: 1,\n            lastTime: Date.now(),\n            pointer: { x: 100, y: 100 },\n            currentPage: 0,\n            color: '#22194D',\n            displayColorPicker: false,\n            upload: null,\n            vectorId: [],\n            pointers: [],\n            pointerEnabled: true,\n            uploadedHeigth: 1000,\n            ratio: 3 / 4,\n            db: null,\n            recording: false,\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.line !== this.props.line) {\n            this.setState({ lines: this.state.lines.concat(this.props.line) });\n        }\n        if (prevProps.participants !== this.props.participants) {\n            //console.log('ZZZZZZZZ', this.props.participants)\n            this.props.participants.map((participant) => {\n                var exisiting = this.state.pointers.filter(\n                    (item) => item.uuid === participant.uuid\n                );\n                if (exisiting.length === 0 || participant.userColor !== exisiting.userColor) {\n                    this.setState({ pointers: this.state.pointers.concat({ uuid: participant.uuid, color: participant.userColor, x: 0, y: 0 }) }, () => {\n                        // console.log('>>>>> Pointers ...', this.state.pointers)\n                    });\n                }\n            })\n\n        }\n        if (prevProps.undoVector !== this.props.undoVector) {\n            if (this.props.undoVector) {\n                this.removeLatestLine(this.props.undoVector);\n                this.props.revertUndo();\n            }\n        }\n        if (prevProps.trash !== this.props.trash) {\n            if (this.props.trash) {\n                this.applyTrash();\n                this.props.revertTrash();\n            }\n        }\n        if (prevProps.upload !== this.props.upload) {\n            if (this.props.upload.converted) {\n                var d = this.props.upload.dimensions[this.state.currentPage]\n                var ratio = d.h / d.w\n                //console.log('><><><><', d.h, d.w)\n                this.setState({ currentPage: 0, upload: this.props.upload, ratio: ratio });\n\n\n                if (this.props.uploadedRecently) {\n                    this.throttle({ currentPage: this.state.currentPage, uuid: this.props.upload.uuid }, 'newUpload')\n                    this.props.uploadedRecentlyReset()\n                }\n            }\n        }\n        if (prevProps.page !== this.props.page) {\n            if (this.props.page.uuid == this.state.upload.uuid) {\n                this.setState({ currentPage: this.props.page.currentPage });\n            } else {\n                //console.log('Calling recentUpload ...')\n                this.props.recentUpload()\n            }\n        }\n\n        if (prevProps.currentPoint !== this.props.currentPoint) {\n\n            this.updateMovement(this.props.currentPoint)\n            // var cord = { x: this.props.currentPoint.x, y: this.props.currentPoint.y }\n            // this.setState({ pointer: cord })\n            /*\n                        var pointers = this.state.pointers\n                        for (let i = 0; i < pointers.length; i++) {\n                            if (pointers[i].uuid === this.props.currentPoint.uuid){\n                                let newState = Object.assign({}, this.state);\n                                newState.pointers[i] = { uuid: pointers[i].uuid, color: pointers[i].color, x: this.props.currentPoint.x, y: this.props.currentPoint.y}\n                                this.setState(newState);\n                            }\n                        }\n            */\n            //this.setState({ lines: this.state.lines.concat(this.props.line) });\n        }\n    }\n\n    updateMovement(pointer) {\n        var pointers = this.state.pointers\n        for (let i = 0; i < pointers.length; i++) {\n            if (pointers[i].uuid === pointer.uuid) {\n                let newState = Object.assign({}, this.state);\n                newState.pointers[i] = { uuid: pointers[i].uuid, color: pointers[i].color, x: pointer.x, y: pointer.y }\n                this.setState(newState);\n                break;\n            }\n        }\n    }\n\n    handleMouseDown = (e) => {\n        this.setState({ isDrawing: true });\n        //console.log(this.getRelativePointerPosition(e.target.getStage()))\n        //console.log(e.target.getStage().getPointerPosition())\n        const pos = this.getRelativePointerPosition(e.target.getStage());\n        var tool = this.state.tool\n        var vectorId = Math.random().toString(36).substring(7)\n        var c = { tool, color: this.state.color, vectorId: vectorId, points: [pos.x, pos.y] }\n        this.setState({ lines: this.state.lines.concat(c), vectorId: this.state.vectorId.concat(vectorId) }, () => {\n            //this.props.wsSend({type: 'line', c: c});\n            this.throttle(c, 'line')\n            //console.log(c)\n        });\n\n    };\n\n    handleMouseMove = (e) => {\n        // no drawing - skipping\n        if (this.state.pointerEnabled && (this.props.isAdmin || this.props.isPresenter || this.props.isWriter) ) {\n            const point = this.getRelativePointerPosition(e.target.getStage());\n            var pointer = { uuid: this.props.userUUID, x: point.x, y: point.y }\n            this.updateMovement(pointer)\n            this.throttle(pointer, 'point')\n            return;\n        }\n        if (this.state.isDrawing && (this.props.isAdmin || this.props.isPresenter || this.props.isWriter)) {\n            const stage = e.target.getStage();\n            const point = this.getRelativePointerPosition(e.target.getStage());//stage.getPointerPosition();\n            let lastLine = this.state.lines[this.state.lines.length - 1];\n            // add point\n            lastLine.points = lastLine.points.concat([point.x, point.y]);\n\n            // replace last\n            this.state.lines.splice(this.state.lines.length - 1, 1, lastLine);\n            this.setState({ lines: this.state.lines.concat() }, () => {\n                //console.log(this.state.lines)\n                //this.props.wsSend({type: 'line', c: this.state.lines});\n                this.throttle(this.state.lines, 'line')\n            });\n        }\n    };\n\n    throttle(c, t) {\n        if (Date.now() - this.state.lastTime > 300) {\n            this.setState({ lastTime: Date.now() }, () => {\n                this.props.wsSend({ type: t, c: c })\n            })\n        }\n    }\n\n    pointer(x, y) {\n        return (<Circle x={x} y={y} radius={2} fill=\"green\" />)\n    }\n\n    handleMouseUp = () => {\n        this.setState({ isDrawing: false });\n    };\n\n    componentDidMount() {\n        this.layer.current.getCanvas()._canvas.id = 'main-canvas';\n\n        window.db = {}\n        window.db = new Dexie(\"VideosDB\");\n        window.db.version(2).stores({\n            videos: \"++id,session,blob\"\n        });\n        //this.setState({db: db})\n\n        window.addEventListener('load', this.fitStageIntoParentContainer);\n        window.addEventListener('resize', this.fitStageIntoParentContainer);\n        this.$$('#board').css({ height: this.$$('#uploaded').height() })\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener(\"resize\", this.fitStageIntoParentContainer);\n        window.removeEventListener(\"load\", this.fitStageIntoParentContainer);\n    }\n\n    fitStageIntoParentContainer() {\n        var cardWidth = this.$$('#board').width()\n        var cardHeight = this.$$('#board').height()\n\n        var scale = Math.min(\n            cardWidth / this.state.width,\n            cardHeight / this.state.height\n        );\n\n        //var scaleX = Math.min(cardWidth, this.state.width) / 800;\n        //var scaleY = Math.min(cardHeight, this.state.width) / 600;\n\n        if (window.innerWidth < 1090) {\n\n            this.setState({ scale: scale })\n            this.setState({ width: this.$$('#board').width(), height: this.$$('#board').width() * this.state.ratio }, () => {\n                this.stage.current.width(this.$$('#board').width());\n                //console.log(this.state.width, this.state.height)\n                this.stage.current.height(this.$$('#board').width() * this.state.ratio);\n                this.stage.current.scale({ x: scale, y: scale });\n                this.stage.current.draw()\n            });\n        }\n\n        if (window.innerWidth > 1090) {\n            this.setState({ scale: scale })\n            this.setState({ width: 800, height: 800 * this.state.ratio }, () => {\n                this.stage.current.width(800);\n                this.stage.current.height(800 * this.state.ratio);\n                this.stage.current.scale({ x: scale, y: scale });\n                this.stage.current.draw()\n            });\n        }\n\n\n    }\n\n    getRelativePointerPosition(node) {\n\n        var transform = node.getAbsoluteTransform().copy();\n        // to detect relative position we need to invert transform\n        transform.invert();\n\n        // get pointer (say mouse or touch) position\n        var pos = node.getStage().getPointerPosition();\n\n        // now we can find relative point\n        return transform.point(pos);\n    }\n\n    progress() {\n        if (this.props.isPresenter || this.props.isAdmin) {\n            if (this.props.progressShow || (this.props.upload && !this.props.upload.converted)) {\n                return (\n                    <Preloader color=\"red\" />\n                )\n            } else {\n                return (\n                    <div class=\"upload-btn\">\n                        <label for=\"file-input\">\n                            <div style={{ float: 'right' }}>\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M14 3v4a1 1 0 0 0 1 1h4\" /><path d=\"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z\" /><line x1=\"12\" y1=\"11\" x2=\"12\" y2=\"17\" /><line x1=\"9\" y1=\"14\" x2=\"15\" y2=\"14\" /></svg>\n                            </div>\n\n                        </label>\n                        <input id=\"file-input\" className=\"file-input\" type=\"file\" name=\"resume\" accept=\"application/pdf\" onInput={(e) => { this.props.uploader(e.target.files[0]); this.setState({ upload: null }) }} />\n                    </div>\n                )\n            }\n        }\n    }\n\n    uploaded() {\n        if (this.state.upload) {\n            return (<img src={'http://localhost:3001/' + this.state.upload.uuid + '/x-' + this.enumerator(this.state.currentPage) + '.jpg'} class=\"b-radius-0 \" id='uploaded' width={this.state.width + 'px'}></img>)\n        }\n    }\n\n    enumerator(e) {\n        if (e < 10) return '000' + e.toString()\n        if (10 <= e < 100) return '00' + e.toString()\n        if (100 <= e < 1000) return '0' + e.toString()\n    }\n\n    arrows() {\n        if (this.props.upload) {\n            return (\n                <React.Fragment>\n                    <div>\n                        <a onClick={() => this.previousPage()}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"20\" y1=\"12\" x2=\"10\" y2=\"12\" /><line x1=\"20\" y1=\"12\" x2=\"16\" y2=\"16\" /><line x1=\"20\" y1=\"12\" x2=\"16\" y2=\"8\" /><line x1=\"4\" y1=\"4\" x2=\"4\" y2=\"20\" /></svg>\n                        </a>\n\n                    </div>\n                    <div style={{ marginTop: '-4px' }}>{this.state.currentPage + 1}/{this.props.upload.pages}</div>\n                    <div>\n                        <a onClick={() => this.nextPage()}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"4\" y1=\"12\" x2=\"14\" y2=\"12\" /><line x1=\"4\" y1=\"12\" x2=\"8\" y2=\"16\" /><line x1=\"4\" y1=\"12\" x2=\"8\" y2=\"8\" /><line x1=\"20\" y1=\"4\" x2=\"20\" y2=\"20\" /></svg>\n                        </a>\n                    </div>\n                </React.Fragment>\n            )\n        }\n    }\n\n    nextPage() {\n        if (this.props.upload && this.props.upload.pages && this.props.upload.pages > this.state.currentPage) {\n            this.setState({ currentPage: this.state.currentPage + 1 }, () => {\n                this.throttle({ currentPage: this.state.currentPage, uuid: this.props.upload.uuid }, 'page')\n            })\n\n        }\n    }\n\n    previousPage() {\n        if (this.props.upload && this.props.upload.pages && this.props.upload.pages > this.state.currentPage && this.state.currentPage > 0) {\n            this.setState({ currentPage: this.state.currentPage - 1 }, () => {\n                this.throttle({ currentPage: this.state.currentPage, uuid: this.props.upload.uuid }, 'page')\n            })\n\n        }\n    }\n\n    handleClick(e) {\n        //console.log(e)\n        this.setState({ displayColorPicker: !this.state.displayColorPicker })\n    };\n\n    handleClose(e) {\n        this.setState({ displayColorPicker: false })\n    };\n\n    handleChange(color, event) {\n        //console.log(color, event)\n        this.setState({ color: color.hex, pointerEnabled: false })\n    }\n\n    undo() {\n        var last = this.state.vectorId[this.state.vectorId.length - 1]\n        this.throttle(last, 'undo')\n        this.removeLatestLine(last)\n        this.setState({ vectorId: this.state.vectorId.filter((v) => v !== last) });\n    }\n\n    removeLatestLine(undoVector) {\n        if (this.state.lines.length > 0) {\n            this.setState({ lines: this.state.lines.filter((line) => line.vectorId !== undoVector) });\n        }\n    }\n\n    trash() {\n        this.throttle(null, 'trash')\n        this.setState({ lines: [] });\n    }\n\n    applyTrash() {\n        this.setState({ lines: [] });\n    }\n\n    pointers() {\n        var result = []\n        this.state.pointers.map((pointer) => {\n            result.push(<Circle x={pointer.x} y={pointer.y} radius={5} fill={pointer.color} />)\n        })\n        return result\n    }\n\n    togglePointer() {\n        this.setState({ pointerEnabled: !this.state.pointerEnabled });\n    }\n\n    loadImage() {\n        if (this.state.upload) {\n            //console.log(this.state.width, this.state.height)\n            return (<URLImage src={'http://localhost:3001/' + this.state.upload.uuid + '/x-' + this.enumerator(this.state.currentPage) + '.jpg'} width={this.state.width} height={this.state.width * this.state.ratio} />)\n        }\n    }\n\n    recorder() {\n        var self = this;\n        //console.log('Record started')\n        var canvas = this.layer.current.getCanvas()._canvas;\n        window.recorder = {}\n        const audioMixer = new MultiStreamsMixer([this.props.localStream, this.props.remoteStream]);\n\n        //console.log(audioMixer.getMixedStream())\n        let combined = new MediaStream([...canvas.captureStream(5).getTracks(), ...audioMixer.getMixedStream().getTracks()]);\n        window.recorder = new MediaRecorder(combined) //([this.props.remoteStream , canvas.captureStream()] )\n        var chunks = [];\n        window.recorder.ondataavailable = function (e) {\n            if (e.data.size) {\n                chunks.push(e.data)\n            }\n        };\n        window.recorder.onstop = function () {\n            var blob = new Blob(chunks, { type: 'video/mp4' });\n            var url = URL.createObjectURL(blob);\n            window.db.videos.add({ blob: blob }).then(function () {\n                //console.log('Blob Stored ...')\n            }).catch(function (e) {\n                alert(\"Error: \" + (e.stack || e));\n            });\n            //console.log('stoped')\n            //unrelatedDOMStuff(url);\n            // var vid = document.createElement('video');\n            // vid.src = url\n            // vid.controls = true;\n            //self.$$('#board').append(vid);\n            //document.body.appendChild(vid);\n            //stopCanvas();\n        };\n        window.recorder.start();\n        this.setState({ recording: true })\n        // setTimeout(function () { recorder.requestData() }, 3000);\n    }\n\n    stageDrawer() {\n\n    }\n\n    stopRecording() {\n        window.recorder.stop();\n        this.setState({ recording: false })\n    }\n\n    recordBtn() {\n        if (!this.state.recording) {\n            return (\n                <div>\n                    <a onClick={() => this.recorder()}>\n                        <div style={{ float: 'right' }}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2\" /><circle cx=\"12\" cy=\"14\" r=\"2\" /><polyline points=\"14 4 14 8 8 8 8 4\" /></svg>\n                        </div>\n                        <div style={{ marginTop: '0px', width: '90px' }}>{dict.record}</div>\n                    </a>\n                </div>\n            )\n        } else {\n            return (\n                <div>\n                    <a onClick={() => this.stopRecording()}>\n                        <div style={{ float: 'left' }}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><rect x=\"5\" y=\"5\" width=\"14\" height=\"14\" rx=\"2\" /></svg>\n                        </div>\n\n                        <div style={{ marginTop: '0px', width: '125px' }}>\n                            <Preloader color=\"multi\" size={15} style={{ marginLeft: '2px' }} />\n                            {dict.recording}...{dict.stop}\n                        </div>\n                    </a>\n                </div>\n            )\n        }\n    }\n\n    boardControl(popover, cover) {\n        if (this.props.isWriter || this.props.isPresenter || this.props.isAdmin) {\n            return (\n                <div>\n                    <a onClick={() => this.togglePointer()}>\n                        {!this.state.pointerEnabled ?\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" /><path d=\"M14.828 9.172a4 4 0 0 1 1.172 2.828\" /><path d=\"M17.657 6.343a8 8 0 0 1 1.635 8.952\" /><path d=\"M9.168 14.828a4 4 0 0 1 0 -5.656\" /><path d=\"M6.337 17.657a8 8 0 0 1 0 -11.314\" /></svg>\n                            :\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"12\" y1=\"12\" x2=\"12\" y2=\"12.01\" /><path d=\"M14.828 9.172a4 4 0 0 1 0 5.656\" /><path d=\"M17.657 6.343a8 8 0 0 1 0 11.314\" /><path d=\"M9.168 14.828a4 4 0 0 1 0 -5.656\" /><path d=\"M6.337 17.657a8 8 0 0 1 0 -11.314\" /></svg>\n                        }\n                    </a>\n                    <a onClick={this.handleClick}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4\" /><line x1=\"13.5\" y1=\"6.5\" x2=\"17.5\" y2=\"10.5\" /></svg>\n                    </a>\n                    {this.state.displayColorPicker ? <div style={popover}>\n                        <div style={cover} onClick={this.handleClose} />\n                        <CompactPicker onChange={this.handleChange} />\n                    </div> : null}\n                    <a onClick={() => this.undo()}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M9 13l-4 -4l4 -4m-4 4h11a4 4 0 0 1 0 8h-1\" /></svg>\n                    </a>\n                    <a onClick={() => this.trash()}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"4\" y1=\"7\" x2=\"20\" y2=\"7\" /><line x1=\"10\" y1=\"11\" x2=\"10\" y2=\"17\" /><line x1=\"14\" y1=\"11\" x2=\"14\" y2=\"17\" /><path d=\"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12\" /><path d=\"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3\" /></svg>\n                    </a>\n\n                </div>\n            )\n        }\n    }\n\n\n    render() {\n        const popover = {\n            position: 'absolute',\n            zIndex: '1000',\n        }\n        const cover = {\n            position: 'fixed',\n            top: '0px',\n            right: '0px',\n            bottom: '0px',\n            left: '0px',\n        }\n\n\n\n        return (\n            <React.Fragment>\n                <Card>\n                    <CardHeader>\n\n                        {this.boardControl(popover, cover)}\n\n                        {this.progress()}\n\n                    </CardHeader>\n                    <CardContent id='board' className='flex-center' style={{ alignItems: 'normal', height: this.state.uploadedHeigth }}>\n                        <div style={{ position: 'absolute' }}>\n\n                        </div>\n\n                        <Stage\n                            width={this.state.width + 2}\n                            height={this.state.width * this.state.ratio + 2}\n                            onMouseDown={this.handleMouseDown}\n                            onMousemove={this.handleMouseMove}\n                            onMouseup={this.handleMouseUp}\n                            ref={this.stage}\n                        >\n\n                            <Layer ref={this.layer}\n                            >\n                                {this.loadImage()}\n                                {this.pointers()}\n                                {this.state.lines.map((line, i) => (\n                                    <Line\n                                        key={i}\n                                        points={line.points}\n                                        stroke={line.color}\n                                        strokeWidth={5}\n                                        tension={0.5}\n                                        lineCap=\"round\"\n                                        globalCompositeOperation={\n                                            line.tool === 'eraser' ? 'destination-out' : 'source-over'\n                                        }\n                                    />\n                                ))}\n\n                            </Layer>\n                        </Stage>\n\n                    </CardContent>\n                    <CardFooter className='board-footer'>\n                        {this.arrows()}\n                    </CardFooter>\n\n                </Card>\n                <div id=\"vid\"></div>\n            </React.Fragment>\n        );\n    }\n}\nexport default Board;","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Page, Navbar, List, BlockTitle, Card, Fab, Icon, Preloader, Block, CardContent, CardHeader, CardFooter } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport randomColor from 'randomcolor';\nimport Quill from 'quill';\nimport QuillCursors from 'quill-cursors';\n\nclass Doc extends Component {\n    constructor(props) {\n        super(props);\n        this.textChangeHandler = this.textChangeHandler.bind(this)\n        this.selectionChangeHandler = this.selectionChangeHandler.bind(this)\n        this.debounce = this.debounce.bind(this)\n        this.throttle = this.throttle.bind(this)\n        this.setContent = this.setContent.bind(this)\n        this.setCursor = this.setCursor.bind(this)\n        this.typingNow = this.typingNow.bind(this)\n        this.showTyping = this.showTyping.bind(this)\n        this.constructCursor = this.constructCursor.bind(this)\n\n        this.state = {\n            textLatency: 500,\n            cursorLatency: 1000,\n            lastTime: Date.now(),\n            curserName: null, //Math.random().toString(36).substring(7),\n            curserColor: this.props.userColor,//randomColor({luminosity: 'dark', alpha: 0.4}),\n            cursor: null,\n            delta: null,\n            quill: null,\n            range: null,\n            clients: [{ id: 'self', color: randomColor() }],\n            cursors: [],\n            isTypying: null,\n\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        var self = this;\n        if (prevProps.quillDelta !== this.props.quillDelta) {\n            this.setState({ delta: this.props.quillDelta }, () => {\n                self.setContent(self.state.quill, this.props.quillDelta)\n            });\n        }\n        \n        if (prevProps.typing !== this.props.typing) {\n            self.typingNow(self.props.typing)\n        }\n        if (prevProps.contentSync !== this.props.contentSync) {\n            //console.log(this.props.contentSync)\n                self.state.quill.setContents(this.props.contentSync)\n        }\n        \n        if (this.props.newComerLength  && this.props.newComerLength < self.state.quill.getLength()) {\n            console.log(this.props.newComerLength,  self.state.quill.getLength())\n          // if(this.props.newComerLength < self.state.quill.getLength()) {\n            setTimeout(() =>  self.throttle( self.state.quill.getContents(), 'contentSync'), 3000);\n            this.props.newComerReset();\n          // }\n        }\n        if (prevProps.name !== this.props.name) {\n            self.setState({ curserName: this.props.name }, () => {\n                self.constructCursor(this.state.curserName, this.state.curserColor)\n                setTimeout(() =>  self.throttle( self.state.quill.getLength(), 'newComer'), 3000);\n               \n            })\n        }\n        if (prevProps.client !== this.props.client) {\n\n        }\n        if (prevProps.cursorRange !== this.props.cursorRange) {\n            console.log(this.props.cursorRange)\n            console.log(this.state.cursor)\n            if (self.state.cursor._cursors) {\n                var item = this.state.cursor._cursors[this.props.cursorRange.name]\n                if (item) {\n                    self.setCursor(this.props.cursorRange.name, this.props.cursorRange.range)\n                } else {\n                    self.constructCursor(this.props.cursorRange.name, this.props.cursorRange.color)\n                }\n            }\n\n        }\n        if (prevProps.newCursor !== this.props.newCursor) {\n            var client = self.state.clients.filter(\n                (item) => item.name === this.props.newCursor.name\n            )\n            if (client.length == 0) {\n                self.constructCursor(this.props.newCursor.name, this.props.newCursor.color)\n            }\n        }\n    }\n\n    constructCursor(cursorName, curserColor) {\n        var self = this;\n        var cursor = self.state.quill.getModule('cursors');\n        cursor.createCursor(cursorName, cursorName, curserColor);\n        self.state.quill.on('selection-change', self.selectionChangeHandler(cursor));\n        this.setState({ cursor: cursor });\n    }\n\n\n\n    componentDidMount() {\n        var self = this;\n        Quill.register('modules/cursors', QuillCursors);\n\n        var toolbarOptions = [\n            ['bold', 'italic', 'underline', 'strike'],        // toggled buttons\n            [{ 'list': 'ordered' }, { 'list': 'bullet' }],   // superscript/subscript        // outdent/indent\n            [{ 'direction': 'rtl' }],                         // text direction\n            [{ 'header': [1, 2, false] }],\n        ];\n\n        var quillOne = new Quill('#editor-one', {\n            theme: 'snow',\n            modules: {\n                toolbar: toolbarOptions,\n                cursors: {\n                    //cursors: true,\n                    transformOnTextChange: true,\n                },\n            },\n        });\n\n\n        quillOne.format('direction', 'rtl');\n        quillOne.format('align', 'right');\n\n        this.setState({ quill: quillOne })\n\n        const cursorsOne = quillOne.getModule('cursors');\n        this.setState({ cursor: cursorsOne })\n        //const cursorsTwo = quillTwo.getModule('cursors');\n\n        //    cursorsOne.createCursor('cursor', this.state.curserName, this.state.curserColor);\n        //    setTimeout(() => self.props.wsSend({ type: 'newCursor', c: { name: self.state.curserName, color: self.state.curserColor } }), 1000);\n\n        // cursorsOne.createCursor('cursor', 'User 1', 'red');\n\n        quillOne.on('text-change', this.textChangeHandler(quillOne));\n\n\n        //quillOne.on('text-change', this.textChangeHandler(quillTwo));\n        //quillTwo.on('text-change', this.textChangeHandler(quillOne));\n\n        //  quillOne.on('selection-change', this.selectionChangeHandler(cursorsOne));\n        //quillTwo.on('selection-change', this.selectionChangeHandler(cursorsOne));\n\n\n    }\n\n    setContent(quill, delta) {\n        quill.updateContents(delta);\n    }\n\n    setCursor(id, range) {\n        this.state.cursor.moveCursor(id, range)\n    }\n\n\n    typingNow(typer) {\n        var self = this;\n        console.log(typer.name + ' is Typing')\n        console.log(self.state.quill.getLength())\n        this.setState({ isTypying: typer.name })\n        setTimeout(() =>\n            this.setState({ isTypying: null })\n            , 2000);\n    }\n\n    showTyping() {\n        if (this.state.isTypying) {\n            return (<span>{this.state.isTypying} {' ' + dict.is_typing}</span>)\n        }\n    }\n\n\n    textChangeHandler(quill) {\n        var self = this;\n        return function (delta, oldContents, source) {\n            if (source === 'user') {\n                self.props.wsSend({ type: 'quill', c: delta })\n                self.throttle({ name: self.state.curserName, rnd: Math.random().toString(36).substring(4) }, 'typing')\n            }\n        };\n    }\n\n    debounce(func, wait) {\n        let timeout;\n        return function (...args) {\n            const context = this;\n            const later = function () {\n                timeout = null;\n                func.apply(context, args);\n            };\n            clearTimeout(timeout);\n            timeout = setTimeout(later, wait);\n        };\n    }\n\n    throttle(c, t) {\n        if (Date.now() - this.state.lastTime > 100) {\n            this.setState({ lastTime: Date.now() }, () => {\n                this.props.wsSend({ type: t, c: c })\n            })\n        }\n    }\n\n\n    selectionChangeHandler(cursors) {\n        var self = this;\n        const debouncedUpdate = self.debounce(updateCursor, 500);\n\n        return function (range, oldRange, source) {\n            if (source === 'user') {\n                updateCursor(range);\n            } else {\n                debouncedUpdate(range);\n            }\n        };\n\n        function updateCursor(range) {\n            self.props.wsSend({ type: 'cursor', c: { range: range, name: self.state.curserName, color: self.state.curserColor } })\n        }\n    }\n\n\n\n\n    render() {\n        return (\n            <Card>\n                <CardHeader>\n                </CardHeader>\n                <CardContent >\n                    <div className=\"container\">\n                        <div clclassNameass=\"editor\">\n                            <br />\n                            <div id=\"editor-one\"></div>\n                        </div>\n                    </div>\n                </CardContent>\n                <CardFooter className='editor-footer'>\n                    {this.showTyping()}\n                </CardFooter>\n            </Card>\n        );\n    }\n}\nexport default Doc;","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Page, Navbar, List, BlockTitle, Card, Fab, Icon, Preloader, Block, CardContent, CardHeader, CardFooter, Button } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport { Client, LocalStream, RemoteStream } from 'ion-sdk-js';\nimport { IonSFUJSONRPCSignal } from 'ion-sdk-js/lib/signal/json-rpc-impl';\nimport { conf } from \"../../conf\";\n\nclass Screen extends Component {\n    constructor(props) {\n        super(props);\n\n        this.start = this.start.bind(this)\n        this.videos = this.videos.bind(this)\n        this.unPublish = this.unPublish.bind(this)\n        this.publishBtn = this.publishBtn.bind(this)\n\n        this.state = {\n            signal: null,\n            config: null,\n            clientLocal: null,\n            streams: [],\n            media: null,\n\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n\n    }\n\n    componentDidMount() {\n        var config = {\n            iceServers: [\n                {\n                    urls: \"stun:stun.l.google.com:19302\",\n                },\n            ],\n        };\n\n\n        var signal = new IonSFUJSONRPCSignal(conf.ionSignalServer);\n\n        this.setState({ config: config, signal: signal }, () => {\n            var clientLocal = new Client(this.state.signal, this.state.config)\n            this.setState({ clientLocal: clientLocal }, () => {\n                this.state.signal.onopen = () => this.state.clientLocal.join(\"test session\");\n                this.state.clientLocal.ontrack = (track, stream) => {\n                    console.log(\"got track\", track.id, \"for stream\", stream.id);\n                    if (track.kind === \"video\") {\n                        track.onunmute = () => {\n                            this.setState({ streams: this.state.streams.concat(stream) })\n                            stream.onremovetrack = () => {\n                                console.log('Stream owner left')\n                                this.setState({ streams: this.state.streams.filter((item) => item.id !== stream.id) })\n                                this.$$('#remotes').remove();\n                                this.$$('#screen').append(\"<div id='remotes'></div>\");\n                            };\n                        };\n                    }\n                };\n            })\n\n        })\n    }\n\n    start() {\n        var self = this;\n        LocalStream.getDisplayMedia({\n            resolution: \"vga\",\n            audio: false,\n        })\n            .then((media) => {\n                console.log(media)\n                this.setState({ media: media })\n                var localVideo = document.createElement(\"video\");\n                localVideo.srcObject = media;\n                localVideo.autoplay = true;\n                localVideo.muted = true;\n                localVideo.width = this.$$('#screen').width() - 20;\n                this.state.clientLocal.publish(media);\n                this.$$('#remotes').append(localVideo);\n                media.getVideoTracks()[0].onended = function () {\n                    self.unPublish()\n                };\n            })\n            .catch(console.error);\n    };\n\n    videos() {\n        var result = []\n        if (this.state.streams) {\n            this.state.streams.map((stream) => {\n                if (this.$$('#' + stream.id).length == 0) {\n                    var remoteVideo = document.createElement(\"video\");\n                    remoteVideo.srcObject = stream;\n                    remoteVideo.autoplay = true;\n                    remoteVideo.muted = true;\n                    remoteVideo.width = this.$$('#screen').width() - 20;\n                    this.$$('#remotes').append(remoteVideo);\n                }\n            })\n\n            return (result)\n        }\n    }\n\n    unPublish() {\n        this.state.media.unpublish();\n        this.state.media.getTracks().forEach(track => track.stop());\n        this.$$('#remotes').remove(this.state.media.id);\n        this.$$('#screen').append(\"<div id='remotes'></div>\");\n        this.setState({ media: null })\n    }\n\n    publishBtn() {\n        if (!this.state.media) {\n            return (\n                <Button fill onClick={() => this.start()}>\n                    <div style={{ float: 'right', paddingTop: '5px' }}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9\" /><line x1=\"7\" y1=\"20\" x2=\"17\" y2=\"20\" /><line x1=\"9\" y1=\"16\" x2=\"9\" y2=\"20\" /><line x1=\"15\" y1=\"16\" x2=\"15\" y2=\"20\" /><path d=\"M17 4h4v4\" /><path d=\"M16 9l5 -5\" /></svg>\n                    </div>\n                    <div style={{ marginTop: '0px', width: '70px' }}>{dict.share}</div>\n                </Button>\n            )\n        } else {\n            return (\n                <Button onClick={() => this.unPublish()}>\n                    <div style={{ float: 'right', paddingTop: '5px' }}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9\" /><line x1=\"7\" y1=\"20\" x2=\"17\" y2=\"20\" /><line x1=\"9\" y1=\"16\" x2=\"9\" y2=\"20\" /><line x1=\"15\" y1=\"16\" x2=\"15\" y2=\"20\" /><path d=\"M17 8l4 -4m-4 0l4 4\" /></svg>\n                    </div>\n                    <div style={{ marginTop: '0px', width: '90px' }}>{dict.unshare}</div>\n                </Button>\n            )\n        }\n    }\n\n    render() {\n        return (\n            <Card>\n                <CardHeader>\n                    {this.publishBtn()}\n                </CardHeader>\n                <CardContent id='screen'>\n                    {this.videos()}\n                    <div id=\"remotes\"></div>\n                </CardContent>\n            </Card>\n        );\n    }\n}\nexport default Screen;","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Page, Navbar, List, BlockTitle, Card, Fab, Icon, Preloader, Block, CardContent, CardHeader, CardFooter, Button } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport { Client, LocalStream, RemoteStream } from 'ion-sdk-js';\nimport { IonSFUJSONRPCSignal } from 'ion-sdk-js/lib/signal/json-rpc-impl';\nimport { scaleDiverging, schemeBuPu } from 'd3';\nimport { conf } from \"../../conf\";\n\nclass Videos extends Component {\n    constructor(props) {\n        super(props);\n\n        this.start = this.start.bind(this)\n        this.videos = this.videos.bind(this)\n        this.unPublish = this.unPublish.bind(this)\n        this.publishBtn = this.publishBtn.bind(this)\n        this.display = this.display.bind(this)\n\n        this.state = {\n            signal: null,\n            config: null,\n            clientLocal: null,\n            streams: [],\n            media: null,\n            display: 1,//Math.floor(Math.random() * 4) + 1,\n\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n\n    }\n\n\n\n\n    componentDidMount() {\n        var config = {\n            iceServers: [\n                {\n                    urls: \"stun:stun.l.google.com:19302\",\n                },\n            ],\n        };\n\n\n        var signal = new IonSFUJSONRPCSignal(conf.ionSignalServer);\n\n        this.setState({ config: config, signal: signal }, () => {\n            var clientLocal = new Client(this.state.signal, this.state.config)\n            this.setState({ clientLocal: clientLocal }, () => {\n                this.state.signal.onopen = () => this.state.clientLocal.join(\"room\"+this.state.display);\n                this.state.clientLocal.ontrack = (track, stream) => {\n                    console.log(\"got track\", track.id, \"for stream\", stream.id);\n                    if (track.kind === \"video\") {\n                        track.onunmute = () => {\n                            var exists = this.state.streams.filter((item) => item.id === stream.id)\n                            if (exists.length == 0) {\n                                this.setState({ streams: this.state.streams.concat(stream) }, () => {\n                                    console.log('Streams are ...', this.state.streams)\n                                })\n                            }\n\n                            stream.onremovetrack = () => {\n                                console.log('Stream owner left')\n                                this.setState({ streams: this.state.streams.filter((item) => item.id !== stream.id) })\n                                this.$$('#remoteVideos').remove();\n                                this.$$('#videos').append(\"<div id='remoteVideos'></div>\");\n                            };\n                        };\n                    }\n                };\n            })\n\n        })\n    }\n\n    start() {\n        var self = this;\n        LocalStream.getUserMedia({\n            resolution: \"vga\",\n            video: true,\n            audio: false,\n        })\n            .then((media) => {\n                this.setState({ media: media })\n                var localVideo = document.createElement(\"video\");\n                localVideo.srcObject = media;\n                localVideo.autoplay = true;\n                localVideo.muted = true;\n                localVideo.width = '320';\n                this.state.clientLocal.publish(media);\n                console.log(media)\n                this.$$('#remoteVideos').append(localVideo);\n                media.getVideoTracks()[0].onended = function () {\n                    self.unPublish()\n                };\n            })\n            .catch(console.error);\n    };\n\n    videos() {\n        var result = []\n        if (this.state.streams) {\n            this.state.streams.map((stream) => {\n                console.log('Attaching to stream ...', stream)\n\n                if (this.$$('#' + stream.id).length == 0) {\n                    var remoteVideo = document.createElement(\"video\");\n                    remoteVideo.srcObject = stream;\n                    remoteVideo.autoplay = true;\n                    remoteVideo.muted = true;\n                    remoteVideo.width = '320';\n                    remoteVideo.id = stream.id;\n                    this.$$('#remoteVideos').append(remoteVideo);\n                }\n\n            })\n\n            return (result)\n        }\n    }\n\n    unPublish() {\n        this.state.media.unpublish();\n        this.state.media.getTracks().forEach(track => track.stop());\n        this.$$('#remoteVideos').remove(this.state.media.id);\n        this.$$('#videos').append(\"<div id='remoteVideos'></div>\");\n        this.setState({ media: null })\n    }\n\n    publishBtn() {\n        if (!this.state.media) {\n            return (\n                <Button fill onClick={() => this.start()}>\n                    <div style={{ float: 'right', paddingTop: '5px' }}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z\" /><rect x=\"3\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" /><line x1=\"7\" y1=\"12\" x2=\"11\" y2=\"12\" /><line x1=\"9\" y1=\"10\" x2=\"9\" y2=\"14\" /></svg>\n                    </div>\n                    <div style={{ marginTop: '0px', width: '90px' }}>{dict.start_camera}</div>\n                </Button>\n            )\n        } else {\n            return (\n                <Button onClick={() => this.unPublish()}>\n                    <div style={{ float: 'right', paddingTop: '5px' }}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" /><path d=\"M15 11v-1l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -.675 .946\" /><path d=\"M10 6h3a2 2 0 0 1 2 2v3m0 4v1a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h1\" /></svg>\n                    </div>\n                    <div style={{ marginTop: '0px', width: '93px' }}>{dict.end_camera}</div>\n                </Button>\n            )\n        }\n    }\n\n    display(event){\n        console.log(event.target.value)\n        this.setState({display: event.target.value}, () => {\n            console.log('Display:' + this.state.display)\n        });\n    }\n\n    render() {\n        return (\n            <Card>\n                <CardHeader>\n                    {this.publishBtn()}\n                    {this.state.display}\n                </CardHeader>\n                <CardContent id='videos'>\n                    {this.videos()}\n                    <div id=\"remoteVideos\"></div>\n                </CardContent>\n            </Card>\n        );\n    }\n}\nexport default Videos;","import React from \"react\";\nimport { Page, Navbar, Row, Toolbar, Col, Tab, Icon, Card, Link, CardContent, CardHeader, Tabs, Panel, Block } from 'framework7-react';\n\n\nimport { dict } from '../../Dict';\nimport Board from \"./board\";\nimport Doc from \"./doc.jsx\";\nimport Screen from \"./screen.jsx\";\nimport Videos from \"./videos.jsx\";\nimport Saved from \"./saved.jsx\";\nimport Player from \"./player.jsx\";\nimport videojs from 'video.js';\n\nconst RoomShow = (props) => {\n    function current(tab) {\n        var result = false\n        if (props.currentTab == tab) {\n            result = true\n        }\n        if (!props.currentTab && tab == 'tab-1') {\n            result = true\n        }\n        return result\n    }\n\n    function videoCard() {\n        var d = 'none'\n        if (props.ionActive || props.vActive) {\n            d = 'flex'\n        } \n        return (\n            <Card style={{ display: d, background: '#5d5d5f', borderRadius: '0' }}>\n                <CardContent id='videos' style={{minHeight: '210px', display: 'flex', flexWrap: 'wrap'}}>\n                    {props.ionVideos()}\n                    \n                    <div id=\"remoteVideos\" ></div>\n                </CardContent>\n            </Card>\n        )\n    }\n\n\n    function screenCard() {\n        var d = 'none'\n        if (props.screenActive) {\n            d = 'block'\n        } \n        return (\n            <Card style={{ minHeight: '0px', background: '#5d5d5f', borderRadius: '0' }}>\n                <div id='screen' style={{textAlign: 'center'}}>\n                    {props.screenVideos()}\n                    <div id=\"remotes\"></div>\n                </div>\n            </Card>\n        )\n    }\n\n    return (\n\n        <Page id='main-page' >\n            <Navbar title={dict.home} >\n                <Link panelOpen=\"right\">\n                    <Icon f7=\"bars\"></Icon>\n                </Link>\n            </Navbar>\n            {videoCard()}\n            \n            <Board\n                wsSend={props.wsSend}\n                line={props.line}\n                currentPoint={props.currentPoint}\n                uploader={props.uploader}\n                progress={props.progress}\n                progressShow={props.progressShow}\n                upload={props.upload}\n                recentUpload={props.recentUpload}\n                page={props.page}\n                undoVector={props.undoVector}\n                revertUndo={props.revertUndo}\n                revertTrash={props.revertTrash}\n                trash={props.trash}\n                userColor={props.userColor}\n                participants={props.participants}\n                userUUID={props.userUUID}\n                uploadedRecently={props.uploadedRecently}\n                uploadedRecentlyReset={props.uploadedRecentlyReset}\n                remoteStream={props.remoteStream}\n                localStream={props.localStream}\n                isAdmin={props.isAdmin}\n                isPresenter={props.isPresenter}\n                isWriter={props.isWriter}\n\n            />\n            {screenCard()}\n            <div id='mixedaudio'></div>\n\n        </Page>\n    )\n}\nexport default RoomShow;\n","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Page, Navbar, List, BlockTitle, Card, Fab, Icon, Preloader, Block, CardContent, CardHeader, CardFooter, Button } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport { Client, LocalStream, RemoteStream } from 'ion-sdk-js';\nimport { IonSFUJSONRPCSignal } from 'ion-sdk-js/lib/signal/json-rpc-impl';\n\nclass Saved extends Component {\n    constructor(props) {\n        super(props);\n        this.getVideos = this.getVideos.bind(this)\n        this.videos = this.videos.bind(this)\n\n        this.state = {\n            videos: []\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n\n    }\n\n    componentDidMount() {\n        this.getVideos()\n\n\n\n    }\n\n    async getVideos() {\n        this.setState({\n            videos: []\n        })\n        var videos =  await window.db.videos\n        .toArray();\n        console.log('Saved videos....', videos)\n        this.setState({\n            videos: videos\n        })\n    }\n\n    videos(){\n        var self = this;\n        if(this.state.videos){\n            this.state.videos.map((video) => {\n                if (video.blob.size !== 0 && this.$$('#saved-' + video.id).length == 0){\n                    var url = URL.createObjectURL(video.blob);\n                    var vid = document.createElement('video');\n                    //vid.srcObject = video.blob\n                    vid.width = 320\n                    vid.src = url\n                    vid.type = \"video/webm\";\n                    vid.id = 'saved-' + video.id\n                    vid.controls = true;\n                    console.log(vid)\n                    self.$$('#saved-videos').append(vid);\n                }\n\n            })\n\n        }\n    }\n\n\n\n\n    render() {\n        return (\n            <Card>\n                <CardHeader>\n                </CardHeader>\n                <CardContent id='saved-videos'>\n                    {this.videos()}\n                </CardContent>\n            </Card>\n        );\n    }\n}\nexport default Saved;","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Page, Navbar, List, ListInput, Card, Row, Col, Preloader, Block, CardContent, CardHeader, CardFooter, Button } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport { conf } from \"../../conf\";\n\nclass Player extends Component {\n    constructor(props) {\n        super(props);\n        this.handleChange = this.handleChange.bind(this)\n        this.throttle = this.throttle.bind(this)\n        this.send = this.send.bind(this)\n\n        this.state = {\n            lastTime: Date.now(),\n            srcLink: null,\n            counter: 0,\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.srcLink !== this.props.srcLink) {\n            this.setState({ counter: this.state.counter + 1 }, () => {\n                console.log(this.state.counter)\n            });\n        }\n    }\n\n    componentWillUnmount() {\n\n    }\n\n\n\n\n    componentDidMount() {\n\n    }\n\n    handleChange(obj) {\n        this.setState(obj);\n    }\n\n    throttle(c, t) {\n        if (Date.now() - this.state.lastTime > 100) {\n            this.setState({ lastTime: Date.now() }, () => {\n                this.props.wsSend({ type: t, c: c })\n            })\n        }\n    }\n    send() {\n        if (this.state.srcLink) {\n            this.throttle(this.state.srcLink, 'srcLink')\n            this.props.appendLink(this.state.srcLink)\n            this.$$('#link-form').val('')\n            this.setState({ counter: this.state.counter + 1 })\n        }\n\n    }\n\n    share() {\n        if (this.props.isAdmin) {\n            return (\n                <React.Fragment>\n                    <List >\n                        <ListInput\n                            inputId='link-form'\n                            label={dict.frame_link}\n                            type=\"text\"\n                            placeholder={dict.write_here}\n                            onChange={(e) => {\n                                this.handleChange({ srcLink: e.target.value })\n                            }} />\n\n                    </List>\n                    <Button fill onClick={() => this.send()}>{dict.submit}</Button>\n                </React.Fragment>\n            )\n        }\n    }\n\n    header() {\n        if (this.props.isAdmin) {\n            return (\n                <CardHeader>\n                    {this.share()}\n                </CardHeader>\n            )\n        } else {\n            return (null)\n        }\n    }\n\n    render() {\n        return (\n            <Card>\n                {this.header()}\n                <CardContent>\n                    <div style={{ textAlign: 'center', marginTop: '12px' }}>\n                        <iframe key={this.state.counter} class='frame' height=\"454\" width=\"718\" src={this.props.srcLink} frameborder=\"0\" allowfullscreen=\"\" title=\"Wysiwyg Embedded Content\"></iframe>\n                    </div>\n                </CardContent>\n            </Card>\n        );\n    }\n}\nexport default Player;","import React from \"react\";\nimport { Page, List, ListItem, Button, Link, Popover } from 'framework7-react';\n\nconst Right = (props) => {\n  function microphone(participant) {\n    if (participant.uuid === props.userUUID && (props.isPresenter || props.isSpeaker)) {\n      if (props.muted) {\n        return (\n          <div className='right-icon' >\n            <a onClick={() => props.toggleMicrophone()}>\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" /><path d=\"M9 5a3 3 0 0 1 6 0v5a3 3 0 0 1 -.13 .874m-2 2a3 3 0 0 1 -3.87 -2.872v-1\" /><path d=\"M5 10a7 7 0 0 0 10.846 5.85m2.002 -2a6.967 6.967 0 0 0 1.152 -3.85\" /><line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\" /><line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\" /></svg>\n            </a>\n          </div>)\n      } else {\n        return (\n          <div className='right-icon' >\n            <a onClick={() => props.toggleMicrophone()} style={{ color: 'white' }}>\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><rect x=\"9\" y=\"2\" width=\"6\" height=\"11\" rx=\"3\" /><path d=\"M5 10a7 7 0 0 0 14 0\" /><line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\" /><line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\" /></svg>\n            </a>\n          </div>)\n      }\n    }\n  }\n  function video(participant) {\n    if (participant.uuid === props.userUUID) {\n      return (\n        <div className='right-icon-1' >\n          {props.vPublishBtn()}\n          <div id='videoLoaderIcon' className=\"loader\" style={{ display: 'none' }}></div>\n        </div>\n      )\n    }\n  }\n\n  function screen(participant) {\n    if (participant.uuid === props.userUUID && props.isPresenter) {\n      return (\n        <div className='right-icon-2' >\n          {props.screenPublishBtn()}\n        </div>\n      )\n    }\n  }\n\n  function talking(participant) {\n    if (props.talking[participant.id]) {\n      return (\n        <div className='right-icon-4' >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M18 8a3 3 0 0 1 0 6\" /><path d=\"M10 8v11a1 1 0 0 1 -1 1h-1a1 1 0 0 1 -1 -1v-5\" /><path d=\"M12 8h0l4.524 -3.77a0.9 .9 0 0 1 1.476 .692v12.156a0.9 .9 0 0 1 -1.476 .692l-4.524 -3.77h-8a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h8\" /></svg>\n        </div>\n      )\n    } else {\n      return (null)\n    }\n  }\n\n  function raise(participant) {\n    if ((!props.isAdmin && participant.uuid === props.userUUID) || (props.isAdmin && participant.uuid !== props.userUUID)) {\n      return (\n        <div className='right-icon-3' style={{ marginTop: '3px', marginLeft: '9px' }}>\n          <a onClick={() => handRaise(participant)} style={{ color: isRaised(participant) }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M8 13v-7.5a1.5 1.5 0 0 1 3 0v6.5\" /><path d=\"M11 5.5v-2a1.5 1.5 0 1 1 3 0v8.5\" /><path d=\"M14 5.5a1.5 1.5 0 0 1 3 0v6.5\" /><path d=\"M17 7.5a1.5 1.5 0 0 1 3 0v8.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7a69.74 69.74 0 0 1 -.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47\" /></svg>\n          </a>\n        </div>\n      )\n    }\n  }\n\n  function kick(participant) {\n    if (participant.uuid !== props.userUUID && props.isPresenter) {\n      return (\n        <div className='right-icon-5' >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><circle cx=\"13\" cy=\"4\" r=\"1\" /><line x1=\"7\" y1=\"21\" x2=\"10\" y2=\"17\" /><path d=\"M16 21l-2 -4l-3 -3l1 -6\" /><path d=\"M6 12l2 -3l4 -1l3 3l3 1\" /></svg>\n        </div>\n      )\n    }\n  }\n\n  function enableMicrophone(participant) {\n    if (participant.uuid !== props.userUUID && props.isPresenter) {\n      return (\n        <div className='right-icon' >\n          <a onClick={() => props.toggleRole(participant.uuid, 'speaker')} style={{ color: isActive(participant, 'speaker') }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><rect x=\"9\" y=\"2\" width=\"6\" height=\"11\" rx=\"3\" /><path d=\"M5 10a7 7 0 0 0 14 0\" /><line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\" /><line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\" /></svg>\n          </a>\n        </div>)\n    }\n  }\n\n\n  function propagateVideo(participant) {\n    if (participant.uuid !== props.userUUID && props.isAdmin  ) {\n      //console.log(props.participantRoom)\n      return (\n        <div className='right-icon-6' >\n          <a onClick={() => props.wsSend({ type: 'joinRoom', c: participant.uuid }, 'all')} >\n           m\n          </a>\n          <a onClick={() => props.wsSend({ type: 'leaveRoom', c:participant.uuid }, 'all')}>\n           x\n          </a>\n        </div>)\n    }\n  }\n\n  function write(participant) {\n    if (participant.uuid !== props.userUUID && props.isPresenter) {\n      return (\n        <div className='right-icon-2' >\n          <a onClick={() => props.toggleRole(participant.uuid, 'writer')} style={{ color: isActive(participant, 'writer') }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4\" /><line x1=\"13.5\" y1=\"6.5\" x2=\"17.5\" y2=\"10.5\" /></svg>\n          </a>\n        </div>\n      )\n    }\n  }\n\n\n\n\n  function presenter(participant) {\n    if (participant.uuid !== props.userUUID && props.isAdmin) {\n      return (\n        <div className='right-icon-1' >\n          <a onClick={() => props.toggleRole(participant.uuid, 'presenter')} style={{ color: isActive(participant, 'presenter') }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><line x1=\"3\" y1=\"4\" x2=\"21\" y2=\"4\" /><path d=\"M4 4v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-10\" /><line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"20\" /><line x1=\"9\" y1=\"20\" x2=\"15\" y2=\"20\" /><path d=\"M8 12l3 -3l2 2l3 -3\" /></svg>\n          </a>\n        </div>\n      )\n    } else {\n      return (null)\n    }\n  }\n\n  function isActive(participant, role) {\n    if (props.participantRole(participant.uuid) === role) {\n      return ('#8ff597')\n    } else {\n      return ('#d4b9a3')\n    }\n  }\n\n  function isRaised(participant) {\n    if (props.handRaised(participant.uuid)) {\n      return ('#8ff597')\n    } else {\n      return ('#d4b9a3')\n    }\n  }\n\n  function handRaise(participant) {\n    if (participant.uuid === props.userUUID) {\n      if(!props.handRaised(participant.uuid)) {\n        props.wsSend({ type: 'handRaise', c: {status: 'raised', raiserUUID: participant.uuid} })\n        props.handRaise({status: 'raised', raiserUUID: participant.uuid})\n      } else {\n        props.wsSend({ type: 'handRaise', c: {status: 'down', raiserUUID: participant.uuid} })\n        props.handRaise({status: 'down', raiserUUID: participant.uuid})\n      }\n\n    }\n  }\n\n  function roomNumber(participant) {\n    if (participant.uuid === props.userUUID && props.currentSlot){\n      return('(' + props.currentSlot + ')')\n    }\n  }\n\n\n\n  function participants() {\n    if (props.participants) {\n      var result = []\n      props.participants.map((participant) => {\n        if (participant.display) {\n          result.push(<ListItem >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill={participant.userColor} stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><circle cx=\"12\" cy=\"7\" r=\"4\" /><path d=\"M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2\" /></svg>\n            <span>\n              {participant.display}\n              {roomNumber(participant)}\n            </span>\n            {talking(participant)}{microphone(participant)}{video(participant)}\n            {screen(participant)}{presenter(participant)}{raise(participant)}\n            {write(participant)}{enableMicrophone(participant)}\n            {propagateVideo(participant)}\n          </ListItem>)\n        }\n      })\n    }\n    return result\n  }\n\n  return (\n    <Page onPageAfterIn={props.pageAfterIn()} >\n      <div style={{ display: 'flex', height: 'max-content'}}>\n      <div className='icon-bar '>\n        <div className='icon-circle'>\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M7 7h10v6a3 3 0 0 1 -3 3h-4a3 3 0 0 1 -3 -3v-6\" /><line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"7\" /><line x1=\"15\" y1=\"3\" x2=\"15\" y2=\"7\" /><path d=\"M12 16v2a2 2 0 0 0 2 2h3\" /></svg>\n        </div>\n        <div className='icon-circle'>\n          <a>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z\" /><path d=\"M16 7h4\" /><path d=\"M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3\" /></svg>\n          </a>\n        </div>\n        <div className='icon-circle'>\n          <a className={props.ionActive ? 'fc-white' : ''}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z\" /><rect x=\"3\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" /></svg>\n          </a>\n        </div>\n\n        <div className='icon-circle'>\n        <Link id='xxx' className={props.screenActive ? 'fc-white' : ''}>\n        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9\" /><line x1=\"7\" y1=\"20\" x2=\"17\" y2=\"20\" /><line x1=\"9\" y1=\"16\" x2=\"9\" y2=\"20\" /><line x1=\"15\" y1=\"16\" x2=\"15\" y2=\"20\" /><path d=\"M17 4h4v4\" /><path d=\"M16 9l5 -5\" /></svg>\n\n        </Link>\n        </div>\n\n        <div className='icon-circle'>\n          <a className={props.screenActive ? 'fc-white' : ''}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><circle cx=\"12\" cy=\"12\" r=\"1\" /><circle cx=\"12\" cy=\"12\" r=\"5\" /><line x1=\"15.9\" y1=\"20.11\" x2=\"15.9\" y2=\"20.12\" /><line x1=\"19.04\" y1=\"17.61\" x2=\"19.04\" y2=\"17.62\" /><line x1=\"20.77\" y1=\"14\" x2=\"20.77\" y2=\"14.01\" /><line x1=\"20.77\" y1=\"10\" x2=\"20.77\" y2=\"10.01\" /><line x1=\"19.04\" y1=\"6.39\" x2=\"19.04\" y2=\"6.4\" /><line x1=\"15.9\" y1=\"3.89\" x2=\"15.9\" y2=\"3.9\" /><line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"3.01\" /><line x1=\"8.1\" y1=\"3.89\" x2=\"8.1\" y2=\"3.9\" /><line x1=\"4.96\" y1=\"6.39\" x2=\"4.96\" y2=\"6.4\" /><line x1=\"3.23\" y1=\"10\" x2=\"3.23\" y2=\"10.01\" /><line x1=\"3.23\" y1=\"14\" x2=\"3.23\" y2=\"14.01\" /><line x1=\"4.96\" y1=\"17.61\" x2=\"4.96\" y2=\"17.62\" /><line x1=\"8.1\" y1=\"20.11\" x2=\"8.1\" y2=\"20.12\" /><line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"21.01\" /></svg>\n          </a>\n        </div>\n\n        <div className='icon-circle'>\n          <Button panelOpen=\"left\" className={props.chatActive ? 'fc-white mr--5' : 'mr--5'} onClick={() => props.chatDeactive()} style={{ textOverflow: \"clip\" }}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1\" /><line x1=\"12\" y1=\"12\" x2=\"12\" y2=\"12.01\" /><line x1=\"8\" y1=\"12\" x2=\"8\" y2=\"12.01\" /><line x1=\"16\" y1=\"12\" x2=\"16\" y2=\"12.01\" /></svg>\n          </Button>\n        </div>\n        <div className='icon-circle'>\n          <a onClick={() => props.logout()} className='fc-white'>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M5.64 5.632a9 9 0 1 0 6.36 -2.632v7.714\" /></svg>\n          </a>\n        </div>\n\n\n      </div>\n\n    <div style={{float: 'right', width: '230px', minHeight: '100vh'}}>\n    <div id=\"selfVideos\" style={{marginBottom: '10px', minHeight: '80px', marginTop: '20px', textAlign: 'center'}}></div>\n      <List className='fs-13 z-1 '>\n      \n      </List>\n      <List className='fs-13'>\n        {participants()}\n\n      </List>\n\n      </div>\n      </div>\n\n      <Popover className=\"popover-menu\">\n      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean vel quam et metus dictum auctor. Morbi vestibulum neque mauris, eget egestas lacus congu\n    </Popover>\n\n    </Page>\n  )\n}\nexport default Right;\n","import React, { Component } from 'react';\nimport { render } from 'react-dom';\nimport { Page, Navbar, List, ListInput, Row, Col, ListItem, Preloader, Block, CardContent, CardHeader, CardFooter, Button } from 'framework7-react';\nimport { dict } from '../Dict';\nimport { Client, LocalStream, RemoteStream } from 'ion-sdk-js';\nimport { IonSFUJSONRPCSignal } from 'ion-sdk-js/lib/signal/json-rpc-impl';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport moment from 'moment'\n\nclass Left extends Component {\n    constructor(props) {\n        super(props);\n\n        this.throttle = this.throttle.bind(this)\n        this.send = this.send.bind(this)\n        this.handleChange = this.handleChange.bind(this)\n        this.chatItems = this.chatItems.bind(this)\n\n\n        this.state = {\n            lastTime: Date.now(),\n            content: null,\n            item: null,\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.chats !== this.props.chats) {\n            //console.log(this.props.chats)\n        }\n    }\n\n    componentDidMount() {\n    }\n\n\n    throttle(c, t) {\n        if (Date.now() - this.state.lastTime > 100) {\n            this.setState({ lastTime: Date.now() }, () => {\n                this.props.wsSend({ type: t, c: c })\n            })\n        }\n    }\n    send() {\n        if (this.state.item) {\n            this.throttle(this.state.item, 'chat')\n            this.props.appendChat(this.state.item)\n            this.$$('#chat-form').val('')\n            this.props.chatDeactive()\n        }\n\n    }\n\n    handleChange(obj) {\n        this.setState(obj);\n    }\n\n    chatItems() {\n        var result = []\n        this.props.chats.slice(0).reverse().map((chat) => {\n            //console.log(chat)\n            result.push(\n                <div class=\"item-content\">\n                    <div class=\"item-inner\">\n                        <div class=\"item-title-row\">\n                            <div class=\"item-title\" style={{fontSize: '10px'}}>\n                                {chat.name}\n                            </div>\n                            <div class=\"item-after\">\n                                <span>{moment(chat.time).fromNow()}</span>\n                            </div>\n                        </div>\n                        <div class=\"item-text mh-auto\" style={{overflow: 'auto'}}>\n                            {chat.content}\n                        </div>\n                    </div>\n                </div>\n            )\n        })\n        return result\n    }\n\n\n    render() {\n        return (\n            <Page >\n                <List noHairlinesMd>\n                    <ListInput\n                        inputId='chat-form'\n                        label={dict.chat}\n                        type=\"textarea\"\n                        placeholder={dict.write_here}\n                        onChange={(e) => {\n                            this.handleChange({ item: { content: e.target.value, name: this.props.name, time: Date.now(), uuid: uuidv4() } })\n                        }} />\n                </List>\n                <Row>\n                    <Col>\n\n                    </Col>\n                    <Col>\n\n                    </Col>\n                    <Col>\n                        <Button fill onClick={() => this.send()}>{dict.send}</Button>\n                    </Col>\n                </Row>\n                <List mediaList>\n                    {this.chatItems()}\n                </List>\n\n\n\n            </Page>\n        );\n    }\n}\nexport default Left;\n","import React from \"react\";\nimport { Page, LoginScreenTitle, List, ListInput, Button, BlockFooter, Icon, Card, Link, CardContent, CardHeader, Tabs, Panel, Block } from 'framework7-react';\n\n\nimport { dict } from '../Dict';\n\nconst Login = (props) => {\n    function isSigningUp(block) {\n        if (props.signingUp) {\n            if (block == 'name') {\n                return (\n                    <ListInput\n                        label={dict.name}\n                        className='fs-14'\n                        type=\"text\"\n                        placeholder=\"Your username\"\n                        value={props.name}\n                        onInput={(e) => {\n                            props.handleChangeValue({ name: e.target.value });\n                        }}\n                    />\n                )\n            }\n            if (block == 'passwordConfirmation') {\n                return (\n                    <ListInput\n                        label={dict.password_confirmation}\n                        type=\"text\"\n                        className='fs-14'\n                        placeholder=\"Password Confirmation\"\n                        value={props.passwordConfirmation}\n                        onInput={(e) => {\n                            props.handleChangeValue({ passwordConfirmation: e.target.value });\n                        }}\n                    />\n                )\n            }\n        }\n    }\n\n    function loginButton() {\n        if (props.signingUp) {\n            return (\n                <React.Fragment>\n                    <Button fill onClick={props.login}>{dict.sign_up}</Button>\n                    <BlockFooter>\n                        <a onClick={props.loginActive}>{dict.you_can_login}</a>\n                    </BlockFooter>\n                </React.Fragment>\n            )\n        } else {\n            return (\n                <React.Fragment>\n                    <Button fill onClick={props.login}>{dict.login}</Button>\n                    <BlockFooter>\n                        <a onClick={props.signUp}>{dict.you_can_sign_up}</a>\n                    </BlockFooter>\n                </React.Fragment>\n            )\n        }\n    }\n\n    function casButton() {\n        return (\n            <Button fill className='fs-11 external f-color-black bg-teal' href=\"https://auth.ut.ac.ir:8443/cas/login?service=https%3A%2F%2Fconnect.ut.ac.ir%2Fusers%2Fservice\" animate={false} ignoreCache={true}>{dict.cas} </Button>\n\n        )\n    }\n    return (\n        <Page loginScreen>\n            <LoginScreenTitle> </LoginScreenTitle>\n            <List form>\n                <ListInput\n                    label={dict.email}\n                    className='fs-14'\n                    type=\"text\"\n                    placeholder=\"Your email\"\n                    value={props.email}\n                    onInput={(e) => {\n                        props.handleChangeValue({ email: e.target.value });\n                    }}\n                />\n                {isSigningUp('name')}\n                <ListInput\n                    label={dict.password}\n                    type=\"text\"\n                    className='fs-14'\n                    placeholder=\"Password\"\n                    value={props.password}\n                    onInput={(e) => {\n                        props.handleChangeValue({ password: e.target.value });\n                    }}\n                />\n                {isSigningUp('passwordConfirmation')}\n            </List>\n            <List>\n                {loginButton()}\n            </List>\n            <List>\n                {casButton()}\n            </List>\n        </Page>\n    )\n}\nexport default Login;\n","import React from \"react\";\nimport { Page, Navbar, Row, Toolbar, Col, Fab, Icon, Card, Link, CardContent, CardHeader } from 'framework7-react';\n\nimport { defaults, Bar, Pie } from 'react-chartjs-2';\n\nimport { dict } from '../../Dict';\nimport 'framework7-icons';\n\n//import Board from './board';\n//import Sketch from './sketch';\nimport Board from \"./board\";\n\nconst HomeIndex = (props) => {\n\n    return (\n        <Page >\n            <Navbar title={dict.home} >\n                <Link panelOpen=\"right\">\n                    <Icon f7=\"bars\"></Icon>\n                </Link>\n            </Navbar>\n            <Toolbar tabbar top>\n                <Link tabLink=\"#tab-1\" tabLinkActive>\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z\" /><path d=\"M16 7h4\" /><path d=\"M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3\" /></svg>\n                </Link>\n                <Link tabLink=\"#tab-2\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9\" /><line x1=\"7\" y1=\"20\" x2=\"17\" y2=\"20\" /><line x1=\"9\" y1=\"16\" x2=\"9\" y2=\"20\" /><line x1=\"15\" y1=\"16\" x2=\"15\" y2=\"20\" /><path d=\"M17 4h4v4\" /><path d=\"M16 9l5 -5\" /></svg>\n                </Link>\n                <Link tabLink=\"#tab-3\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z\" /><rect x=\"3\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" /></svg>\n\n                </Link>\n            </Toolbar>\n            <Row>\n\n            </Row>\n        </Page>\n    )\n}\nexport default HomeIndex;\n","import React, { Component } from 'react';\nimport { NavLeft, Link, Page, Navbar, Icon, Row, Col, Card } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport Framework7 from 'framework7/framework7.esm.bundle'\nimport HomeContent from \"../../containers/home/index\"\nimport board from \"../../board.js\";\n\nexport default class HomePage extends Component {\n  constructor() {\n    super();\n    this.getList = this.getList.bind(this);\n    \n\n    this.state = {\n      token: window.localStorage.getItem('token'),\n      bbMeetingHistogram: null,\n      meetingHistogram: null,\n      hourMeetingHistogram: null,\n    }\n  }\n\n\n  componentWillMount() {\n    ModelStore.on(\"got_multiple_list\", this.getList);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"got_multiple_list\", this.getList);\n  }\n\n  componentDidMount() {\n    MyActions.getMultipleList('/home', this.state.page, {}, this.state.token);\n  }\n\n\n  getList() {\n    var home = ModelStore.getMutipleList()\n    var klass = ModelStore.getKlass()\n    if (home && klass === 'Home') {\n      this.setState({\n        meetingHistogram: home.meeting_histogram,\n        hourMeetingHistogram: home.hour_meeting_histogram,\n        bbMeetingHistogram: home.bb_meeting_histogram\n      });\n    }\n  }\n \n\n  render() {\n    const { \n      meetingHistogram, bbMeetingHistogram, \n      hourMeetingHistogram\n     } = this.state;\n    return (<HomeContent \n      bbMeetingHistogram={bbMeetingHistogram}\n      meetingHistogram={meetingHistogram}\n      hourMeetingHistogram={hourMeetingHistogram}\n       />)\n  }\n}","import React from \"react\";\nimport { List, ListItem, Card } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport { Chart } from 'react-charts'\nimport { color } from \"d3\";\n\nconst ProfileShow = (props) => {\n\n  if (props.profile) {\n    console.log(props)\n    return (\n      <React.Fragment>\n        <List className='fs-12'>\n          <ListItem\n            key={'profile-show' + props.profile.id}\n            title={props.profile.fullname}\n            after=''>\n            <img slot=\"media\" src={props.profile.avatar} width=\"27\" height=\"27\" />\n          </ListItem>\n\n        </List>\n        <Card>\n         \n        </Card>\n        <Card>\n          \n        </Card>\n      </React.Fragment>\n    )\n  } else {\n    return (null)\n  }\n}\nexport default ProfileShow;\n","import React, { Component } from 'react';\nimport {\n  Page,\n  Navbar,\n  List,\n  ListItem,\n  ListInput,\n  Link,\n  Tabs,\n  Toolbar,\n  Tab,\n  Range,\n  Block,\n  Icon, Fab\n} from 'framework7-react';\nimport { dict } from '../../Dict';\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport ProfileShow from \"../../containers/profiles/show\"\n\nexport default class Layout extends Component {\n  constructor() {\n    super();\n    this.getInstance = this.getInstance.bind(this);\n    \n    this.state = {\n      token: window.localStorage.getItem('token'),\n      profile: null,\n      id: null,\n      actuals: null,\n      metas: null,\n      channels: null,\n    }\n  }\n\n  componentWillMount() {\n    ModelStore.on(\"got_instance\", this.getInstance);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"got_instance\", this.getInstance);\n  }\n\n  componentDidMount() {\n    MyActions.getInstance('profiles', this.$f7route.params['profileId'], this.state.token);\n  }\n\n  getInstance() {\n    var profile = ModelStore.getIntance()\n    var klass = ModelStore.getKlass()\n    if (profile && klass === 'Profile') {\n      this.setState({\n        profile: profile,\n        id: profile.id,\n      });\n    }\n  }\n\n  fab() {\n    if (this.state.profile) {\n      return (\n        <Fab href={\"/profiles/\" + this.state.profile.id + \"/edit\"} target=\"#main-view\" position=\"left-bottom\" slot=\"fixed\" color=\"lime\">\n          <Icon ios=\"f7:edit\" aurora=\"f7:edit\" md=\"material:edit\"></Icon>\n          <Icon ios=\"f7:close\" aurora=\"f7:close\" md=\"material:close\"></Icon>\n        </Fab>\n      )\n    }\n  }\n\n\n  render() {\n    const { profile } = this.state;\n    return (\n      <Page>\n        <Navbar title={dict.profiles} backLink={dict.back} />\n        {this.fab()}\n        <ProfileShow profile={profile} />\n      </Page>\n    );\n  }\n}\n","import React from \"react\";\nimport { List,ListItem } from 'framework7-react';\nimport crypto from 'crypto-js';\nimport { dict } from \"../../Dict\";\nimport Moment from 'react-moment';\nimport 'moment-timezone';\nimport 'moment/locale/fa';\nimport ExpertiesList from \"./experties\";\n\nconst ProfileList = (props) => {\n\n  if (props.profiles) {\n    return (\n      <List mediaList>\n        {props.profiles.map((profile) =>\n          <ListItem\n          key={crypto.lib.WordArray.random(32)}\n          link={\"/profiles/\" + profile.id}\n          title={profile.fullname}\n          after=\"\"\n          subtitle=\"\"\n          text=\"\"\n          >\n                <img slot=\"media\" src={profile.avatar} width=\"40\" height=\"40\" />\n          </ListItem>\n        )}\n      </List>\n    )\n  } else {\n    return (<ul></ul>)\n  }\n}\nexport default ProfileList;\n","import React from \"react\";\nimport { Page, Navbar, Searchbar, BlockTitle, Subnavbar, Fab, Icon, Link } from 'framework7-react';\nimport ProfileList from \"./list\"\nimport { dict } from '../../Dict';\n\nconst ProfileIndex = (props) => {\n  return (\n    <Page>\n      <Navbar title={dict.profiles} backLink={dict.back} >\n        <Link panelOpen=\"right\">\n          <Icon f7=\"bars\"></Icon>\n        </Link>\n        <Subnavbar inner={false}>\n          <Searchbar\n            disableButtonText={dict.cancel}\n            placeholder={dict.search}\n            onChange={(e) => {\n              props.search({ query: e.target.value })\n            }}\n          ></Searchbar>\n        </Subnavbar>\n      </Navbar>\n      <BlockTitle></BlockTitle>\n      <Fab href=\"/profiles/new\" target=\"#main-view\" position=\"left-bottom\" slot=\"fixed\" color=\"deeporange\">\n        <Icon ios=\"f7:add\" aurora=\"f7:add\" md=\"material:add\"></Icon>\n        <Icon ios=\"f7:close\" aurora=\"f7:close\" md=\"material:close\"></Icon>\n      </Fab>\n      <ProfileList profiles={props.profiles} />\n\n    </Page>\n  )\n}\nexport default ProfileIndex;\n","import React from \"react\"\nimport { Page,Fab, Icon } from 'framework7-react';\nimport ModelStore from \"../../stores/ModelStore\";\nimport ProfileIndex from \"../../containers/profiles/index\"\nimport * as MyActions from \"../../actions/MyActions\";\nimport { dict} from '../../Dict';\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\n\nexport default class Layout extends React.Component {\n  constructor() {\n    super();\n    this.getList = this.getList.bind(this);\n    this.search = this.search.bind(this);\n    \n    this.state = {\n      token: window.localStorage.getItem('token'),\n      profiles: null,\n      query: null,\n    }\n  }\n  componentWillMount() {\n    ModelStore.on(\"got_list\", this.getList);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"got_list\", this.getList);\n  }\n\n  componentDidMount(){\n    this.loadData();\n  }\n\n  loadData(){\n    MyActions.getList('profiles', this.state.page, {}, this.state.token);\n  }\n\n  search(obj){\n    this.setState(obj, () => {\n      MyActions.getList('profiles/search', this.state.page, {q: this.state.query}, this.state.token);\n  });    \n  }\n\n  getList() {\n    var profiles = ModelStore.getList()\n    var klass = ModelStore.getKlass()\n    if (profiles && klass === 'Profile'){\n      this.setState({\n        profiles: profiles,\n      });\n    }\n  }\n\n  render() {\n    const {profiles} = this.state;\n    return(<ProfileIndex profiles={profiles} search={this.search}/>)\n  }\n}\n","import React from \"react\";\nimport { List, ListInput, CardFooter, Button, Card, Link, CardHeader, CardContent, Row } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport crypto from 'crypto-js';\nimport ExpertiesList from \"./experties\";\nimport ImageUploader from 'react-images-upload';\nconst ProfileForm = (props) => {\n  if (props.profile) {\n    return (\n      <React.Fragment>\n        <Card>\n          <CardHeader>{dict.profile_info}</CardHeader>\n          <CardContent>\n            <List >\n              <ListInput\n                label={dict.firstname}\n                type=\"text\"\n                placeholder='...'\n                defaultValue={props.name}\n                onInput={(e) => {\n                  props.handleChange({ name: e.target.value })\n                }}\n              />\n\n              <ListInput\n                label={dict.surename}\n                type=\"text\"\n                placeholder='...'\n                defaultValue={props.surename}\n                onInput={(e) => {\n                  props.handleChange({ surename: e.target.value })\n                }}\n              />\n            </List>\n          </CardContent>\n          <CardFooter>\n            <Link></Link>\n            <Link className=\"btn-notice\"></Link>\n            <Button className=\"col btn\" fill onClick={props.submit}>{dict.submit}</Button>\n          </CardFooter>\n        </Card>\n\n\n\n        <Card>\n          <CardHeader>\n            <img src={props.avatar} width=\"40\" height=\"40\"></img>\n          </CardHeader>\n          <ImageUploader\n            withIcon={true}\n            buttonText={dict.choose_image}\n            onChange={props.onDrop}\n            buttonClassName='upload-btn'\n            imgExtension={['.jpg', '.jpeg', '.png']}\n            maxFileSize={5242880}\n          />\n        </Card>\n\n\n      </React.Fragment>\n    )\n  } else {\n    return (null)\n  }\n\n}\nexport default ProfileForm;\n","import React, { Component } from 'react';\nimport {\n  Page,\n  Navbar,\n  List,\n  ListItem,\n  ListInput,\n  Toggle,\n  BlockTitle,\n  Row,\n  Button,\n  Range,\n  Block,\n  Icon\n} from 'framework7-react';\nimport { dict} from '../../Dict';\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport ProfileForm from \"../../containers/profiles/form\"\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\nexport default class ProfileCreate extends Component {\n  constructor() {\n    super();\n    this.submit = this.submit.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n    this.handleChangeValue = this.handleChangeValue.bind(this);\n    this.handleChangeValueFields = this.handleChangeValueFields.bind(this);\n    this.removeActual = this.removeActual.bind(this);\n    this.getInstance = this.getInstance.bind(this);\n    this.submitFields = this.submitFields.bind(this);\n    this.onDrop = this.onDrop.bind(this);    \n    this.getList = this.getList.bind(this);\n    \n    \n    this.getList = this.getList.bind(this);\n\n    this.state = {\n      profile: {},\n      metas: null,\n      token: window.localStorage.getItem('token'),\n      fields: [],\n      name: 'dd',\n      surename: '',\n      pictures: [],\n      avatar: null,\n    }\n  }\n\n\n  componentWillMount() {\n    ModelStore.on(\"got_instance\", this.getInstance);\n    ModelStore.on(\"set_instance\", this.getInstance);\n    ModelStore.on(\"deleted_instance\", this.getInstance);\n    ModelStore.on(\"got_list\", this.getList);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"got_instance\", this.getInstance);\n    ModelStore.removeListener(\"set_instance\", this.getInstance);\n    ModelStore.removeListener(\"deleted_instance\", this.getInstance);\n    ModelStore.removeListener(\"got_list\", this.getList);\n  }\n\n  componentDidMount(){\n    this.loadData();\n\n  }\n\n  loadData(){\n    MyActions.getList('metas', this.state.page);\n  }\n\n  onDrop(picture) {\n    console.log(picture[0])\n    MyActions.fileUpload('profiles', this.state.id, picture[0], this.state.token);\n  }\n\n\n  submit(){\n    var data = {id: this.state.id, name: this.state.name, surename: this.state.surename}\n    MyActions.updateInstance('profiles', data, this.state.token);\n  }\n\n  submitFields(){\n    var data = {meta_id: this.state.metaId, content: this.state.fields}\n    MyActions.setInstance('actuals', data, this.state.token);\n  }\n\n\n  handleChangeValue(obj) {\n    this.setState(obj);\n  }\n\n  handleChangeValueFields(key, value, metaId) {\n    var fields = this.state.fields\n    if (fields.length > 0) {\n      for (let i = 0; i < fields.length; i++) {\n        if (fields[i].fid && fields[i].fid === key) {\n          let newState = Object.assign({}, this.state);\n          newState.fields[i] = { fid: key, value: value, metaId: metaId }\n          this.setState(newState);\n        } else {\n          this.setState({ fields: this.state.fields.concat({ fid: key, value: value , metaId:metaId}) });\n        }\n      }\n    } else {\n      this.setState({ fields: this.state.fields.concat({ fid: key, value: value, metaId:metaId }) });\n    }\n  }\n\n  setInstance(){\n    const self = this;\n    this.$f7router.navigate('/profiles/');\n  }\n\n  getInstance() {\n    var profile = ModelStore.getIntance()\n    var klass = ModelStore.getKlass()\n    if (profile && klass === 'Profile') {\n      this.setState({\n        metas: profile.metas,\n        profile: profile\n      });\n    }\n  }\n\n\n  removeActual(uuid){\n    MyActions.removeInstance('actuals', {uuid: uuid});\n  }\n\n  getList() {\n    var metas = ModelStore.getList()\n    var klass = ModelStore.getKlass()\n    if (metas && klass === 'Meta'){\n      this.setState({\n        metas: metas,\n      });\n    }\n  }\n\n\n\n  render() {\n    const {profile, metas, name, avatar, surename} = this.state;\n    return (\n      <Page>\n        <Navbar title={dict.profile_form} backLink={dict.back} />\n        <BlockTitle>{dict.profile_form}</BlockTitle>\n        <ProfileForm name={name} avatar={avatar} surename={surename} metas={metas} onDrop={this.onDrop} removeActual={this.removeActual} submitFields={this.submitFields} submit={this.submit} editing={true} handleChangeValueFields={this.handleChangeValueFields} handleChange={this.handleChangeValue}/>\n      </Page>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport {\n  Page,\n  Navbar,\n  BlockTitle,\n} from 'framework7-react';\nimport { dict} from '../../Dict';\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport ProfileForm from \"../../containers/profiles/form\"\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\nexport default class ProfileCreate extends Component {\n  constructor() {\n    super();\n    this.submit = this.submit.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n    this.handleChangeValue = this.handleChangeValue.bind(this);\n    this.getInstance = this.getInstance.bind(this);\n    this.onDrop = this.onDrop.bind(this);    \n    \n\n    \n\n    this.state = {\n      name: null,\n      surename: null,\n      token: window.localStorage.getItem('token'),\n      profile: null,\n      id: null, \n      pictures: [],\n      avatar: null,\n    }\n  }\n\n\n  componentWillMount() {\n    ModelStore.on(\"got_instance\", this.getInstance);\n    ModelStore.on(\"set_instance\", this.setInstance);\n    ModelStore.on(\"file_posted\", this.getInstance);    \n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"got_instance\", this.getInstance);\n    ModelStore.removeListener(\"set_instance\", this.setInstance);\n    ModelStore.removeListener(\"file_posted\", this.getInstance);\n  }\n\n  componentDidMount(){\n    this.loadData();\n  }\n\n  loadData(){\n    if (this.$f7route.params['profileId']) {\n      MyActions.getInstance('profiles', this.$f7route.params['profileId'], this.state.token);\n    }\n  }\n\n  onDrop(picture) {\n    console.log(picture[0])\n    MyActions.fileUpload('profiles', this.state.id, picture[0], this.state.token);\n  }\n\n\n  submit(){\n    var data = {id: this.state.id, name: this.state.name, surename: this.state.surename}\n    MyActions.updateInstance('profiles', data, this.state.token);\n  }\n\n\n\n\n  handleChangeValue(obj) {\n    this.setState(obj);\n  }\n\n\n\n  setInstance(){\n    const self = this;\n    this.$f7router.navigate('/profiles/');\n  }\n\n  getInstance() {\n    var profile = ModelStore.getIntance()\n    var klass = ModelStore.getKlass()\n    if (profile && klass === 'Profile') {\n      this.setState({\n        id: profile.id, \n        profile: profile,\n        name: profile.name,\n        surename : profile.surename,\n        avatar: profile.avatar,\n      });\n    }\n  }\n\n\n\n\n\n\n  render() {\n    const {profile, name, surename, avatar} = this.state;\n    return (\n      <Page>\n        <Navbar title={dict.profile_form} backLink={dict.back} />\n        <BlockTitle>{dict.profile_form}</BlockTitle>\n        <ProfileForm profile={profile}\n          name={name} avatar={avatar} surename={surename} onDrop={this.onDrop}  \n         submit={this.submit} editing={true} \n         handleChange={this.handleChangeValue} \n         />\n      </Page>\n    );\n  }\n}\n\n","import Janus from \"../../janus.js\";\nexport function sessionCreate() {\n    var self = this;\n    Janus.init({\n        debug: \"all\",\n        callback: function () {\n            var janus = new Janus(\n                {\n                    server: self.state.server,\n                    success: function () {\n                        // Attach to AudioBridge plugin\n                        janus.attach(\n                            {\n                                plugin: \"janus.plugin.audiobridge\",\n                                opaqueId: self.state.opaqueId,\n                                success: function (pluginHandle) {\n                                    //$('#details').remove();\n                                    self.setState({ mixertest: pluginHandle });\n                                    Janus.log(\"Plugin attached! (\" + self.state.mixertest.getPlugin() + \", id=\" + self.state.mixertest.getId() + \")\");\n                                    self.registerUsername();\n                                    // Prepare the username registration\n                                    /*\n                                    $('#audiojoin').removeClass('hide').show();\n                                    $('#registernow').removeClass('hide').show();\n                                    $('#register').click(registerUsername);\n                                    $('#username').focus();\n                                    $('#start').removeAttr('disabled').html(\"Stop\")\n                                        .click(function () {\n                                            $(this).attr('disabled', true);\n                                            janus.destroy();\n                                        });\n                                    */\n                                },\n                                error: function (error) {\n                                    Janus.error(\"  -- Error attaching plugin...\", error);\n                                    //bootbox.alert(\"Error attaching plugin... \" + error);\n                                },\n                                consentDialog: function (on) {\n                                    Janus.debug(\"Consent dialog should be \" + (on ? \"on\" : \"off\") + \" now\");\n                                },\n                                iceState: function (state) {\n                                    Janus.log(\"ICE state changed to \" + state);\n                                },\n                                mediaState: function (medium, on) {\n                                    Janus.log(\"Janus \" + (on ? \"started\" : \"stopped\") + \" receiving our \" + medium);\n                                },\n                                webrtcState: function (on) {\n                                    Janus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n                                },\n                                onmessage: function (msg, jsep) {\n                                    Janus.debug(\" ::: Got a message :::\", msg);\n                                    var event = msg[\"audiobridge\"];\n                                    Janus.debug(\"Event: \" + event);\n                                    if (event) {\n                                        if (event === \"joined\") {\n                                            // Successfully joined, negotiate WebRTC now\n                                            if (msg[\"id\"]) {\n                                                self.setState({\n                                                    myid: msg[\"id\"],\n                                                });\n                                                Janus.log(\"Successfully joined room \" + msg[\"room\"] + \" with ID \" + self.state.myid);\n                                                self.addParticipant(msg[\"id\"], self.state.fullname + '' + self.state.userUUID);\n                                                if (!self.state.webrtcUp) {\n                                                    self.setState({ webrtcUp: true });\n                                                    // Publish our stream\n                                                    self.state.mixertest.createOffer(\n                                                        {\n                                                            media: { video: false,  audio: { echoCancellation: true } },\t// This is an audio only room\n                                                            success: function (jsep) {\n                                                                Janus.debug(\"Got SDP!\", jsep);\n                                                                var publish = { request: \"configure\", muted: false };\n                                                                self.state.mixertest.send({ message: publish, jsep: jsep });\n                                                            },\n                                                            error: function (error) {\n                                                                Janus.error(\"WebRTC error:\", error);\n                                                                // bootbox.alert(\"WebRTC error... \" + error.message);\n                                                            }\n                                                        });\n                                                }\n                                            }\n                                            // Any room participant?\n                                            if (msg[\"participants\"]) {\n                                                var list = msg[\"participants\"];\n                                                Janus.debug(\"Got a list of participants:\", list);\n                                                for (var f in list) {\n                                                    var id = list[f][\"id\"];\n                                                    var display = list[f][\"display\"];\n                                                    var setup = list[f][\"setup\"];\n                                                    var muted = list[f][\"muted\"];\n                                                    self.addParticipant(list[f][\"id\"], list[f][\"display\"]);\n                                                    //self.newRemoteFeed(id, display, audio, video);\n                                                    /*\n                                                    Janus.debug(\"  >> [\" + id + \"] \" + display + \" (setup=\" + setup + \", muted=\" + muted + \")\");\n                                                    if ($('#rp' + id).length === 0) {\n                                                        // Add to the participants list\n                                                        $('#list').append('<li id=\"rp' + id + '\" class=\"list-group-item\">' + display +\n                                                            ' <i class=\"absetup fa fa-chain-broken\"></i>' +\n                                                            ' <i class=\"abmuted fa fa-microphone-slash\"></i></li>');\n                                                        $('#rp' + id + ' > i').hide();\n                                                    }\n                                                    if (muted === true || muted === \"true\")\n                                                        $('#rp' + id + ' > i.abmuted').removeClass('hide').show();\n                                                    else\n                                                        $('#rp' + id + ' > i.abmuted').hide();\n                                                    if (setup === true || setup === \"true\")\n                                                        $('#rp' + id + ' > i.absetup').hide();\n                                                    else\n                                                        $('#rp' + id + ' > i.absetup').removeClass('hide').show();\n                                                        */\n                                                }\n                                            }\n                                        } else if (event === \"roomchanged\") {\n                                            // The user switched to a different room\n                                            self.setState({\n                                                myid: msg[\"id\"],\n                                            });\n                                            Janus.log(\"Moved to room \" + msg[\"room\"] + \", new ID: \" + self.state.myid);\n                                            // Any room participant?\n                                           // $('#list').empty();\n                                            if (msg[\"participants\"]) {\n                                                var list = msg[\"participants\"];\n                                                Janus.debug(\"Got a list of participants:\", list);\n                                                for (var f in list) {\n                                                    var id = list[f][\"id\"];\n                                                    var display = list[f][\"display\"];\n                                                    var setup = list[f][\"setup\"];\n                                                    var muted = list[f][\"muted\"];\n\n                                                    self.addParticipant(msg[\"id\"], self.state.fullname + '' + self.state.userUUID);\n\n                                                    Janus.debug(\"  >> [\" + id + \"] \" + display + \" (setup=\" + setup + \", muted=\" + muted + \")\");\n                                                    /*\n                                                     if ($('#rp' + id).length === 0) {\n                                                         // Add to the participants list\n                                                         $('#list').append('<li id=\"rp' + id + '\" class=\"list-group-item\">' + display +\n                                                             ' <i class=\"absetup fa fa-chain-broken\"></i>' +\n                                                             ' <i class=\"abmuted fa fa-microphone-slash\"></i></li>');\n                                                         $('#rp' + id + ' > i').hide();\n                                                     }\n                                                     if (muted === true || muted === \"true\")\n                                                         $('#rp' + id + ' > i.abmuted').removeClass('hide').show();\n                                                     else\n                                                         $('#rp' + id + ' > i.abmuted').hide();\n                                                     if (setup === true || setup === \"true\")\n                                                         $('#rp' + id + ' > i.absetup').hide();\n                                                     else\n                                                         $('#rp' + id + ' > i.absetup').removeClass('hide').show();\n                                                         */\n                                                }\n                                            }\n                                        } else if (event === \"destroyed\") {\n                                            // The room has been destroyed\n                                            Janus.warn(\"The room has been destroyed!\");\n                                        } else if (event === \"event\") {\n                                            if (msg[\"participants\"]) {\n                                                var list = msg[\"participants\"];\n                                                Janus.debug(\"Got a list of participants:\", list);\n                                                for (var f in list) {\n                                                    var id = list[f][\"id\"];\n                                                    var display = list[f][\"display\"];\n                                                    var setup = list[f][\"setup\"];\n                                                    var muted = list[f][\"muted\"];\n                                                    Janus.debug(\"  >> [\" + id + \"] \" + display + \" (setup=\" + setup + \", muted=\" + muted + \")\");\n\n                                                    self.addParticipant(list[f][\"id\"], list[f][\"display\"]);\n                                                    /*\n                                                    if ($('#rp' + id).length === 0) {\n                                                        // Add to the participants list\n                                                        $('#list').append('<li id=\"rp' + id + '\" class=\"list-group-item\">' + display +\n                                                            ' <i class=\"absetup fa fa-chain-broken\"></i>' +\n                                                            ' <i class=\"abmuted fa fa-microphone-slash\"></i></li>');\n                                                        $('#rp' + id + ' > i').hide();\n                                                    }\n                                                    if (muted === true || muted === \"true\")\n                                                        $('#rp' + id + ' > i.abmuted').removeClass('hide').show();\n                                                    else\n                                                        $('#rp' + id + ' > i.abmuted').hide();\n                                                    if (setup === true || setup === \"true\")\n                                                        $('#rp' + id + ' > i.absetup').hide();\n                                                    else\n                                                        $('#rp' + id + ' > i.absetup').removeClass('hide').show();\n                                                        */\n                                                }\n                                            } else if (msg[\"error\"]) {\n                                                if (msg[\"error_code\"] === 485) {\n                                                    // This is a \"no such room\" error: give a more meaningful description\n                                                } else {\n\n                                                }\n                                                return;\n                                            }\n                                            // Any new feed to attach to?\n                                            if (msg[\"leaving\"]) {\n                                                // One of the participants has gone away?\n                                                var leaving = msg[\"leaving\"];\n                                                Janus.log(\"Participant left: \" + leaving  + \" elements with ID #rp\" + leaving + \")\");\n                                                //$('#rp' + leaving).remove();\n                                            }\n                                        }\n                                    }\n                                    if (jsep) {\n                                        Janus.debug(\"Handling SDP as well...\", jsep);\n                                        self.state.mixertest.handleRemoteJsep({ jsep: jsep });\n                                    }\n                                },\n                                onlocalstream: function (stream) {\n                                    Janus.debug(\" ::: Got a local stream :::\", stream);\n                                    // We're not going to attach the local audio stream\n                                    // $('#audiojoin').hide();\n                                    // $('#room').removeClass('hide').show();\n                                    //$('#participant').removeClass('hide').html(myusername).show();\n                                },\n                                onremotestream: function (stream) {\n                                    // $('#room').removeClass('hide').show();\n                                    // var addButtons = false;\n                                    /// if ($('#roomaudio').length === 0) {\n                                    //    addButtons = true;\n                                    //    $('#mixedaudio').append('<audio class=\"rounded centered\" id=\"roomaudio\" width=\"100%\" height=\"100%\" autoplay/>');\n                                    //}\n                                    //Janus.attachMediaStream($('#roomaudio').get(0), stream);\n                                    // if (!addButtons)\n                                    //     return;\n                                    // Mute button\n                                    //   audioenabled = true;\n                                    //   $('#toggleaudio').click(\n                                    //      function () {\n                                    //          audioenabled = !audioenabled;\n                                    //          if (audioenabled)\n                                    //            $('#toggleaudio').html(\"Mute\").removeClass(\"btn-success\").addClass(\"btn-danger\");\n                                    //        else\n                                    //           $('#toggleaudio').html(\"Unmute\").removeClass(\"btn-danger\").addClass(\"btn-success\");\n                                    //       mixertest.send({ message: { request: \"configure\", muted: !audioenabled } });\n                                    //  }).removeClass('hide').show();\n                                    if (self.$$('#roomaudio').length === 0) {\n                                        self.$$('#mixedaudio').append('<audio class=\"rounded centered\" id=\"roomaudio\" width=\"100%\" height=\"100%\" autoplay/>');\n                                        Janus.attachMediaStream(document.getElementById('roomaudio'), stream);\n                                    }\n                                },\n                                oncleanup: function () {\n                                    //  webrtcUp = false;\n                                    Janus.log(\" ::: Got a cleanup notification :::\");\n                                    //$('#participant').empty().hide();\n                                    //$('#list').empty();\n                                    //$('#mixedaudio').empty();\n                                    //$('#room').hide();\n                                }\n                            });\n                    },\n                    error: function (error) {\n                        //   Janus.error(error);\n                        console.log(error)\n                    },\n                    destroyed: function () {\n                        window.location.reload();\n                    }\n                });\n        },\n    });\n}\n\nexport function registerUsername() {\n    var self = this;\n    var register = {\n        request: \"join\",\n        room: 1234,\n        display: self.state.fullname + \" \" + self.state.userUUID,\n    };\n    self.state.mixertest.send({ message: register });\n}\n\nexport function addParticipant(id, p) {\n    console.log('Adding Participants ...', id, p)\n    var self = this;\n    var participant = p.split('')\n    if (this.exisitingParticipant(participant[1])) {\n        self.setState({ participants: self.state.participants.concat({ id: id, display: participant[0], uuid: participant[1], role: 'listener' }) });\n    }\n    console.log('participant added:', participant[1])\n}\n\nexport function exisitingParticipant(participantId) {\n    var self = this;\n    var exisiting = self.state.participants.filter(\n        (item) => item.uuid === participantId\n    );\n    if (exisiting.length === 0) {\n        return true\n    } else {\n        return false\n    }\n}","import React from \"react\";\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport {  Panel, View} from 'framework7-react';\n\n\nimport $ from 'jquery';\nimport { dict } from \"../../Dict\";\nimport { conf } from \"../../conf\";\nimport Janus from \"../../janus.js\";\nimport RoomShow from \"../../containers/rooms/show\";\nimport { \n    sessionCreate, addParticipant, exisitingParticipant, registerUsername\n   } from \"../../components/rooms/janus-tools.js\"\n\n//import {newRemoteFeed} from \"./newRemoteFeed.js\"\n\nexport default class Layout extends React.Component {\n    constructor() {\n        super();\n\n        this.sessionCreate = sessionCreate.bind(this);\n        this.registerUsername = registerUsername.bind(this);\n        this.pageAfterIn = this.pageAfterIn.bind(this);\n        //this.streamAttacher = this.streamAttacher.bind(this);\n        //this.streamDettacher = this.streamDettacher.bind(this);\n        //this.unmute = this.unmute.bind(this);\n        this.getInstance = this.getInstance.bind(this);\n        this.setInstance = this.setInstance.bind(this);\n        this.addParticipant = addParticipant.bind(this);\n        //this.removeParticipant = this.removeParticipant.bind(this);\n        this.exisitingParticipant = exisitingParticipant.bind(this);\n        //this.findParticpantByUuid = this.findParticpantByUuid.bind(this);\n        //this.participantIndex = this.participantIndex.bind(this);\n        //this.findParticpantById = this.findParticpantById.bind(this);\n        //this.findFeedByRfid = this.findFeedByRfid.bind(this);\n        //this.findFeedById = this.findFeedById.bind(this);\n\n\n\n        this.state = {\n            token: window.localStorage.getItem(\"token\"),\n            shortners: null,\n            server: conf.janusServer,\n            janus: null,\n            sfutest: null,\n            opaqueId: \"videoroomtest-\" + Janus.randomString(12),\n            roomId: 1234,\n            webrtcUp: null,\n            myusername: null,\n            mixertest: null,\n            myid: null,\n            mystream: null,\n            pin: null,\n            userUUID: null,\n            fullname: null,\n            isOwner: false,\n            muted: true,\n            participants: [],\n            room: null,\n            notification: {},\n            chats: [],\n            panelOpen: false,\n        };\n    }\n    componentWillMount() {\n        ModelStore.on(\"got_instance\", this.getInstance);\n        ModelStore.on(\"set_instance\", this.setInstance);\n    }\n\n    componentWillUnmount() {\n        ModelStore.removeListener(\"got_instance\", this.getInstance);\n        ModelStore.removeListener(\"set_instance\", this.setInstance);\n        window.removeEventListener(\"beforeunload\", this.unPublishData);\n    }\n\n    componentDidMount() {\n        MyActions.getInstance('rooms', this.$f7route.params['roomId'], this.state.token);\n        window.addEventListener(\"beforeunload\", this.unPublishData);\n        if(window.innerWidth > 960) {\n            this.setState({panelOpen: true})\n            console.log('>960')\n        }\n        const app = this.$f7;\n      \n        console.log('props',   app.panel.get('#panel-r'))\n\n\n    }\n\n    submitParticipation(activity) {\n        var data = { room_id: this.state.id, activity: activity }\n        MyActions.setInstance('participations', data, this.state.token);\n    }\n\n\n\n\n    getInstance() {\n        var room = ModelStore.getIntance()\n        var klass = ModelStore.getKlass()\n        if (room && klass === 'Room') {\n            this.setState({\n                room: room,\n                id: room.id,\n                roomId: room.room_id,\n                pin: room.pin,\n                //userUUID: room.user_uuid,\n                fullname: room.user_fullname,\n                title: room.title,\n                isOwner: room.is_owner\n            }, () => this.submitParticipation('joined'));\n        }\n        console.log(room)\n    }\n\n    pageAfterIn() {\n        var self = this;\n        self.sessionCreate();\n    }\n\n    setInstance() {\n        var participation = ModelStore.getIntance()\n        var klass = ModelStore.getKlass()\n        if (participation && klass === 'Participation') {\n            this.setState({\n                userUUID: participation.uuid,\n            }, () => this.pageAfterIn());\n        }\n        console.log(participation)\n    }\n\n\n    render() {\n        const {\n            token,\n            shortners,\n            urls,\n            publishedMicrophone,\n            publishedCamera,\n            publishedDesktop,\n            feeds,\n            muted,\n            lowFeeds,\n            requests,\n            participants,\n            room,\n            notification,\n            chats,\n            isOwner,\n            roomId,\n            panelOpen\n        } = this.state;\n        return (\n            <React.Fragment>\n\n            <RoomShow participants={participants} panelOpen={panelOpen}\n            />\n            </React.Fragment>\n        );\n    }\n}","import React from \"react\";\nimport { Link, List, CardHeader, ListInput, CardContent, CardFooter, Button, Page, Card, Navbar, Icon } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport crypto from 'crypto-js';\n\nconst LoginForm = (props) => {\n  return (\n    <Page>\n      <Navbar title={dict.sign_up} >\n        <Link panelOpen=\"right\">\n          <Icon f7=\"bars\"></Icon>\n        </Link>\n      </Navbar>\n      <Card>\n        <CardHeader>{dict.login}</CardHeader>\n        <CardContent className='mh-auto'>\n          <List >\n            <ListInput\n              label={dict.email}\n              type=\"text\"\n              autofocus={true}\n              placeholder={dict.enter_your_email}\n              value={props.email}\n              onInput={(e) => {\n                props.handleChange({ email: e.target.value })\n              }}\n            />\n            {/*<ListInput\n              label={dict.password}\n              type=\"password\"\n              placeholder={dict.enter_your_password}\n              value={props.password}\n              onInput={(e) => {\n                props.handleChange({ password: e.target.value })\n              }}\n            />*/}\n          </List>\n        </CardContent>\n        <CardFooter>\n          <Link href=\"/sign_up/\" animate={false} ignoreCache={true}>{dict.you_can_sign_up} </Link>\n          <Button fill className='fs-11 external f-color-black bg-teal' href=\"https://auth.ut.ac.ir:8443/cas/login?service=https%3A%2F%2Ftavan.ut.ac.ir%2Fusers%2Fservice\"  animate={false} ignoreCache={true}>{dict.cas} </Button>\n          <Link className=\"btn-notice\"></Link>\n          <Button className=\"col btn\" fill onClick={props.submit}>{dict.login}</Button>\n        </CardFooter>\n      </Card>\n    </Page>\n  )\n}\nexport default LoginForm;\n","import React from 'react';\nimport {\n  Page,\n  Navbar,\n  NavLeft,\n  NavTitle,\n  NavRight,\n  Link,\n  Toolbar,\n  Block,\n  BlockTitle,\n  List,\n  ListItem,\n  Row,\n  Col,\n  Button, Icon, Fab,Searchbar, Subnavbar, LoginScreenTitle, ListInput, ListButton, BlockFooter\n} from 'framework7-react';\nimport { dict} from '../../Dict';\nimport LoginForm from \"../../containers/users/Login\"\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\nexport default class extends React.Component {\n  constructor() {\n    super();\n    this.submit = this.submit.bind(this);\n    this.handleChangeValue = this.handleChangeValue.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n\n    this.state = {\n      token: window.localStorage.getItem('token'),\n      email: '',\n      password: '',\n    };\n  }\n\n  componentWillMount() {\n    ModelStore.on(\"set_instance\", this.setInstance);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"set_instance\", this.setInstance);\n  }\n  componentDidMount(){\n    if(this.$f7route.params['token']) {\n      MyActions.setInstance('users/validate_token', {}, this.$f7route.params['token']);\n    }\n    if(this.state.token && this.state.token.length > 10){\n      MyActions.setInstance('users/validate_token', {}, this.state.token);\n    }\n  }\n\n  submit(){\n    var data = {email: this.state.email, password: this.state.password}\n    MyActions.setInstance('users/login', data);\n  }\n\n  setInstance(){\n    var klass = ModelStore.getKlass()\n    if (klass === 'Login') {\n      this.$f7router.navigate('/verification/'+this.state.email);\n    }\n    if (klass === 'Validate') {\n      this.$f7router.navigate('/');\n      window.location.replace('https://connect.ut.ac.ir/');\n    }\n    console.log(klass)\n  }\n\n\n  handleChangeValue(obj) {\n    this.setState(obj);\n  }\n\n  render() {\n    const {username, password} = this.state;\n    return (\n      <LoginForm submit={this.submit} handleChange={this.handleChangeValue}/>\n    )\n  }\n\n}\n","import React from 'react';\nimport {\n  Page,\n  Navbar,\n  NavLeft,\n  NavTitle,\n  NavRight,\n  Link,\n  Toolbar,\n  Block,\n  BlockTitle,\n  List,\n  ListItem,\n  Row,\n  Col,\n  Button, Icon, Fab,Searchbar, Subnavbar, LoginScreenTitle, ListInput, ListButton, BlockFooter\n} from 'framework7-react';\nimport { dict} from '../../Dict';\nimport LoginForm from \"../../containers/users/Login\"\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\nexport default class extends React.Component {\n  constructor() {\n    super();\n    this.handleChangeValue = this.handleChangeValue.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n\n    this.state = {\n      email: '',\n      password: '',\n    };\n  }\n\n  componentWillMount() {\n    ModelStore.on(\"set_instance\", this.setInstance);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"set_instance\", this.setInstance);\n  }\n  componentDidMount(){\n    MyActions.setInstance('users/validate_token', {}, this.$f7route.params['token']);\n  }\n\n  setInstance() {\n    var user = ModelStore.getIntance()\n    var klass = ModelStore.getKlass()\n    if (klass === 'Validate') {\n      window.localStorage.setItem('token', user.token);\n      this.$f7router.navigate('/');\n      window.location.reload()\n    } else {\n      this.$f7router.navigate('/login_error/');\n      window.location.reload()\n    }\n  }\n\n\n\n  handleChangeValue(obj) {\n    this.setState(obj);\n  }\n\n  render() {\n    const {username, password} = this.state;\n    return (\n      <LoginForm submit={this.submit} handleChange={this.handleChangeValue}/>\n    )\n  }\n\n}\n","import React from \"react\";\nimport { Link, List, ListItem, ListInput, Navbar, Icon, Button, Page, LoginScreenTitle, ListButton, CardFooter, Card, CardHeader, CardContent } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport crypto from 'crypto-js';\n\nconst SignUpForm = (props) => {\n  return (\n    <Page>\n      <Navbar title={dict.sign_up} >\n        <Link panelOpen=\"right\">\n          <Icon f7=\"bars\"></Icon>\n        </Link>\n      </Navbar>\n      <Card>\n        <CardHeader>{dict.sign_up}</CardHeader>\n        <CardContent>\n          <List >\n            <ListInput\n              label={dict.firstname + ' *'}\n              placeholder={dict.enter_your_name}\n              type=\"text\"\n              name={crypto.lib.WordArray.random(32)}\n              onInput={(e) => {\n                props.handleChange({ name: e.target.value })\n              }}\n            />\n\n            <ListInput\n              label={dict.surename + ' *'}\n              placeholder={dict.enter_your_surename}\n              type=\"text\"\n              name={crypto.lib.WordArray.random(32)}\n              onInput={(e) => {\n                props.handleChange({ surename: e.target.value })\n              }}\n            />\n\n\n            <ListInput\n              label={' * ' + dict.email}\n              type=\"email\"\n              validate\n              placeholder={dict.enter_your_email}\n              className='ltr'\n              value={props.email}\n              onInput={(e) => {\n                props.handleChange({ email: e.target.value })\n              }}\n            />\n          {/*\n            <ListInput\n              label={dict.password + ' *'}\n              type=\"password\"\n              placeholder={dict.enter_your_password}\n              autocomplete='new-password'\n              name={crypto.lib.WordArray.random(32)}\n              value={props.password}\n              onInput={(e) => {\n                props.handleChange({ password: e.target.value })\n              }}\n            />\n            <ListInput\n              label={dict.password_confirmation + ' *'}\n              type=\"password\"\n              autocomplete='off'\n              placeholder={dict.enter_your_password_confirmation}\n              value={props.password}\n              onInput={(e) => {\n                props.handleChange({ password_confirmation: e.target.value })\n              }}\n            />*/}\n          </List>\n        </CardContent>\n        <CardFooter>\n          <Link href=\"/login/\">{dict.if_registered}{'\\u00A0'}{dict.you_can_login} </Link>\n          <Link className=\"btn-notice\"></Link>\n          <Button className=\"col btn\" fill onClick={props.submit}>{dict.sign_up}</Button>\n        </CardFooter>\n      </Card>\n    </Page>\n  )\n}\nexport default SignUpForm;\n","import React from 'react';\nimport {\n  Page,\n  Navbar,\n  NavLeft,\n  NavTitle,\n  NavRight,\n  Link,\n  Toolbar,\n  Block,\n  BlockTitle,\n  List,\n  ListItem,\n  Row,\n  Col,\n  Button, Icon, Fab, Searchbar, Subnavbar, LoginScreenTitle, ListInput, ListButton, BlockFooter\n} from 'framework7-react';\nimport { dict } from '../../Dict';\nimport SignUpForm from \"../../containers/users/SignUp\"\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\nexport default class extends React.Component {\n  constructor() {\n    super();\n    this.submit = this.submit.bind(this);\n    this.handleChangeValue = this.handleChangeValue.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n\n    this.state = {\n      email: '',\n      name: '',\n      surename: '',\n    };\n  }\n\n  componentWillMount() {\n    ModelStore.on(\"set_instance\", this.setInstance);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"set_instance\", this.setInstance);\n  }\n\n  submit() {\n    this.$$('.btn').hide();\n    this.$$('.btn-notice').text(dict.submitting);\n    var data = { \n      email: this.state.email,\n       name: this.state.name, \n       surename: this.state.surename }\n    if (\n      (this.state.email && this.state.email.length > 0) &&\n      (this.state.name && this.state.name.length > 0) &&\n      (this.state.surename && this.state.surename.length > 0) \n      ) {\n      MyActions.setInstance('users/sign_up', data);\n    } else {\n      const self = this;\n      self.$f7.dialog.alert(dict.incomplete_data, dict.alert);\n    }\n  }\n\n  setInstance() {\n    var klass = ModelStore.getKlass()\n    if (klass === 'SignUp') {\n      this.$$('.btn').show();\n      this.$f7router.navigate('/verification/'+this.state.email);\n    }\n  }\n\n\n  handleChangeValue(obj) {\n    this.setState(obj);\n    console.log(obj)\n  }\n\n  render() {\n    const { username, password } = this.state;\n    return (\n      <SignUpForm submit={this.submit} handleChange={this.handleChangeValue} />\n    )\n  }\n\n}\n","import React from \"react\";\nimport { Link, List, CardHeader, ListInput, CardContent, CardFooter, Button, Page, Card, Navbar, Icon } from 'framework7-react';\nimport { dict } from '../../Dict';\nimport crypto from 'crypto-js';\n\nconst LoginForm = (props) => {\n  return (\n    <Page>\n      <Navbar title={dict.verification} >\n        <Link panelOpen=\"right\">\n          <Icon f7=\"bars\"></Icon>\n        </Link>\n      </Navbar>\n      <Card>\n        <CardHeader>{dict.login}</CardHeader>\n        <CardContent >\n          <List >\n          <ListInput\n              label={dict.email}\n              type=\"text\"\n              autofocus={true}\n              placeholder={dict.enter_your_email}\n              value={props.email}\n              onInput={(e) => {\n                props.handleChange({ email: e.target.value })\n              }}\n            />\n            <ListInput\n              label={dict.verification_code}\n              type=\"text\"\n              placeholder={dict.enter_verification_code}\n              onInput={(e) => {\n                props.handleChange({ verificationCode: e.target.value })\n              }}\n            />\n          </List>\n        </CardContent>\n        <CardFooter>\n          <Link href=\"/sign_up/\" animate={false} ignoreCache={true}>{dict.you_can_sign_up} </Link>\n          <Link className=\"btn-notice\"></Link>\n          <Button className=\"col btn\" fill onClick={props.submit}>{dict.login}</Button>\n        </CardFooter>\n      </Card>\n    </Page>\n  )\n}\nexport default LoginForm;\n","import App from './components/App.jsx';\nimport HomePage from './components/home/index.jsx';\nimport NotFoundPage from './containers/layouts/NotFoundPage';\n//import PanelRightPage from './containers/layouts/PanelRightPage';\n\nimport ProfileShow from './components/profiles/show';\nimport ProfileIndex from './components/profiles/index';\nimport ProfileCreate from './components/profiles/create';\nimport ProfileUpdate from './components/profiles/update';\n\n\nimport RoomShow from './components/rooms/show';\nimport RoomIndex from './components/rooms/index';\n\nimport Login from './components/users/Login';\nimport LoginJwt from './components/users/LoginJwt';\nimport SignUp from './components/users/SignUp';\nimport Verification from './components/users/Verification';\n\n\nexport default [\n  {\n    path: '/',\n    component: App,\n  },\n  {\n    path: '/:token',\n    component: App,\n  },\n  {\n    path: '/login/',\n    component: Login,\n  },\n  {\n    path: '/sign_up/',\n    component: SignUp,\n  },\n  {\n    path: '/verification/:email',\n    component: Verification,\n  },\n  {\n    path: '/login_jwt/:token',\n    component: LoginJwt,\n  },\n\n  //{\n  //  path: '/panel-right/',\n  //  component: PanelRightPage,\n  //},\n\n  {\n    path: '/profiles/',\n    component: ProfileIndex,\n  },\n  {\n    path: '/profiles/:profileId/edit',\n    component: ProfileUpdate,\n  },\n  {\n    path: '/profiles/new',\n    component: ProfileCreate,\n  },\n  {\n    path: '/profiles/:profileId',\n    component: ProfileShow,\n  },\n\n  {\n    path: '/rooms/',\n    component: RoomIndex,\n  },\n  {\n    path: '/rooms/:roomId',\n    component: RoomShow,\n  },\n\n  {\n    path: '(.*)',\n    component: NotFoundPage,\n  },\n];\n","import React from 'react';\nimport {\n  Page,\n  Navbar,\n  NavLeft,\n  NavTitle,\n  NavRight,\n  Link,\n  Toolbar,\n  Block,\n  BlockTitle,\n  List,\n  ListItem,\n  Row,\n  Col,\n  Button, Icon, Fab,Searchbar, Subnavbar, LoginScreenTitle, ListInput, ListButton, BlockFooter\n} from 'framework7-react';\nimport { dict} from '../../Dict';\nimport VerificationForm from \"../../containers/users/Verification\"\nimport ModelStore from \"../../stores/ModelStore\";\nimport * as MyActions from \"../../actions/MyActions\";\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\nexport default class extends React.Component {\n  constructor() {\n    super();\n    this.submit = this.submit.bind(this);\n    this.handleChangeValue = this.handleChangeValue.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n\n    this.state = {\n      verificationCode: '',\n      email: '',\n    };\n  }\n\n  componentWillMount() {\n    ModelStore.on(\"set_instance\", this.setInstance);\n  }\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"set_instance\", this.setInstance);\n  }\n\n  componentDidMount(){\n    this.setState({email: this.$f7route.params['email']})\n  }\n\n  submit(){\n    var data = {verification_code: this.state.verificationCode}\n    MyActions.setInstance('users/verify', data);\n  }\n\n  setInstance(){\n    var user = ModelStore.getIntance();\n    var klass = ModelStore.getKlass()\n    if (user && klass == 'Verify'){\n      window.localStorage.setItem('token', user.token);\n      this.$f7router.navigate('/');\n      window.location.reload()\n    }\n  }\n\n\n  handleChangeValue(obj) {\n    this.setState(obj);\n  }\n\n  render() {\n    const {username, email} = this.state;\n    return (\n      <VerificationForm submit={this.submit} email={email} handleChange={this.handleChangeValue}/>\n    )\n  }\n\n}\n","import React from 'react';\nimport { Page, Navbar, Block } from 'framework7-react';\n\nexport default () => (\n  <Page>\n    <Navbar title=\"Not found\" backLink=\"Back\" />\n    <Block strong>\n      <p>Sorry</p>\n      <p>Requested content not found.</p>\n    </Block>\n  </Page>\n);\n","import Janus from \"../janus.js\";\nexport function sessionCreate(room) {\n  var self = this;\n  Janus.init({\n    debug: \"none\",\n    callback: function () {\n      var janus = new Janus({\n        server: self.state.server,\n        success: function () {\n          // Attach to AudioBridge plugin\n          janus.attach({\n            plugin: \"janus.plugin.audiobridge\",\n            opaqueId: self.state.opaqueId,\n            success: function (pluginHandle) {\n              //$('#details').remove();\n              self.setState({ mixertest: pluginHandle });\n              Janus.log(\n                \"Plugin attached! (\" +\n                  self.state.mixertest.getPlugin() +\n                  \", id=\" +\n                  self.state.mixertest.getId() +\n                  \")\"\n              );\n              self.registerUsername(room);\n              // Prepare the username registration\n              /*\n                                    $('#audiojoin').removeClass('hide').show();\n                                    $('#registernow').removeClass('hide').show();\n                                    $('#register').click(registerUsername);\n                                    $('#username').focus();\n                                    $('#start').removeAttr('disabled').html(\"Stop\")\n                                        .click(function () {\n                                            $(this).attr('disabled', true);\n                                            janus.destroy();\n                                        });\n                                    */\n            },\n            error: function (error) {\n              Janus.error(\"  -- Error attaching plugin...\", error);\n              //bootbox.alert(\"Error attaching plugin... \" + error);\n            },\n            consentDialog: function (on) {\n              Janus.debug(\n                \"Consent dialog should be \" + (on ? \"on\" : \"off\") + \" now\"\n              );\n            },\n            iceState: function (state) {\n              Janus.log(\"ICE state changed to \" + state);\n            },\n            mediaState: function (medium, on) {\n              Janus.log(\n                \"Janus \" +\n                  (on ? \"started\" : \"stopped\") +\n                  \" receiving our \" +\n                  medium\n              );\n            },\n            webrtcState: function (on) {\n              Janus.log(\n                \"Janus says our WebRTC PeerConnection is \" +\n                  (on ? \"up\" : \"down\") +\n                  \" now\"\n              );\n            },\n            onmessage: function (msg, jsep) {\n              Janus.debug(\" ::: Got a message :::\", msg);\n              var event = msg[\"audiobridge\"];\n              Janus.debug(\"Event: \" + event);\n              if (event) {\n                //console.log(event, msg);\n                if (event == \"talking\") {\n                  self.participantChangeStatus(msg[\"id\"], true);\n                }\n                if (event == \"stopped-talking\") {\n                  self.participantChangeStatus(msg[\"id\"], false);\n                }\n                if (event === \"joined\") {\n                  // Successfully joined, negotiate WebRTC now\n                  if (msg[\"id\"]) {\n                    self.setState({\n                      myid: msg[\"id\"],\n                    });\n                    Janus.log(\n                      \"Successfully joined room \" +\n                        msg[\"room\"] +\n                        \" with ID \" +\n                        self.state.myid\n                    );\n                    self.addParticipant(\n                      msg[\"id\"],\n                      self.state.fullname +\n                        \"\" +\n                        self.state.userUUID +\n                        \"\" +\n                        self.state.userColor\n                    );\n                    if (!self.state.webrtcUp) {\n                      self.setState({ webrtcUp: true });\n                      // Publish our stream\n                      self.state.mixertest.createOffer({\n                        media: {\n                          video: false,\n                          audio: { echoCancellation: true },\n                        }, // This is an audio only room\n                        success: function (jsep) {\n                          Janus.debug(\"Got SDP!\", jsep);\n                          var publish = { request: \"configure\", muted: true };\n                          self.state.mixertest.send({\n                            message: publish,\n                            jsep: jsep,\n                          });\n                        },\n                        error: function (error) {\n                          Janus.error(\"WebRTC error:\", error);\n                          // bootbox.alert(\"WebRTC error... \" + error.message);\n                        },\n                      });\n                    }\n                  }\n                  // Any room participant?\n                  if (msg[\"participants\"]) {\n                    var list = msg[\"participants\"];\n                    Janus.debug(\"Got a list of participants:\", list);\n                    for (var f in list) {\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var setup = list[f][\"setup\"];\n                      var muted = list[f][\"muted\"];\n                      //console.log(\"%%%%%%%%\", list[f]);\n                      self.addParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      //self.newRemoteFeed(id, display, audio, video);\n                      /*\n                                                    Janus.debug(\"  >> [\" + id + \"] \" + display + \" (setup=\" + setup + \", muted=\" + muted + \")\");\n                                                    if ($('#rp' + id).length === 0) {\n                                                        // Add to the participants list\n                                                        $('#list').append('<li id=\"rp' + id + '\" class=\"list-group-item\">' + display +\n                                                            ' <i class=\"absetup fa fa-chain-broken\"></i>' +\n                                                            ' <i class=\"abmuted fa fa-microphone-slash\"></i></li>');\n                                                        $('#rp' + id + ' > i').hide();\n                                                    }\n                                                    if (muted === true || muted === \"true\")\n                                                        $('#rp' + id + ' > i.abmuted').removeClass('hide').show();\n                                                    else\n                                                        $('#rp' + id + ' > i.abmuted').hide();\n                                                    if (setup === true || setup === \"true\")\n                                                        $('#rp' + id + ' > i.absetup').hide();\n                                                    else\n                                                        $('#rp' + id + ' > i.absetup').removeClass('hide').show();\n                                                        */\n                    }\n                  }\n                } else if (event === \"roomchanged\") {\n                  // The user switched to a different room\n                  self.setState({\n                    myid: msg[\"id\"],\n                  });\n                  Janus.log(\n                    \"Moved to room \" +\n                      msg[\"room\"] +\n                      \", new ID: \" +\n                      self.state.myid\n                  );\n                  // Any room participant?\n                  // $('#list').empty();\n                  if (msg[\"participants\"]) {\n                    var list = msg[\"participants\"];\n                    Janus.debug(\"Got a list of participants:\", list);\n                    for (var f in list) {\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var setup = list[f][\"setup\"];\n                      var muted = list[f][\"muted\"];\n                      //console.log(\">>>>>>\", list[f]);\n                      self.addParticipant(\n                        msg[\"id\"],\n                        self.state.fullname +\n                          \"\" +\n                          self.state.userUUID +\n                          \"\" +\n                          self.state.userColor\n                      );\n\n                      Janus.debug(\n                        \"  >> [\" +\n                          id +\n                          \"] \" +\n                          display +\n                          \" (setup=\" +\n                          setup +\n                          \", muted=\" +\n                          muted +\n                          \")\"\n                      );\n                      /*\n                                                     if ($('#rp' + id).length === 0) {\n                                                         // Add to the participants list\n                                                         $('#list').append('<li id=\"rp' + id + '\" class=\"list-group-item\">' + display +\n                                                             ' <i class=\"absetup fa fa-chain-broken\"></i>' +\n                                                             ' <i class=\"abmuted fa fa-microphone-slash\"></i></li>');\n                                                         $('#rp' + id + ' > i').hide();\n                                                     }\n                                                     if (muted === true || muted === \"true\")\n                                                         $('#rp' + id + ' > i.abmuted').removeClass('hide').show();\n                                                     else\n                                                         $('#rp' + id + ' > i.abmuted').hide();\n                                                     if (setup === true || setup === \"true\")\n                                                         $('#rp' + id + ' > i.absetup').hide();\n                                                     else\n                                                         $('#rp' + id + ' > i.absetup').removeClass('hide').show();\n                                                         */\n                    }\n                  }\n                } else if (event === \"destroyed\") {\n                  // The room has been destroyed\n                  Janus.warn(\"The room has been destroyed!\");\n                } else if (event === \"event\") {\n                  //console.log('Participant...', msg)\n                  if (msg[\"participants\"]) {\n                    var list = msg[\"participants\"];\n                    Janus.debug(\"Got a list of participants:\", list);\n                    for (var f in list) {\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var setup = list[f][\"setup\"];\n                      var muted = list[f][\"muted\"];\n                      var talking = list[f][\"talking\"];\n                      Janus.debug(\n                        \"  >> [\" +\n                          id +\n                          \"] \" +\n                          display +\n                          \" (setup=\" +\n                          setup +\n                          \", muted=\" +\n                          muted +\n                          \")\"\n                      );\n                      //console.log(\"%%%%%%%%\", list);\n                      if (talking) {\n                        //console.log(\"%%%%%%%%\",list[f][\"id\"],\"is talking ...\");\n                      }\n                      if (muted) {\n                        self.participantChangeStatus(list[f][\"id\"], false);\n                      }\n                      self.addParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      /*\n                                                    if ($('#rp' + id).length === 0) {\n                                                        // Add to the participants list\n                                                        $('#list').append('<li id=\"rp' + id + '\" class=\"list-group-item\">' + display +\n                                                            ' <i class=\"absetup fa fa-chain-broken\"></i>' +\n                                                            ' <i class=\"abmuted fa fa-microphone-slash\"></i></li>');\n                                                        $('#rp' + id + ' > i').hide();\n                                                    }\n                                                    if (muted === true || muted === \"true\")\n                                                        $('#rp' + id + ' > i.abmuted').removeClass('hide').show();\n                                                    else\n                                                        $('#rp' + id + ' > i.abmuted').hide();\n                                                    if (setup === true || setup === \"true\")\n                                                        $('#rp' + id + ' > i.absetup').hide();\n                                                    else\n                                                        $('#rp' + id + ' > i.absetup').removeClass('hide').show();\n                                                        */\n                    }\n                  } else if (msg[\"error\"]) {\n                    if (msg[\"error_code\"] === 485) {\n                      // This is a \"no such room\" error: give a more meaningful description\n                    } else {\n                    }\n                    return;\n                  }\n                  // Any new feed to attach to?\n                  if (msg[\"leaving\"]) {\n                    // One of the participants has gone away?\n                    var leaving = msg[\"leaving\"];\n                    self.removeParticipant(leaving);\n                    Janus.log(\n                      \"Participant left: \" +\n                        leaving +\n                        \" elements with ID #rp\" +\n                        leaving +\n                        \")\"\n                    );\n                    //$('#rp' + leaving).remove();\n                  }\n                }\n              }\n              if (jsep) {\n                Janus.debug(\"Handling SDP as well...\", jsep);\n                self.state.mixertest.handleRemoteJsep({ jsep: jsep });\n              }\n            },\n            onlocalstream: function (stream) {\n              Janus.debug(\" ::: Got a local stream :::\", stream);\n              //console.log(\"Local stream ******\", stream);\n              //console.log(\"Local stream ******\", stream.getTracks());\n              self.setState({ localStream: stream });\n\n              // We're not going to attach the local audio stream\n              // $('#audiojoin').hide();\n              // $('#room').removeClass('hide').show();\n              //$('#participant').removeClass('hide').html(myusername).show();\n            },\n            onremotestream: function (stream) {\n              // $('#room').removeClass('hide').show();\n              // var addButtons = false;\n              /// if ($('#roomaudio').length === 0) {\n              //    addButtons = true;\n              //    $('#mixedaudio').append('<audio class=\"rounded centered\" id=\"roomaudio\" width=\"100%\" height=\"100%\" autoplay/>');\n              //}\n              //Janus.attachMediaStream($('#roomaudio').get(0), stream);\n              // if (!addButtons)\n              //     return;\n              // Mute button\n              //   audioenabled = true;\n              //   $('#toggleaudio').click(\n              //      function () {\n              //          audioenabled = !audioenabled;\n              //          if (audioenabled)\n              //            $('#toggleaudio').html(\"Mute\").removeClass(\"btn-success\").addClass(\"btn-danger\");\n              //        else\n              //           $('#toggleaudio').html(\"Unmute\").removeClass(\"btn-danger\").addClass(\"btn-success\");\n              //       mixertest.send({ message: { request: \"configure\", muted: !audioenabled } });\n              //  }).removeClass('hide').show();\n              if (self.$$(\"#roomaudio\").length === 0) {\n                self\n                  .$$(\"#mixedaudio\")\n                  .append(\n                    '<audio class=\"rounded centered\" id=\"roomaudio\" width=\"100%\" height=\"100%\" autoplay/>'\n                  );\n                Janus.attachMediaStream(\n                  document.getElementById(\"roomaudio\"),\n                  stream\n                );\n                self.setState({ remoteStream: stream });\n              }\n            },\n            oncleanup: function () {\n              //  webrtcUp = false;\n              Janus.log(\" ::: Got a cleanup notification :::\");\n              //$('#participant').empty().hide();\n              //$('#list').empty();\n              //$('#mixedaudio').empty();\n              //$('#room').hide();\n            },\n          });\n        },\n        error: function (error) {\n          //   Janus.error(error);\n          //console.log(error);\n        },\n        destroyed: function () {\n          window.location.reload();\n        },\n      });\n    },\n  });\n}\n\nexport function registerUsername(room) {\n  var self = this;\n  var register = {\n    request: \"join\",\n    room: room,\n    pin: self.state.pin,\n    display:\n      self.state.fullname +\n      \" \" +\n      self.state.userUUID +\n      \"\" +\n      self.state.userColor,\n  };\n  self.state.mixertest.send({ message: register });\n  self.setState({ myId: self.state.mixertest.id });\n}\n\nexport function removeParticipant(id) {\n  var self = this;\n  self.setState({\n    participants: self.state.participants.filter((item) => item.id !== id),\n  });\n}\n\nexport function addParticipant(id, p) {\n  //console.log(\"Adding Participants ...\", id, p);\n  var self = this;\n  var participant = p.split(\"\");\n  if (this.exisitingParticipant(participant[1])) {\n    self.setState({\n      participants: self.state.participants.concat({\n        id: id,\n        display: participant[0],\n        uuid: participant[1],\n        userColor: participant[2],\n        role: \"listener\",\n        current: \"stopped-talking\",\n      }),\n    });\n  }\n  //console.log(\"participant added:\", participant[1]);\n}\n\nexport function exisitingParticipant(participantId) {\n  var self = this;\n  var exisiting = self.state.participants.filter(\n    (item) => item.uuid === participantId\n  );\n  if (exisiting.length === 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nexport function participantDisplay(participantId) {\n  var self = this;\n  var exisiting = self.state.participants.filter(\n    (item) => item.uuid === participantId\n  );\n  if (exisiting.length === 0) {\n    return \"\";\n  } else {\n    return exisiting[0].display;\n  }\n}\n\nexport function participantChangeStatus(participantId, status) {\n  //console.log(participantId, status)\n  /*\n  var self = this;\n  var participants = self.state.participants;\n  if (participants.length > 0) {\n    for (let i = 0; i < participants.length; i++) {\n      //console.log(participants[i].id)\n      if (participants[i].id == participantId) {\n        let newState = Object.assign({}, self.state);\n        newState.participants[i] = {\n          id: participants[i].id,\n          display: participants[i].display,\n          uuid: participants[i].uuid,\n          userColor: participants[i].userColor,\n          role: participants[i].role,\n          room: participants[i].room,\n          current: status,\n        };\n        self.setState(newState, () => {\n          console.log(self.state.participants);\n          break;\n        });\n      }\n    }\n  }*/\n\n  this.setState((prevState) => ({\n    talking: {\n      ...prevState.talking, \n      [participantId]: status, \n    },\n  }));\n}\n\nexport function participantChangeRoom(participantId, room) {\n  //console.log(participantId, room)\n  /*\n  var self = this;\n  var participants = self.state.participants;\n  if (participants.length > 0) {\n    for (let i = 0; i < participants.length; i++) {\n      //console.log(participants[i].id)\n      if (participants[i].uuid == participantId) {\n        let newState = Object.assign({}, self.state);\n        newState.participants[i] = {\n          id: participants[i].id,\n          display: participants[i].display,\n          uuid: participants[i].uuid,\n          userColor: participants[i].userColor,\n          role: participants[i].role,\n          current: participants[i].current,\n          room: room,\n        };\n        self.setState(newState, () => {\n          console.log(self.state.participants);\n          break;\n        });\n      }\n    }\n  }*/\n  this.setState((prevState) => ({\n    participantRoom: {\n      ...prevState.participantRoom, \n      [participantId]: room, \n    },\n  }));\n}\n\nexport function toggleMute() {\n  var self = this;\n  this.state.mixertest.send({\n    message: { request: \"configure\", muted: self.state.muted },\n  });\n  //console.log('muted', this.state.mixertest)\n  //if(self.state.muted){\n  self.participantChangeStatus(this.state.myId, false);\n  //}\n}\n\nexport function forceMute() {\n  var self = this;\n  this.state.mixertest.send({\n    message: { request: \"configure\", muted: true },\n  });\n\n  self.participantChangeStatus(this.state.myId, false);\n}\n\nexport function exitAudioRoom() {\n  var self = this;\n  if (this.state.mixertest) {\n    this.state.mixertest.send({ message: { request: \"unpublish\" } });\n  }\n}\n","/*\n\tThe MIT License (MIT)\n\n\tCopyright (c) 2016 Meetecho\n\n\tPermission is hereby granted, free of charge, to any person obtaining\n\ta copy of this software and associated documentation files (the \"Software\"),\n\tto deal in the Software without restriction, including without limitation\n\tthe rights to use, copy, modify, merge, publish, distribute, sublicense,\n\tand/or sell copies of the Software, and to permit persons to whom the\n\tSoftware is furnished to do so, subject to the following conditions:\n\n\tThe above copyright notice and this permission notice shall be included\n\tin all copies or substantial portions of the Software.\n\n\tTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n\tOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\tFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n\tTHE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\n\tOTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n\tARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n\tOTHER DEALINGS IN THE SOFTWARE.\n */\n\n// List of sessions\nimport jQuery from 'jquery';\nimport adapter from 'webrtc-adapter';\nconst RTCRtpTransceiver = window.RTCRtpTransceiver;\nJanus.sessions = {};\n\nJanus.isExtensionEnabled = function() {\n\tif(navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n\t\t// No need for the extension, getDisplayMedia is supported\n\t\treturn true;\n\t}\n\tif(window.navigator.userAgent.match('Chrome')) {\n\t\tvar chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\n\t\tvar maxver = 33;\n\t\tif(window.navigator.userAgent.match('Linux'))\n\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\n\t\tif(chromever >= 26 && chromever <= maxver) {\n\t\t\t// Older versions of Chrome don't support this extension-based approach, so lie\n\t\t\treturn true;\n\t\t}\n\t\treturn Janus.extension.isInstalled();\n\t} else {\n\t\t// Firefox and others, no need for the extension (but this doesn't mean it will work)\n\t\treturn true;\n\t}\n};\n\nvar defaultExtension = {\n\t// Screensharing Chrome Extension ID\n\textensionId: 'hapfgfdkleiggjjpfpenajgdnfckjpaj',\n\tisInstalled: function() { return document.querySelector('#janus-extension-installed') !== null; },\n\tgetScreen: function (callback) {\n\t\tvar pending = window.setTimeout(function () {\n\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\terror.name = 'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\n\t\t\treturn callback(error);\n\t\t}, 1000);\n\t\tthis.cache[pending] = callback;\n\t\twindow.postMessage({ type: 'janusGetScreen', id: pending }, '*');\n\t},\n\tinit: function () {\n\t\tvar cache = {};\n\t\tthis.cache = cache;\n\t\t// Wait for events from the Chrome Extension\n\t\twindow.addEventListener('message', function (event) {\n\t\t\tif(event.origin != window.location.origin)\n\t\t\t\treturn;\n\t\t\tif(event.data.type == 'janusGotScreen' && cache[event.data.id]) {\n\t\t\t\tvar callback = cache[event.data.id];\n\t\t\t\tdelete cache[event.data.id];\n\n\t\t\t\tif (event.data.sourceId === '') {\n\t\t\t\t\t// user canceled\n\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\t\t\terror.name = 'You cancelled the request for permission, giving up...';\n\t\t\t\t\tcallback(error);\n\t\t\t\t} else {\n\t\t\t\t\tcallback(null, event.data.sourceId);\n\t\t\t\t}\n\t\t\t} else if (event.data.type == 'janusGetScreenPending') {\n\t\t\t\tconsole.log('clearing ', event.data.id);\n\t\t\t\twindow.clearTimeout(event.data.id);\n\t\t\t}\n\t\t});\n\t}\n};\n\nJanus.useDefaultDependencies = function (deps) {\n\tvar f = (deps && deps.fetch) || fetch;\n\tvar p = (deps && deps.Promise) || Promise;\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\n\n\treturn {\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\n\t\textension: (deps && deps.extension) || defaultExtension,\n\t\tisArray: function(arr) { return Array.isArray(arr); },\n\t\twebRTCAdapter: (deps && deps.adapter) || adapter,\n\t\thttpAPICall: function(url, options) {\n\t\t\tvar fetchOptions = {\n\t\t\t\tmethod: options.verb,\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json, text/plain, */*'\n\t\t\t\t},\n\t\t\t\tcache: 'no-cache'\n\t\t\t};\n\t\t\tif(options.verb === \"POST\") {\n\t\t\t\tfetchOptions.headers['Content-Type'] = 'application/json';\n\t\t\t}\n\t\t\tif(options.withCredentials !== undefined) {\n\t\t\t\tfetchOptions.credentials = options.withCredentials === true ? 'include' : (options.withCredentials ? options.withCredentials : 'omit');\n\t\t\t}\n\t\t\tif(options.body) {\n\t\t\t\tfetchOptions.body = JSON.stringify(options.body);\n\t\t\t}\n\n\t\t\tvar fetching = f(url, fetchOptions).catch(function(error) {\n\t\t\t\treturn p.reject({message: 'Probably a network error, is the server down?', error: error});\n\t\t\t});\n\n\t\t\t/*\n\t\t\t * fetch() does not natively support timeouts.\n\t\t\t * Work around this by starting a timeout manually, and racing it agains the fetch() to see which thing resolves first.\n\t\t\t */\n\n\t\t\tif(options.timeout) {\n\t\t\t\tvar timeout = new p(function(resolve, reject) {\n\t\t\t\t\tvar timerId = setTimeout(function() {\n\t\t\t\t\t\tclearTimeout(timerId);\n\t\t\t\t\t\treturn reject({message: 'Request timed out', timeout: options.timeout});\n\t\t\t\t\t}, options.timeout);\n\t\t\t\t});\n\t\t\t\tfetching = p.race([fetching, timeout]);\n\t\t\t}\n\n\t\t\tfetching.then(function(response) {\n\t\t\t\tif(response.ok) {\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\n\t\t\t\t\t\treturn response.json().then(function(parsed) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\toptions.success(parsed);\n\t\t\t\t\t\t\t} catch(error) {\n\t\t\t\t\t\t\t\tJanus.error('Unhandled httpAPICall success callback error', error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function(error) {\n\t\t\t\t\t\t\treturn p.reject({message: 'Failed to parse response body', error: error, response: response});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn p.reject({message: 'API call failed', response: response});\n\t\t\t\t}\n\t\t\t}).catch(function(error) {\n\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\n\t\t\t\t\toptions.error(error.message || '<< internal error >>', error);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn fetching;\n\t\t}\n\t}\n};\n\nJanus.useOldDependencies = function (deps) {\n\tvar jq = (deps && deps.jQuery) || jQuery;\n\tvar socketCls = (deps && deps.WebSocket) || WebSocket;\n\treturn {\n\t\tnewWebSocket: function(server, proto) { return new socketCls(server, proto); },\n\t\tisArray: function(arr) { return jq.isArray(arr); },\n\t\textension: (deps && deps.extension) || defaultExtension,\n\t\twebRTCAdapter: (deps && deps.adapter) || adapter,\n\t\thttpAPICall: function(url, options) {\n\t\t\tvar payload = options.body !== undefined ? {\n\t\t\t\tcontentType: 'application/json',\n\t\t\t\tdata: JSON.stringify(options.body)\n\t\t\t} : {};\n\t\t\tvar credentials = options.withCredentials !== undefined ? {xhrFields: {withCredentials: options.withCredentials}} : {};\n\n\t\t\treturn jq.ajax(jq.extend(payload, credentials, {\n\t\t\t\turl: url,\n\t\t\t\ttype: options.verb,\n\t\t\t\tcache: false,\n\t\t\t\tdataType: 'json',\n\t\t\t\tasync: options.async,\n\t\t\t\ttimeout: options.timeout,\n\t\t\t\tsuccess: function(result) {\n\t\t\t\t\tif(typeof(options.success) === typeof(Janus.noop)) {\n\t\t\t\t\t\toptions.success(result);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, err) {\n\t\t\t\t\tif(typeof(options.error) === typeof(Janus.noop)) {\n\t\t\t\t\t\toptions.error(status, err);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t};\n};\n\nJanus.noop = function() {};\n\nJanus.dataChanDefaultLabel = \"JanusDataChannel\";\n\n// Note: in the future we may want to change this, e.g., as was\n// attempted in https://github.com/meetecho/janus-gateway/issues/1670\nJanus.endOfCandidates = null;\n\n// Stop all tracks from a given stream\nJanus.stopAllTracks = function(stream) {\n\ttry {\n\t\t// Try a MediaStreamTrack.stop() for each track\n\t\tvar tracks = stream.getTracks();\n\t\tfor(var mst of tracks) {\n\t\t\tJanus.log(mst);\n\t\t\tif(mst) {\n\t\t\t\tmst.stop();\n\t\t\t}\n\t\t}\n\t} catch(e) {\n\t\t// Do nothing if this fails\n\t}\n}\n\n// Initialization\nJanus.init = function(options) {\n\toptions = options || {};\n\toptions.callback = (typeof options.callback == \"function\") ? options.callback : Janus.noop;\n\tif(Janus.initDone) {\n\t\t// Already initialized\n\t\toptions.callback();\n\t} else {\n\t\tif(typeof console == \"undefined\" || typeof console.log == \"undefined\") {\n\t\t\tconsole = { log: function() {} };\n\t\t}\n\t\t// Console logging (all debugging disabled by default)\n\t\tJanus.trace = Janus.noop;\n\t\tJanus.debug = Janus.noop;\n\t\tJanus.vdebug = Janus.noop;\n\t\tJanus.log = Janus.noop;\n\t\tJanus.warn = Janus.noop;\n\t\tJanus.error = Janus.noop;\n\t\tif(options.debug === true || options.debug === \"all\") {\n\t\t\t// Enable all debugging levels\n\t\t\tJanus.trace = console.trace.bind(console);\n\t\t\tJanus.debug = console.debug.bind(console);\n\t\t\tJanus.vdebug = console.debug.bind(console);\n\t\t\tJanus.log = console.log.bind(console);\n\t\t\tJanus.warn = console.warn.bind(console);\n\t\t\tJanus.error = console.error.bind(console);\n\t\t} else if(Array.isArray(options.debug)) {\n\t\t\tfor(var d of options.debug) {\n\t\t\t\tswitch(d) {\n\t\t\t\t\tcase \"trace\":\n\t\t\t\t\t\tJanus.trace = console.trace.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"debug\":\n\t\t\t\t\t\tJanus.debug = console.debug.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"vdebug\":\n\t\t\t\t\t\tJanus.vdebug = console.debug.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\tJanus.log = console.log.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"warn\":\n\t\t\t\t\t\tJanus.warn = console.warn.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"error\":\n\t\t\t\t\t\tJanus.error = console.error.bind(console);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error(\"Unknown debugging option '\" + d + \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\");\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tJanus.log(\"Initializing library\");\n\n\t\tvar usedDependencies = options.dependencies || Janus.useDefaultDependencies();\n\t\tJanus.isArray = usedDependencies.isArray;\n\t\tJanus.webRTCAdapter = usedDependencies.webRTCAdapter;\n\t\tJanus.httpAPICall = usedDependencies.httpAPICall;\n\t\tJanus.newWebSocket = usedDependencies.newWebSocket;\n\t\tJanus.extension = usedDependencies.extension;\n\t\tJanus.extension.init();\n\n\t\t// Helper method to enumerate devices\n\t\tJanus.listDevices = function(callback, config) {\n\t\t\tcallback = (typeof callback == \"function\") ? callback : Janus.noop;\n\t\t\tif (config == null) config = { audio: true, video: true };\n\t\t\tif(Janus.isGetUserMediaAvailable()) {\n\t\t\t\tnavigator.mediaDevices.getUserMedia(config)\n\t\t\t\t.then(function(stream) {\n\t\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\n\t\t\t\t\t\tJanus.debug(devices);\n\t\t\t\t\t\tcallback(devices);\n\t\t\t\t\t\t// Get rid of the now useless stream\n\t\t\t\t\t\tJanus.stopAllTracks(stream)\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(function(err) {\n\t\t\t\t\tJanus.error(err);\n\t\t\t\t\tcallback([]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tJanus.warn(\"navigator.mediaDevices unavailable\");\n\t\t\t\tcallback([]);\n\t\t\t}\n\t\t};\n\t\t// Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\n\t\tJanus.attachMediaStream = function(element, stream) {\n\t\t\ttry {\n\t\t\t\telement.srcObject = stream;\n\t\t\t} catch (e) {\n\t\t\t\ttry {\n\t\t\t\t\telement.src = URL.createObjectURL(stream);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tJanus.error(\"Error attaching stream to element\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tJanus.reattachMediaStream = function(to, from) {\n\t\t\ttry {\n\t\t\t\tto.srcObject = from.srcObject;\n\t\t\t} catch (e) {\n\t\t\t\ttry {\n\t\t\t\t\tto.src = from.src;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tJanus.error(\"Error reattaching stream to element\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t// Detect tab close: make sure we don't loose existing onbeforeunload handlers\n\t\t// (note: for iOS we need to subscribe to a different event, 'pagehide', see\n\t\t// https://gist.github.com/thehunmonkgroup/6bee8941a49b86be31a787fe8f4b8cfe)\n\t\tvar iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n\t\tvar eventName = iOS ? 'pagehide' : 'beforeunload';\n\t\tvar oldOBF = window[\"on\" + eventName];\n\t\twindow.addEventListener(eventName, function(event) {\n\t\t\tJanus.log(\"Closing window\");\n\t\t\tfor(var s in Janus.sessions) {\n\t\t\t\tif(Janus.sessions[s] && Janus.sessions[s].destroyOnUnload) {\n\t\t\t\t\tJanus.log(\"Destroying session \" + s);\n\t\t\t\t\tJanus.sessions[s].destroy({unload: true, notifyDestroyed: false});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(oldOBF && typeof oldOBF == \"function\") {\n\t\t\t\toldOBF();\n\t\t\t}\n\t\t});\n\t\t// If this is a Safari Technology Preview, check if VP8 is supported\n\t\tJanus.safariVp8 = false;\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'safari' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 605) {\n\t\t\t// Let's see if RTCRtpSender.getCapabilities() is there\n\t\t\tif(RTCRtpSender && RTCRtpSender.getCapabilities && RTCRtpSender.getCapabilities(\"video\") &&\n\t\t\t\t\tRTCRtpSender.getCapabilities(\"video\").codecs && RTCRtpSender.getCapabilities(\"video\").codecs.length) {\n\t\t\t\tfor(var codec of RTCRtpSender.getCapabilities(\"video\").codecs) {\n\t\t\t\t\tif(codec && codec.mimeType && codec.mimeType.toLowerCase() === \"video/vp8\") {\n\t\t\t\t\t\tJanus.safariVp8 = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(Janus.safariVp8) {\n\t\t\t\t\tJanus.log(\"This version of Safari supports VP8\");\n\t\t\t\t} else {\n\t\t\t\t\tJanus.warn(\"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n\t\t\t\t\t\t\"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We do it in a very ugly way, as there's no alternative...\n\t\t\t\t// We create a PeerConnection to see if VP8 is in an offer\n\t\t\t\tvar testpc = new RTCPeerConnection({});\n\t\t\t\ttestpc.createOffer({offerToReceiveVideo: true}).then(function(offer) {\n\t\t\t\t\tJanus.safariVp8 = offer.sdp.indexOf(\"VP8\") !== -1;\n\t\t\t\t\tif(Janus.safariVp8) {\n\t\t\t\t\t\tJanus.log(\"This version of Safari supports VP8\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.warn(\"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n\t\t\t\t\t\t\t\"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\");\n\t\t\t\t\t}\n\t\t\t\t\ttestpc.close();\n\t\t\t\t\ttestpc = null;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// Check if this browser supports Unified Plan and transceivers\n\t\t// Based on https://codepen.io/anon/pen/ZqLwWV?editors=0010\n\t\tJanus.unifiedPlan = false;\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'firefox' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 59) {\n\t\t\t// Firefox definitely does, starting from version 59\n\t\t\tJanus.unifiedPlan = true;\n\t\t} else if(Janus.webRTCAdapter.browserDetails.browser === 'chrome' &&\n\t\t\t\tJanus.webRTCAdapter.browserDetails.version >= 72) {\n\t\t\t// Chrome does, but it's only usable from version 72 on\n\t\t\tJanus.unifiedPlan = true;\n\t\t} else if(!window.RTCRtpTransceiver || !('currentDirection' in RTCRtpTransceiver.prototype)) {\n\t\t\t// Safari supports addTransceiver() but not Unified Plan when\n\t\t\t// currentDirection is not defined (see codepen above).\n\t\t\tJanus.unifiedPlan = false;\n\t\t} else {\n\t\t\t// Check if addTransceiver() throws an exception\n\t\t\tvar tempPc = new RTCPeerConnection();\n\t\t\ttry {\n\t\t\t\ttempPc.addTransceiver('audio');\n\t\t\t\tJanus.unifiedPlan = true;\n\t\t\t} catch (e) {}\n\t\t\ttempPc.close();\n\t\t}\n\t\tJanus.initDone = true;\n\t\toptions.callback();\n\t}\n};\n\n// Helper method to check whether WebRTC is supported by this browser\nJanus.isWebrtcSupported = function() {\n\treturn !!window.RTCPeerConnection;\n};\n// Helper method to check whether devices can be accessed by this browser (e.g., not possible via plain HTTP)\nJanus.isGetUserMediaAvailable = function() {\n\treturn navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\n};\n\n// Helper method to create random identifiers (e.g., transaction)\nJanus.randomString = function(len) {\n\tvar charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\tvar randomString = '';\n\tfor (var i = 0; i < len; i++) {\n\t\tvar randomPoz = Math.floor(Math.random() * charSet.length);\n\t\trandomString += charSet.substring(randomPoz,randomPoz+1);\n\t}\n\treturn randomString;\n};\n\nfunction Janus(gatewayCallbacks) {\n\tgatewayCallbacks = gatewayCallbacks || {};\n\tgatewayCallbacks.success = (typeof gatewayCallbacks.success == \"function\") ? gatewayCallbacks.success : Janus.noop;\n\tgatewayCallbacks.error = (typeof gatewayCallbacks.error == \"function\") ? gatewayCallbacks.error : Janus.noop;\n\tgatewayCallbacks.destroyed = (typeof gatewayCallbacks.destroyed == \"function\") ? gatewayCallbacks.destroyed : Janus.noop;\n\tif(!Janus.initDone) {\n\t\tgatewayCallbacks.error(\"Library not initialized\");\n\t\treturn {};\n\t}\n\tif(!Janus.isWebrtcSupported()) {\n\t\tgatewayCallbacks.error(\"WebRTC not supported by this browser\");\n\t\treturn {};\n\t}\n\tJanus.log(\"Library initialized: \" + Janus.initDone);\n\tif(!gatewayCallbacks.server) {\n\t\tgatewayCallbacks.error(\"Invalid server url\");\n\t\treturn {};\n\t}\n\tvar websockets = false;\n\tvar ws = null;\n\tvar wsHandlers = {};\n\tvar wsKeepaliveTimeoutId = null;\n\tvar servers = null;\n\tvar serversIndex = 0;\n\tvar server = gatewayCallbacks.server;\n\tif(Janus.isArray(server)) {\n\t\tJanus.log(\"Multiple servers provided (\" + server.length + \"), will use the first that works\");\n\t\tserver = null;\n\t\tservers = gatewayCallbacks.server;\n\t\tJanus.debug(servers);\n\t} else {\n\t\tif(server.indexOf(\"ws\") === 0) {\n\t\t\twebsockets = true;\n\t\t\tJanus.log(\"Using WebSockets to contact Janus: \" + server);\n\t\t} else {\n\t\t\twebsockets = false;\n\t\t\tJanus.log(\"Using REST API to contact Janus: \" + server);\n\t\t}\n\t}\n\tvar iceServers = gatewayCallbacks.iceServers || [{urls: \"stun:stun.l.google.com:19302\"}];\n\tvar iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\n\tvar bundlePolicy = gatewayCallbacks.bundlePolicy;\n\t// Whether IPv6 candidates should be gathered\n\tvar ipv6Support = (gatewayCallbacks.ipv6 === true);\n\t// Whether we should enable the withCredentials flag for XHR requests\n\tvar withCredentials = false;\n\tif(gatewayCallbacks.withCredentials !== undefined && gatewayCallbacks.withCredentials !== null)\n\t\twithCredentials = gatewayCallbacks.withCredentials === true;\n\t// Optional max events\n\tvar maxev = 10;\n\tif(gatewayCallbacks.max_poll_events !== undefined && gatewayCallbacks.max_poll_events !== null)\n\t\tmaxev = gatewayCallbacks.max_poll_events;\n\tif(maxev < 1)\n\t\tmaxev = 1;\n\t// Token to use (only if the token based authentication mechanism is enabled)\n\tvar token = null;\n\tif(gatewayCallbacks.token !== undefined && gatewayCallbacks.token !== null)\n\t\ttoken = gatewayCallbacks.token;\n\t// API secret to use (only if the shared API secret is enabled)\n\tvar apisecret = null;\n\tif(gatewayCallbacks.apisecret !== undefined && gatewayCallbacks.apisecret !== null)\n\t\tapisecret = gatewayCallbacks.apisecret;\n\t// Whether we should destroy this session when onbeforeunload is called\n\tthis.destroyOnUnload = true;\n\tif(gatewayCallbacks.destroyOnUnload !== undefined && gatewayCallbacks.destroyOnUnload !== null)\n\t\tthis.destroyOnUnload = (gatewayCallbacks.destroyOnUnload === true);\n\t// Some timeout-related values\n\tvar keepAlivePeriod = 25000;\n\tif(gatewayCallbacks.keepAlivePeriod !== undefined && gatewayCallbacks.keepAlivePeriod !== null)\n\t\tkeepAlivePeriod = gatewayCallbacks.keepAlivePeriod;\n\tif(isNaN(keepAlivePeriod))\n\t\tkeepAlivePeriod = 25000;\n\tvar longPollTimeout = 60000;\n\tif(gatewayCallbacks.longPollTimeout !== undefined && gatewayCallbacks.longPollTimeout !== null)\n\t\tlongPollTimeout = gatewayCallbacks.longPollTimeout;\n\tif(isNaN(longPollTimeout))\n\t\tlongPollTimeout = 60000;\n\n\t// overrides for default maxBitrate values for simulcasting\n\tfunction getMaxBitrates(simulcastMaxBitrates) {\n\t\tvar maxBitrates = {\n\t\t\thigh: 900000,\n\t\t\tmedium: 300000,\n\t\t\tlow: 100000,\n\t\t};\n\n\t\tif (simulcastMaxBitrates !== undefined && simulcastMaxBitrates !== null) {\n\t\t\tif (simulcastMaxBitrates.high)\n\t\t\t\tmaxBitrates.high = simulcastMaxBitrates.high;\n\t\t\tif (simulcastMaxBitrates.medium)\n\t\t\t\tmaxBitrates.medium = simulcastMaxBitrates.medium;\n\t\t\tif (simulcastMaxBitrates.low)\n\t\t\t\tmaxBitrates.low = simulcastMaxBitrates.low;\n\t\t}\n\n\t\treturn maxBitrates;\n\t}\n\n\tvar connected = false;\n\tvar sessionId = null;\n\tvar pluginHandles = {};\n\tvar that = this;\n\tvar retries = 0;\n\tvar transactions = {};\n\tcreateSession(gatewayCallbacks);\n\n\t// Public methods\n\tthis.getServer = function() { return server; };\n\tthis.isConnected = function() { return connected; };\n\tthis.reconnect = function(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks[\"reconnect\"] = true;\n\t\tcreateSession(callbacks);\n\t};\n\tthis.getSessionId = function() { return sessionId; };\n\tthis.getInfo = function(callbacks) { getInfo(callbacks); };\n\tthis.destroy = function(callbacks) { destroySession(callbacks); };\n\tthis.attach = function(callbacks) { createHandle(callbacks); };\n\n\tfunction eventHandler() {\n\t\tif(sessionId == null)\n\t\t\treturn;\n\t\tJanus.debug('Long poll...');\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar longpoll = server + \"/\" + sessionId + \"?rid=\" + new Date().getTime();\n\t\tif(maxev)\n\t\t\tlongpoll = longpoll + \"&maxev=\" + maxev;\n\t\tif(token)\n\t\t\tlongpoll = longpoll + \"&token=\" + encodeURIComponent(token);\n\t\tif(apisecret)\n\t\t\tlongpoll = longpoll + \"&apisecret=\" + encodeURIComponent(apisecret);\n\t\tJanus.httpAPICall(longpoll, {\n\t\t\tverb: 'GET',\n\t\t\twithCredentials: withCredentials,\n\t\t\tsuccess: handleEvent,\n\t\t\ttimeout: longPollTimeout,\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\n\t\t\t\tretries++;\n\t\t\t\tif(retries > 3) {\n\t\t\t\t\t// Did we just lose the server? :-(\n\t\t\t\t\tconnected = false;\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the server (is it down?)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\teventHandler();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private event handler: this will trigger plugin callbacks, if set\n\tfunction handleEvent(json, skipTimeout) {\n\t\tretries = 0;\n\t\tif(!websockets && sessionId !== undefined && sessionId !== null && skipTimeout !== true)\n\t\t\teventHandler();\n\t\tif(!websockets && Janus.isArray(json)) {\n\t\t\t// We got an array: it means we passed a maxev > 1, iterate on all objects\n\t\t\tfor(var i=0; i<json.length; i++) {\n\t\t\t\thandleEvent(json[i], true);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif(json[\"janus\"] === \"keepalive\") {\n\t\t\t// Nothing happened\n\t\t\tJanus.vdebug(\"Got a keepalive on session \" + sessionId);\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"server_info\") {\n\t\t\t// Just info on the Janus instance\n\t\t\tJanus.debug(\"Got info on the Janus instance\");\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess)\n\t\t\t\t\treportSuccess(json);\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"ack\") {\n\t\t\t// Just an ack, we can probably ignore\n\t\t\tJanus.debug(\"Got an ack on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess)\n\t\t\t\t\treportSuccess(json);\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"success\") {\n\t\t\t// Success!\n\t\t\tJanus.debug(\"Got a success on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess)\n\t\t\t\t\treportSuccess(json);\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"trickle\") {\n\t\t\t// We got a trickle candidate from Janus\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar candidate = json[\"candidate\"];\n\t\t\tJanus.debug(\"Got a trickled candidate on session \" + sessionId);\n\t\t\tJanus.debug(candidate);\n\t\t\tvar config = pluginHandle.webrtcStuff;\n\t\t\tif(config.pc && config.remoteSdp) {\n\t\t\t\t// Add candidate right now\n\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t// end-of-candidates\n\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t} else {\n\t\t\t\t\t// New candidate\n\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We didn't do setRemoteDescription (trickle got here before the offer?)\n\t\t\t\tJanus.debug(\"We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate\");\n\t\t\t\tif(!config.candidates)\n\t\t\t\t\tconfig.candidates = [];\n\t\t\t\tconfig.candidates.push(candidate);\n\t\t\t\tJanus.debug(config.candidates);\n\t\t\t}\n\t\t} else if(json[\"janus\"] === \"webrtcup\") {\n\t\t\t// The PeerConnection with the server is up! Notify this\n\t\t\tJanus.debug(\"Got a webrtcup event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.webrtcState(true);\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"hangup\") {\n\t\t\t// A plugin asked the core to hangup a PeerConnection on one of our handles\n\t\t\tJanus.debug(\"Got a hangup event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.webrtcState(false, json[\"reason\"]);\n\t\t\tpluginHandle.hangup();\n\t\t} else if(json[\"janus\"] === \"detached\") {\n\t\t\t// A plugin asked the core to detach one of our handles\n\t\t\tJanus.debug(\"Got a detached event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\t// Don't warn here because destroyHandle causes this situation.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.ondetached();\n\t\t\tpluginHandle.detach();\n\t\t} else if(json[\"janus\"] === \"media\") {\n\t\t\t// Media started/stopped flowing\n\t\t\tJanus.debug(\"Got a media event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.mediaState(json[\"type\"], json[\"receiving\"]);\n\t\t} else if(json[\"janus\"] === \"slowlink\") {\n\t\t\tJanus.debug(\"Got a slowlink event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\t// Trouble uplink or downlink\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.debug(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpluginHandle.slowLink(json[\"uplink\"], json[\"lost\"]);\n\t\t} else if(json[\"janus\"] === \"error\") {\n\t\t\t// Oops, something wrong happened\n\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\tJanus.debug(json);\n\t\t\tvar transaction = json[\"transaction\"];\n\t\t\tif(transaction) {\n\t\t\t\tvar reportSuccess = transactions[transaction];\n\t\t\t\tif(reportSuccess) {\n\t\t\t\t\treportSuccess(json);\n\t\t\t\t}\n\t\t\t\tdelete transactions[transaction];\n\t\t\t}\n\t\t\treturn;\n\t\t} else if(json[\"janus\"] === \"event\") {\n\t\t\tJanus.debug(\"Got a plugin event on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tvar sender = json[\"sender\"];\n\t\t\tif(!sender) {\n\t\t\t\tJanus.warn(\"Missing sender...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\tif(!plugindata) {\n\t\t\t\tJanus.warn(\"Missing plugindata...\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tJanus.debug(\"  -- Event is coming from \" + sender + \" (\" + plugindata[\"plugin\"] + \")\");\n\t\t\tvar data = plugindata[\"data\"];\n\t\t\tJanus.debug(data);\n\t\t\tvar pluginHandle = pluginHandles[sender];\n\t\t\tif(!pluginHandle) {\n\t\t\t\tJanus.warn(\"This handle is not attached to this session\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar jsep = json[\"jsep\"];\n\t\t\tif(jsep) {\n\t\t\t\tJanus.debug(\"Handling SDP as well...\");\n\t\t\t\tJanus.debug(jsep);\n\t\t\t}\n\t\t\tvar callback = pluginHandle.onmessage;\n\t\t\tif(callback) {\n\t\t\t\tJanus.debug(\"Notifying application...\");\n\t\t\t\t// Send to callback specified when attaching plugin handle\n\t\t\t\tcallback(data, jsep);\n\t\t\t} else {\n\t\t\t\t// Send to generic callback (?)\n\t\t\t\tJanus.debug(\"No provided notification callback\");\n\t\t\t}\n\t\t} else if(json[\"janus\"] === \"timeout\") {\n\t\t\tJanus.error(\"Timeout on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t\tif (websockets) {\n\t\t\t\tws.close(3504, \"Gateway timeout\");\n\t\t\t}\n\t\t\treturn;\n\t\t} else {\n\t\t\tJanus.warn(\"Unknown message/event  '\" + json[\"janus\"] + \"' on session \" + sessionId);\n\t\t\tJanus.debug(json);\n\t\t}\n\t}\n\n\t// Private helper to send keep-alive messages on WebSockets\n\tfunction keepAlive() {\n\t\tif(!server || !websockets || !connected)\n\t\t\treturn;\n\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n\t\tvar request = { \"janus\": \"keepalive\", \"session_id\": sessionId, \"transaction\": Janus.randomString(12) };\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tws.send(JSON.stringify(request));\n\t}\n\n\t// Private method to create a session\n\tfunction createSession(callbacks) {\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"create\", \"transaction\": transaction };\n\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t// We're reconnecting, claim the session\n\t\t\tconnected = false;\n\t\t\trequest[\"janus\"] = \"claim\";\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\t// If we were using websockets, ignore the old connection\n\t\t\tif(ws) {\n\t\t\t\tws.onopen = null;\n\t\t\t\tws.onerror = null;\n\t\t\t\tws.onclose = null;\n\t\t\t\tif(wsKeepaliveTimeoutId) {\n\t\t\t\t\tclearTimeout(wsKeepaliveTimeoutId);\n\t\t\t\t\twsKeepaliveTimeoutId = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(!server && Janus.isArray(servers)) {\n\t\t\t// We still need to find a working server from the list we were given\n\t\t\tserver = servers[serversIndex];\n\t\t\tif(server.indexOf(\"ws\") === 0) {\n\t\t\t\twebsockets = true;\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying WebSockets to contact Janus (\" + server + \")\");\n\t\t\t} else {\n\t\t\t\twebsockets = false;\n\t\t\t\tJanus.log(\"Server #\" + (serversIndex+1) + \": trying REST API to contact Janus (\" + server + \")\");\n\t\t\t}\n\t\t}\n\t\tif(websockets) {\n\t\t\tws = Janus.newWebSocket(server, 'janus-protocol');\n\t\t\twsHandlers = {\n\t\t\t\t'error': function() {\n\t\t\t\t\tJanus.error(\"Error connecting to the Janus WebSockets server... \" + server);\n\t\t\t\t\tif (Janus.isArray(servers) && !callbacks[\"reconnect\"]) {\n\t\t\t\t\t\tserversIndex++;\n\t\t\t\t\t\tif (serversIndex === servers.length) {\n\t\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\n\t\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the server down?\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Let's try the next server\n\t\t\t\t\t\tserver = null;\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tcreateSession(callbacks);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcallbacks.error(\"Error connecting to the Janus WebSockets server: Is the server down?\");\n\t\t\t\t},\n\n\t\t\t\t'open': function() {\n\t\t\t\t\t// We need to be notified about the success\n\t\t\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\t\t\tJanus.debug(json);\n\t\t\t\t\t\tif (json[\"janus\"] !== \"success\") {\n\t\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n\t\t\t\t\t\tconnected = true;\n\t\t\t\t\t\tsessionId = json[\"session_id\"] ? json[\"session_id\"] : json.data[\"id\"];\n\t\t\t\t\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t\t\t\t\tJanus.log(\"Claimed session: \" + sessionId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tJanus.log(\"Created session: \" + sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.sessions[sessionId] = that;\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t};\n\t\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t\t},\n\n\t\t\t\t'message': function(event) {\n\t\t\t\t\thandleEvent(JSON.parse(event.data));\n\t\t\t\t},\n\n\t\t\t\t'close': function() {\n\t\t\t\t\tif (!server || !connected) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconnected = false;\n\t\t\t\t\t// FIXME What if this is called when the page is closed?\n\t\t\t\t\tgatewayCallbacks.error(\"Lost connection to the server (is it down?)\");\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfor(var eventName in wsHandlers) {\n\t\t\t\tws.addEventListener(eventName, wsHandlers[eventName]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconnected = true;\n\t\t\t\tsessionId = json[\"session_id\"] ? json[\"session_id\"] : json.data[\"id\"];\n\t\t\t\tif(callbacks[\"reconnect\"]) {\n\t\t\t\t\tJanus.log(\"Claimed session: \" + sessionId);\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log(\"Created session: \" + sessionId);\n\t\t\t\t}\n\t\t\t\tJanus.sessions[sessionId] = that;\n\t\t\t\teventHandler();\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tif(Janus.isArray(servers) && !callbacks[\"reconnect\"]) {\n\t\t\t\t\tserversIndex++;\n\t\t\t\t\tif(serversIndex === servers.length) {\n\t\t\t\t\t\t// We tried all the servers the user gave us and they all failed\n\t\t\t\t\t\tcallbacks.error(\"Error connecting to any of the provided Janus servers: Is the server down?\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Let's try the next server\n\t\t\t\t\tserver = null;\n\t\t\t\t\tsetTimeout(function() { createSession(callbacks); }, 200);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(errorThrown === \"\")\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the server down?\");\n\t\t\t\telse\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to get info on the server\n\tfunction getInfo(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\t// FIXME This method triggers a success even when we fail\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tJanus.log(\"Getting info on Janus instance\");\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\t// We just need to send an \"info\" request\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"info\", \"transaction\": transaction };\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.log(\"Server info:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"server_info\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tcallbacks.success(json);\n\t\t\t}\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Server info:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"server_info\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tcallbacks.success(json);\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tif(errorThrown === \"\")\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the server down?\");\n\t\t\t\telse\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to destroy a session\n\tfunction destroySession(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\t// FIXME This method triggers a success even when we fail\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar unload = (callbacks.unload === true);\n\t\tvar notifyDestroyed = true;\n\t\tif(callbacks.notifyDestroyed !== undefined && callbacks.notifyDestroyed !== null)\n\t\t\tnotifyDestroyed = (callbacks.notifyDestroyed === true);\n\t\tvar cleanupHandles = (callbacks.cleanupHandles === true);\n\t\tJanus.log(\"Destroying session \" + sessionId + \" (unload=\" + unload + \")\");\n\t\tif(!sessionId) {\n\t\t\tJanus.warn(\"No session to destroy\");\n\t\t\tcallbacks.success();\n\t\t\tif(notifyDestroyed)\n\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\treturn;\n\t\t}\n\t\tif(cleanupHandles) {\n\t\t\tfor(var handleId in pluginHandles)\n\t\t\t\tdestroyHandle(handleId, { noRequest: true });\n\t\t}\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tsessionId = null;\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\t// No need to destroy all handles first, Janus will do that itself\n\t\tvar request = { \"janus\": \"destroy\", \"transaction\": Janus.randomString(12) };\n\t\tif(token)\n\t\t\trequest[\"token\"] = token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(unload) {\n\t\t\t// We're unloading the page: use sendBeacon for HTTP instead,\n\t\t\t// or just close the WebSocket connection if we're using that\n\t\t\tif(websockets) {\n\t\t\t\tws.onclose = null;\n\t\t\t\tws.close();\n\t\t\t\tws = null;\n\t\t\t} else {\n\t\t\t\tnavigator.sendBeacon(server + \"/\" + sessionId, JSON.stringify(request));\n\t\t\t}\n\t\t\tJanus.log(\"Destroyed session:\");\n\t\t\tsessionId = null;\n\t\t\tconnected = false;\n\t\t\tcallbacks.success();\n\t\t\tif(notifyDestroyed)\n\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\treturn;\n\t\t}\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\n\t\t\tvar unbindWebSocket = function() {\n\t\t\t\tfor(var eventName in wsHandlers) {\n\t\t\t\t\tws.removeEventListener(eventName, wsHandlers[eventName]);\n\t\t\t\t}\n\t\t\t\tws.removeEventListener('message', onUnbindMessage);\n\t\t\t\tws.removeEventListener('error', onUnbindError);\n\t\t\t\tif(wsKeepaliveTimeoutId) {\n\t\t\t\t\tclearTimeout(wsKeepaliveTimeoutId);\n\t\t\t\t}\n\t\t\t\tws.close();\n\t\t\t};\n\n\t\t\tvar onUnbindMessage = function(event){\n\t\t\t\tvar data = JSON.parse(event.data);\n\t\t\t\tif(data.session_id == request.session_id && data.transaction == request.transaction) {\n\t\t\t\t\tunbindWebSocket();\n\t\t\t\t\tcallbacks.success();\n\t\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar onUnbindError = function(event) {\n\t\t\t\tunbindWebSocket();\n\t\t\t\tcallbacks.error(\"Failed to destroy the server: Is the server down?\");\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t};\n\n\t\t\tws.addEventListener('message', onUnbindMessage);\n\t\t\tws.addEventListener('error', onUnbindError);\n\n\t\t\tif (ws.readyState === 1) {\n\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t} else {\n\t\t\t\tonUnbindError();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Destroyed session:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tsessionId = null;\n\t\t\t\tconnected = false;\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tcallbacks.success();\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\t// Reset everything anyway\n\t\t\t\tsessionId = null;\n\t\t\t\tconnected = false;\n\t\t\t\tcallbacks.success();\n\t\t\t\tif(notifyDestroyed)\n\t\t\t\t\tgatewayCallbacks.destroyed();\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to create a plugin handle\n\tfunction createHandle(callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.consentDialog = (typeof callbacks.consentDialog == \"function\") ? callbacks.consentDialog : Janus.noop;\n\t\tcallbacks.iceState = (typeof callbacks.iceState == \"function\") ? callbacks.iceState : Janus.noop;\n\t\tcallbacks.mediaState = (typeof callbacks.mediaState == \"function\") ? callbacks.mediaState : Janus.noop;\n\t\tcallbacks.webrtcState = (typeof callbacks.webrtcState == \"function\") ? callbacks.webrtcState : Janus.noop;\n\t\tcallbacks.slowLink = (typeof callbacks.slowLink == \"function\") ? callbacks.slowLink : Janus.noop;\n\t\tcallbacks.onmessage = (typeof callbacks.onmessage == \"function\") ? callbacks.onmessage : Janus.noop;\n\t\tcallbacks.onlocalstream = (typeof callbacks.onlocalstream == \"function\") ? callbacks.onlocalstream : Janus.noop;\n\t\tcallbacks.onremotestream = (typeof callbacks.onremotestream == \"function\") ? callbacks.onremotestream : Janus.noop;\n\t\tcallbacks.ondata = (typeof callbacks.ondata == \"function\") ? callbacks.ondata : Janus.noop;\n\t\tcallbacks.ondataopen = (typeof callbacks.ondataopen == \"function\") ? callbacks.ondataopen : Janus.noop;\n\t\tcallbacks.oncleanup = (typeof callbacks.oncleanup == \"function\") ? callbacks.oncleanup : Janus.noop;\n\t\tcallbacks.ondetached = (typeof callbacks.ondetached == \"function\") ? callbacks.ondetached : Janus.noop;\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar plugin = callbacks.plugin;\n\t\tif(!plugin) {\n\t\t\tJanus.error(\"Invalid plugin\");\n\t\t\tcallbacks.error(\"Invalid plugin\");\n\t\t\treturn;\n\t\t}\n\t\tvar opaqueId = callbacks.opaqueId;\n\t\tvar handleToken = callbacks.token ? callbacks.token : token;\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"attach\", \"plugin\": plugin, \"opaque_id\": opaqueId, \"transaction\": transaction };\n\t\tif(handleToken)\n\t\t\trequest[\"token\"] = handleToken;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar handleId = json.data[\"id\"];\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\n\t\t\t\tvar pluginHandle =\n\t\t\t\t\t{\n\t\t\t\t\t\tsession : that,\n\t\t\t\t\t\tplugin : plugin,\n\t\t\t\t\t\tid : handleId,\n\t\t\t\t\t\ttoken : handleToken,\n\t\t\t\t\t\tdetached : false,\n\t\t\t\t\t\twebrtcStuff : {\n\t\t\t\t\t\t\tstarted : false,\n\t\t\t\t\t\t\tmyStream : null,\n\t\t\t\t\t\t\tstreamExternal : false,\n\t\t\t\t\t\t\tremoteStream : null,\n\t\t\t\t\t\t\tmySdp : null,\n\t\t\t\t\t\t\tmediaConstraints : null,\n\t\t\t\t\t\t\tpc : null,\n\t\t\t\t\t\t\tdataChannel : {},\n\t\t\t\t\t\t\tdtmfSender : null,\n\t\t\t\t\t\t\ttrickle : true,\n\t\t\t\t\t\t\ticeDone : false,\n\t\t\t\t\t\t\tvolume : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbitrate : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\tbsnow : null,\n\t\t\t\t\t\t\t\tbsbefore : null,\n\t\t\t\t\t\t\t\ttsnow : null,\n\t\t\t\t\t\t\t\ttsbefore : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetId : function() { return handleId; },\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetRemoteVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetLocalVolume : function() { return getVolume(handleId, false); },\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\n\t\t\t\t\t\ticeState : callbacks.iceState,\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, true, callbacks); },\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, false, callbacks); },\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\n\t\t\t\t\t\tondata : callbacks.ondata,\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\n\t\t\t\t\t\tondetached : callbacks.ondetached,\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\n\t\t\t\t\t};\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\n\t\t\t\tcallbacks.success(pluginHandle);\n\t\t\t};\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\tcallbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar handleId = json.data[\"id\"];\n\t\t\t\tJanus.log(\"Created handle: \" + handleId);\n\t\t\t\tvar pluginHandle =\n\t\t\t\t\t{\n\t\t\t\t\t\tsession : that,\n\t\t\t\t\t\tplugin : plugin,\n\t\t\t\t\t\tid : handleId,\n\t\t\t\t\t\ttoken : handleToken,\n\t\t\t\t\t\tdetached : false,\n\t\t\t\t\t\twebrtcStuff : {\n\t\t\t\t\t\t\tstarted : false,\n\t\t\t\t\t\t\tmyStream : null,\n\t\t\t\t\t\t\tstreamExternal : false,\n\t\t\t\t\t\t\tremoteStream : null,\n\t\t\t\t\t\t\tmySdp : null,\n\t\t\t\t\t\t\tmediaConstraints : null,\n\t\t\t\t\t\t\tpc : null,\n\t\t\t\t\t\t\tdataChannel : {},\n\t\t\t\t\t\t\tdtmfSender : null,\n\t\t\t\t\t\t\ttrickle : true,\n\t\t\t\t\t\t\ticeDone : false,\n\t\t\t\t\t\t\tvolume : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbitrate : {\n\t\t\t\t\t\t\t\tvalue : null,\n\t\t\t\t\t\t\t\tbsnow : null,\n\t\t\t\t\t\t\t\tbsbefore : null,\n\t\t\t\t\t\t\t\ttsnow : null,\n\t\t\t\t\t\t\t\ttsbefore : null,\n\t\t\t\t\t\t\t\ttimer : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetId : function() { return handleId; },\n\t\t\t\t\t\tgetPlugin : function() { return plugin; },\n\t\t\t\t\t\tgetVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetRemoteVolume : function() { return getVolume(handleId, true); },\n\t\t\t\t\t\tgetLocalVolume : function() { return getVolume(handleId, false); },\n\t\t\t\t\t\tisAudioMuted : function() { return isMuted(handleId, false); },\n\t\t\t\t\t\tmuteAudio : function() { return mute(handleId, false, true); },\n\t\t\t\t\t\tunmuteAudio : function() { return mute(handleId, false, false); },\n\t\t\t\t\t\tisVideoMuted : function() { return isMuted(handleId, true); },\n\t\t\t\t\t\tmuteVideo : function() { return mute(handleId, true, true); },\n\t\t\t\t\t\tunmuteVideo : function() { return mute(handleId, true, false); },\n\t\t\t\t\t\tgetBitrate : function() { return getBitrate(handleId); },\n\t\t\t\t\t\tsend : function(callbacks) { sendMessage(handleId, callbacks); },\n\t\t\t\t\t\tdata : function(callbacks) { sendData(handleId, callbacks); },\n\t\t\t\t\t\tdtmf : function(callbacks) { sendDtmf(handleId, callbacks); },\n\t\t\t\t\t\tconsentDialog : callbacks.consentDialog,\n\t\t\t\t\t\ticeState : callbacks.iceState,\n\t\t\t\t\t\tmediaState : callbacks.mediaState,\n\t\t\t\t\t\twebrtcState : callbacks.webrtcState,\n\t\t\t\t\t\tslowLink : callbacks.slowLink,\n\t\t\t\t\t\tonmessage : callbacks.onmessage,\n\t\t\t\t\t\tcreateOffer : function(callbacks) { prepareWebrtc(handleId, true, callbacks); },\n\t\t\t\t\t\tcreateAnswer : function(callbacks) { prepareWebrtc(handleId, false, callbacks); },\n\t\t\t\t\t\thandleRemoteJsep : function(callbacks) { prepareWebrtcPeer(handleId, callbacks); },\n\t\t\t\t\t\tonlocalstream : callbacks.onlocalstream,\n\t\t\t\t\t\tonremotestream : callbacks.onremotestream,\n\t\t\t\t\t\tondata : callbacks.ondata,\n\t\t\t\t\t\tondataopen : callbacks.ondataopen,\n\t\t\t\t\t\toncleanup : callbacks.oncleanup,\n\t\t\t\t\t\tondetached : callbacks.ondetached,\n\t\t\t\t\t\thangup : function(sendRequest) { cleanupWebrtc(handleId, sendRequest === true); },\n\t\t\t\t\t\tdetach : function(callbacks) { destroyHandle(handleId, callbacks); }\n\t\t\t\t\t}\n\t\t\t\tpluginHandles[handleId] = pluginHandle;\n\t\t\t\tcallbacks.success(pluginHandle);\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tif(errorThrown === \"\")\n\t\t\t\t\tcallbacks.error(textStatus + \": Is the server down?\");\n\t\t\t\telse\n\t\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to send a message\n\tfunction sendMessage(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar message = callbacks.message;\n\t\tvar jsep = callbacks.jsep;\n\t\tvar transaction = Janus.randomString(12);\n\t\tvar request = { \"janus\": \"message\", \"body\": message, \"transaction\": transaction };\n\t\tif(pluginHandle.token)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(jsep) {\n\t\t\trequest.jsep = {\n\t\t\t\ttype: jsep.type,\n\t\t\t\tsdp: jsep.sdp\n\t\t\t};\n\t\t\tif(jsep.e2ee)\n\t\t\t\trequest.jsep.e2ee = true;\n\t\t\tif(jsep.rid_order === \"hml\" || jsep.rid_order === \"lmh\")\n\t\t\t\trequest.jsep.rid_order = jsep.rid_order;\n\t\t}\n\t\tJanus.debug(\"Sending message to plugin (handle=\" + handleId + \"):\");\n\t\tJanus.debug(request);\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\ttransactions[transaction] = function(json) {\n\t\t\t\tJanus.debug(\"Message sent!\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] === \"success\") {\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\t\t\tif(!plugindata) {\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\n\t\t\t\t\tvar data = plugindata[\"data\"];\n\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\tcallbacks.success(data);\n\t\t\t\t\treturn;\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\t// Not a success and not an ack, must be an error\n\t\t\t\t\tif(json[\"error\"]) {\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\n\t\t\t\tcallbacks.success();\n\t\t\t};\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.debug(\"Message sent!\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] === \"success\") {\n\t\t\t\t\t// We got a success, must have been a synchronous transaction\n\t\t\t\t\tvar plugindata = json[\"plugindata\"];\n\t\t\t\t\tif(!plugindata) {\n\t\t\t\t\t\tJanus.warn(\"Request succeeded, but missing plugindata...\");\n\t\t\t\t\t\tcallbacks.success();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\n\t\t\t\t\tvar data = plugindata[\"data\"];\n\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\tcallbacks.success(data);\n\t\t\t\t\treturn;\n\t\t\t\t} else if(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\t// Not a success and not an ack, must be an error\n\t\t\t\t\tif(json[\"error\"]) {\n\t\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\t\tcallbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tJanus.error(\"Unknown error\");\t// FIXME\n\t\t\t\t\t\tcallbacks.error(\"Unknown error\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If we got here, the plugin decided to handle the request asynchronously\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\tcallbacks.error(textStatus + \": \" + errorThrown);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to send a trickle candidate\n\tfunction sendTrickleCandidate(handleId, candidate) {\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar request = { \"janus\": \"trickle\", \"candidate\": candidate, \"transaction\": Janus.randomString(12) };\n\t\tif(pluginHandle.token)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tJanus.vdebug(\"Sending trickle candidate (handle=\" + handleId + \"):\");\n\t\tJanus.vdebug(request);\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.vdebug(\"Candidate sent!\");\n\t\t\t\tJanus.vdebug(json);\n\t\t\t\tif(json[\"janus\"] !== \"ack\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t}\n\t\t});\n\t}\n\n\t// Private method to create a data channel\n\tfunction createDataChannel(handleId, dclabel, dcprotocol, incoming, pendingData) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn;\n\t\t}\n\t\tvar onDataChannelMessage = function(event) {\n\t\t\tJanus.log('Received message on data channel:', event);\n\t\t\tvar label = event.target.label;\n\t\t\tpluginHandle.ondata(event.data, label);\n\t\t};\n\t\tvar onDataChannelStateChange = function(event) {\n\t\t\tJanus.log('Received state change on data channel:', event);\n\t\t\tvar label = event.target.label;\n\t\t\tvar protocol = event.target.protocol;\n\t\t\tvar dcState = config.dataChannel[label] ? config.dataChannel[label].readyState : \"null\";\n\t\t\tJanus.log('State change on <' + label + '> data channel: ' + dcState);\n\t\t\tif(dcState === 'open') {\n\t\t\t\t// Any pending messages to send?\n\t\t\t\tif(config.dataChannel[label].pending && config.dataChannel[label].pending.length > 0) {\n\t\t\t\t\tJanus.log(\"Sending pending messages on <\" + label + \">:\", config.dataChannel[label].pending.length);\n\t\t\t\t\tfor(var data of config.dataChannel[label].pending) {\n\t\t\t\t\t\tJanus.log(\"Sending data on data channel <\" + label + \">\");\n\t\t\t\t\t\tJanus.debug(data);\n\t\t\t\t\t\tconfig.dataChannel[label].send(data);\n\t\t\t\t\t}\n\t\t\t\t\tconfig.dataChannel[label].pending = [];\n\t\t\t\t}\n\t\t\t\t// Notify the open data channel\n\t\t\t\tpluginHandle.ondataopen(label, protocol);\n\t\t\t}\n\t\t};\n\t\tvar onDataChannelError = function(error) {\n\t\t\tJanus.error('Got error on data channel:', error);\n\t\t\t// TODO\n\t\t};\n\t\tif(!incoming) {\n\t\t\t// FIXME Add options (ordered, maxRetransmits, etc.)\n\t\t\tvar dcoptions = { ordered: true };\n\t\t\tif(dcprotocol)\n\t\t\t\tdcoptions.protocol = dcprotocol;\n\t\t\tconfig.dataChannel[dclabel] = config.pc.createDataChannel(dclabel, dcoptions);\n\t\t} else {\n\t\t\t// The channel was created by Janus\n\t\t\tconfig.dataChannel[dclabel] = incoming;\n\t\t}\n\t\tconfig.dataChannel[dclabel].onmessage = onDataChannelMessage;\n\t\tconfig.dataChannel[dclabel].onopen = onDataChannelStateChange;\n\t\tconfig.dataChannel[dclabel].onclose = onDataChannelStateChange;\n\t\tconfig.dataChannel[dclabel].onerror = onDataChannelError;\n\t\tconfig.dataChannel[dclabel].pending = [];\n\t\tif(pendingData)\n\t\t\tconfig.dataChannel[dclabel].pending.push(pendingData);\n\t}\n\n\t// Private method to send a data channel message\n\tfunction sendData(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar data = callbacks.text || callbacks.data;\n\t\tif(!data) {\n\t\t\tJanus.warn(\"Invalid data\");\n\t\t\tcallbacks.error(\"Invalid data\");\n\t\t\treturn;\n\t\t}\n\t\tvar label = callbacks.label ? callbacks.label : Janus.dataChanDefaultLabel;\n\t\tif(!config.dataChannel[label]) {\n\t\t\t// Create new data channel and wait for it to open\n\t\t\tcreateDataChannel(handleId, label, callbacks.protocol, false, data, callbacks.protocol);\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(config.dataChannel[label].readyState !== \"open\") {\n\t\t\tconfig.dataChannel[label].pending.push(data);\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tJanus.log(\"Sending data on data channel <\" + label + \">\");\n\t\tJanus.debug(data);\n\t\tconfig.dataChannel[label].send(data);\n\t\tcallbacks.success();\n\t}\n\n\t// Private method to send a DTMF tone\n\tfunction sendDtmf(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.dtmfSender) {\n\t\t\t// Create the DTMF sender the proper way, if possible\n\t\t\tif(config.pc) {\n\t\t\t\tvar senders = config.pc.getSenders();\n\t\t\t\tvar audioSender = senders.find(function(sender) {\n\t\t\t\t\treturn sender.track && sender.track.kind === 'audio';\n\t\t\t\t});\n\t\t\t\tif(!audioSender) {\n\t\t\t\t\tJanus.warn(\"Invalid DTMF configuration (no audio track)\");\n\t\t\t\t\tcallbacks.error(\"Invalid DTMF configuration (no audio track)\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconfig.dtmfSender = audioSender.dtmf;\n\t\t\t\tif(config.dtmfSender) {\n\t\t\t\t\tJanus.log(\"Created DTMF Sender\");\n\t\t\t\t\tconfig.dtmfSender.ontonechange = function(tone) { Janus.debug(\"Sent DTMF tone: \" + tone.tone); };\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(!config.dtmfSender) {\n\t\t\t\tJanus.warn(\"Invalid DTMF configuration\");\n\t\t\t\tcallbacks.error(\"Invalid DTMF configuration\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tvar dtmf = callbacks.dtmf;\n\t\tif(!dtmf) {\n\t\t\tJanus.warn(\"Invalid DTMF parameters\");\n\t\t\tcallbacks.error(\"Invalid DTMF parameters\");\n\t\t\treturn;\n\t\t}\n\t\tvar tones = dtmf.tones;\n\t\tif(!tones) {\n\t\t\tJanus.warn(\"Invalid DTMF string\");\n\t\t\tcallbacks.error(\"Invalid DTMF string\");\n\t\t\treturn;\n\t\t}\n\t\tvar duration = (typeof dtmf.duration === 'number') ? dtmf.duration : 500; // We choose 500ms as the default duration for a tone\n\t\tvar gap = (typeof dtmf.gap === 'number') ? dtmf.gap : 50; // We choose 50ms as the default gap between tones\n\t\tJanus.debug(\"Sending DTMF string \" + tones + \" (duration \" + duration + \"ms, gap \" + gap + \"ms)\");\n\t\tconfig.dtmfSender.insertDTMF(tones, duration, gap);\n\t\tcallbacks.success();\n\t}\n\n\t// Private method to destroy a plugin handle\n\tfunction destroyHandle(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar noRequest = (callbacks.noRequest === true);\n\t\tJanus.log(\"Destroying handle \" + handleId + \" (only-locally=\" + noRequest + \")\");\n\t\tcleanupWebrtc(handleId);\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || pluginHandle.detached) {\n\t\t\t// Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tpluginHandle.detached = true;\n\t\tif(noRequest) {\n\t\t\t// We're only removing the handle locally\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tif(!connected) {\n\t\t\tJanus.warn(\"Is the server down? (connected=false)\");\n\t\t\tcallbacks.error(\"Is the server down? (connected=false)\");\n\t\t\treturn;\n\t\t}\n\t\tvar request = { \"janus\": \"detach\", \"transaction\": Janus.randomString(12) };\n\t\tif(pluginHandle.token)\n\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\tif(apisecret)\n\t\t\trequest[\"apisecret\"] = apisecret;\n\t\tif(websockets) {\n\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\tws.send(JSON.stringify(request));\n\t\t\tdelete pluginHandles[handleId];\n\t\t\tcallbacks.success();\n\t\t\treturn;\n\t\t}\n\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\tverb: 'POST',\n\t\t\twithCredentials: withCredentials,\n\t\t\tbody: request,\n\t\t\tsuccess: function(json) {\n\t\t\t\tJanus.log(\"Destroyed handle:\");\n\t\t\t\tJanus.debug(json);\n\t\t\t\tif(json[\"janus\"] !== \"success\") {\n\t\t\t\t\tJanus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\t// FIXME\n\t\t\t\t}\n\t\t\t\tdelete pluginHandles[handleId];\n\t\t\t\tcallbacks.success();\n\t\t\t},\n\t\t\terror: function(textStatus, errorThrown) {\n\t\t\t\tJanus.error(textStatus + \":\", errorThrown);\t// FIXME\n\t\t\t\t// We cleanup anyway\n\t\t\t\tdelete pluginHandles[handleId];\n\t\t\t\tcallbacks.success();\n\t\t\t}\n\t\t});\n\t}\n\n\t// WebRTC stuff\n\tfunction streamsDone(handleId, jsep, media, callbacks, stream) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\t// Close all tracks if the given stream has been created internally\n\t\t\tif(!callbacks.stream) {\n\t\t\t\tJanus.stopAllTracks(stream);\n\t\t\t}\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tJanus.debug(\"streamsDone:\", stream);\n\t\tif(stream) {\n\t\t\tJanus.debug(\"  -- Audio tracks:\", stream.getAudioTracks());\n\t\t\tJanus.debug(\"  -- Video tracks:\", stream.getVideoTracks());\n\t\t}\n\t\t// We're now capturing the new stream: check if we're updating or if it's a new thing\n\t\tvar addTracks = false;\n\t\tif(!config.myStream || !media.update || (config.streamExternal && !media.replaceAudio && !media.replaceVideo)) {\n\t\t\tconfig.myStream = stream;\n\t\t\taddTracks = true;\n\t\t} else {\n\t\t\t// We only need to update the existing stream\n\t\t\tif(((!media.update && isAudioSendEnabled(media)) || (media.update && (media.addAudio || media.replaceAudio))) &&\n\t\t\t\t\tstream.getAudioTracks() && stream.getAudioTracks().length) {\n\t\t\t\tconfig.myStream.addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tif(Janus.unifiedPlan) {\n\t\t\t\t\t// Use Transceivers\n\t\t\t\t\tJanus.log((media.replaceAudio ? \"Replacing\" : \"Adding\") + \" audio track:\", stream.getAudioTracks()[0]);\n\t\t\t\t\tvar audioTransceiver = null;\n\t\t\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(audioTransceiver && audioTransceiver.sender) {\n\t\t\t\t\t\taudioTransceiver.sender.replaceTrack(stream.getAudioTracks()[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfig.pc.addTrack(stream.getAudioTracks()[0], stream);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log((media.replaceAudio ? \"Replacing\" : \"Adding\") + \" audio track:\", stream.getAudioTracks()[0]);\n\t\t\t\t\tconfig.pc.addTrack(stream.getAudioTracks()[0], stream);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(((!media.update && isVideoSendEnabled(media)) || (media.update && (media.addVideo || media.replaceVideo))) &&\n\t\t\t\t\tstream.getVideoTracks() && stream.getVideoTracks().length) {\n\t\t\t\tconfig.myStream.addTrack(stream.getVideoTracks()[0]);\n\t\t\t\tif(Janus.unifiedPlan) {\n\t\t\t\t\t// Use Transceivers\n\t\t\t\t\tJanus.log((media.replaceVideo ? \"Replacing\" : \"Adding\") + \" video track:\", stream.getVideoTracks()[0]);\n\t\t\t\t\tvar videoTransceiver = null;\n\t\t\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(videoTransceiver && videoTransceiver.sender) {\n\t\t\t\t\t\tvideoTransceiver.sender.replaceTrack(stream.getVideoTracks()[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfig.pc.addTrack(stream.getVideoTracks()[0], stream);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log((media.replaceVideo ? \"Replacing\" : \"Adding\") + \" video track:\", stream.getVideoTracks()[0]);\n\t\t\t\t\tconfig.pc.addTrack(stream.getVideoTracks()[0], stream);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// If we still need to create a PeerConnection, let's do that\n\t\tif(!config.pc) {\n\t\t\tvar pc_config = {\"iceServers\": iceServers, \"iceTransportPolicy\": iceTransportPolicy, \"bundlePolicy\": bundlePolicy};\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\n\t\t\t\t// For Chrome versions before 72, we force a plan-b semantic, and unified-plan otherwise\n\t\t\t\tpc_config[\"sdpSemantics\"] = (Janus.webRTCAdapter.browserDetails.version < 72) ? \"plan-b\" : \"unified-plan\";\n\t\t\t}\n\t\t\tvar pc_constraints = {\n\t\t\t\t\"optional\": [{\"DtlsSrtpKeyAgreement\": true}]\n\t\t\t};\n\t\t\tif(ipv6Support) {\n\t\t\t\tpc_constraints.optional.push({\"googIPv6\":true});\n\t\t\t}\n\t\t\t// Any custom constraint to add?\n\t\t\tif(callbacks.rtcConstraints && typeof callbacks.rtcConstraints === 'object') {\n\t\t\t\tJanus.debug(\"Adding custom PeerConnection constraints:\", callbacks.rtcConstraints);\n\t\t\t\tfor(var i in callbacks.rtcConstraints) {\n\t\t\t\t\tpc_constraints.optional.push(callbacks.rtcConstraints[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\n\t\t\t\t// This is Edge, enable BUNDLE explicitly\n\t\t\t\tpc_config.bundlePolicy = \"max-bundle\";\n\t\t\t}\n\t\t\t// Check if a sender or receiver transform has been provided\n\t\t\tif(RTCRtpSender && (RTCRtpSender.prototype.createEncodedStreams ||\n\t\t\t\t\t(RTCRtpSender.prototype.createEncodedAudioStreams &&\n\t\t\t\t\tRTCRtpSender.prototype.createEncodedVideoStreams)) &&\n\t\t\t\t\t(callbacks.senderTransforms || callbacks.receiverTransforms)) {\n\t\t\t\tconfig.senderTransforms = callbacks.senderTransforms;\n\t\t\t\tconfig.receiverTransforms = callbacks.receiverTransforms;\n\t\t\t\tpc_config[\"forceEncodedAudioInsertableStreams\"] = true;\n\t\t\t\tpc_config[\"forceEncodedVideoInsertableStreams\"] = true;\n\t\t\t\tpc_config[\"encodedInsertableStreams\"] = true;\n\t\t\t}\n\t\t\tJanus.log(\"Creating PeerConnection\");\n\t\t\tJanus.debug(pc_constraints);\n\t\t\tconfig.pc = new RTCPeerConnection(pc_config, pc_constraints);\n\t\t\tJanus.debug(config.pc);\n\t\t\tif(config.pc.getStats) {\t// FIXME\n\t\t\t\tconfig.volume = {};\n\t\t\t\tconfig.bitrate.value = \"0 kbits/sec\";\n\t\t\t}\n\t\t\tJanus.log(\"Preparing local SDP and gathering candidates (trickle=\" + config.trickle + \")\");\n\t\t\tconfig.pc.oniceconnectionstatechange = function(e) {\n\t\t\t\tif(config.pc)\n\t\t\t\t\tpluginHandle.iceState(config.pc.iceConnectionState);\n\t\t\t};\n\t\t\tconfig.pc.onicecandidate = function(event) {\n\t\t\t\tif (!event.candidate ||\n\t\t\t\t\t\t(Janus.webRTCAdapter.browserDetails.browser === 'edge' && event.candidate.candidate.indexOf('endOfCandidates') > 0)) {\n\t\t\t\t\tJanus.log(\"End of candidates.\");\n\t\t\t\t\tconfig.iceDone = true;\n\t\t\t\t\tif(config.trickle === true) {\n\t\t\t\t\t\t// Notify end of candidates\n\t\t\t\t\t\tsendTrickleCandidate(handleId, {\"completed\": true});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// No trickle, time to send the complete SDP (including all candidates)\n\t\t\t\t\t\tsendSDP(handleId, callbacks);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\t\tvar candidate = {\n\t\t\t\t\t\t\"candidate\": event.candidate.candidate,\n\t\t\t\t\t\t\"sdpMid\": event.candidate.sdpMid,\n\t\t\t\t\t\t\"sdpMLineIndex\": event.candidate.sdpMLineIndex\n\t\t\t\t\t};\n\t\t\t\t\tif(config.trickle === true) {\n\t\t\t\t\t\t// Send candidate\n\t\t\t\t\t\tsendTrickleCandidate(handleId, candidate);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tconfig.pc.ontrack = function(event) {\n\t\t\t\tJanus.log(\"Handling Remote Track\");\n\t\t\t\tJanus.debug(event);\n\t\t\t\tif(!event.streams)\n\t\t\t\t\treturn;\n\t\t\t\tconfig.remoteStream = event.streams[0];\n\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\tif(event.track.onended)\n\t\t\t\t\treturn;\n\t\t\t\tif(config.receiverTransforms) {\n\t\t\t\t\tvar receiverStreams = null;\n\t\t\t\t\tif(RTCRtpSender.prototype.createEncodedStreams) {\n\t\t\t\t\t\treceiverStreams = event.receiver.createEncodedStreams();\n\t\t\t\t\t} else if(RTCRtpSender.prototype.createAudioEncodedStreams || RTCRtpSender.prototype.createEncodedVideoStreams) {\n\t\t\t\t\t\tif(event.track.kind === \"audio\" && config.receiverTransforms[\"audio\"]) {\n\t\t\t\t\t\t\treceiverStreams = event.receiver.createEncodedAudioStreams();\n\t\t\t\t\t\t} else if(event.track.kind === \"video\" && config.receiverTransforms[\"video\"]) {\n\t\t\t\t\t\t\treceiverStreams = event.receiver.createEncodedVideoStreams();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(receiverStreams) {\n\t\t\t\t\t\tconsole.log(receiverStreams);\n\t\t\t\t\t\tif(receiverStreams.readableStream && receiverStreams.writableStream) {\n\t\t\t\t\t\t\treceiverStreams.readableStream\n\t\t\t\t\t\t\t\t.pipeThrough(config.receiverTransforms[event.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(receiverStreams.writableStream);\n\t\t\t\t\t\t} else if(receiverStreams.readable && receiverStreams.writable) {\n\t\t\t\t\t\t\treceiverStreams.readable\n\t\t\t\t\t\t\t\t.pipeThrough(config.receiverTransforms[event.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(receiverStreams.writable);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar trackMutedTimeoutId = null;\n\t\t\t\tJanus.log(\"Adding onended callback to track:\", event.track);\n\t\t\t\tevent.track.onended = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track removed:\", ev);\n\t\t\t\t\tif(config.remoteStream) {\n\t\t\t\t\t\tclearTimeout(trackMutedTimeoutId);\n\t\t\t\t\t\tconfig.remoteStream.removeTrack(ev.target);\n\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tevent.track.onmute = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track muted:\", ev);\n\t\t\t\t\tif(config.remoteStream && trackMutedTimeoutId == null) {\n\t\t\t\t\t\ttrackMutedTimeoutId = setTimeout(function() {\n\t\t\t\t\t\t\tJanus.log(\"Removing remote track\");\n\t\t\t\t\t\t\tif (config.remoteStream) {\n\t\t\t\t\t\t\t\tconfig.remoteStream.removeTrack(ev.target);\n\t\t\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttrackMutedTimeoutId = null;\n\t\t\t\t\t\t// Chrome seems to raise mute events only at multiples of 834ms;\n\t\t\t\t\t\t// we set the timeout to three times this value (rounded to 840ms)\n\t\t\t\t\t\t}, 3 * 840);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tevent.track.onunmute = function(ev) {\n\t\t\t\t\tJanus.log(\"Remote track flowing again:\", ev);\n\t\t\t\t\tif(trackMutedTimeoutId != null) {\n\t\t\t\t\t\tclearTimeout(trackMutedTimeoutId);\n\t\t\t\t\t\ttrackMutedTimeoutId = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconfig.remoteStream.addTrack(ev.target);\n\t\t\t\t\t\t\tpluginHandle.onremotestream(config.remoteStream);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t\tif(addTracks && stream) {\n\t\t\tJanus.log('Adding local stream');\n\t\t\tvar simulcast2 = (callbacks.simulcast2 === true);\n\t\t\tstream.getTracks().forEach(function(track) {\n\t\t\t\tJanus.log('Adding local track:', track);\n\t\t\t\tvar sender = null;\n\t\t\t\tif(!simulcast2 || track.kind === 'audio') {\n\t\t\t\t\tsender = config.pc.addTrack(track, stream);\n\t\t\t\t} else {\n\t\t\t\t\tJanus.log('Enabling rid-based simulcasting:', track);\n\t\t\t\t\tvar maxBitrates = getMaxBitrates(callbacks.simulcastMaxBitrates);\n\t\t\t\t\tvar tr = config.pc.addTransceiver(track, {\n\t\t\t\t\t\tdirection: \"sendrecv\",\n\t\t\t\t\t\tstreams: [stream],\n\t\t\t\t\t\tsendEncodings: callbacks.sendEncodings || [\n\t\t\t\t\t\t\t{ rid: \"h\", active: true, maxBitrate: maxBitrates.high },\n\t\t\t\t\t\t\t{ rid: \"m\", active: true, maxBitrate: maxBitrates.medium, scaleResolutionDownBy: 2 },\n\t\t\t\t\t\t\t{ rid: \"l\", active: true, maxBitrate: maxBitrates.low, scaleResolutionDownBy: 4 }\n\t\t\t\t\t\t]\n\t\t\t\t\t});\n\t\t\t\t\tif(tr)\n\t\t\t\t\t\tsender = tr.sender;\n\t\t\t\t}\n\t\t\t\t// Check if insertable streams are involved\n\t\t\t\tif(sender && config.senderTransforms) {\n\t\t\t\t\tvar senderStreams = null;\n\t\t\t\t\tif(RTCRtpSender.prototype.createEncodedStreams) {\n\t\t\t\t\t\tsenderStreams = sender.createEncodedStreams();\n\t\t\t\t\t} else if(RTCRtpSender.prototype.createAudioEncodedStreams || RTCRtpSender.prototype.createEncodedVideoStreams) {\n\t\t\t\t\t\tif(sender.track.kind === \"audio\" && config.senderTransforms[\"audio\"]) {\n\t\t\t\t\t\t\tsenderStreams = sender.createEncodedAudioStreams();\n\t\t\t\t\t\t} else if(sender.track.kind === \"video\" && config.senderTransforms[\"video\"]) {\n\t\t\t\t\t\t\tsenderStreams = sender.createEncodedVideoStreams();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(senderStreams) {\n\t\t\t\t\t\tconsole.log(senderStreams);\n\t\t\t\t\t\tif(senderStreams.readableStream && senderStreams.writableStream) {\n\t\t\t\t\t\t\tsenderStreams.readableStream\n\t\t\t\t\t\t\t\t.pipeThrough(config.senderTransforms[sender.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(senderStreams.writableStream);\n\t\t\t\t\t\t} else if(senderStreams.readable && senderStreams.writable) {\n\t\t\t\t\t\t\tsenderStreams.readable\n\t\t\t\t\t\t\t\t.pipeThrough(config.senderTransforms[sender.track.kind])\n\t\t\t\t\t\t\t\t.pipeTo(senderStreams.writable);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Any data channel to create?\n\t\tif(isDataEnabled(media) && !config.dataChannel[Janus.dataChanDefaultLabel]) {\n\t\t\tJanus.log(\"Creating default data channel\");\n\t\t\tcreateDataChannel(handleId, Janus.dataChanDefaultLabel, null, false);\n\t\t\tconfig.pc.ondatachannel = function(event) {\n\t\t\t\tJanus.log(\"Data channel created by Janus:\", event);\n\t\t\t\tcreateDataChannel(handleId, event.channel.label, event.channel.protocol, event.channel);\n\t\t\t};\n\t\t}\n\t\t// If there's a new local stream, let's notify the application\n\t\tif(config.myStream) {\n\t\t\tpluginHandle.onlocalstream(config.myStream);\n\t\t}\n\t\t// Create offer/answer now\n\t\tif(!jsep) {\n\t\t\tcreateOffer(handleId, media, callbacks);\n\t\t} else {\n\t\t\tconfig.pc.setRemoteDescription(jsep)\n\t\t\t\t.then(function() {\n\t\t\t\t\tJanus.log(\"Remote description accepted!\");\n\t\t\t\t\tconfig.remoteSdp = jsep.sdp;\n\t\t\t\t\t// Any trickle candidate we cached?\n\t\t\t\t\tif(config.candidates && config.candidates.length > 0) {\n\t\t\t\t\t\tfor(var i = 0; i< config.candidates.length; i++) {\n\t\t\t\t\t\t\tvar candidate = config.candidates[i];\n\t\t\t\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t\t\t\t// end-of-candidates\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// New candidate\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconfig.candidates = [];\n\t\t\t\t\t}\n\t\t\t\t\t// Create the answer now\n\t\t\t\t\tcreateAnswer(handleId, media, callbacks);\n\t\t\t\t}, callbacks.error);\n\t\t}\n\t}\n\n\tfunction prepareWebrtc(handleId, offer, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\n\t\tvar jsep = callbacks.jsep;\n\t\tif(offer && jsep) {\n\t\t\tJanus.error(\"Provided a JSEP to a createOffer\");\n\t\t\tcallbacks.error(\"Provided a JSEP to a createOffer\");\n\t\t\treturn;\n\t\t} else if(!offer && (!jsep || !jsep.type || !jsep.sdp)) {\n\t\t\tJanus.error(\"A valid JSEP is required for createAnswer\");\n\t\t\tcallbacks.error(\"A valid JSEP is required for createAnswer\");\n\t\t\treturn;\n\t\t}\n\t\t/* Check that callbacks.media is a (not null) Object */\n\t\tcallbacks.media = (typeof callbacks.media === 'object' && callbacks.media) ? callbacks.media : { audio: true, video: true };\n\t\tvar media = callbacks.media;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tconfig.trickle = isTrickleEnabled(callbacks.trickle);\n\t\t// Are we updating a session?\n\t\tif(!config.pc) {\n\t\t\t// Nope, new PeerConnection\n\t\t\tmedia.update = false;\n\t\t\tmedia.keepAudio = false;\n\t\t\tmedia.keepVideo = false;\n\t\t} else {\n\t\t\tJanus.log(\"Updating existing media session\");\n\t\t\tmedia.update = true;\n\t\t\t// Check if there's anything to add/remove/replace, or if we\n\t\t\t// can go directly to preparing the new SDP offer or answer\n\t\t\tif(callbacks.stream) {\n\t\t\t\t// External stream: is this the same as the one we were using before?\n\t\t\t\tif(callbacks.stream !== config.myStream) {\n\t\t\t\t\tJanus.log(\"Renegotiation involves a new external stream\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Check if there are changes on audio\n\t\t\t\tif(media.addAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\tmedia.removeAudio = false;\n\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n\t\t\t\t\t\tJanus.error(\"Can't add audio stream, there already is one\");\n\t\t\t\t\t\tcallbacks.error(\"Can't add audio stream, there already is one\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if(media.removeAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\tmedia.addAudio = false;\n\t\t\t\t\tmedia.audioSend = false;\n\t\t\t\t} else if(media.replaceAudio) {\n\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\tmedia.addAudio = false;\n\t\t\t\t\tmedia.removeAudio = false;\n\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t}\n\t\t\t\tif(!config.myStream) {\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\tif(media.replaceAudio) {\n\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\t}\n\t\t\t\t\tif(isAudioSendEnabled(media)) {\n\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n\t\t\t\t\t\t// No audio track: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\t\tif(media.replaceAudio) {\n\t\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\t\tmedia.replaceAudio = false;\n\t\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\t\tmedia.audioSend = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(isAudioSendEnabled(media)) {\n\t\t\t\t\t\t\tmedia.keepAudio = false;\n\t\t\t\t\t\t\tmedia.addAudio = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We have an audio track: should we keep it as it is?\n\t\t\t\t\t\tif(isAudioSendEnabled(media) &&\n\t\t\t\t\t\t\t\t!media.removeAudio && !media.replaceAudio) {\n\t\t\t\t\t\t\tmedia.keepAudio = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Check if there are changes on video\n\t\t\t\tif(media.addVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\tmedia.removeVideo = false;\n\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n\t\t\t\t\t\tJanus.error(\"Can't add video stream, there already is one\");\n\t\t\t\t\t\tcallbacks.error(\"Can't add video stream, there already is one\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if(media.removeVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\tmedia.addVideo = false;\n\t\t\t\t\tmedia.videoSend = false;\n\t\t\t\t} else if(media.replaceVideo) {\n\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\tmedia.addVideo = false;\n\t\t\t\t\tmedia.removeVideo = false;\n\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t}\n\t\t\t\tif(!config.myStream) {\n\t\t\t\t\t// No media stream: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\tif(media.replaceVideo) {\n\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\t}\n\t\t\t\t\tif(isVideoSendEnabled(media)) {\n\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n\t\t\t\t\t\t// No video track: if we were asked to replace, it's actually an \"add\"\n\t\t\t\t\t\tif(media.replaceVideo) {\n\t\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\t\tmedia.replaceVideo = false;\n\t\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\t\tmedia.videoSend = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(isVideoSendEnabled(media)) {\n\t\t\t\t\t\t\tmedia.keepVideo = false;\n\t\t\t\t\t\t\tmedia.addVideo = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We have a video track: should we keep it as it is?\n\t\t\t\t\t\tif(isVideoSendEnabled(media) && !media.removeVideo && !media.replaceVideo) {\n\t\t\t\t\t\t\tmedia.keepVideo = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Data channels can only be added\n\t\t\t\tif(media.addData) {\n\t\t\t\t\tmedia.data = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If we're updating and keeping all tracks, let's skip the getUserMedia part\n\t\t\tif((isAudioSendEnabled(media) && media.keepAudio) &&\n\t\t\t\t\t(isVideoSendEnabled(media) && media.keepVideo)) {\n\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, config.myStream);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t// If we're updating, check if we need to remove/replace one of the tracks\n\t\tif(media.update && (!config.streamExternal || (config.streamExternal && (media.replaceAudio || media.replaceVideo)))) {\n\t\t\tif(media.removeAudio || media.replaceAudio) {\n\t\t\t\tif(config.myStream && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n\t\t\t\t\tvar at = config.myStream.getAudioTracks()[0];\n\t\t\t\t\tJanus.log(\"Removing audio track:\", at);\n\t\t\t\t\tconfig.myStream.removeTrack(at);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tat.stop();\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t}\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\n\t\t\t\t\tvar ra = true;\n\t\t\t\t\tif(media.replaceAudio && Janus.unifiedPlan) {\n\t\t\t\t\t\t// We can use replaceTrack\n\t\t\t\t\t\tra = false;\n\t\t\t\t\t}\n\t\t\t\t\tif(ra) {\n\t\t\t\t\t\tfor(var asnd of config.pc.getSenders()) {\n\t\t\t\t\t\t\tif(asnd && asnd.track && asnd.track.kind === \"audio\") {\n\t\t\t\t\t\t\t\tJanus.log(\"Removing audio sender:\", asnd);\n\t\t\t\t\t\t\t\tconfig.pc.removeTrack(asnd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(media.removeVideo || media.replaceVideo) {\n\t\t\t\tif(config.myStream && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n\t\t\t\t\tvar vt = config.myStream.getVideoTracks()[0];\n\t\t\t\t\tJanus.log(\"Removing video track:\", vt);\n\t\t\t\t\tconfig.myStream.removeTrack(vt);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvt.stop();\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t}\n\t\t\t\tif(config.pc.getSenders() && config.pc.getSenders().length) {\n\t\t\t\t\tvar rv = true;\n\t\t\t\t\tif(media.replaceVideo && Janus.unifiedPlan) {\n\t\t\t\t\t\t// We can use replaceTrack\n\t\t\t\t\t\trv = false;\n\t\t\t\t\t}\n\t\t\t\t\tif(rv) {\n\t\t\t\t\t\tfor(var vsnd of config.pc.getSenders()) {\n\t\t\t\t\t\t\tif(vsnd && vsnd.track && vsnd.track.kind === \"video\") {\n\t\t\t\t\t\t\t\tJanus.log(\"Removing video sender:\", vsnd);\n\t\t\t\t\t\t\t\tconfig.pc.removeTrack(vsnd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Was a MediaStream object passed, or do we need to take care of that?\n\t\tif(callbacks.stream) {\n\t\t\tvar stream = callbacks.stream;\n\t\t\tJanus.log(\"MediaStream provided by the application\");\n\t\t\tJanus.debug(stream);\n\t\t\t// If this is an update, let's check if we need to release the previous stream\n\t\t\tif(media.update && config.myStream && config.myStream !== callbacks.stream && !config.streamExternal && !media.replaceAudio && !media.replaceVideo) {\n\t\t\t\t// We're replacing a stream we captured ourselves with an external one\n\t\t\t\tJanus.stopAllTracks(config.myStream);\n\t\t\t\tconfig.myStream = null;\n\t\t\t}\n\t\t\t// Skip the getUserMedia part\n\t\t\tconfig.streamExternal = true;\n\t\t\tpluginHandle.consentDialog(false);\n\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\treturn;\n\t\t}\n\t\tif(isAudioSendEnabled(media) || isVideoSendEnabled(media)) {\n\t\t\tif(!Janus.isGetUserMediaAvailable()) {\n\t\t\t\tcallbacks.error(\"getUserMedia not available\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar constraints = { mandatory: {}, optional: []};\n\t\t\tpluginHandle.consentDialog(true);\n\t\t\tvar audioSupport = isAudioSendEnabled(media);\n\t\t\tif(audioSupport && media && typeof media.audio === 'object')\n\t\t\t\taudioSupport = media.audio;\n\t\t\tvar videoSupport = isVideoSendEnabled(media);\n\t\t\tif(videoSupport && media) {\n\t\t\t\tvar simulcast = (callbacks.simulcast === true);\n\t\t\t\tvar simulcast2 = (callbacks.simulcast2 === true);\n\t\t\t\tif((simulcast || simulcast2) && !jsep && !media.video)\n\t\t\t\t\tmedia.video = \"hires\";\n\t\t\t\tif(media.video && media.video != 'screen' && media.video != 'window') {\n\t\t\t\t\tif(typeof media.video === 'object') {\n\t\t\t\t\t\tvideoSupport = media.video;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar width = 0;\n\t\t\t\t\t\tvar height = 0, maxHeight = 0;\n\t\t\t\t\t\tif(media.video === 'lowres') {\n\t\t\t\t\t\t\t// Small resolution, 4:3\n\t\t\t\t\t\t\theight = 240;\n\t\t\t\t\t\t\tmaxHeight = 240;\n\t\t\t\t\t\t\twidth = 320;\n\t\t\t\t\t\t} else if(media.video === 'lowres-16:9') {\n\t\t\t\t\t\t\t// Small resolution, 16:9\n\t\t\t\t\t\t\theight = 180;\n\t\t\t\t\t\t\tmaxHeight = 180;\n\t\t\t\t\t\t\twidth = 320;\n\t\t\t\t\t\t} else if(media.video === 'hires' || media.video === 'hires-16:9' || media.video === 'hdres') {\n\t\t\t\t\t\t\t// High(HD) resolution is only 16:9\n\t\t\t\t\t\t\theight = 720;\n\t\t\t\t\t\t\tmaxHeight = 720;\n\t\t\t\t\t\t\twidth = 1280;\n\t\t\t\t\t\t} else if(media.video === 'fhdres') {\n\t\t\t\t\t\t\t// Full HD resolution is only 16:9\n\t\t\t\t\t\t\theight = 1080;\n\t\t\t\t\t\t\tmaxHeight = 1080;\n\t\t\t\t\t\t\twidth = 1920;\n\t\t\t\t\t\t} else if(media.video === '4kres') {\n\t\t\t\t\t\t\t// 4K resolution is only 16:9\n\t\t\t\t\t\t\theight = 2160;\n\t\t\t\t\t\t\tmaxHeight = 2160;\n\t\t\t\t\t\t\twidth = 3840;\n\t\t\t\t\t\t} else if(media.video === 'stdres') {\n\t\t\t\t\t\t\t// Normal resolution, 4:3\n\t\t\t\t\t\t\theight = 480;\n\t\t\t\t\t\t\tmaxHeight = 480;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t} else if(media.video === 'stdres-16:9') {\n\t\t\t\t\t\t\t// Normal resolution, 16:9\n\t\t\t\t\t\t\theight = 360;\n\t\t\t\t\t\t\tmaxHeight = 360;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tJanus.log(\"Default video setting is stdres 4:3\");\n\t\t\t\t\t\t\theight = 480;\n\t\t\t\t\t\t\tmaxHeight = 480;\n\t\t\t\t\t\t\twidth = 640;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Adding media constraint:\", media.video);\n\t\t\t\t\t\tvideoSupport = {\n\t\t\t\t\t\t\t'height': {'ideal': height},\n\t\t\t\t\t\t\t'width': {'ideal': width}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tJanus.log(\"Adding video constraint:\", videoSupport);\n\t\t\t\t\t}\n\t\t\t\t} else if(media.video === 'screen' || media.video === 'window') {\n\t\t\t\t\tif(navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n\t\t\t\t\t\t// The new experimental getDisplayMedia API is available, let's use that\n\t\t\t\t\t\t// https://groups.google.com/forum/#!topic/discuss-webrtc/Uf0SrR4uxzk\n\t\t\t\t\t\t// https://webrtchacks.com/chrome-screensharing-getdisplaymedia/\n\t\t\t\t\t\tconstraints.video = {};\n\t\t\t\t\t\tif(media.screenshareFrameRate) {\n\t\t\t\t\t\t\tconstraints.video.frameRate = media.screenshareFrameRate;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(media.screenshareHeight) {\n\t\t\t\t\t\t\tconstraints.video.height = media.screenshareHeight;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(media.screenshareWidth) {\n\t\t\t\t\t\t\tconstraints.video.width = media.screenshareWidth;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconstraints.audio = media.captureDesktopAudio;\n\t\t\t\t\t\tnavigator.mediaDevices.getDisplayMedia(constraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tif(isAudioSendEnabled(media) && !media.keepAudio) {\n\t\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false })\n\t\t\t\t\t\t\t\t\t.then(function (audioStream) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, function (error) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// We're going to try and use the extension for Chrome 34+, the old approach\n\t\t\t\t\t// for older versions of Chrome, or the experimental support in Firefox 33+\n\t\t\t\t\tfunction callbackUserMedia (error, stream) {\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\tif(error) {\n\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfunction getScreenMedia(constraints, gsmCallback, useAudio) {\n\t\t\t\t\t\tJanus.log(\"Adding media constraint (screen capture)\");\n\t\t\t\t\t\tJanus.debug(constraints);\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(constraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tif(useAudio) {\n\t\t\t\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: false })\n\t\t\t\t\t\t\t\t\t.then(function (audioStream) {\n\t\t\t\t\t\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tgsmCallback(null, stream);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(function(error) { pluginHandle.consentDialog(false); gsmCallback(error); });\n\t\t\t\t\t}\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === 'chrome') {\n\t\t\t\t\t\tvar chromever = Janus.webRTCAdapter.browserDetails.version;\n\t\t\t\t\t\tvar maxver = 33;\n\t\t\t\t\t\tif(window.navigator.userAgent.match('Linux'))\n\t\t\t\t\t\t\tmaxver = 35;\t// \"known\" crash in chrome 34 and 35 on linux\n\t\t\t\t\t\tif(chromever >= 26 && chromever <= maxver) {\n\t\t\t\t\t\t\t// Chrome 26->33 requires some awkward chrome://flags manipulation\n\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\t\tgoogLeakyBucket: true,\n\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\n\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\n\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'screen'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media) && !media.keepAudio\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tgetScreenMedia(constraints, callbackUserMedia);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Chrome 34+ requires an extension\n\t\t\t\t\t\t\tJanus.extension.getScreen(function (error, sourceId) {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\t\treturn callbacks.error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\t\t\t\tmaxWidth: window.screen.width,\n\t\t\t\t\t\t\t\t\t\t\tmaxHeight: window.screen.height,\n\t\t\t\t\t\t\t\t\t\t\tminFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\t\tmaxFrameRate: media.screenshareFrameRate,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\toptional: [\n\t\t\t\t\t\t\t\t\t\t\t{googLeakyBucket: true},\n\t\t\t\t\t\t\t\t\t\t\t{googTemporalLayeredScreencast: true}\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tconstraints.video.mandatory.chromeMediaSourceId = sourceId;\n\t\t\t\t\t\t\t\tgetScreenMedia(constraints, callbackUserMedia,\n\t\t\t\t\t\t\t\t\tisAudioSendEnabled(media) && !media.keepAudio);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.version >= 33) {\n\t\t\t\t\t\t\t// Firefox 33+ has experimental support for screen sharing\n\t\t\t\t\t\t\tconstraints = {\n\t\t\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\t\t\tmozMediaSource: media.video,\n\t\t\t\t\t\t\t\t\tmediaSource: media.video\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\taudio: isAudioSendEnabled(media) && !media.keepAudio\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tgetScreenMedia(constraints, function (err, stream) {\n\t\t\t\t\t\t\t\tcallbackUserMedia(err, stream);\n\t\t\t\t\t\t\t\t// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=1045810\n\t\t\t\t\t\t\t\tif (!err) {\n\t\t\t\t\t\t\t\t\tvar lastTime = stream.currentTime;\n\t\t\t\t\t\t\t\t\tvar polly = window.setInterval(function () {\n\t\t\t\t\t\t\t\t\t\tif(!stream)\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\n\t\t\t\t\t\t\t\t\t\tif(stream.currentTime == lastTime) {\n\t\t\t\t\t\t\t\t\t\t\twindow.clearInterval(polly);\n\t\t\t\t\t\t\t\t\t\t\tif(stream.onended) {\n\t\t\t\t\t\t\t\t\t\t\t\tstream.onended();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tlastTime = stream.currentTime;\n\t\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar error = new Error('NavigatorUserMediaError');\n\t\t\t\t\t\t\terror.name = 'Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)';\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If we got here, we're not screensharing\n\t\t\tif(!media || media.video !== 'screen') {\n\t\t\t\t// Check whether all media sources are actually available or not\n\t\t\t\tnavigator.mediaDevices.enumerateDevices().then(function(devices) {\n\t\t\t\t\tvar audioExist = devices.some(function(device) {\n\t\t\t\t\t\treturn device.kind === 'audioinput';\n\t\t\t\t\t}),\n\t\t\t\t\tvideoExist = isScreenSendEnabled(media) || devices.some(function(device) {\n\t\t\t\t\t\treturn device.kind === 'videoinput';\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check whether a missing device is really a problem\n\t\t\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\t\t\tvar needAudioDevice = isAudioSendRequired(media);\n\t\t\t\t\tvar needVideoDevice = isVideoSendRequired(media);\n\t\t\t\t\tif(audioSend || videoSend || needAudioDevice || needVideoDevice) {\n\t\t\t\t\t\t// We need to send either audio or video\n\t\t\t\t\t\tvar haveAudioDevice = audioSend ? audioExist : false;\n\t\t\t\t\t\tvar haveVideoDevice = videoSend ? videoExist : false;\n\t\t\t\t\t\tif(!haveAudioDevice && !haveVideoDevice) {\n\t\t\t\t\t\t\t// FIXME Should we really give up, or just assume recvonly for both?\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('No capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else if(!haveAudioDevice && needAudioDevice) {\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('Audio capture is required, but no capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t} else if(!haveVideoDevice && needVideoDevice) {\n\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\tcallbacks.error('Video capture is required, but no capture device found');\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar gumConstraints = {\n\t\t\t\t\t\taudio: (audioExist && !media.keepAudio) ? audioSupport : false,\n\t\t\t\t\t\tvideo: (videoExist && !media.keepVideo) ? videoSupport : false\n\t\t\t\t\t};\n\t\t\t\t\tJanus.debug(\"getUserMedia constraints\", gumConstraints);\n\t\t\t\t\tif (!gumConstraints.audio && !gumConstraints.video) {\n\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnavigator.mediaDevices.getUserMedia(gumConstraints)\n\t\t\t\t\t\t\t.then(function(stream) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tstreamsDone(handleId, jsep, media, callbacks, stream);\n\t\t\t\t\t\t\t}).catch(function(error) {\n\t\t\t\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\t\t\t\tcallbacks.error({code: error.code, name: error.name, message: error.message});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(function(error) {\n\t\t\t\t\tpluginHandle.consentDialog(false);\n\t\t\t\t\tcallbacks.error(error);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\t// No need to do a getUserMedia, create offer/answer right away\n\t\t\tstreamsDone(handleId, jsep, media, callbacks);\n\t\t}\n\t}\n\n\tfunction prepareWebrtcPeer(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : webrtcError;\n\t\tcallbacks.customizeSdp = (typeof callbacks.customizeSdp == \"function\") ? callbacks.customizeSdp : Janus.noop;\n\t\tvar jsep = callbacks.jsep;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(jsep) {\n\t\t\tif(!config.pc) {\n\t\t\t\tJanus.warn(\"Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep\");\n\t\t\t\tcallbacks.error(\"No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcallbacks.customizeSdp(jsep);\n\t\t\tconfig.pc.setRemoteDescription(jsep)\n\t\t\t\t.then(function() {\n\t\t\t\t\tJanus.log(\"Remote description accepted!\");\n\t\t\t\t\tconfig.remoteSdp = jsep.sdp;\n\t\t\t\t\t// Any trickle candidate we cached?\n\t\t\t\t\tif(config.candidates && config.candidates.length > 0) {\n\t\t\t\t\t\tfor(var i = 0; i< config.candidates.length; i++) {\n\t\t\t\t\t\t\tvar candidate = config.candidates[i];\n\t\t\t\t\t\t\tJanus.debug(\"Adding remote candidate:\", candidate);\n\t\t\t\t\t\t\tif(!candidate || candidate.completed === true) {\n\t\t\t\t\t\t\t\t// end-of-candidates\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(Janus.endOfCandidates);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// New candidate\n\t\t\t\t\t\t\t\tconfig.pc.addIceCandidate(candidate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconfig.candidates = [];\n\t\t\t\t\t}\n\t\t\t\t\t// Done\n\t\t\t\t\tcallbacks.success();\n\t\t\t\t}, callbacks.error);\n\t\t} else {\n\t\t\tcallbacks.error(\"Invalid JSEP\");\n\t\t}\n\t}\n\n\tfunction createOffer(handleId, media, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.customizeSdp = (typeof callbacks.customizeSdp == \"function\") ? callbacks.customizeSdp : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar simulcast = (callbacks.simulcast === true);\n\t\tif(!simulcast) {\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \")\");\n\t\t} else {\n\t\t\tJanus.log(\"Creating offer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\n\t\t}\n\t\t// https://code.google.com/p/webrtc/issues/detail?id=3508\n\t\tvar mediaConstraints = {};\n\t\tif(Janus.unifiedPlan) {\n\t\t\t// We can use Transceivers\n\t\t\tvar audioTransceiver = null, videoTransceiver = null;\n\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\tif(!audioTransceiver) {\n\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\tif(!videoTransceiver) {\n\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle audio (and related changes, if any)\n\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\tvar audioRecv = isAudioRecvEnabled(media);\n\t\t\tif(!audioSend && !audioRecv) {\n\t\t\t\t// Audio disabled: have we removed it?\n\t\t\t\tif(media.removeAudio && audioTransceiver) {\n\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\taudioTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\taudioTransceiver.direction = \"inactive\";\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Setting audio transceiver to inactive:\", audioTransceiver);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of audio m-line\n\t\t\t\tif(audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendrecv:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(audioSend && !audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendonly:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(!audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to recvonly:\", audioTransceiver);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\taudioTransceiver = config.pc.addTransceiver(\"audio\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly audio transceiver:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle video (and related changes, if any)\n\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\tvar videoRecv = isVideoRecvEnabled(media);\n\t\t\tif(!videoSend && !videoRecv) {\n\t\t\t\t// Video disabled: have we removed it?\n\t\t\t\tif(media.removeVideo && videoTransceiver) {\n\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\tvideoTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvideoTransceiver.direction = \"inactive\";\n\t\t\t\t\t}\n\t\t\t\t\tJanus.log(\"Setting video transceiver to inactive:\", videoTransceiver);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of video m-line\n\t\t\t\tif(videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendrecv:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(videoSend && !videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendonly:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t} else if(!videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to recvonly:\", videoTransceiver);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\tvideoTransceiver = config.pc.addTransceiver(\"video\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly video transceiver:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tmediaConstraints[\"offerToReceiveAudio\"] = isAudioRecvEnabled(media);\n\t\t\tmediaConstraints[\"offerToReceiveVideo\"] = isVideoRecvEnabled(media);\n\t\t}\n\t\tvar iceRestart = (callbacks.iceRestart === true);\n\t\tif(iceRestart) {\n\t\t\tmediaConstraints[\"iceRestart\"] = true;\n\t\t}\n\t\tJanus.debug(mediaConstraints);\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\n\t\tvar sendVideo = isVideoSendEnabled(media);\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\n\t\t\tvar sender = config.pc.getSenders().find(function(s) {return s.track && s.track.kind === \"video\"});\n\t\t\tif(sender) {\n\t\t\t\tvar parameters = sender.getParameters();\n\t\t\t\tif(!parameters) {\n\t\t\t\t\tparameters = {};\n\t\t\t\t}\n\t\t\t\tvar maxBitrates = getMaxBitrates(callbacks.simulcastMaxBitrates);\n\t\t\t\tparameters.encodings = callbacks.sendEncodings || [\n\t\t\t\t\t{ rid: \"h\", active: true, maxBitrate: maxBitrates.high },\n\t\t\t\t\t{ rid: \"m\", active: true, maxBitrate: maxBitrates.medium, scaleResolutionDownBy: 2 },\n\t\t\t\t\t{ rid: \"l\", active: true, maxBitrate: maxBitrates.low, scaleResolutionDownBy: 4 }\n\t\t\t\t];\n\t\t\t\tsender.setParameters(parameters);\n\t\t\t}\n\t\t}\n\t\tconfig.pc.createOffer(mediaConstraints)\n\t\t\t.then(function(offer) {\n\t\t\t\tJanus.debug(offer);\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\tvar jsep = {\n\t\t\t\t\t\"type\": offer.type,\n\t\t\t\t\t\"sdp\": offer.sdp\n\t\t\t\t};\n\t\t\t\tcallbacks.customizeSdp(jsep);\n\t\t\t\toffer.sdp = jsep.sdp;\n\t\t\t\tJanus.log(\"Setting local description\");\n\t\t\t\tif(sendVideo && simulcast) {\n\t\t\t\t\t// This SDP munging only works with Chrome (Safari STP may support it too)\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\" ||\n\t\t\t\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"safari\") {\n\t\t\t\t\t\tJanus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\n\t\t\t\t\t\toffer.sdp = mungeSdpForSimulcasting(offer.sdp);\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconfig.mySdp = {\n\t\t\t\t\ttype: \"offer\",\n\t\t\t\t\tsdp: offer.sdp\n\t\t\t\t};\n\t\t\t\tconfig.pc.setLocalDescription(offer)\n\t\t\t\t\t.catch(callbacks.error);\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\n\t\t\t\tif(!config.iceDone && !config.trickle) {\n\t\t\t\t\t// Don't do anything until we have all candidates\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If transforms are present, notify Janus that the media is end-to-end encrypted\n\t\t\t\tif(config.senderTransforms || config.receiverTransforms) {\n\t\t\t\t\toffer[\"e2ee\"] = true;\n\t\t\t\t}\n\t\t\t\tcallbacks.success(offer);\n\t\t\t}, callbacks.error);\n\t}\n\n\tfunction createAnswer(handleId, media, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tcallbacks.customizeSdp = (typeof callbacks.customizeSdp == \"function\") ? callbacks.customizeSdp : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\tcallbacks.error(\"Invalid handle\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tvar simulcast = (callbacks.simulcast === true);\n\t\tif(!simulcast) {\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \")\");\n\t\t} else {\n\t\t\tJanus.log(\"Creating answer (iceDone=\" + config.iceDone + \", simulcast=\" + simulcast + \")\");\n\t\t}\n\t\tvar mediaConstraints = null;\n\t\tif(Janus.unifiedPlan) {\n\t\t\t// We can use Transceivers\n\t\t\tmediaConstraints = {};\n\t\t\tvar audioTransceiver = null, videoTransceiver = null;\n\t\t\tvar transceivers = config.pc.getTransceivers();\n\t\t\tif(transceivers && transceivers.length > 0) {\n\t\t\t\tfor(var t of transceivers) {\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"audio\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"audio\")) {\n\t\t\t\t\t\tif(!audioTransceiver)\n\t\t\t\t\t\t\taudioTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif((t.sender && t.sender.track && t.sender.track.kind === \"video\") ||\n\t\t\t\t\t\t\t(t.receiver && t.receiver.track && t.receiver.track.kind === \"video\")) {\n\t\t\t\t\t\tif(!videoTransceiver)\n\t\t\t\t\t\t\tvideoTransceiver = t;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle audio (and related changes, if any)\n\t\t\tvar audioSend = isAudioSendEnabled(media);\n\t\t\tvar audioRecv = isAudioRecvEnabled(media);\n\t\t\tif(!audioSend && !audioRecv) {\n\t\t\t\t// Audio disabled: have we removed it?\n\t\t\t\tif(media.removeAudio && audioTransceiver) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\taudioTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taudioTransceiver.direction = \"inactive\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to inactive:\", audioTransceiver);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of audio m-line\n\t\t\t\tif(audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendrecv:\", audioTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(audioSend && !audioRecv) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to sendonly:\", audioTransceiver);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t} else if(!audioSend && audioRecv) {\n\t\t\t\t\tif(audioTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (audioTransceiver.setDirection) {\n\t\t\t\t\t\t\t\taudioTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taudioTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting audio transceiver to recvonly:\", audioTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\taudioTransceiver = config.pc.addTransceiver(\"audio\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly audio transceiver:\", audioTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Handle video (and related changes, if any)\n\t\t\tvar videoSend = isVideoSendEnabled(media);\n\t\t\tvar videoRecv = isVideoRecvEnabled(media);\n\t\t\tif(!videoSend && !videoRecv) {\n\t\t\t\t// Video disabled: have we removed it?\n\t\t\t\tif(media.removeVideo && videoTransceiver) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"inactive\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvideoTransceiver.direction = \"inactive\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tJanus.log(\"Setting video transceiver to inactive:\", videoTransceiver);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Take care of video m-line\n\t\t\t\tif(videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendrecv\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendrecv\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendrecv:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(videoSend && !videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"sendonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"sendonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to sendonly:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if(!videoSend && videoRecv) {\n\t\t\t\t\tif(videoTransceiver) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (videoTransceiver.setDirection) {\n\t\t\t\t\t\t\t\tvideoTransceiver.setDirection(\"recvonly\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvideoTransceiver.direction = \"recvonly\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tJanus.log(\"Setting video transceiver to recvonly:\", videoTransceiver);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tJanus.error(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// In theory, this is the only case where we might not have a transceiver yet\n\t\t\t\t\t\tvideoTransceiver = config.pc.addTransceiver(\"video\", { direction: \"recvonly\" });\n\t\t\t\t\t\tJanus.log(\"Adding recvonly video transceiver:\", videoTransceiver);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"firefox\" || Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\n\t\t\t\tmediaConstraints = {\n\t\t\t\t\tofferToReceiveAudio: isAudioRecvEnabled(media),\n\t\t\t\t\tofferToReceiveVideo: isVideoRecvEnabled(media)\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tmediaConstraints = {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tOfferToReceiveAudio: isAudioRecvEnabled(media),\n\t\t\t\t\t\tOfferToReceiveVideo: isVideoRecvEnabled(media)\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tJanus.debug(mediaConstraints);\n\t\t// Check if this is Firefox and we've been asked to do simulcasting\n\t\tvar sendVideo = isVideoSendEnabled(media);\n\t\tif(sendVideo && simulcast && Janus.webRTCAdapter.browserDetails.browser === \"firefox\") {\n\t\t\t// FIXME Based on https://gist.github.com/voluntas/088bc3cc62094730647b\n\t\t\tJanus.log(\"Enabling Simulcasting for Firefox (RID)\");\n\t\t\tvar sender = config.pc.getSenders()[1];\n\t\t\tJanus.log(sender);\n\t\t\tvar parameters = sender.getParameters();\n\t\t\tJanus.log(parameters);\n\n\t\t\tvar maxBitrates = getMaxBitrates(callbacks.simulcastMaxBitrates);\n\t\t\tsender.setParameters({encodings: callbacks.sendEncodings || [\n\t\t\t\t{ rid: \"h\", active: true, maxBitrate: maxBitrates.high },\n\t\t\t\t{ rid: \"m\", active: true, maxBitrate: maxBitrates.medium, scaleResolutionDownBy: 2},\n\t\t\t\t{ rid: \"l\", active: true, maxBitrate: maxBitrates.low, scaleResolutionDownBy: 4}\n\t\t\t]});\n\t\t}\n\t\tconfig.pc.createAnswer(mediaConstraints)\n\t\t\t.then(function(answer) {\n\t\t\t\tJanus.debug(answer);\n\t\t\t\t// JSON.stringify doesn't work on some WebRTC objects anymore\n\t\t\t\t// See https://code.google.com/p/chromium/issues/detail?id=467366\n\t\t\t\tvar jsep = {\n\t\t\t\t\t\"type\": answer.type,\n\t\t\t\t\t\"sdp\": answer.sdp\n\t\t\t\t};\n\t\t\t\tcallbacks.customizeSdp(jsep);\n\t\t\t\tanswer.sdp = jsep.sdp;\n\t\t\t\tJanus.log(\"Setting local description\");\n\t\t\t\tif(sendVideo && simulcast) {\n\t\t\t\t\t// This SDP munging only works with Chrome\n\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"chrome\") {\n\t\t\t\t\t\t// FIXME Apparently trying to simulcast when answering breaks video in Chrome...\n\t\t\t\t\t\t//~ Janus.log(\"Enabling Simulcasting for Chrome (SDP munging)\");\n\t\t\t\t\t\t//~ answer.sdp = mungeSdpForSimulcasting(answer.sdp);\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is an answer, and video breaks in Chrome if we enable it\");\n\t\t\t\t\t} else if(Janus.webRTCAdapter.browserDetails.browser !== \"firefox\") {\n\t\t\t\t\t\tJanus.warn(\"simulcast=true, but this is not Chrome nor Firefox, ignoring\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconfig.mySdp = {\n\t\t\t\t\ttype: \"answer\",\n\t\t\t\t\tsdp: answer.sdp\n\t\t\t\t};\n\t\t\t\tconfig.pc.setLocalDescription(answer)\n\t\t\t\t\t.catch(callbacks.error);\n\t\t\t\tconfig.mediaConstraints = mediaConstraints;\n\t\t\t\tif(!config.iceDone && !config.trickle) {\n\t\t\t\t\t// Don't do anything until we have all candidates\n\t\t\t\t\tJanus.log(\"Waiting for all candidates...\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// If transforms are present, notify Janus that the media is end-to-end encrypted\n\t\t\t\tif(config.senderTransforms || config.receiverTransforms) {\n\t\t\t\t\tanswer[\"e2ee\"] = true;\n\t\t\t\t}\n\t\t\t\tcallbacks.success(answer);\n\t\t\t}, callbacks.error);\n\t}\n\n\tfunction sendSDP(handleId, callbacks) {\n\t\tcallbacks = callbacks || {};\n\t\tcallbacks.success = (typeof callbacks.success == \"function\") ? callbacks.success : Janus.noop;\n\t\tcallbacks.error = (typeof callbacks.error == \"function\") ? callbacks.error : Janus.noop;\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle, not sending anything\");\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tJanus.log(\"Sending offer/answer SDP...\");\n\t\tif(!config.mySdp) {\n\t\t\tJanus.warn(\"Local SDP instance is invalid, not sending anything...\");\n\t\t\treturn;\n\t\t}\n\t\tconfig.mySdp = {\n\t\t\t\"type\": config.pc.localDescription.type,\n\t\t\t\"sdp\": config.pc.localDescription.sdp\n\t\t};\n\t\tif(config.trickle === false)\n\t\t\tconfig.mySdp[\"trickle\"] = false;\n\t\tJanus.debug(callbacks);\n\t\tconfig.sdpSent = true;\n\t\tcallbacks.success(config.mySdp);\n\t}\n\n\tfunction getVolume(handleId, remote) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn 0;\n\t\t}\n\t\tvar stream = remote ? \"remote\" : \"local\";\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.volume[stream])\n\t\t\tconfig.volume[stream] = { value: 0 };\n\t\t// Start getting the volume, if audioLevel in getStats is supported (apparently\n\t\t// they're only available in Chrome/Safari right now: https://webrtc-stats.callstats.io/)\n\t\tif(config.pc.getStats && (Janus.webRTCAdapter.browserDetails.browser === \"chrome\" ||\n\t\t\t\tJanus.webRTCAdapter.browserDetails.browser === \"safari\")) {\n\t\t\tif(remote && !config.remoteStream) {\n\t\t\t\tJanus.warn(\"Remote stream unavailable\");\n\t\t\t\treturn 0;\n\t\t\t} else if(!remote && !config.myStream) {\n\t\t\t\tJanus.warn(\"Local stream unavailable\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(!config.volume[stream].timer) {\n\t\t\t\tJanus.log(\"Starting \" + stream + \" volume monitor\");\n\t\t\t\tconfig.volume[stream].timer = setInterval(function() {\n\t\t\t\t\tconfig.pc.getStats()\n\t\t\t\t\t\t.then(function(stats) {\n\t\t\t\t\t\t\tstats.forEach(function (res) {\n\t\t\t\t\t\t\t\tif(!res || res.kind !== \"audio\")\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\tif((remote && !res.remoteSource) || (!remote && res.type !== \"media-source\"))\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\tconfig.volume[stream].value = (res.audioLevel ? res.audioLevel : 0);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}, 200);\n\t\t\t\treturn 0;\t// We don't have a volume to return yet\n\t\t\t}\n\t\t\treturn config.volume[stream].value;\n\t\t} else {\n\t\t\t// audioInputLevel and audioOutputLevel seem only available in Chrome? audioLevel\n\t\t\t// seems to be available on Chrome and Firefox, but they don't seem to work\n\t\t\tJanus.warn(\"Getting the \" + stream + \" volume unsupported by browser\");\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tfunction isMuted(handleId, video) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn true;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn true;\n\t\t}\n\t\tif(!config.myStream) {\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\n\t\t\treturn true;\n\t\t}\n\t\tif(video) {\n\t\t\t// Check video track\n\t\t\tif(!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No video track\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn !config.myStream.getVideoTracks()[0].enabled;\n\t\t} else {\n\t\t\t// Check audio track\n\t\t\tif(!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No audio track\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn !config.myStream.getAudioTracks()[0].enabled;\n\t\t}\n\t}\n\n\tfunction mute(handleId, video, mute) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn false;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc) {\n\t\t\tJanus.warn(\"Invalid PeerConnection\");\n\t\t\treturn false;\n\t\t}\n\t\tif(!config.myStream) {\n\t\t\tJanus.warn(\"Invalid local MediaStream\");\n\t\t\treturn false;\n\t\t}\n\t\tif(video) {\n\t\t\t// Mute/unmute video track\n\t\t\tif(!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No video track\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconfig.myStream.getVideoTracks()[0].enabled = !mute;\n\t\t\treturn true;\n\t\t} else {\n\t\t\t// Mute/unmute audio track\n\t\t\tif(!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n\t\t\t\tJanus.warn(\"No audio track\");\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconfig.myStream.getAudioTracks()[0].enabled = !mute;\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tfunction getBitrate(handleId) {\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle || !pluginHandle.webrtcStuff) {\n\t\t\tJanus.warn(\"Invalid handle\");\n\t\t\treturn \"Invalid handle\";\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(!config.pc)\n\t\t\treturn \"Invalid PeerConnection\";\n\t\t// Start getting the bitrate, if getStats is supported\n\t\tif(config.pc.getStats) {\n\t\t\tif(!config.bitrate.timer) {\n\t\t\t\tJanus.log(\"Starting bitrate timer (via getStats)\");\n\t\t\t\tconfig.bitrate.timer = setInterval(function() {\n\t\t\t\t\tconfig.pc.getStats()\n\t\t\t\t\t\t.then(function(stats) {\n\t\t\t\t\t\t\tstats.forEach(function (res) {\n\t\t\t\t\t\t\t\tif(!res)\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\tvar inStats = false;\n\t\t\t\t\t\t\t\t// Check if these are statistics on incoming media\n\t\t\t\t\t\t\t\tif((res.mediaType === \"video\" || res.id.toLowerCase().indexOf(\"video\") > -1) &&\n\t\t\t\t\t\t\t\t\t\tres.type === \"inbound-rtp\" && res.id.indexOf(\"rtcp\") < 0) {\n\t\t\t\t\t\t\t\t\t// New stats\n\t\t\t\t\t\t\t\t\tinStats = true;\n\t\t\t\t\t\t\t\t} else if(res.type == 'ssrc' && res.bytesReceived &&\n\t\t\t\t\t\t\t\t\t\t(res.googCodecName === \"VP8\" || res.googCodecName === \"\")) {\n\t\t\t\t\t\t\t\t\t// Older Chromer versions\n\t\t\t\t\t\t\t\t\tinStats = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Parse stats now\n\t\t\t\t\t\t\t\tif(inStats) {\n\t\t\t\t\t\t\t\t\tconfig.bitrate.bsnow = res.bytesReceived;\n\t\t\t\t\t\t\t\t\tconfig.bitrate.tsnow = res.timestamp;\n\t\t\t\t\t\t\t\t\tif(config.bitrate.bsbefore === null || config.bitrate.tsbefore === null) {\n\t\t\t\t\t\t\t\t\t\t// Skip this round\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Calculate bitrate\n\t\t\t\t\t\t\t\t\t\tvar timePassed = config.bitrate.tsnow - config.bitrate.tsbefore;\n\t\t\t\t\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"safari\")\n\t\t\t\t\t\t\t\t\t\t\ttimePassed = timePassed/1000;\t// Apparently the timestamp is in microseconds, in Safari\n\t\t\t\t\t\t\t\t\t\tvar bitRate = Math.round((config.bitrate.bsnow - config.bitrate.bsbefore) * 8 / timePassed);\n\t\t\t\t\t\t\t\t\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"safari\")\n\t\t\t\t\t\t\t\t\t\t\tbitRate = parseInt(bitRate/1000);\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.value = bitRate + ' kbits/sec';\n\t\t\t\t\t\t\t\t\t\t//~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.bsbefore = config.bitrate.bsnow;\n\t\t\t\t\t\t\t\t\t\tconfig.bitrate.tsbefore = config.bitrate.tsnow;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t\treturn \"0 kbits/sec\";\t// We don't have a bitrate value yet\n\t\t\t}\n\t\t\treturn config.bitrate.value;\n\t\t} else {\n\t\t\tJanus.warn(\"Getting the video bitrate unsupported by browser\");\n\t\t\treturn \"Feature unsupported by browser\";\n\t\t}\n\t}\n\n\tfunction webrtcError(error) {\n\t\tJanus.error(\"WebRTC error:\", error);\n\t}\n\n\tfunction cleanupWebrtc(handleId, hangupRequest) {\n\t\tJanus.log(\"Cleaning WebRTC stuff\");\n\t\tvar pluginHandle = pluginHandles[handleId];\n\t\tif(!pluginHandle) {\n\t\t\t// Nothing to clean\n\t\t\treturn;\n\t\t}\n\t\tvar config = pluginHandle.webrtcStuff;\n\t\tif(config) {\n\t\t\tif(hangupRequest === true) {\n\t\t\t\t// Send a hangup request (we don't really care about the response)\n\t\t\t\tvar request = { \"janus\": \"hangup\", \"transaction\": Janus.randomString(12) };\n\t\t\t\tif(pluginHandle.token)\n\t\t\t\t\trequest[\"token\"] = pluginHandle.token;\n\t\t\t\tif(apisecret)\n\t\t\t\t\trequest[\"apisecret\"] = apisecret;\n\t\t\t\tJanus.debug(\"Sending hangup request (handle=\" + handleId + \"):\");\n\t\t\t\tJanus.debug(request);\n\t\t\t\tif(websockets) {\n\t\t\t\t\trequest[\"session_id\"] = sessionId;\n\t\t\t\t\trequest[\"handle_id\"] = handleId;\n\t\t\t\t\tws.send(JSON.stringify(request));\n\t\t\t\t} else {\n\t\t\t\t\tJanus.httpAPICall(server + \"/\" + sessionId + \"/\" + handleId, {\n\t\t\t\t\t\tverb: 'POST',\n\t\t\t\t\t\twithCredentials: withCredentials,\n\t\t\t\t\t\tbody: request\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Cleanup stack\n\t\t\tconfig.remoteStream = null;\n\t\t\tif(config.volume) {\n\t\t\t\tif(config.volume[\"local\"] && config.volume[\"local\"].timer)\n\t\t\t\t\tclearInterval(config.volume[\"local\"].timer);\n\t\t\t\tif(config.volume[\"remote\"] && config.volume[\"remote\"].timer)\n\t\t\t\t\tclearInterval(config.volume[\"remote\"].timer);\n\t\t\t}\n\t\t\tconfig.volume = {};\n\t\t\tif(config.bitrate.timer)\n\t\t\t\tclearInterval(config.bitrate.timer);\n\t\t\tconfig.bitrate.timer = null;\n\t\t\tconfig.bitrate.bsnow = null;\n\t\t\tconfig.bitrate.bsbefore = null;\n\t\t\tconfig.bitrate.tsnow = null;\n\t\t\tconfig.bitrate.tsbefore = null;\n\t\t\tconfig.bitrate.value = null;\n\t\t\tif(!config.streamExternal && config.myStream) {\n\t\t\t\tJanus.log(\"Stopping local stream tracks\");\n\t\t\t\tJanus.stopAllTracks(config.myStream);\n\t\t\t}\n\t\t\tconfig.streamExternal = false;\n\t\t\tconfig.myStream = null;\n\t\t\t// Close PeerConnection\n\t\t\ttry {\n\t\t\t\tconfig.pc.close();\n\t\t\t} catch(e) {\n\t\t\t\t// Do nothing\n\t\t\t}\n\t\t\tconfig.pc = null;\n\t\t\tconfig.candidates = null;\n\t\t\tconfig.mySdp = null;\n\t\t\tconfig.remoteSdp = null;\n\t\t\tconfig.iceDone = false;\n\t\t\tconfig.dataChannel = {};\n\t\t\tconfig.dtmfSender = null;\n\t\t\tconfig.senderTransforms = null;\n\t\t\tconfig.receiverTransforms = null;\n\t\t}\n\t\tpluginHandle.oncleanup();\n\t}\n\n\t// Helper method to munge an SDP to enable simulcasting (Chrome only)\n\tfunction mungeSdpForSimulcasting(sdp) {\n\t\t// Let's munge the SDP to add the attributes for enabling simulcasting\n\t\t// (based on https://gist.github.com/ggarber/a19b4c33510028b9c657)\n\t\tvar lines = sdp.split(\"\\r\\n\");\n\t\tvar video = false;\n\t\tvar ssrc = [ -1 ], ssrc_fid = [ -1 ];\n\t\tvar cname = null, msid = null, mslabel = null, label = null;\n\t\tvar insertAt = -1;\n\t\tfor(var i=0; i<lines.length; i++) {\n\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\n\t\t\tif(mline) {\n\t\t\t\tvar medium = mline[1];\n\t\t\t\tif(medium === \"video\") {\n\t\t\t\t\t// New video m-line: make sure it's the first one\n\t\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\t\tvideo = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\n\t\t\t\t\tif(ssrc[0] > -1) {\n\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(!video)\n\t\t\t\tcontinue;\n\t\t\tvar sim = lines[i].match(/a=ssrc-group:SIM (\\d+) (\\d+) (\\d+)/);\n\t\t\tif(sim) {\n\t\t\t\tJanus.warn(\"The SDP already contains a SIM attribute, munging will be skipped\");\n\t\t\t\treturn sdp;\n\t\t\t}\n\t\t\tvar fid = lines[i].match(/a=ssrc-group:FID (\\d+) (\\d+)/);\n\t\t\tif(fid) {\n\t\t\t\tssrc[0] = fid[1];\n\t\t\t\tssrc_fid[0] = fid[2];\n\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(ssrc[0]) {\n\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tcname = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tmsid = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tmslabel = match[1];\n\t\t\t\t}\n\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' label:(.+)')\n\t\t\t\tif(match) {\n\t\t\t\t\tlabel = match[1];\n\t\t\t\t}\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid[0]) === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(lines[i].length == 0) {\n\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\tif(ssrc[0] < 0) {\n\t\t\t// Couldn't find a FID attribute, let's just take the first video SSRC we find\n\t\t\tinsertAt = -1;\n\t\t\tvideo = false;\n\t\t\tfor(var i=0; i<lines.length; i++) {\n\t\t\t\tvar mline = lines[i].match(/m=(\\w+) */);\n\t\t\t\tif(mline) {\n\t\t\t\t\tvar medium = mline[1];\n\t\t\t\t\tif(medium === \"video\") {\n\t\t\t\t\t\t// New video m-line: make sure it's the first one\n\t\t\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\t\t\tvideo = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// New non-video m-line: do we have what we were looking for?\n\t\t\t\t\t\tif(ssrc[0] > -1) {\n\t\t\t\t\t\t\t// We're done, let's add the new attributes here\n\t\t\t\t\t\t\tinsertAt = i;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(!video)\n\t\t\t\t\tcontinue;\n\t\t\t\tif(ssrc[0] < 0) {\n\t\t\t\t\tvar value = lines[i].match(/a=ssrc:(\\d+)/);\n\t\t\t\t\tif(value) {\n\t\t\t\t\t\tssrc[0] = value[1];\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar match = lines[i].match('a=ssrc:' + ssrc[0] + ' cname:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tcname = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' msid:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tmsid = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' mslabel:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tmslabel = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tmatch = lines[i].match('a=ssrc:' + ssrc[0] + ' label:(.+)')\n\t\t\t\t\tif(match) {\n\t\t\t\t\t\tlabel = match[1];\n\t\t\t\t\t}\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc_fid[0]) === 0) {\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif(lines[i].indexOf('a=ssrc:' + ssrc[0]) === 0) {\n\t\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(lines[i].length === 0) {\n\t\t\t\t\tlines.splice(i, 1); i--;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(ssrc[0] < 0) {\n\t\t\t// Still nothing, let's just return the SDP we were asked to munge\n\t\t\tJanus.warn(\"Couldn't find the video SSRC, simulcasting NOT enabled\");\n\t\t\treturn sdp;\n\t\t}\n\t\tif(insertAt < 0) {\n\t\t\t// Append at the end\n\t\t\tinsertAt = lines.length;\n\t\t}\n\t\t// Generate a couple of SSRCs (for retransmissions too)\n\t\t// Note: should we check if there are conflicts, here?\n\t\tssrc[1] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc[2] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc_fid[1] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\tssrc_fid[2] = Math.floor(Math.random()*0xFFFFFFFF);\n\t\t// Add attributes to the SDP\n\t\tfor(var i=0; i<ssrc.length; i++) {\n\t\t\tif(cname) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' cname:' + cname);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(msid) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' msid:' + msid);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(mslabel) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' mslabel:' + mslabel);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(label) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc[i] + ' label:' + label);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\t// Add the same info for the retransmission SSRC\n\t\t\tif(cname) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' cname:' + cname);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(msid) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' msid:' + msid);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(mslabel) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' mslabel:' + mslabel);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t\tif(label) {\n\t\t\t\tlines.splice(insertAt, 0, 'a=ssrc:' + ssrc_fid[i] + ' label:' + label);\n\t\t\t\tinsertAt++;\n\t\t\t}\n\t\t}\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[2] + ' ' + ssrc_fid[2]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[1] + ' ' + ssrc_fid[1]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:FID ' + ssrc[0] + ' ' + ssrc_fid[0]);\n\t\tlines.splice(insertAt, 0, 'a=ssrc-group:SIM ' + ssrc[0] + ' ' + ssrc[1] + ' ' + ssrc[2]);\n\t\tsdp = lines.join(\"\\r\\n\");\n\t\tif(!sdp.endsWith(\"\\r\\n\"))\n\t\t\tsdp += \"\\r\\n\";\n\t\treturn sdp;\n\t}\n\n\t// Helper methods to parse a media object\n\tfunction isAudioSendEnabled(media) {\n\t\tJanus.debug(\"isAudioSendEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.audio === false)\n\t\t\treturn false;\t// Generic audio has precedence\n\t\tif(media.audioSend === undefined || media.audioSend === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.audioSend === true);\n\t}\n\n\tfunction isAudioSendRequired(media) {\n\t\tJanus.debug(\"isAudioSendRequired:\", media);\n\t\tif(!media)\n\t\t\treturn false;\t// Default\n\t\tif(media.audio === false || media.audioSend === false)\n\t\t\treturn false;\t// If we're not asking to capture audio, it's not required\n\t\tif(media.failIfNoAudio === undefined || media.failIfNoAudio === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.failIfNoAudio === true);\n\t}\n\n\tfunction isAudioRecvEnabled(media) {\n\t\tJanus.debug(\"isAudioRecvEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.audio === false)\n\t\t\treturn false;\t// Generic audio has precedence\n\t\tif(media.audioRecv === undefined || media.audioRecv === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.audioRecv === true);\n\t}\n\n\tfunction isVideoSendEnabled(media) {\n\t\tJanus.debug(\"isVideoSendEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.video === false)\n\t\t\treturn false;\t// Generic video has precedence\n\t\tif(media.videoSend === undefined || media.videoSend === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.videoSend === true);\n\t}\n\n\tfunction isVideoSendRequired(media) {\n\t\tJanus.debug(\"isVideoSendRequired:\", media);\n\t\tif(!media)\n\t\t\treturn false;\t// Default\n\t\tif(media.video === false || media.videoSend === false)\n\t\t\treturn false;\t// If we're not asking to capture video, it's not required\n\t\tif(media.failIfNoVideo === undefined || media.failIfNoVideo === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.failIfNoVideo === true);\n\t}\n\n\tfunction isVideoRecvEnabled(media) {\n\t\tJanus.debug(\"isVideoRecvEnabled:\", media);\n\t\tif(!media)\n\t\t\treturn true;\t// Default\n\t\tif(media.video === false)\n\t\t\treturn false;\t// Generic video has precedence\n\t\tif(media.videoRecv === undefined || media.videoRecv === null)\n\t\t\treturn true;\t// Default\n\t\treturn (media.videoRecv === true);\n\t}\n\n\tfunction isScreenSendEnabled(media) {\n\t\tJanus.debug(\"isScreenSendEnabled:\", media);\n\t\tif (!media)\n\t\t\treturn false;\n\t\tif (typeof media.video !== 'object' || typeof media.video.mandatory !== 'object')\n\t\t\treturn false;\n\t\tvar constraints = media.video.mandatory;\n\t\tif (constraints.chromeMediaSource)\n\t\t\treturn constraints.chromeMediaSource === 'desktop' || constraints.chromeMediaSource === 'screen';\n\t\telse if (constraints.mozMediaSource)\n\t\t\treturn constraints.mozMediaSource === 'window' || constraints.mozMediaSource === 'screen';\n\t\telse if (constraints.mediaSource)\n\t\t\treturn constraints.mediaSource === 'window' || constraints.mediaSource === 'screen';\n\t\treturn false;\n\t}\n\n\tfunction isDataEnabled(media) {\n\t\tJanus.debug(\"isDataEnabled:\", media);\n\t\tif(Janus.webRTCAdapter.browserDetails.browser === \"edge\") {\n\t\t\tJanus.warn(\"Edge doesn't support data channels yet\");\n\t\t\treturn false;\n\t\t}\n\t\tif(media === undefined || media === null)\n\t\t\treturn false;\t// Default\n\t\treturn (media.data === true);\n\t}\n\n\tfunction isTrickleEnabled(trickle) {\n\t\tJanus.debug(\"isTrickleEnabled:\", trickle);\n\t\treturn (trickle === false) ? false : true;\n\t}\n}\n\nexport default Janus;","import io from 'socket.io-client'\nimport { conf } from \"../conf\";\n//const socket = io.connect(conf.socketIOServer)\n//const socket = io.connect(conf.socketIOServer, { transports: ['websocket'] })\nconst socket = io.connect(conf.socketIOServer, \n    { transports: ['websocket'],\n    secure:true,\n    reconnect: true,\n    rejectUnauthorized : false }\n    )\nexport { socket }","import Janus from \"../janus-2021.js\";\nimport React, { Component } from \"react\";\nimport $ from \"jquery\";\nimport { socket } from \"./socket.js\";\n\nexport function vsessionCreate(room) {\n  var self = this;\n  Janus.init({\n    debug: \"all\",\n    callback: function () {\n      // Create session\n      var janus = new Janus({\n        server: self.state.server,\n        success: function () {\n          // Attach to VideoRoom plugin\n          janus.attach({\n            plugin: \"janus.plugin.videoroom\",\n            opaqueId: self.state.opaqueId,\n            success: function (pluginHandle) {\n              //sfutest = pluginHandle;\n              self.setState({ janus: janus });\n              self.setState({ sfutest: pluginHandle });\n              Janus.log(\n                \"Plugin attached! (\" +\n                  self.state.sfutest.getPlugin() +\n                  \", id=\" +\n                  self.state.sfutest.getId() +\n                  \")\"\n              );\n              Janus.log(\"  -- This is a publisher/manager\");\n              self.vregisterUsername(room);\n              // Prepare the username registration\n            },\n            error: function (error) {\n              Janus.error(\"  -- Error attaching plugin...\", error);\n            },\n            consentDialog: function (on) {\n              Janus.debug(\n                \"Consent dialog should be \" + (on ? \"on\" : \"off\") + \" now\"\n              );\n            },\n            iceState: function (state) {\n              Janus.log(\"ICE state changed to \" + state);\n            },\n            mediaState: function (medium, on) {\n              Janus.log(\n                \"Janus \" +\n                  (on ? \"started\" : \"stopped\") +\n                  \" receiving our \" +\n                  medium\n              );\n            },\n            webrtcState: function (on) {\n              Janus.log(\n                \"Janus says our WebRTC PeerConnection is \" +\n                  (on ? \"up\" : \"down\") +\n                  \" now\"\n              );\n            },\n            onmessage: function (msg, jsep) {\n              Janus.debug(\" ::: Got a message (publisher) :::\", msg);\n              var event = msg[\"videoroom\"];\n              Janus.debug(\"Event: \" + event);\n              if (event) {\n                if (event === \"joined\") {\n                  // Publisher/manager created, negotiate WebRTC and attach to existing feeds, if any\n                  //myid = msg[\"id\"];\n                  //mypvtid = msg[\"private_id\"];\n                  self.setState({\n                    myVroomId: msg[\"id\"],\n                    vJoined: true,\n                  });\n                  Janus.log(\n                    \"Successfully joined room \" +\n                      msg[\"room\"] +\n                      \" with ID \" +\n                      msg[\"id\"]\n                  );\n                  self.addParticipant(\n                    msg[\"id\"],\n                    self.state.fullname + \"\" + self.state.userUUID\n                  );\n                  //publishOwnFeed(true);\n                  //}\n                  // Any new feed to attach to?\n                  if (msg[\"publishers\"]) {\n                    var list = msg[\"publishers\"];\n                    Janus.debug(\n                      \"Got a list of available publishers/feeds:\",\n                      list\n                    );\n                    for (var f in list) {\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var audio = list[f][\"audio_codec\"];\n                      var video = list[f][\"video_codec\"];\n                      Janus.debug(\n                        \"  >> [\" +\n                          id +\n                          \"] \" +\n                          display +\n                          \" (audio: \" +\n                          audio +\n                          \", video: \" +\n                          video +\n                          \")\"\n                      );\n                      self.addParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      self.vNewRemoteFeed(id, display, audio, video);\n                    }\n                  }\n                } else if (event === \"destroyed\") {\n                  // The room has been destroyed\n                  Janus.warn(\"The room has been destroyed!\");\n                } else if (event === \"event\") {\n                  // Any new feed to attach to?\n                  if (msg[\"publishers\"]) {\n                    var list = msg[\"publishers\"];\n                    Janus.debug(\n                      \"Got a list of available publishers/feeds:\",\n                      list\n                    );\n                    for (var f in list) {\n                      var id = list[f][\"id\"];\n                      var display = list[f][\"display\"];\n                      var audio = list[f][\"audio_codec\"];\n                      var video = list[f][\"video_codec\"];\n                      Janus.debug(\n                        \"  >> [\" +\n                          id +\n                          \"] \" +\n                          display +\n                          \" (audio: \" +\n                          audio +\n                          \", video: \" +\n                          video +\n                          \")\"\n                      );\n                      self.addParticipant(list[f][\"id\"], list[f][\"display\"]);\n                      self.vNewRemoteFeed(id, display, audio, video);\n                    }\n                  } else if (msg[\"leaving\"]) {\n                    // One of the publishers has gone away?\n                    var leaving = msg[\"leaving\"];\n                    console.log(\"Publisher leaving: \" + leaving);\n                    self.setState(\n                      {\n                        feeds: self.state.feeds.filter(\n                          (item) => item.rfid != leaving\n                        ),\n                      },\n                      () => console.log(\"feeds: >>>>\", self.state.feeds)\n                    );\n                    var unPublishedFeed = self.state.feeds.filter(\n                      (item) => item.rfid === leaving\n                    );\n                    var remoteFeed = unPublishedFeed.shift();\n                    if (remoteFeed != null) {\n                      remoteFeed.detach();\n                    }\n                    self.removeParticipant(leaving);\n                  } else if (msg[\"unpublished\"]) {\n                    // One of the publishers has unpublished?\n                    var unpublished = msg[\"unpublished\"];\n                    console.log(\"Publisher left: \" + unpublished);\n                    if (unpublished === \"ok\") {\n                      self.state.sfutest.hangup();\n                      self.vStreamDettacher(self.state.sfutest);\n                      return;\n                    }\n                    var unPublishedFeed = self.state.feeds.filter(\n                      (item) => item.rfid === unpublished\n                    );\n                    var remoteFeed = unPublishedFeed.shift();\n                    if (remoteFeed != null) {\n                      remoteFeed.detach();\n                      self.vStreamDettacher(remoteFeed);\n                    }\n                    self.removeParticipant(unpublished);\n\n                    self.setState({\n                      feeds: self.state.feeds.filter(\n                        (item) => item.rfid != unpublished\n                      ),\n                    });\n                  } else if (msg[\"error\"]) {\n                    if (msg[\"error_code\"] === 426) {\n                      // This is a \"no such room\" error: give a more meaningful description\n                    } else {\n                    }\n                  }\n                }\n              }\n              if (jsep) {\n                Janus.debug(\"Handling SDP as well...\", jsep);\n                self.state.sfutest.handleRemoteJsep({ jsep: jsep });\n              }\n            },\n            onlocalstream: function (stream) {\n              Janus.debug(\" ::: Got a local stream :::\", stream);\n              console.log(\" ::: Got a local stream :::\", stream);\n              console.log(self.state.sfutest.id);\n              var exisiting = self.state.feeds.filter(\n                (item) => item.id === self.state.sfutest.id\n              );\n              if (exisiting.length === 0) {\n                self.state.sfutest.rfid = self.state.myVroomId;\n                self.setState({\n                  feeds: self.state.feeds.concat(self.state.sfutest),\n                });\n              }\n\n              var videoTracks = stream.getVideoTracks();\n\n              if (!videoTracks || videoTracks.length === 0) {\n                self.vStreamDettacher(self.state.sfutest);\n              } else {\n                console.log(self.state.vparticipants);\n                self.vStreamAttacher(self.state.sfutest);\n              }\n            },\n            onremotestream: function (stream) {\n              // The publisher stream is sendonly, we don't expect anything here\n            },\n            oncleanup: function () {\n              Janus.log(\n                \" ::: Got a cleanup notification: we are unpublished now :::\"\n              );\n            },\n          });\n        },\n        error: function (error) {\n          Janus.error(error);\n          //bootbox.alert(error, function() {\n          window.location.reload();\n          //});\n        },\n        destroyed: function () {\n          window.location.reload();\n        },\n      });\n    },\n  });\n}\n\nexport function vNewRemoteFeed(id, feeds, display, audio, video) {\n  var self = this;\n  // A new feed has been published, create a new plugin handle and attach to it as a subscriber\n  var remoteFeed = null;\n  self.state.janus.attach({\n    plugin: \"janus.plugin.videoroom\",\n    opaqueId: this.state.opaqueId,\n    success: function (pluginHandle) {\n      remoteFeed = pluginHandle;\n      remoteFeed.simulcastStarted = false;\n      Janus.log(\n        \"Plugin attached! (\" +\n          remoteFeed.getPlugin() +\n          \", id=\" +\n          remoteFeed.getId() +\n          \")\"\n      );\n      Janus.log(\"  -- This is a subscriber\");\n      // We wait for the plugin to send us an offer\n      var subscribe = {\n        request: \"join\",\n        room: 1234,\n        ptype: \"subscriber\",\n        pin: self.state.pin,\n        feed: id,\n        private_id: self.state.mypvtid,\n      };\n      // In case you don't want to receive audio, video or data, even if the\n      // publisher is sending them, set the 'offer_audio', 'offer_video' or\n      // 'offer_data' properties to false (they're true by default), e.g.:\n      // \t\tsubscribe[\"offer_video\"] = false;\n      // For example, if the publisher is VP8 and this is Safari, let's avoid video\n      if (\n        Janus.webRTCAdapter.browserDetails.browser === \"safari\" &&\n        (video === \"vp9\" || (video === \"vp8\" && !Janus.safariVp8))\n      ) {\n        if (video) video = video.toUpperCase();\n        console.log(\n          \"Publisher is using \" +\n            video +\n            \", but Safari doesn't support it: disabling video\"\n        );\n        subscribe[\"offer_video\"] = false;\n      }\n      //subscribe[\"offer_video\"] = false;\n      //remoteFeed.videoCodec = video;\n      //var participantId = display.split(\"\")[1]\n      //var propagate = self.state.propagates.filter((item) => item === participantId)\n      if (feeds) {\n        //name should be display !!\n        var participantId = feeds.split(\"\")[1];\n        var propagate = self.state.propagates.filter(\n          (item) => item === participantId\n        );\n        self.setState({\n          availableFeeds: self.state.availableFeeds.filter(\n            (item) => item.id === id\n          ),\n        });\n        console.log(self.state.availableFeeds);\n        if (propagate && propagate[0]) {\n          remoteFeed.send({ message: subscribe });\n        } else {\n          self.setState({\n            availableFeeds: self.state.availableFeeds.concat({\n              id: id,\n              display: feeds,\n              uuid: participantId,\n              video: video,\n            }),\n          });\n        }\n      }\n    },\n    error: function (error) {\n      Janus.error(\"  -- Error attaching plugin...\", error);\n      window.alert(\"Error attaching plugin... \" + error);\n    },\n    onmessage: function (msg, jsep) {\n      Janus.debug(\" ::: Got a message (subscriber) :::\", msg);\n      var event = msg[\"videoroom\"];\n      Janus.log(\"Event: \" + event);\n\n      if (msg[\"error\"]) {\n        window.alert(msg[\"error\"]);\n      } else if (event) {\n        if (event === \"attached\") {\n          remoteFeed.rfid = msg[\"id\"];\n          remoteFeed.rfdisplay = msg[\"display\"];\n          self.setState({ feeds: self.state.feeds.concat(remoteFeed) }, () =>\n            console.log(\"@@@@\", self.state.feeds)\n          );\n\n          if (!video) {\n            self.vStreamDettacher(remoteFeed);\n          }\n\n          Janus.log(\n            \"Successfully attached to feed \" +\n              remoteFeed.rfid +\n              \" (\" +\n              remoteFeed.rfdisplay +\n              \") in room \" +\n              msg[\"room\"]\n          );\n        } else if (event === \"event\") {\n        } else {\n          // What has just happened?\n        }\n      }\n      if (jsep) {\n        Janus.log(\"Handling SDP as well...\", jsep);\n        remoteFeed.createAnswer({\n          jsep: jsep,\n          // Add data:true here if you want to subscribe to datachannels as well\n          // (obviously only works if the publisher offered them in the first place)\n          media: { audioSend: false, videoSend: false, data: false }, // We want recvonly audio/video\n          success: function (jsep) {\n            Janus.log(\"Got SDP!\", jsep);\n            var body = { request: \"start\", room: self.state.roomId };\n            remoteFeed.send({ message: body, jsep: jsep });\n          },\n          error: function (error) {\n            Janus.log(\"WebRTC error:\", error);\n            window.alert(\"WebRTC error... \" + error.message);\n          },\n        });\n      }\n    },\n    iceState: function (state) {\n      Janus.log(\n        \"ICE state of this WebRTC PeerConnection (feed #\" +\n          remoteFeed.rfid +\n          \") changed to \" +\n          state\n      );\n    },\n    webrtcState: function (on) {\n      Janus.log(\n        \"Janus says this WebRTC PeerConnection (feed #\" +\n          remoteFeed.rfid +\n          \") is \" +\n          (on ? \"up\" : \"down\") +\n          \" now\"\n      );\n      if (on === \"down\") {\n        self.vremoveParticipant(remoteFeed.rfid);\n      }\n    },\n    onlocalstream: function (stream) {\n      console.log(\">>>>>>>>>>>\", stream);\n    },\n    onremotestream: function (stream) {\n      self.vStreamAttacher(remoteFeed);\n    },\n    ondata: function (data) {},\n    oncleanup: function () {\n      Janus.log(\" ::: Got a cleanup notification (remote feed \" + id + \") :::\");\n    },\n  });\n}\n\nexport function vregisterUsername(room) {\n  var self = this;\n  var register = {\n    request: \"join\",\n    room: 1234,\n    ptype: \"publisher\",\n    //pin: self.state.pin,\n    display:\n      self.state.fullname +\n      \" \" +\n      self.state.userUUID +\n      \"\" +\n      self.state.userColor +\n      \"\" +\n      self.state.slot,\n  };\n  self.state.sfutest.send({ message: register });\n  //self.setState({ myVroomId: self.state.mixertest.id });\n}\n\nexport function vChangeUsername(room) {\n  var self = this;\n  var register = {\n    request: \"configure\",\n    room: 1234,\n    ptype: \"publisher\",\n    //pin: self.state.pin,\n    display:\n      self.state.fullname +\n      \" \" +\n      self.state.userUUID +\n      \"\" +\n      self.state.userColor +\n      \"\" +\n      self.state.slot,\n  };\n  self.state.sfutest.send({ message: register });\n  //self.setState({ myVroomId: self.state.mixertest.id });\n}\n\nexport function vStreamAttacher(feed) {\n  var self = this;\n  console.log(\"Attaching \" + feed.id);\n  console.log(this.$$(\"#video-\" + feed.id));\n  if (this.$$(\"#video-\" + feed.id).length == 0) {\n    var localVideo = document.createElement(\"video\");\n    localVideo.autoplay = true;\n    localVideo.muted = true;\n    localVideo.width = \"320\";\n    localVideo.id = \"video-\" + feed.id;\n  }\n  $(\"#video-\" + feed.id).show();\n  if (feed.id && feed.webrtcStuff && feed.webrtcStuff.remoteStream) {\n    self.setState({ vActive: true });\n    if (localVideo) self.$$(\"#remoteVideos\").append(localVideo);\n    Janus.attachMediaStream(\n      document.getElementById(\"video-\" + feed.id),\n      feed.webrtcStuff.remoteStream\n    );\n  }\n  if (feed.id && feed.webrtcStuff && feed.webrtcStuff.myStream) {\n    if (localVideo) self.$$(\"#selfVideos\").append(localVideo);\n    self.$$(\"#videoLoaderIcon\").hide();\n    self.$$(\"#disableVideo\").show();\n    Janus.attachMediaStream(\n      document.getElementById(\"video-\" + feed.id),\n      feed.webrtcStuff.myStream\n    );\n  }\n}\n\nexport function vStreamDettacher(feed) {\n  if (feed.id) {\n    console.log(\"Dettaching \" + feed.id);\n    $(\"#video-\" + feed.id).hide();\n  }\n}\n\nexport function vremoveParticipant(id) {\n  var self = this;\n  self.setState({\n    participants: self.state.vparticipants.filter((item) => item.id !== id),\n  });\n}\n\nexport function vaddParticipant(id, p) {\n  //console.log(\"Adding Participants ...\", id, p);\n  var self = this;\n  var participant = p.split(\"\");\n  if (this.exisitingParticipant(participant[1])) {\n    self.setState({\n      participants: self.state.vparticipants.concat({\n        id: id,\n        display: participant[0],\n        uuid: participant[1],\n        userColor: participant[2],\n        role: \"listener\",\n        current: \"stopped-talking\",\n      }),\n    });\n  }\n  //console.log(\"participant added:\", participant[1]);\n}\n\nexport function publishCamera(bitrate = 16) {\n  var self = this;\n  self.state.sfutest.createOffer({\n    media: {\n      audioRecv: false,\n      videoRecv: false,\n      data: false,\n      videoSend: true,\n      audioSend: false,\n      video: { width: 180, height: 151 },\n    },\n\n    success: function (jsep) {\n      Janus.debug(\"********* Got publisher SDP!\", jsep);\n      console.log(\"switching to \" + bitrate);\n      if (jsep) {\n        var publish = {\n          request: \"configure\",\n          audio: false,\n          video: true,\n          //video:{width: 180, height: 180},\n          data: false,\n          bitrate: bitrate * 8000,\n          bitrate_cap: true,\n          //videocodec: \"vp8\",\n        };\n        self.state.sfutest.send({ message: publish, jsep: jsep });\n      }\n      self.setState({ publishedCamera: true });\n      self.$$(\"#disableVideo\").show();\n      console.log(\"ID: >>>\", self.state.sfutest.id);\n      socket.emit(\"ionSetSlot\", {\n        slot: self.state.slot,\n        stream: self.state.sfutest.id,\n      });\n      var tracks = self.state.sfutest.webrtcStuff.myStream.getTracks();\n      console.log(tracks);\n    },\n    error: function (error) {\n      Janus.error(\"***** WebRTC error:\", error);\n    },\n  });\n}\n\nexport function unPublishCamera() {\n  var self = this;\n  console.log(\"unPublishing ..\");\n  var unpublish = { request: \"unpublish\" };\n  self.state.sfutest.send({ message: unpublish });\n  self.vStreamDettacher(self.state.sfutest);\n  console.log(\"ID: >>>\", self.state.sfutest.id);\n  socket.emit(\"ionRelSlot\", {\n    slot: self.state.slot,\n    stream: self.state.sfutest.id,\n  });\n  self.setState({ publishedCamera: false, videoState: \"initial\", slot: null });\n\n  /*\n  var self = this;\n  self.state.sfutest.createOffer({\n      media: {\n          audioRecv: false,\n          videoRecv: false,\n          data: false,\n          videoSend: false,\n          audioSend: false,\n      },\n\n      success: function (jsep) {\n          Janus.debug(\"********* Got publisher SDP!\", jsep);\n          //console.log('switching to ' + bitrate)\n          if (jsep) {\n              var publish = {\n                  request: \"unpublish\",\n                  audio: false,\n                  video: false,\n                  data: false,\n              };\n              self.state.sfutest.send({ message: publish, jsep: jsep });\n          }\n          self.setState({ publishedCamera: false });\n         // self.vStreamDettacher(self.state.sfutest);\n          /*\n          var tracks = self.state.sfutest.webrtcStuff.myStream.getTracks()\n          tracks.forEach(function (track) {\n              if (track.kind === \"video\") {\n                  track.stop();\n              }\n          });\n      },\n      error: function (error) {\n          Janus.error(\"***** WebRTC error:\", error);\n      },\n  });*/\n}\n\nexport function vexisitingParticipant(participantId) {\n  var self = this;\n  var exisiting = self.state.vparticipants.filter(\n    (item) => item.uuid === participantId\n  );\n  if (exisiting.length === 0) {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nexport function vparticipantDisplay(participantId) {\n  var self = this;\n  var exisiting = self.state.vparticipants.filter(\n    (item) => item.uuid === participantId\n  );\n  if (exisiting.length === 0) {\n    return \"\";\n  } else {\n    return exisiting[0].display;\n  }\n}\n\nexport function vparticipantChangeStatus(participantId, status) {\n  this.setState((prevState) => ({\n    talking: {\n      ...prevState.talking,\n      [participantId]: status,\n    },\n  }));\n}\n\nexport function vparticipantChangeRoom(participantId, room) {\n  this.setState((prevState) => ({\n    participantRoom: {\n      ...prevState.participantRoom,\n      [participantId]: room,\n    },\n  }));\n}\n\nexport function vexitAudioRoom() {\n  var self = this;\n  if (this.state.mixertest) {\n    this.state.mixertest.send({ message: { request: \"unpublish\" } });\n  }\n}\n\nexport function vPublishBtn() {\n  var self = this;\n  if (!self.state.publishedCamera) {\n    return (\n      <a id=\"enableVideo\" fill onClick={() => self.ionRequestRoom()}>\n        <div style={{ float: \"right\", paddingTop: \"3px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"18\"\n            height=\"18\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <path d=\"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z\" />\n            <rect x=\"3\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" />\n            <line x1=\"7\" y1=\"12\" x2=\"11\" y2=\"12\" />\n            <line x1=\"9\" y1=\"10\" x2=\"9\" y2=\"14\" />\n          </svg>\n        </div>\n      </a>\n    );\n  } else {\n    return (\n      <a id=\"disableVideo\" onClick={() => self.unPublishCamera()}>\n        <div style={{ float: \"right\", paddingTop: \"1px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"16\"\n            height=\"16\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" />\n            <path d=\"M15 11v-1l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -.675 .946\" />\n            <path d=\"M10 6h3a2 2 0 0 1 2 2v3m0 4v1a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h1\" />\n          </svg>\n        </div>\n      </a>\n    );\n  }\n}\n","import React, { Component } from \"react\";\nimport { Button } from \"framework7-react\";\nimport { dict } from \"../Dict\";\nimport { Client, LocalStream, RemoteStream } from \"ion-sdk-js\";\nimport { IonSFUJSONRPCSignal } from \"ion-sdk-js/lib/signal/json-rpc-impl\";\nimport { conf } from \"../conf\";\nimport { socket } from \"./socket.js\";\n\nexport function ionSessionCreate(room) {\n  var config = {\n    iceServers: [\n      {url: \"stun:stun.l.google.com:19302\"},\n      {\n        url: \"turn:sync1.ut.ac.ir:3478\",\n        username: 'shafiei',\n        credential: '12345678'\n    \n      }\n    ]\n  };\n\n  var self = this;\n\n  var signal = new IonSFUJSONRPCSignal(conf.ionSignalServer);\n\n  self.setState({ config: config, signal: signal }, () => {\n    var client = new Client(self.state.signal, self.state.config);\n    var clientExists = self.state.clients.filter((item) => item.room === room);\n    //console.log(\"clientExists: \", clientExists);\n    if (clientExists.length == 0) {\n      self.setState(\n        { clients: self.state.clients.concat({ room: room, client: client }) },\n        () => {\n          console.log(self.state.clients)\n          self.state.signal.onopen = () => {\n            //var cl = self.state.clientLocal[self.state.clientLocal.length - 1];\n            var cl = self.state.clients.filter((item) => item.room === room);\n            cl[0].client.join(\"room\" + room);\n            cl[0].client.ontrack = (track, stream) => {\n              //console.log(track, stream);\n              console.log(\"got track\", track.id, \"for stream\", stream.id);\n              if (track.kind === \"video\" && stream) {\n                track.onunmute = () => {\n                  var exists = self.state.streams.filter(\n                    (item) => item.id === stream.id\n                  );\n                  if (exists.length == 0) {\n                    stream[\"room\"] = \"room\" + room;\n                    self.setState(\n                      {\n                        streams: self.state.streams.concat(stream),\n                        ionActive: true,\n                      },\n                      () => {\n                        console.log(\"Streams are ...\", self.state.streams);\n                      }\n                    );\n                  }\n\n                  stream.onremovetrack = () => {\n                    console.log(\"Stream owner left\");\n                    self.setState(\n                      {\n                        streams: self.state.streams.filter(\n                          (item) => item.id !== stream.id\n                        ),\n                      },\n                      () => {\n                        if (\n                          self.state.streams.length == 0 &&\n                          !self.state.media\n                        ) {\n                          self.setState({ ionActive: false });\n                        }\n                      }\n                    );\n\n                    self.$$(\"#remoteVideos\").remove();\n                    self.$$(\"#videos\").append(\"<div id='remoteVideos'></div>\");\n                  };\n                };\n              }\n            };\n          };\n        }\n      );\n    }\n  });\n}\n\nexport function ionStart() {\n  var self = this;\n  LocalStream.getUserMedia({\n    resolution: \"vga\",\n    codec: 'vp8',\n    video: true,\n    video: { width: 180, height: 180, facingMode: \"user\", frameRate: { min: 15, max: 20 } },\n    audio: false,\n    simulcast: false\n  })\n    .then((media) => {\n      self.setState({ media: media, ionActive: true });\n      var localVideo = document.createElement(\"video\");\n      localVideo.srcObject = media;\n      localVideo.autoplay = true;\n      localVideo.muted = true;\n      localVideo.width = \"320\";\n      var cl = self.state.clients.filter(\n        (item) => item.room === self.state.slot\n      );\n      cl[0].client.publish(media);\n      console.log(media);\n      self.$$(\"#selfVideos\").append(localVideo);\n      self.$$(\"#videoLoaderIcon\").hide();\n      self.$$(\"#disableVideo\").show();\n\n      socket.emit(\"ionSetSlot\", { slot: this.state.slot, stream: media.id });\n      media.getVideoTracks()[0].onended = function () {\n        self.ionUnPublish();\n      };\n    })\n    .catch(console.error);\n}\n\nexport function ionVideos() {\n  var self = this;\n  var result = [];\n  if (this.state.streams) {\n    this.state.streams.map((stream) => {\n      console.log(\"Attaching to stream ...\", stream);\n      if (self.state.media && stream.id === self.state.media.id) {\n      } else {\n        if (this.$$(\"#\" + stream.id).length == 0) {\n          var remoteVideo = document.createElement(\"video\");\n          remoteVideo.srcObject = stream;\n          remoteVideo.autoplay = true;\n          remoteVideo.muted = true;\n          remoteVideo.width = \"320\";\n          remoteVideo.id = stream.id;\n          console.log(\"Trying to attach to\", stream.id);\n\n          this.$$(\"#remoteVideos\").append(remoteVideo);\n        }\n      }\n    });\n\n    return result;\n  }\n}\n\nexport function ionUnPublish() {\n  var self = this;\n  this.state.media.unpublish();\n  this.state.media.getTracks().forEach((track) => track.stop());\n  this.$$(\"#selfVideos\").remove();\n  this.$$(\"#videos\").prepend(\"<div id='selfVideos'></div>\");\n  socket.emit(\"ionRelSlot\", { stream: this.state.media.id });\n  this.setState({ media: null }, () => {\n    if (self.state.streams.length == 0 && !self.state.media) {\n      self.setState({ ionActive: false, videoState: \"initial\" });\n    }\n  });\n\n  this.setState({ videoState: \"initial\", slot: null });\n  self.leaveRoom(self.state.slot);\n}\n\nexport function ionPublishBtn() {\n  var self = this;\n\n  if (!self.state.media) {\n    return (\n      <a id=\"enableVideo\" fill onClick={() => self.ionRequestRoom()}>\n        <div style={{ float: \"right\", paddingTop: \"3px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"18\"\n            height=\"18\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <path d=\"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z\" />\n            <rect x=\"3\" y=\"6\" width=\"12\" height=\"12\" rx=\"2\" />\n            <line x1=\"7\" y1=\"12\" x2=\"11\" y2=\"12\" />\n            <line x1=\"9\" y1=\"10\" x2=\"9\" y2=\"14\" />\n          </svg>\n        </div>\n      </a>\n    );\n  } else {\n    return (\n      <a id=\"disableVideo\" onClick={() => self.ionUnPublish()}>\n        <div style={{ float: \"right\", paddingTop: \"1px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"16\"\n            height=\"16\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <line x1=\"3\" y1=\"3\" x2=\"21\" y2=\"21\" />\n            <path d=\"M15 11v-1l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -.675 .946\" />\n            <path d=\"M10 6h3a2 2 0 0 1 2 2v3m0 4v1a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h1\" />\n          </svg>\n        </div>\n      </a>\n    );\n  }\n}\n\nexport function ionDisplay(event) {\n  console.log(event.target.value);\n  this.setState({ display: event.target.value }, () => {\n    console.log(\"Display:\" + this.state.display);\n  });\n}\n\nexport function leaveRoom(room) {\n  var self = this;\n  //var cl = self.state.clientLocal[self.state.clientLocal.length - 1];\n  //cl.leave(\"room\" + room);\n  var cl = self.state.clients.filter((item) => item.room === room);\n  cl[0].client.leave(\"room\" + room);\n  console.log(\"leaving room \" + room);\n  var streams = self.state.streams.filter(\n    (item) => item.room === \"room\" + room\n  );\n  console.log(streams);\n  for (let i = 0; i < streams.length; i++) {\n    console.log(streams[i].id);\n    this.$$(\"#\" + streams[i].id).remove();\n  }\n  self.setState({\n    streams: self.state.streams.filter((item) => item.room !== \"room\" + room),\n  });\n  self.setState({\n    clients: self.state.clients.filter((item) => item.room !== room),\n  });\n}\n\nexport function screenSessionCreate() {\n  var self = this;\n  var config = {\n    iceServers: [\n      {url: \"stun:stun.l.google.com:19302\"},\n      {\n        url: \"turn:sync1.ut.ac.ir:3478\",\n        username: 'shafiei',\n        credential: '12345678'\n    \n      }\n    ]\n  };\n\n  var screenSignal = new IonSFUJSONRPCSignal(conf.ionSignalServer);\n\n  self.setState({ screenConfig: config, screenSignal: screenSignal }, () => {\n    var screenClientLocal = new Client(\n      self.state.screenSignal,\n      self.state.screenConfig\n    );\n    self.setState({ screenClientLocal: screenClientLocal }, () => {\n      self.state.screenSignal.onopen = () =>\n        self.state.screenClientLocal.join(\"screen room\");\n      self.state.screenClientLocal.ontrack = (track, stream) => {\n        console.log(\"got track\", track.id, \"for stream\", stream.id);\n        if (track.kind === \"video\") {\n          track.onunmute = () => {\n            var exists = self.state.screenStreams.filter(\n              (item) => item.id === stream.id\n            );\n            if (exists.length == 0) {\n              self.setState(\n                {\n                  screenStreams: self.state.screenStreams.concat(stream),\n                  screenActive: true,\n                },\n                () => {\n                  // self.scrollTo('#screen')\n                }\n              );\n            }\n            //self.scrollTo('#screen')\n            stream.onremovetrack = () => {\n              console.log(\"Stream owner left\");\n              self.setState(\n                {\n                  screenStreams: self.state.screenStreams.filter(\n                    (item) => item.id !== stream.id\n                  ),\n                },\n                () => {\n                  if (\n                    self.state.screenStreams.length == 0 &&\n                    !self.state.screenMedia\n                  ) {\n                    self.setState({ screenActive: false });\n                  }\n                }\n              );\n              self.$$(\"#remotes\").remove();\n              self.$$(\"#screen\").append(\"<div id='remotes'></div>\");\n            };\n          };\n        }\n      };\n    });\n  });\n}\n\nexport function screenStart() {\n  var self = this;\n  LocalStream.getDisplayMedia({\n    resolution: \"vga\",\n    frameRate: 18,\n    width: 600,\n    audio: false,\n  })\n    .then((media) => {\n      console.log(media);\n      this.setState({ screenMedia: media, screenActive: true });\n      var localVideo = document.createElement(\"video\");\n      localVideo.srcObject = media;\n      localVideo.autoplay = true;\n      localVideo.muted = true;\n      localVideo.width = this.$$(\"#screen\").width() - 20;\n      this.state.screenClientLocal.publish(media);\n      this.$$(\"#remotes\").append(localVideo);\n      media.getVideoTracks()[0].onended = function () {\n        self.screenUnPublish();\n      };\n      self.scrollTo(\"#screen\");\n    })\n    .catch(console.error);\n}\n\nexport function screenVideos() {\n  var self = this;\n  var result = [];\n  if (this.state.screenStreams) {\n    this.state.screenStreams.map((stream) => {\n      if (this.$$(\"#\" + stream.id).length == 0) {\n        console.log(\"Going to show\", stream.id);\n        var remoteVideo = document.createElement(\"video\");\n        remoteVideo.srcObject = stream;\n        remoteVideo.autoplay = true;\n        remoteVideo.muted = true;\n        remoteVideo.width = this.$$(\"#screen\").width() - 20;\n        remoteVideo.id = stream.id;\n        this.$$(\"#remotes\").append(remoteVideo);\n        self.scrollTo(\"#screen\");\n      }\n    });\n\n    return result;\n  }\n}\n\nexport function screenUnPublish() {\n  var self = this;\n  this.state.screenMedia.unpublish();\n  this.state.screenMedia.getTracks().forEach((track) => track.stop());\n  this.$$(\"#remotes\").remove(this.state.screenMedia.id);\n  this.$$(\"#screen\").append(\"<div id='remotes'></div>\");\n  this.setState({ screenMedia: null }, () => {\n    if (self.state.screenStreams.length == 0 && !self.state.screenMedia) {\n      self.setState({ screenActive: false });\n    }\n  });\n}\n\nexport function screenPublishBtn() {\n  if (!this.state.screenMedia) {\n    return (\n      <a fill onClick={() => this.screenStart()}>\n        <div style={{ float: \"right\", paddingTop: \"5px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"16\"\n            height=\"16\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <path d=\"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9\" />\n            <line x1=\"7\" y1=\"20\" x2=\"17\" y2=\"20\" />\n            <line x1=\"9\" y1=\"16\" x2=\"9\" y2=\"20\" />\n            <line x1=\"15\" y1=\"16\" x2=\"15\" y2=\"20\" />\n            <path d=\"M17 4h4v4\" />\n            <path d=\"M16 9l5 -5\" />\n          </svg>\n        </div>\n      </a>\n    );\n  } else {\n    return (\n      <a onClick={() => this.screenUnPublish()}>\n        <div style={{ float: \"right\", paddingTop: \"5px\" }}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            class=\"icon\"\n            width=\"16\"\n            height=\"16\"\n            viewBox=\"0 0 24 24\"\n            stroke-width=\"2\"\n            stroke=\"currentColor\"\n            fill=\"none\"\n            stroke-linecap=\"round\"\n            stroke-linejoin=\"round\"\n          >\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <path d=\"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9\" />\n            <line x1=\"7\" y1=\"20\" x2=\"17\" y2=\"20\" />\n            <line x1=\"9\" y1=\"16\" x2=\"9\" y2=\"20\" />\n            <line x1=\"15\" y1=\"16\" x2=\"15\" y2=\"20\" />\n            <path d=\"M17 8l4 -4m-4 0l4 4\" />\n          </svg>\n        </div>\n      </a>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { w3cwebsocket as W3CWebSocket } from \"websocket\";\nimport RecordRTC from 'recordrtc'\n//import socketClient  from \"socket.io-client\";\nimport {\n  App,\n  Panel,\n  View,\n  Page, Row, Block,\n  LoginScreen,\n  LoginScreenTitle,\n  List,\n  ListInput,\n  BlockFooter,\n  ListButton,\n  Button\n} from 'framework7-react';\nimport ModelStore from \"../stores/ModelStore\";\nimport * as MyActions from \"../actions/MyActions\";\nimport { messaging } from \"../init-fcm.js\";\nimport 'framework7-icons';\nimport { conf } from \"../conf\";\nimport Janus from \"../janus.js\";\nimport PanelRightPage from \"../containers/layouts/PanelRightPage\";\nimport RoomShow from \"../containers/rooms/show\";\nimport LoadedPage from \"../containers/rooms/page\";\nimport Right from \"./right\";\nimport Left from \"./left\"\nimport Login from \"./login\"\nimport routes from '../routes';\nimport axios, { put } from 'axios';\nimport randomColor from 'randomcolor';\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\nimport {\n  sessionCreate, addParticipant, exisitingParticipant, registerUsername,\n  toggleMute, exitAudioRoom, removeParticipant, participantChangeStatus,\n  participantDisplay, forceMute, participantChangeRoom\n} from \"./janus-tools.js\";\n\nimport {\n  vsessionCreate, vregisterUsername, vNewRemoteFeed, publishCamera,\n  vPublishBtn, vStreamAttacher, vStreamDettacher, unPublishCamera,\n  vChangeUsername\n} from \"./janus-videoroom.js\";\n\nimport {\n  ionSessionCreate, ionStart, ionVideos, ionUnPublish, ionPublishBtn, ionDisplay,\n  screenSessionCreate, screenStart, screenVideos, screenUnPublish, screenPublishBtn,\n  leaveRoom\n} from \"./ion-tools.js\";\n\nimport { socket } from './socket.js'\n\nimport { dict } from '../Dict';\n\n\nconst client = new W3CWebSocket(conf.socketServer);\n\n\n//const io = socketClient(conf.socketIOServer);\n\nexport default class extends React.Component {\n  constructor() {\n    super();\n    this.setParticipants = this.setParticipants.bind(this);\n    this.sessionCreate = sessionCreate.bind(this);\n    this.registerUsername = registerUsername.bind(this);\n    this.participantChangeStatus = participantChangeStatus.bind(this);\n    this.participantDisplay = participantDisplay.bind(this);\n    this.forceMute = forceMute.bind(this);\n    this.participantChangeRoom = participantChangeRoom.bind(this);\n    this.leaveRoom = leaveRoom.bind(this);\n\n    this.vsessionCreate = vsessionCreate.bind(this)\n    this.vregisterUsername = vregisterUsername.bind(this)\n    this.vNewRemoteFeed = vNewRemoteFeed.bind(this)\n    this.publishCamera = publishCamera.bind(this)\n    this.vPublishBtn = vPublishBtn.bind(this)\n    this.vStreamAttacher = vStreamAttacher.bind(this)\n    this.vStreamDettacher = vStreamDettacher.bind(this)\n    this.unPublishCamera = unPublishCamera.bind(this)\n    this.vChangeUsername = vChangeUsername.bind(this)\n\n    //this.pageAfterIn = this.pageAfterIn.bind(this);\n    //this.streamAttacher = this.streamAttacher.bind(this);\n    //this.streamDettacher = this.streamDettacher.bind(this);\n    //this.unmute = this.unmute.bind(this);\n    //this.getInstance = this.getInstance.bind(this);\n    //this.setInstance = this.setInstance.bind(this);\n    this.addParticipant = addParticipant.bind(this);\n    //this.removeParticipant = this.removeParticipant.bind(this);\n    this.exisitingParticipant = exisitingParticipant.bind(this);\n    this.toggleMute = toggleMute.bind(this);\n    this.getJsonFromUrl = this.getJsonFromUrl.bind(this);\n    this.wsSend = this.wsSend.bind(this);\n\n    this.ionSessionCreate = ionSessionCreate.bind(this);\n    this.ionStart = ionStart.bind(this);\n    this.ionVideos = ionVideos.bind(this);\n    this.ionUnPublish = ionUnPublish.bind(this);\n    this.ionPublishBtn = ionPublishBtn.bind(this);\n    this.ionDisplay = ionDisplay.bind(this);\n\n    this.screenSessionCreate = screenSessionCreate.bind(this);\n    this.screenStart = screenStart.bind(this);\n    this.screenVideos = screenVideos.bind(this);\n    this.screenUnPublish = screenUnPublish.bind(this);\n    this.screenPublishBtn = screenPublishBtn.bind(this);\n\n    this.handleChangeValue = this.handleChangeValue.bind(this);\n    this.login = this.login.bind(this);\n    this.setInstance = this.setInstance.bind(this);\n    this.newComerReset = this.newComerReset.bind(this);\n    this.toggleMicrophone = this.toggleMicrophone.bind(this);\n\n    this.uploader = this.uploader.bind(this);\n    this.getInstance = this.getInstance.bind(this);\n    this.recentUpload = this.recentUpload.bind(this);\n    this.revertUndo = this.revertUndo.bind(this);\n    this.revertTrash = this.revertTrash.bind(this);\n    this.exitAudioRoom = exitAudioRoom.bind(this);\n    this.removeParticipant = removeParticipant.bind(this);\n\n    this.uploadedRecentlyReset = this.uploadedRecentlyReset.bind(this)\n    this.extractAction = this.extractAction.bind(this)\n    this.logout = this.logout.bind(this)\n    this.signUp = this.signUp.bind(this)\n\n    this.scrollTo = this.scrollTo.bind(this)\n\n    this.appendChat = this.appendChat.bind(this)\n    this.chatDeactive = this.chatDeactive.bind(this)\n\n\n    this.appendLink = this.appendLink.bind(this)\n    this.socketHandle = this.socketHandle.bind(this)\n    this.togglePresenter = this.togglePresenter.bind(this)\n\n    this.ionRequestRoom = this.ionRequestRoom.bind(this)\n    this.toggleRole = this.toggleRole.bind(this)\n\n    this.connectSocketRoom = this.connectSocketRoom.bind(this)\n    this.participantRole = this.participantRole.bind(this)\n\n    this.handRaise = this.handRaise.bind(this)\n    this.handRaised = this.handRaised.bind(this)\n    this.pageAfterIn = this.pageAfterIn.bind(this)\n\n\n    this.state = {\n      participants: [],\n      vparticipants: [],\n      feeds: [],\n      token: window.localStorage.getItem(\"token\"),\n      shortners: null,\n      server: conf.janusServer,\n      janus: null,\n      sfutest: null,\n      opaqueId: \"videoroomtest-\" + Janus.randomString(12),\n      roomId: null,\n      pin: 'c13eab83262202c2840a',\n      myId: null,\n      myVroomId: null,\n      isAdmin: false,\n      webrtcUp: null,\n      myusername: null,\n      mixertest: null,\n      fullname: null,\n      userUUID: null,\n      line: null,\n      currentTab: null,\n      currentPoint: null,\n      quillDelta: null,\n      cursorRange: null,\n      newCursor: null,\n      client: null,\n      clients: [],\n      typing: null,\n      loginScreenOpened: true,\n      username: '',\n      pass: '',\n      name: null,\n      newComerLength: null,\n      contentSync: null,\n      wsConnected: false,\n      muted: true,\n      progressShow: false,\n      progress: null,\n      upload: null,\n      page: null,\n      undoVector: null,\n      trash: false,\n      userColor: randomColor({ luminosity: 'dark', hue: 'random', alpha: 0.6 }),\n      uploadedRecently: false,\n      remoteStream: null,\n      localStream: null,\n      chats: [],\n      action: null,\n      signingUp: false,\n      email: null,\n      password: null,\n      passwordConfirmation: null,\n      // ion states\n      signal: null,\n      config: null,\n      clientLocal: [],\n      streams: [],\n      media: null,\n      display: 1,\n      ionActive: false,\n      //\n\n      vActive: false,\n      publishedCamera: false,\n      vJoined: false,\n\n      screenSignal: null,\n      screenConfig: null,\n      screenClientLocal: null,\n      screenStreams: [],\n      screenMedia: null,\n      screenActive: false,\n      //\n      chatActive: false,\n      //\n      srcLink: null,\n      converterCounter: 0,\n\n      presenters: [],\n      roles: [],\n      isPresenter: false,\n      isSpeaker: false,\n      isWriter: false,\n\n      handRaisings: [],\n\n      slot: null,\n      videoState: 'initial',\n\n      validationState: null,\n      talking: {},\n      participantRoom: {},\n      propagates: [],\n      availableFeeds: []\n\n    };\n  }\n  /*\nasync componentDidMount() {\n  const self = this;      \n  const app = self.$f7;\n\n  if (messaging) {\n    messaging.requestPermission()\n      .then(async function () {\n        const token = await messaging.getToken();\n        var data = { token: token }\n        if (self.state.token && self.state.token.length > 10) {\n          MyActions.setInstance('devices', data, self.state.token);\n        }\n      })\n      .catch(function (err) {\n        console.log(\"Unable to get permission to notify.\", err);\n      });\n  }\n  navigator.serviceWorker.addEventListener(\"message\", (message) => {\n\n    app.notification.create({\n      icon: '',\n\n      title: message.data.firebaseMessaging.payload.notification.title,\n      titleRightText: '',\n      cssClass: 'notification',\n      subtitle: message.data.firebaseMessaging.payload.notification.body,\n      closeTimeout: 5000,\n    }).open();\n  });\n\n\n}*/\n  // Framework7 parameters here\n  setParticipants() {\n\n  }\n\n  toggleMicrophone() {\n    var self = this;\n    this.setState({ muted: !this.state.muted }, () => { self.toggleMute() })\n  }\n\n  togglePresenter(uuid) {\n    var self = this;\n    //console.log('presenter', uuid)\n    //socket.emit('presenter', { uuid: uuid });\n    //this.setState({ presenters: self.state.presenters.concat(uuid) })\n  }\n\n  toggleRole(uuid, role, domain = 'single') {\n    var self = this;\n    //console.log(uuid, role, this.participantRole(uuid))\n    if (this.participantRole(uuid) === role) {\n      role = 'not' + role\n    }\n    var roleBlock = { uuid: uuid, role: role, domain: domain }\n    socket.emit('changeRole', roleBlock);\n    var roles = this.state.roles\n    if (roles.length > 0) {\n      for (let i = 0; i < roles.length; i++) {\n        if (roles[i].uuid && roles[i].uuid === uuid) {\n          let newState = Object.assign({}, this.state);\n          newState.roles[i] = roleBlock\n          this.setState(newState);\n        } else {\n          this.setState({ roles: this.state.roles.concat(roleBlock) });\n        }\n      }\n    } else {\n      this.setState({ roles: this.state.roles.concat(roleBlock) });\n    }\n  }\n\n  participantRole(uuid) {\n    var roles = this.state.roles.filter(\n      (item) => item.uuid === uuid\n    );\n    if (roles && roles[0] && roles[0].role) {\n      return (roles[0].role)\n    } else {\n      return ('')\n    }\n  }\n\n  handRaise(msg) {\n    var self = this;\n    var raiseBlock = { uuid: msg['raiserUUID'], status: msg['status'] }\n    var handRaisings = this.state.handRaisings\n    if (handRaisings.length > 0) {\n      for (let i = 0; i < handRaisings.length; i++) {\n        if (handRaisings[i].uuid && handRaisings[i].uuid === msg['raiserUUID']) {\n          let newState = Object.assign({}, this.state);\n          newState.handRaisings[i] = raiseBlock\n          this.setState(newState);\n        } else {\n          this.setState({ handRaisings: this.state.handRaisings.concat(raiseBlock) });\n        }\n      }\n    } else {\n      this.setState({ handRaisings: this.state.handRaisings.concat(raiseBlock) });\n    }\n  }\n\n  handRaised(uuid) {\n    // console.log(this.state.handRaisings)\n    var flag = false\n    var handRaisings = this.state.handRaisings\n    for (let i = 0; i < handRaisings.length; i++) {\n      if (handRaisings[i].uuid && handRaisings[i].uuid === uuid && handRaisings[i].status === 'raised') {\n        flag = true\n      }\n      if (i === handRaisings.length - 1) {\n        return flag\n      }\n\n    }\n\n  }\n\n\n\n  wsSend(msg, sender = this.state.userUUID) {\n    msg['room'] = this.state.roomId\n    msg['sender'] = sender\n    socket.emit('message', msg);\n  }\n\n  componentDidMount() {\n    var self = this;\n    MyActions.getInstance('uploads/recent', 1, this.state.token);\n    const app = this.$f7;\n    //console.log('this $$$$$$$', this.getJsonFromUrl(this.$f7.view[0].history[0]))\n    //this.extractAction();\n    MyActions.getInstance('rooms/last', 1, this.state.token);\n\n\n    if (this.state.token && this.state.token.length > 10) {\n      MyActions.setInstance('users/validate_token', {}, this.state.token);\n      this.setState({ loginScreenOpened: false, validationState: 'confirm' })\n    } else {\n      var params = this.getJsonFromUrl(this.$f7.view[0].history[0])\n      if (params && params['token']) {\n        MyActions.setInstance('users/validate_token', {}, params['token']);\n        this.setState({ validationState: 'start' })\n        window.localStorage.setItem('token', params['token']);\n      }\n\n    }\n\n    self.screenSessionCreate();\n\n\n    socket.on('connect', function () {\n      if (self.state.roomId) {\n        socket.emit('room', { room: self.state.roomId.toString(), uuid: self.state.userUUID });\n      }\n    });\n\n    socket.on('message', function (data) {\n      if (data['sender'] !== self.state.userUUID) {\n        self.socketHandle(data)\n      }\n    });\n\n\n    socket.on('ionSlot', function (data) {\n      console.log(data['slot']);\n      self.setState({ slot: data['slot'] }, () => {\n        if (!self.state.vJoined) {\n          self.vsessionCreate(1234)\n        } else {\n          self.vChangeUsername(1234)\n        }\n      })\n      self.wsSend({ type: 'joinedRoom', c: data['slot'] })\n      setTimeout(\n        () => self.publishCamera(),\n        5000\n      );\n      //console.log('>>>>>!!!', data['slot'])\n    })\n\n    window.onunload = window.onbeforeunload = function () {\n      self.unPublishCamera()\n    }\n\n    //window.onunload = function(){self.ionUnPublish();}\n    // self.$$('.popover-menu').toggleClass(\"popover-open\")\n\n\n    //.on('popover:open', function (e) {\n    //  console.log('About popover open');\n    //});\n  }\n\n  ionRequestRoom() {\n    var self = this;\n    self.$$('#videoLoaderIcon').show();\n    self.$$('#enableVideo').hide();\n\n    if (self.state.videoState == 'initial') {\n      self.setState({ videoState: 'requested' },\n        () => {\n          socket.emit('ionReqSlot', { uuid: this.state.userUUID })\n          //console.log('ionReqSlot')\n        })\n    }\n\n  }\n\n  extractAction() {\n    var params = this.getJsonFromUrl(this.$f7.view[0].history[0])\n    if (params && params.action) {\n      this.setState({ action: params.action })\n    } else {\n      this.setState({ action: 'room' })\n    }\n\n  }\n\n\n  componentWillUnmount() {\n    ModelStore.removeListener(\"set_instance\", this.setInstance);\n    ModelStore.removeListener(\"got_instance\", this.getInstance);\n  }\n\n  newComerReset() {\n    this.setState({ newComerLength: null })\n  }\n\n  uploadedRecentlyReset() {\n    this.setState({ uploadedRecently: false })\n  }\n\n  logout() {\n    this.setState({ token: null });\n    this.exitAudioRoom();\n    setTimeout(() => {\n      window.localStorage.removeItem('token');\n      window.location.replace('/')\n    }, 1000);\n\n  }\n\n  uploader(file) {\n    var self = this;\n    //console.log(file)\n    self.setState({ progressShow: true }, () => console.log(this.state.progressShow))\n    const config = {\n      onUploadProgress: function (progressEvent) {\n        var percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)\n        //console.log(percentCompleted)\n        self.setState({ progress: percentCompleted })\n\n      },\n      headers: { 'Content-Type': 'application/json', 'Authorization': \"bearer \" + self.state.token }\n    }\n\n    let data = new FormData()\n    data.append('upload[attached_document]', file)\n    data.append('upload[room_id]', 1)//self.state.room.id)\n\n    axios.post(conf.server + '/uploads', data, config)\n      .then(res => {\n        self.setState({ progressShow: false, uploadedRecently: true });\n        MyActions.getInstance('uploads/recent', 1, this.state.token);\n        //self.props.fileUploaded()\n      })\n      .catch(err => self.setState({ progressShow: false }))\n  }\n\n  recentUpload() {\n    //console.log('recentUpload Called ...')\n    this.setState({ progressShow: true });\n    MyActions.getInstance('uploads/recent', 1, this.state.token);\n  }\n\n  revertUndo() {\n    this.setState({ undo: null });\n  }\n\n  revertTrash() {\n    this.setState({ trash: false });\n  }\n\n  scrollTo(el) {\n    const pos = this.$$(el).offset()\n    this.$$('.page-content').scrollTop(pos.top, 350)\n  }\n\n  appendChat(c) {\n    //console.log(c)\n    var exist = this.state.chats.filter((item) => item.uuid === c.uuid)\n    //console.log(exist)\n    if (exist && exist.length === 0) {\n      if (this.state.chats && this.state.chats.length > 50) {\n        this.setState({ chats: this.state.chats.slice(1).concat(c) })\n      } else {\n        this.setState({ chats: this.state.chats.concat(c) })\n      }\n      if (!this.state.chatActive) {\n        this.setState({ chatActive: true })\n      }\n    }\n\n  }\n\n  chatDeactive() {\n    this.setState({ chatActive: false })\n  }\n\n  appendLink(l) {\n    this.setState({ srcLink: l })\n  }\n\n\n\n  componentWillMount() {\n    ModelStore.on(\"set_instance\", this.setInstance);\n    ModelStore.on(\"got_instance\", this.getInstance);\n    //this.maintainWS()\n  }\n\n  socketHandle(msg) {\n\n    var self = this;\n    //console.log(msg)\n    var parsed = msg\n    switch (parsed.type) {\n      case 'room':\n        //console.log('client', parsed.c)\n        self.setState({ client: parsed.c })\n        break;\n      case 'presenter':\n        //console.log()\n        if (parsed.c['presenterUUID'] == self.state.userUUID) {\n          self.setState({ isPresenter: true })\n        }\n        break;\n      case 'joinedRoom':\n        //console.log(parsed)\n        self.participantChangeRoom(parsed.sender, parsed.c)\n        break;\n      case 'joinRoom':\n        if (this.state.slot !== parsed.c) {\n          console.log(parsed.c)\n          self.setState({ propagates: self.state.propagates.concat(parsed.c) })\n          var feeds = self.state.availableFeeds.filter(\n            (item) => item.uuid === parsed.c\n          )\n          if (feeds && feeds[0]) {\n            self.vNewRemoteFeed(feeds[0].id, feeds[0].display, '', '', 'vp8')\n          }\n        }\n        break;\n      case 'leaveRoom':\n        if (this.state.slot !== parsed.c) {\n          //console.log(parsed.c)\n          //self.leaveRoom(parsed.c);\n          self.setState({\n            propagates: self.state.propagates.filter(\n              (item) => item !== parsed.c\n            )\n          })\n        \n          var feeds = self.state.availableFeeds.filter(\n            (item) => item.uuid === parsed.c\n          )\n          if (feeds && feeds[0]) {\n            var unPublishedFeed = self.state.feeds.filter(\n              (item) => item.rfid === feeds[0].id\n            );\n            var remoteFeed = unPublishedFeed.shift();\n            if (remoteFeed != null) {\n              remoteFeed.detach();\n              self.vStreamDettacher(feeds[0].id);\n            }\n          }\n\n        }\n        break;\n      case 'changeRole':\n        //console.log()\n        if (parsed.c['domain'] == 'all' || parsed.c['roleUUID'] == self.state.userUUID) {\n          if (parsed.c['role'] == 'presenter') {\n            self.setState({ isPresenter: true, isSpeaker: false, isWriter: false })\n          }\n          if (parsed.c['role'] == 'speaker') {\n            self.setState({ isSpeaker: true, isPresenter: false })\n          }\n          if (parsed.c['role'] == 'writer') {\n            self.setState({ isWriter: true, isPresenter: false })\n          }\n          if (parsed.c['role'] == 'notpresenter') {\n            self.setState({ isPresenter: false })\n          }\n          if (parsed.c['role'] == 'notwriter') {\n            self.setState({ isWriter: false })\n          }\n          if (parsed.c['role'] == 'notspeaker') {\n            self.forceMute();\n            self.setState({ isSpeaker: false })\n          }\n        }\n        break;\n\n      case 'handRaise':\n        self.handRaise(parsed.c)\n        break;\n      case 'srcLink':\n        self.appendLink(parsed.c)\n        break;\n      case 'chat':\n        self.appendChat(parsed.c)\n        break;\n      case 'page':\n        self.setState({ page: parsed.c })\n        break;\n      case 'undo':\n        self.setState({ undoVector: parsed.c })\n        break;\n      case 'trash':\n        self.setState({ trash: true })\n        break;\n      case 'newUpload':\n        self.recentUpload();\n        break;\n      case 'contentSync':\n        self.setState({ contentSync: parsed.c })\n        break;\n      case 'newComer':\n        //console.log('newComer', parsed.c)\n        self.setState({ newComerLength: parsed.c })\n        break;\n      case 'newCursor':\n        self.setState({ newCursor: parsed.c })\n        break;\n      case 'typing':\n        self.setState({ typing: parsed.c })\n        break;\n      case 'point':\n        self.setState({ currentPoint: parsed.c })\n        break;\n      case 'quill':\n        self.setState({ quillDelta: parsed.c })\n        break;\n      case 'cursor':\n        self.setState({ cursorRange: parsed.c })\n        break;\n      case 'line':\n        self.setState({ line: parsed.c })\n        break;\n      case 'tab':\n        self.setState({ currentTab: parsed.current })\n        break;\n    }\n  }\n\n  maintainWS() {\n    var self = this;\n    client.onopen = () => {\n      //console.log('$$$$$$$$$$$ -> WebSocket Client Connected');\n      //client.send(JSON.stringify({ type: 'room', id: this.state.roomId }));\n      client.send(JSON.stringify({ type: 'room', id: 1234 }));\n      self.setState({ wsConnected: true })\n    };\n    client.onclose = () => {\n      self.setState({ wsConnected: false })\n    }\n    client.onmessage = (message) => {\n      //  console.log(message);\n      var parsed = {}\n      if (message.data && message.data.length > 0) {\n        parsed = JSON.parse(message.data)\n      }\n\n      switch (parsed.type) {\n        case 'room':\n          //console.log('client', parsed.c)\n          self.setState({ client: parsed.c })\n          break;\n\n        case 'srcLink':\n          self.appendLink(parsed.c)\n          break;\n        case 'chat':\n          self.appendChat(parsed.c)\n          break;\n        case 'page':\n          self.setState({ page: parsed.c })\n          break;\n        case 'undo':\n          self.setState({ undoVector: parsed.c })\n          break;\n        case 'trash':\n          self.setState({ trash: true })\n          break;\n        case 'newUpload':\n          self.recentUpload();\n          break;\n        case 'contentSync':\n          self.setState({ contentSync: parsed.c })\n          break;\n        case 'newComer':\n          //console.log('newComer', parsed.c)\n          self.setState({ newComerLength: parsed.c })\n          break;\n        case 'newCursor':\n          self.setState({ newCursor: parsed.c })\n          break;\n        case 'typing':\n          self.setState({ typing: parsed.c })\n          break;\n        case 'point':\n          self.setState({ currentPoint: parsed.c })\n          break;\n        case 'quill':\n          self.setState({ quillDelta: parsed.c })\n          break;\n        case 'cursor':\n          self.setState({ cursorRange: parsed.c })\n          break;\n        case 'line':\n          self.setState({ line: parsed.c })\n          break;\n        case 'tab':\n          self.setState({ currentTab: parsed.current })\n          break;\n      }\n\n    };\n  }\n\n  getJsonFromUrl(url) {\n    if (!url || !url.split(\"?\") || !url.split(\"?\")[1]) return [];\n    var query = url.split(\"?\")[1];\n    var result = {};\n    query.split(\"&\").forEach(function (part) {\n      var item = part.split(\"=\");\n      result[item[0]] = decodeURIComponent(item[1]);\n    });\n    return result;\n  }\n\n  handleChangeValue(obj) {\n    this.setState(obj);\n  }\n\n  login() {\n    this.$$('.btn').hide();\n    this.$$('.btn-notice').text(dict.submitting);\n    var data = { name: this.state.name, user: { email: this.state.email, password: this.state.password } }\n    if (this.state.email && this.state.email.length > 0) {\n      if (this.state.signingUp) {\n        MyActions.setInstance('users/sign_up', data);\n      } else {\n        MyActions.setInstance('users/login', data);\n      }\n    } else {\n      const self = this;\n      self.$f7.dialog.alert(dict.incomplete_data, dict.alert);\n    }\n  }\n\n  signUp() {\n    this.setState({ signingUp: true });\n  }\n\n  setInstance() {\n    var self = this;\n    var klass = ModelStore.getKlass()\n    var user = ModelStore.getIntance();\n    if (user && (klass === 'SignUp' || klass === 'Login')) {\n      window.localStorage.setItem('token', user.token);\n      //this.$f7router.navigate('/');\n      window.location.reload()\n    }\n    if (klass === 'Validate') {\n      if (this.state.validationState === 'confirm') {\n        //console.log('registering name ...')\n        this.setState({ name: user.name, fullname: user.name, userUUID: user.uuid }, () => {\n          self.connectSocketRoom();\n        })\n      } else {\n        window.location.reload()\n      }\n\n      //this.setState({ loginScreenOpened: false })\n    }\n    //console.log(user, klass)\n\n  }\n\n  getInstance() {\n    var self = this;\n    var model = ModelStore.getIntance()\n    var klass = ModelStore.getKlass()\n    if (model && klass === 'Upload') {\n      this.setState({\n        model: model,\n      }, () => {\n        if (!model.converted && self.state.converterCounter < 10) {\n          //console.log('Cheking for conversion ...')\n          setTimeout(() => this.recentUpload(), 10000);\n          this.setState({ converterCounter: self.state.converterCounter + 1 })\n        } else {\n          this.setState({ progressShow: false });\n        }\n      });\n    }\n    if (model && klass === 'Room') {\n      this.setState({\n        roomId: model.room_id,\n        pin: model.pin,\n        isAdmin: model.is_admin,\n        isPresenter: model.is_admin,\n      }, () => {\n        self.sessionCreate(self.state.roomId);\n        //self.sessionCreate(1234);\n        self.vsessionCreate(1234);\n        self.connectSocketRoom();\n      })\n    }\n    //console.log(model, klass)\n  }\n\n  connectSocketRoom() {\n    if (this.state.userUUID && this.state.roomId) {\n      socket.emit('room', { room: this.state.roomId, uuid: this.state.userUUID });\n      //console.log('*******', this.state.roomId, this.state.userUUID)\n    }\n  }\n\n  currentPage() {\n\n  }\n\n  pageAfterIn() {\n    // setTimeout(\n    //   () => this.$f7.popover.open('.popover-menu', '#xxx'),\n    //   7000\n    // );\n  }\n\n\n\n  render() {\n    const f7params = {\n      id: 'io.framework7.testapp', // App bundle ID\n      name: 'Framework7', // App name\n      theme: 'aurora', // Automatic theme detection\n      panel: {\n        rightBreakpoint: 960,\n      },\n      view: {\n        //ignoreCache: true,\n        //reloadCurrent: true\n      },\n      // App routes\n      routes,\n    };\n\n    const {\n      line,\n      currentTab,\n      currentPoint,\n      quillDelta,\n      cursorRange,\n      clients,\n      client,\n      newCursor,\n      typing,\n      name,\n      newComerLength,\n      contentSync,\n      muted,\n      userUUID,\n      progress,\n      progressShow,\n      upload,\n      page,\n      undoVector,\n      trash,\n      userColor,\n      participants,\n      uploadedRecently,\n      remoteStream,\n      localStream,\n      chats,\n      email,\n      password,\n      passwordConfirmation,\n      signingUp,\n      ionActive,\n      screenActive,\n      srcLink,\n      isAdmin,\n      chatActive,\n      isPresenter,\n      isSpeaker,\n      isWriter,\n      roles,\n      handRaisings,\n      slot,\n      talking,\n      participantRoom,\n      vActive\n    } = this.state;\n\n    return (\n      <App params={f7params}>\n        <Panel resizable left cover>\n          <View>\n            <Left\n              wsSend={this.wsSend}\n              chats={chats}\n              appendChat={this.appendChat}\n              userUUID={userUUID}\n              name={name}\n              participantDisplay={this.participantDisplay}\n              isAdmin={isAdmin}\n              chatDeactive={this.chatDeactive}\n\n            />\n          </View>\n        </Panel>\n        <Panel resizable right themeDark>\n          <View>\n            <Right\n              participants={participants}\n              handleChangeValue={this.handleChangeValue}\n              muted={muted}\n              userUUID={userUUID}\n              toggleMicrophone={this.toggleMicrophone}\n              userColor={userColor}\n              logout={this.logout}\n              scrollTo={this.scrollTo}\n              ionPublishBtn={this.ionPublishBtn}\n              screenPublishBtn={this.screenPublishBtn}\n              ionActive={ionActive}\n              screenActive={screenActive}\n              isAdmin={isAdmin}\n              chatActive={chatActive}\n              chatDeactive={this.chatDeactive}\n              togglePresenter={this.togglePresenter}\n              isPresenter={isPresenter}\n              toggleRole={this.toggleRole}\n              isSpeaker={isSpeaker}\n              isWriter={isWriter}\n              roles={roles}\n              participantRole={this.participantRole}\n              wsSend={this.wsSend}\n              handRaisings={handRaisings}\n              handRaised={this.handRaised}\n              handRaise={this.handRaise}\n              currentSlot={slot}\n              talking={talking}\n              participantRoom={participantRoom}\n              pageAfterIn={this.pageAfterIn}\n              vPublishBtn={this.vPublishBtn}\n            />\n          </View>\n        </Panel>\n        <View id=\"main-view\" url=\"\" pushState={true} main className=\"safe-areas\">\n          <RoomShow\n            //setParticipants={this.participants}\n            wsSend={this.wsSend}\n            line={line}\n            currentTab={currentTab}\n            currentPoint={currentPoint}\n            quillDelta={quillDelta}\n            cursorRange={cursorRange}\n            client={client}\n            typing={typing}\n            newCursor={newCursor}\n            name={name}\n            newComerLength={newComerLength}\n            contentSync={contentSync}\n            newComerReset={this.newComerReset}\n            uploader={this.uploader}\n            progress={progress}\n            progressShow={progressShow}\n            upload={upload}\n            recentUpload={this.recentUpload}\n            page={page}\n            undoVector={undoVector}\n            revertUndo={this.revertUndo}\n            trash={trash}\n            revertTrash={this.revertTrash}\n            userColor={userColor}\n            participants={participants}\n            userUUID={userUUID}\n            uploadedRecently={uploadedRecently}\n            uploadedRecentlyReset={this.uploadedRecentlyReset}\n            remoteStream={remoteStream}\n            localStream={localStream}\n            ionVideos={this.ionVideos}\n            ionActive={ionActive}\n            screenVideos={this.screenVideos}\n            screenActive={screenActive}\n            appendLink={this.appendLink}\n            srcLink={srcLink}\n            isAdmin={isAdmin}\n            isPresenter={isPresenter}\n            isWriter={isWriter}\n            vActive={vActive}\n          />\n          <LoginScreen\n            className=\"demo-login-screen\"\n            opened={this.state.loginScreenOpened}\n            onLoginScreenClosed={() => {\n              this.handleChangeValue({ loginScreenOpened: false });\n            }}\n          >\n            <Login\n              email={email}\n              handleChangeValue={this.handleChangeValue}\n              name={name}\n              password={password}\n              passwordConfirmation={passwordConfirmation}\n              login={this.login}\n              signUp={this.signUp}\n              signingUp={signingUp}\n            />\n\n          </LoginScreen>\n        </View>\n      </App>\n    );\n  }\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n// Import Framework7\nimport Framework7 from 'framework7/framework7.esm.bundle';\n\n// Import Framework7-React plugin\nimport Framework7React from 'framework7-react';\n\n// Import main App component\nimport App from './components/App.jsx';\n\n// Framework7 styles\nimport 'framework7/css/framework7.bundle.rtl.min.css';\n\n// Icons\nimport './css/icons.css';\n\n// Custom app styles\nimport './css/app.css';\nimport './css/editor.css';\nimport './css/font-awesome.min.css';\nimport 'react-draft-wysiwyg/dist/react-draft-wysiwyg.css';\nimport './css/board.css';\nimport './css/style.css';\nimport './css/loader.css';\nimport './css/quill.snow.css';\n\nimport * as serviceWorker from './serviceWorker';\n\nif (\"serviceWorker\" in navigator) {\n  navigator.serviceWorker\n    .register(\"./firebase-messaging-sw.js\")\n    .then(function(registration) {\n      console.log(\"Registration successful, scope is:\", registration.scope);\n    })\n    .catch(function(err) {\n      console.log(\"Service worker registration failed, error:\", err);\n    });\n}\n// Init Framework7-React plugin\nFramework7.use(Framework7React);\n\n// Mount React App\nReactDOM.render(React.createElement(App),\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n//serviceWorker.unregister();\n"],"sourceRoot":""}