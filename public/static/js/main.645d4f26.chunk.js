(window["webpackJsonpd1-react"]=window["webpackJsonpd1-react"]||[]).push([[0],{132:function(e,t,n){e.exports=n(291)},286:function(e,t,n){},287:function(e,t,n){},288:function(e,t,n){},289:function(e,t,n){},291:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(30),r=n.n(o),s=n(11),l=n(1),c=n(52),u=n.n(c),d=n(80),m=n(4),h=n(7),f=n(2),g=n(5),p=n(6),v=new(n(127).Dispatcher),b=n(42),k=n.n(b),y={server:"/v1",janusServer:"https://kaarafarinan.ir:8089/janus"},E=y.server;function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,i=Object.keys(n).map((function(e){return e+"="+n[e]})).join("&");k.a.get(E+"/"+e+"?page="+t+"&"+i,{headers:{"Content-Type":"application/json",Authorization:"bearer "+a}}).then((function(e){v.dispatch({type:"LIST_MODEL_SUCCESS",list:e.data})})).catch((function(e){console.log(e)}))}function w(e,t,n,a){var i=E+"/"+e+"/"+t,o=new FormData;o.append("profile[avatar]",n),o.append("profile[id]",t);var r={headers:{"content-type":"multipart/form-data",Authorization:"bearer "+a}};Object(b.put)(i,o,r).then((function(e){v.dispatch({type:"POST_FILE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function S(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;k.a.get(E+"/"+e+"/"+t+"?page="+a,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"GET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=Object.keys(t).map((function(e){return e+"="+t[e]})).join("&");k.a.get(E+"/"+e+"/delete?"+a,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"DELETE_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function O(e,t,n){k.a.post(E+"/"+e+"/",t,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"SET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function j(e,t,n){k.a.put(E+"/"+e+"/"+t.id,t,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"SET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}var I=n(81),T=(n(293),I.initializeApp({apiKey:"AIzaSyAbQ1NDkKB_E_SbfgHY3w-esVWhjwj9DeE",authDomain:"tavan-e768d.firebaseapp.com",databaseURL:"https://tavan-e768d.firebaseio.com",projectId:"tavan-e768d",storageBucket:"tavan-e768d.appspot.com",messagingSenderId:"498708095861",appId:"1:498708095861:web:00428b1330b24e1eece93c",measurementId:"G-55DLXZ4VZY"})),D=null;I.messaging.isSupported()&&(D=T.messaging()).usePublicVapidKey("BGtSQdySGVQOeOwFha6rSVdmtfIUo_V33Eq-RTRb5kUNLvvwM7AVGCLtChjnGlD50fudRx8D4Aw-7br71Qfefrc");var L,A=n(8),N=(L={home:"\u062e\u0627\u0646\u0647",name:"\u0646\u0627\u0645 \u0648 \u0646\u0627\u0645 \u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc ",login:"\u0648\u0631\u0648\u062f",username:"\u0646\u0627\u0645 \u06a9\u0627\u0631\u0628\u0631\u06cc ",password:"\u0631\u0645\u0632 \u0639\u0628\u0648\u0631 ",password_confirmation:"\u062a\u06a9\u0631\u0627\u0631 \u0631\u0645\u0632 \u0639\u0628\u0648\u0631",mobile:"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06cc\u0644 ",error:"\u062e\u0637\u0627",sign_in:"\u0648\u0631\u0648\u062f ",sign_up:"\u062b\u0628\u062a \u0646\u0627\u0645",back:"\u0628\u0627\u0632\u06af\u0634\u062a",signed_up_already:"\u062a\u0627 \u06a9\u0646\u0648\u0646 \u062b\u0628\u062a \u0646\u0627\u0645 \u0646\u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f\u061f",new_advert:"\u062f\u0631\u062c \u0622\u06af\u0647\u06cc ",title:"\u0639\u0646\u0648\u0627\u0646",abstract:"\u0686\u06a9\u06cc\u062f\u0647",content:"\u0645\u062a\u0646",submit:"\u062b\u0628\u062a ",upload_from_gallery:"\u0627\u0646\u062a\u062e\u0627\u0628 \u0627\u0632 \u06af\u0627\u0644\u0631\u06cc",welcome:"\u062e\u0648\u0634 \u0622\u0645\u062f\u06cc\u062f",sign_out:"\u062e\u0631\u0648\u062c",phone_number:"\u0634\u0645\u0627\u0631\u0647 \u062a\u0644\u0641\u0646",telegram_channel:"\u06a9\u0627\u0646\u0627\u0644 \u062a\u0644\u06af\u0631\u0627\u0645",instagram_page:"\u0635\u0641\u062d\u0647 \u0627\u06cc\u0646\u0633\u062a\u0627\u06af\u0631\u0627\u0645",address:"\u0622\u062f\u0631\u0633 ",email:"\u0627\u06cc\u0645\u06cc\u0644 ",contact_information:"\u0627\u0637\u0644\u0627\u0639\u0627\u062a \u062a\u0645\u0627\u0633 ",search:"\u062c\u0633\u062a\u062c\u0648 ",cancel:"\u0628\u06cc\u062e\u06cc\u0627\u0644",view:"\u0646\u0645\u0627\u06cc\u0634",edit:"\u0648\u06cc\u0631\u0627\u06cc\u0634",delete:"\u062d\u0630\u0641",adverts_nes:"\u0639\u0646\u0648\u0627\u0646\u060c \u0645\u062a\u0646 \u0648 \u0634\u0645\u0627\u0631\u0647 \u062a\u0644\u0641\u0646 \u0627\u062c\u0628\u0627\u0631\u06cc \u0627\u0633\u062a",my_pins:" \u0646\u0634\u0627\u0646 \u0634\u062f\u0647\u200c\u0647\u0627 ",pin:"\u0646\u0634\u0627\u0646 \u06a9\u0646",pinned:"\u0646\u0634\u0627\u0646 \u0634\u062f\u0647",message_to_seller:"\u0627\u0631\u0633\u0627\u0644 \u067e\u06cc\u0627\u0645",messages:"\u067e\u06cc\u0627\u0645 \u0647\u0627 ",send_message:"\u067e\u06cc\u0627\u0645 \u062e\u0648\u062f \u0631\u0627 \u0628\u0646\u0648\u06cc\u0633\u06cc\u062f",province:"\u0627\u0633\u062a\u0627\u0646",city:"\u0634\u0647\u0631",website:"\u0648\u0628\u0633\u0627\u06cc\u062a",call:"\u062a\u0645\u0627\u0633 \u0628\u06af\u06cc\u0631\u06cc\u062f",ago:" \u0642\u0628\u0644",all_above:"\u0647\u0645\u0647 \u06cc \u0645\u0648\u0627\u0631\u062f \u0641\u0648\u0642",no_result:"\u0645\u0648\u0631\u062f\u06cc \u06cc\u0627\u0641\u062a \u0646\u0634\u062f ",category:"\u062f\u0633\u062a\u0647 \u0628\u0646\u062f\u06cc ",leg:"\u0645\u0633\u06cc\u0631",date:"\u062a\u0627\u0631\u06cc\u062e",time:"\u0632\u0645\u0627\u0646",numberOfPassngers:"\u062a\u0639\u062f\u0627\u062f \u0645\u0633\u0627\u0641\u0631\u0627\u0646 ",surename:"\u0646\u0627\u0645 \u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc",fathername:"\u0646\u0627\u0645 \u067e\u062f\u0631",ssn:"\u06a9\u062f\u0645\u0644\u06cc",birthplace:"\u0645\u062d\u0644 \u062a\u0648\u0644\u062f",pass_no:"\u0634\u0645\u0627\u0631\u0647 \u06af\u0630\u0631\u0646\u0627\u0645\u0647",birthdate:"\u062a\u0627\u0631\u06cc\u062e \u062a\u0648\u0644\u062f",place_of_birth:"\u0645\u062d\u0644 \u062a\u0648\u0644\u062f",required_fields:"\u0641\u06cc\u0644\u062f\u0647\u0627\u06cc \u0627\u062c\u0628\u0627\u0631\u06cc",en_father_name:"\u0646\u0627\u0645 \u067e\u062f\u0631 \u0644\u0627\u062a\u06cc\u0646",en_name:"\u0646\u0627\u0645 \u0644\u0627\u062a\u06cc\u0646",en_surename:"\u0646\u0627\u0645 \u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc \u0644\u0627\u062a\u06cc\u0646 ",passport_no:"\u0634\u0645\u0627\u0631\u0647 \u06af\u0630\u0631\u0646\u0627\u0645\u0647",final_confirm:"\u062a\u0627\u06cc\u06cc\u062f \u0646\u0647\u0627\u06cc\u06cc ",document_form:"\u0641\u0631\u0645 \u0627\u0633\u0646\u0627\u062f ",save:"\u0630\u062e\u06cc\u0631\u0647",documents:"\u0627\u0633\u0646\u0627\u062f ",type:"\u0646\u0648\u0639",string:"\u0645\u062a\u0646 \u06a9\u0648\u062a\u0627\u0647",text:"\u0645\u062a\u0646 \u0628\u0644\u0646\u062f",select:"\u06af\u0632\u06cc\u0646\u0647",multiSelect:"\u0686\u0646\u062f \u06af\u0632\u06cc\u0646\u0647",table:"\u062c\u062f\u0648\u0644"},Object(A.a)(L,"date","\u062a\u0627\u0631\u06cc\u062e"),Object(A.a)(L,"refundable","\u0642\u0627\u0628\u0644 \u0627\u0639\u0627\u062f\u0647"),Object(A.a)(L,"yes","\u0628\u0644\u0647"),Object(A.a)(L,"no","\u062e\u06cc\u0631"),Object(A.a)(L,"commentable","\u0642\u0627\u0628\u0644 \u0646\u0638\u0631\u062f\u0647\u06cc"),Object(A.a)(L,"end_point","\u0646\u0642\u0637\u0647 \u067e\u0627\u06cc\u0627\u0646"),Object(A.a)(L,"start_point","\u0646\u0642\u0637\u0647 \u0634\u0631\u0648\u0639"),Object(A.a)(L,"votable","\u0631\u0627\u06cc \u06af\u06cc\u0631\u06cc"),Object(A.a)(L,"publishable","\u0642\u0627\u0628\u0644 \u0627\u0646\u062a\u0634\u0627\u0631"),Object(A.a)(L,"field_name","\u0646\u0627\u0645 \u0641\u06cc\u0644\u062f"),Object(A.a)(L,"add","\u0627\u0641\u0632\u0648\u062f\u0646 "),Object(A.a)(L,"remove","\u062d\u0630\u0641"),Object(A.a)(L,"auxiliary_tables","\u062c\u062f\u0627\u0648\u0644 \u06a9\u0645\u06a9\u06cc"),Object(A.a)(L,"create_by","\u0627\u06cc\u062c\u0627\u062f \u0634\u062f\u0647 \u062a\u0648\u0633\u0637"),Object(A.a)(L,"list","\u0644\u06cc\u0633\u062a"),Object(A.a)(L,"workflows","\u06af\u0631\u062f\u0634 \u06a9\u0627\u0631\u0647\u0627"),Object(A.a)(L,"auxiliary_records","\u0645\u0642\u0627\u062f\u06cc\u0631 \u06a9\u0645\u06a9\u06cc"),Object(A.a)(L,"basic_table","\u062c\u062f\u0648\u0644 \u067e\u0627\u06cc\u0647"),Object(A.a)(L,"relation_table","\u062c\u062f\u0648\u0644 \u0631\u0627\u0628\u0637\u0647"),Object(A.a)(L,"auxiliary_table_form","\u0641\u0631\u0645 \u062c\u062f\u0648\u0644 \u06a9\u0645\u06a9\u06cc "),Object(A.a)(L,"Basic","\u067e\u0627\u06cc\u0647"),Object(A.a)(L,"Relation","\u0631\u0627\u0628\u0637\u0647 "),Object(A.a)(L,"Divan","\u062f\u06cc\u0648\u0627\u0646"),Object(A.a)(L,"workflow_form","\u0641\u0631\u0645 \u06af\u0631\u062f\u0634 \u06a9\u0627\u0631"),Object(A.a)(L,"submitting","\u062f\u0631 \u062d\u0627\u0644 \u0627\u0631\u0633\u0627\u0644 ... "),Object(A.a)(L,"settings","\u062a\u0646\u0638\u06cc\u0645\u0627\u062a"),Object(A.a)(L,"receiving","\u062f\u0631 \u062d\u0627\u0644 \u062f\u0631\u06cc\u0627\u0641\u062a ..."),Object(A.a)(L,"workflow_tables","\u062c\u062f\u0627\u0648\u0644 \u06a9\u0645\u06a9\u06cc \u06af\u0631\u062f\u0634 \u06a9\u0627\u0631 "),Object(A.a)(L,"auxiliary_table","\u062c\u062f\u0648\u0644 \u06a9\u0645\u06a9\u06cc"),Object(A.a)(L,"workflow","\u06af\u0631\u062f\u0634 \u06a9\u0627\u0631"),Object(A.a)(L,"actions","\u0639\u0645\u0644\u06cc\u0627\u062a"),Object(A.a)(L,"roles","\u0646\u0642\u0634 \u0647\u0627"),Object(A.a)(L,"divan","\u062f\u06cc\u0648\u0627\u0646"),Object(A.a)(L,"enter_your_email","\u0627\u06cc\u0645\u06cc\u0644 \u062e\u0648\u062f \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f"),Object(A.a)(L,"enter_your_password","\u0631\u0645\u0632 \u0639\u0628\u0648\u0631 \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f "),Object(A.a)(L,"enter_your_password_confirmation","\u0631\u0645\u0632 \u0639\u0628\u0648\u0631 \u0631\u0627 \u062a\u06a9\u0631\u0627\u0631 \u06a9\u0646\u06cc\u062f "),Object(A.a)(L,"profiles","\u0627\u0641\u0631\u0627\u062f "),Object(A.a)(L,"firstname","\u0646\u0627\u0645"),Object(A.a)(L,"if_registered","\u0627\u06af\u0631 \u0642\u0628\u0644\u0627 \u062b\u0628\u062a \u0646\u0627\u0645 \u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f"),Object(A.a)(L,"you_can_login","\u0648\u0627\u0631\u062f \u0634\u0648\u06cc\u062f "),Object(A.a)(L,"if_not_registered","\u0627\u06af\u0631 \u062b\u0628\u062a \u0646\u0627\u0645 \u0646\u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f"),Object(A.a)(L,"you_can_sign_up","\u062b\u0628\u062a \u0646\u0627\u0645 \u06a9\u0646\u06cc\u062f"),Object(A.a)(L,"new_assignment","\u0627\u0639\u0637\u0627\u06cc \u0646\u0642\u0634 \u062c\u062f\u06cc\u062f"),Object(A.a)(L,"posts","\u067e\u0633\u062a \u0647\u0627"),Object(A.a)(L,"bookmark","\u0646\u0634\u0627\u0646"),Object(A.a)(L,"like","\u0639\u0644\u0627\u0642\u0647"),Object(A.a)(L,"follow","\u062f\u0646\u0628\u0627\u0644"),Object(A.a)(L,"share","\u0627\u0634\u062a\u0631\u0627\u06a9"),Object(A.a)(L,"social_acts","\u0639\u0645\u0644\u06af\u0631\u0647\u0627\u06cc \u0627\u062c\u062a\u0645\u0627\u0639\u06cc "),Object(A.a)(L,"channels","\u06a9\u0627\u0646\u0627\u0644 \u0647\u0627"),Object(A.a)(L,"close","\u0628\u0633\u062a\u0646"),Object(A.a)(L,"channel","\u06a9\u0627\u0646\u0627\u0644 "),Object(A.a)(L,"details","\u0634\u0631\u062d"),Object(A.a)(L,"Shoa","\u0634\u0639\u0627\u0639 "),Object(A.a)(L,"role","\u0646\u0642\u0634"),Object(A.a)(L,"Default","\u067e\u06cc\u0634 \u0641\u0631\u0636"),Object(A.a)(L,"NonDefault","\u063a\u06cc\u0631 \u067e\u06cc\u0634 \u0641\u0631\u0636 "),Object(A.a)(L,"value"," \u0645\u0642\u062f\u0627\u0631"),Object(A.a)(L,"true","\u0645\u062b\u0628\u062a"),Object(A.a)(L,"false","\u0645\u0646\u0641\u06cc"),Object(A.a)(L,"access_control_list","\u0644\u06cc\u0633\u062a \u06a9\u0646\u062a\u0631\u0644 \u062f\u0633\u062a\u0631\u0633\u06cc"),Object(A.a)(L,"access_control_form","\u0641\u0631\u0645 \u06a9\u0646\u062a\u0631\u0644 \u062f\u0633\u062a\u0631\u0633\u06cc"),Object(A.a)(L,"assignment_form","\u0641\u0631\u0645 \u0627\u0639\u0637\u0627\u06cc \u0646\u0642\u0634"),Object(A.a)(L,"comment_form","\u0646\u0638\u0631 \u0628\u062f\u0647\u06cc\u062f"),Object(A.a)(L,"post_form","\u0641\u0631\u0645 \u067e\u0633\u062a"),Object(A.a)(L,"metas","\u067e\u06cc\u0634 \u062c\u062f\u0627\u0648\u0644"),Object(A.a)(L,"shoa","\u0634\u0639\u0627\u0639"),Object(A.a)(L,"form","\u0648\u0631\u0648\u062f \u0627\u0637\u0644\u0627\u0639\u0627\u062a"),Object(A.a)(L,"choose_image","\u0627\u0646\u062a\u062e\u0627\u0628 \u0639\u06a9\u0633"),Object(A.a)(L,"logout","\u062e\u0631\u0648\u062c"),Object(A.a)(L,"more","\u0628\u06cc\u0634\u062a\u0631 ..."),Object(A.a)(L,"social","\u0627\u062c\u062a\u0645\u0627\u0639\u06cc"),Object(A.a)(L,"others","\u062f\u06cc\u06af\u0631\u0627\u0646"),Object(A.a)(L,"related","\u0645\u0631\u062a\u0628\u0637"),Object(A.a)(L,"mine","\u0645\u0646"),Object(A.a)(L,"info","\u0627\u0637\u0644\u0627\u0639\u0627\u062a"),Object(A.a)(L,"admins","\u0645\u062f\u06cc\u0631\u0627\u0646"),Object(A.a)(L,"recent_posts","\u067e\u0633\u062a \u0647\u0627\u06cc \u0627\u062e\u06cc\u0631"),Object(A.a)(L,"profile_info","\u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0641\u0631\u062f\u06cc "),Object(A.a)(L,"experties","\u062a\u062e\u0635\u0635 \u0647\u0627 \u0648 \u0645\u0647\u0627\u0631\u062a \u0647\u0627"),Object(A.a)(L,"new_experties","\u0627\u0641\u0632\u0648\u062f\u0646 \u062a\u062e\u0635\u0635"),Object(A.a)(L,"notifications","\u0622\u06af\u0627\u0647\u0633\u0627\u0632\u06cc \u0647\u0627"),Object(A.a)(L,"enter_your_name","\u0646\u0627\u0645 \u062e\u0648\u062f \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f"),Object(A.a)(L,"enter_your_surename","\u0646\u0627\u0645 \u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc \u062e\u0648\u062f \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f"),Object(A.a)(L,"incomplete_data","\u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0646\u0627\u0642\u0635"),Object(A.a)(L,"alert","\u0622\u06cc\u0627 \u0627\u0637\u0645\u06cc\u0646\u0627\u0646 \u062f\u0627\u0631\u06cc\u062f\u061f"),Object(A.a)(L,"followers","\u062f\u0646\u0628\u0627\u0644 \u06a9\u0646\u0646\u062f\u06af\u0627\u0646"),Object(A.a)(L,"followees","\u062f\u0646\u0628\u0627\u0644 \u0634\u0648\u0646\u062f\u06af\u0627\u0646"),Object(A.a)(L,"verification","\u0627\u062d\u0631\u0627\u0632 \u0647\u0648\u06cc\u062a"),Object(A.a)(L,"verification_code","\u06a9\u062f \u0627\u062d\u0631\u0627\u0632"),Object(A.a)(L,"enter_verification_code","\u06a9\u062f \u0627\u062d\u0631\u0627\u0632 \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f"),Object(A.a)(L,"faculty","\u062f\u0627\u0646\u0634\u06a9\u062f\u0647"),Object(A.a)(L,"enter_your_faculty","\u0646\u0627\u0645 \u062f\u0627\u0646\u0634\u06a9\u062f\u0647 \u062e\u0648\u062f \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f"),Object(A.a)(L,"new_post","\u067e\u0633\u062a \u062c\u062f\u06cc\u062f"),Object(A.a)(L,"full_list","\u0644\u06cc\u0633\u062a \u06a9\u0627\u0645\u0644"),Object(A.a)(L,"privacy_settings","\u062d\u0631\u06cc\u0645 \u062e\u0635\u0648\u0635\u06cc"),Object(A.a)(L,"global_settings","\u062a\u0646\u0638\u06cc\u0645\u0627\u062a \u0639\u0645\u0648\u0645\u06cc"),Object(A.a)(L,"message","\u067e\u06cc\u0627\u0645"),Object(A.a)(L,"completed_successfully","\u0628\u0627 \u0645\u0648\u0641\u0642\u06cc\u062a \u0627\u0646\u062c\u0627\u0645 \u0634\u062f"),Object(A.a)(L,"cas","\u0627\u062d\u0631\u0627\u0632 \u0647\u0648\u06cc\u062a \u0645\u0631\u06a9\u0632\u06cc"),Object(A.a)(L,"in_reply_to","\u062f\u0631 \u067e\u0627\u0633\u062e \u0628\u0647"),Object(A.a)(L,"notification_settings","\u062a\u0646\u0638\u06cc\u0645\u0627\u062a \u0622\u06af\u0627\u0647\u0633\u0627\u0632\u06cc"),Object(A.a)(L,"add_comment_to_posts","\u0627\u0641\u0632\u0648\u062f\u0646 \u0646\u0638\u0631 \u0628\u0647 \u067e\u0633\u062a"),Object(A.a)(L,"add_comment_to_followed_posts","\u0627\u0641\u0632\u0648\u062f\u0646 \u0646\u0638\u0631 \u0628\u0647 \u067e\u0633\u062a \u0647\u0627\u06cc \u062f\u0646\u0628\u0627\u0644 \u0634\u062f\u0647"),Object(A.a)(L,"remove_comments_from_posts","\u062d\u0630\u0641 \u0646\u0638\u0631 \u0627\u0632 \u067e\u0633\u062a"),Object(A.a)(L,"add_likes_to_posts","\u0627\u0628\u0631\u0627\u0632 \u0639\u0644\u0627\u0642\u0647 \u0628\u0647 \u067e\u0633\u062a"),Object(A.a)(L,"remove_likes_from_posts","\u062d\u0630\u0641 \u0627\u0628\u0631\u0627\u0632 \u0639\u0644\u0627\u0642\u0647 \u0628\u0647 \u067e\u0633\u062a"),Object(A.a)(L,"add_bookmarks_to_posts","\u0627\u0641\u0632\u0648\u062f\u0646 \u0646\u0634\u0627\u0646 \u0628\u0647 \u067e\u0633\u062a"),Object(A.a)(L,"remove_bookmarks_from_posts","\u062d\u0630\u0641 \u0646\u0634\u0627\u0646 \u0627\u0632 \u067e\u0633\u062a"),Object(A.a)(L,"add_follows_to_posts","\u062f\u0646\u0628\u0627\u0644 \u06a9\u0631\u062f\u0646 \u067e\u0633\u062a"),Object(A.a)(L,"remove_follows_from_posts","\u062f\u0646\u0628\u0627\u0644 \u0646\u06a9\u0631\u062f\u0646 \u067e\u0633\u062a"),Object(A.a)(L,"add_shares_to_posts","\u0628\u0627\u0632\u0646\u0634\u0631 \u067e\u0633\u062a"),Object(A.a)(L,"remove_shares_from_posts","\u0639\u062f\u0645 \u0628\u0627\u0632\u0646\u0634\u0631 \u067e\u0633\u062a"),Object(A.a)(L,"add_likes_to_channels","\u0627\u0628\u0631\u0627\u0632 \u0639\u0644\u0627\u0642\u0647 \u0628\u0647 \u06a9\u0627\u0646\u0627\u0644"),Object(A.a)(L,"remove_likes_from_channels","\u062d\u0630\u0641 \u0627\u0628\u0631\u0627\u0632 \u0639\u0644\u0627\u0642\u0647 \u0628\u0647 \u06a9\u0627\u0646\u0627\u0644"),Object(A.a)(L,"add_bookmarks_to_channels","\u0646\u0634\u0627\u0646 \u06a9\u0631\u062f\u0646 \u06a9\u0627\u0646\u0627\u0644"),Object(A.a)(L,"remove_bookmarks_from_channels","\u0639\u062f\u0645 \u0646\u0634\u0627\u0646 \u06a9\u0627\u0646\u0627\u0644"),Object(A.a)(L,"add_follows_to_channels","\u062f\u0646\u0628\u0627\u0644 \u06a9\u0631\u062f\u0646 \u06a9\u0627\u0646\u0627\u0644"),Object(A.a)(L,"remove_follows_from_channels","\u0639\u062f\u0645 \u062f\u0646\u0628\u0627\u0644 \u06a9\u0631\u062f\u0646 \u06a9\u0627\u0646\u0627\u0644"),Object(A.a)(L,"add_post_to_channels","\u0627\u0641\u0632\u0648\u062f\u0646 \u067e\u0633\u062a \u0628\u0647 \u06a9\u0627\u0646\u0627\u0644"),Object(A.a)(L,"notification_type","\u0646\u0648\u0639 \u0622\u06af\u0627\u0647\u0633\u0627\u0632\u06cc"),Object(A.a)(L,"mail_notification","\u0627\u06cc\u0645\u06cc\u0644"),Object(A.a)(L,"push_notification","\u0648\u0628"),Object(A.a)(L,"sms","\u067e\u06cc\u0627\u0645\u06a9"),Object(A.a)(L,"NonPrivate","\u0639\u0645\u0648\u0645\u06cc"),Object(A.a)(L,"Private","\u062e\u0635\u0648\u0635\u06cc"),Object(A.a)(L,"privacy","\u062d\u0631\u06cc\u0645 \u062e\u0635\u0648\u0635\u06cc"),Object(A.a)(L,"profile","\u067e\u0631\u0648\u0641\u0627\u06cc\u0644"),Object(A.a)(L,"dashboard","\u0645\u06cc\u0632\u06a9\u0627\u0631"),Object(A.a)(L,"user_settings","\u062a\u0646\u0638\u06cc\u0645\u0627\u062a \u06a9\u0627\u0631\u0628\u0631"),Object(A.a)(L,"change_role","\u062a\u063a\u06cc\u06cc\u0631 \u0646\u0642\u0634"),Object(A.a)(L,"bookmarks","\u0646\u0634\u0627\u0646 \u06af\u0630\u0627\u0631\u06cc \u0647\u0627"),Object(A.a)(L,"rooms","\u0646\u0634\u0633\u062a \u0647\u0627"),L),x=n(3),R=new(function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).list=[],e.instance=null,e.klass=null,e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"listModel",value:function(e){this.list=[],this.klass=e.klass;for(var t=0,n=e.data.length;t<n;++t)this.list.push(e.data[t]),t===n-1&&this.emit("got_list");0==e.data.length&&this.emit("got_list")}},{key:"showIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("got_instance")}},{key:"setIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("set_instance")}},{key:"deleteIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("deleted_instance")}},{key:"postFile",value:function(e){console.log(e),this.klass=e.klass,this.instance=e.data,this.emit("file_posted")}},{key:"getIntance",value:function(){return this.instance}},{key:"getList",value:function(){return this.list}},{key:"getListnKlass",value:function(){return[this.list,this.klass]}},{key:"getKlass",value:function(){return this.klass}},{key:"handleActions",value:function(e){switch(e.type){case"LIST_MODEL_SUCCESS":this.listModel(e.list);break;case"GET_INSTANCE_SUCCESS":this.showIntance(e.instance);break;case"DELETE_INSTANCE_SUCCESS":this.deleteIntance(e.instance);break;case"SET_INSTANCE_SUCCESS":this.setIntance(e.instance);break;case"POST_FILE_SUCCESS":this.postFile(e.instance)}}}]),t}(n(128).EventEmitter));v.register(R.handleActions.bind(R));var V=R,M=(n(91),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).logout=e.logout.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.check_ability=e.check_ability.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),ability:null,profileId:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"logout",value:function(){this.setState({token:null}),window.localStorage.removeItem("token"),window.location.replace("/")}},{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.getInstance)}},{key:"componentDidMount",value:function(){this.state.token&&this.state.token.length>10&&S("users","role",this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"UserRole"===t&&this.setState({ability:e.the_ability,roles:e.the_roles,profileId:e.profile_id})}},{key:"check_ability",value:function(e,t,n){var a=[];return this.state.ability&&this.state.ability.map((function(o){o.title===e&&o.value&&a.push(i.a.createElement(l.t,{link:"/"+t+"/",ignoreCache:!0,key:"panel"+t,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-"+n}),i.a.createElement("span",null,N[t])))})),a}},{key:"changeRole",value:function(e){O("users/change_role",{role_id:e},this.state.token)}},{key:"profile",value:function(){if(this.state.profileId)return i.a.createElement(l.t,{link:"/profiles/"+this.state.profileId,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-user-circle-o"}),i.a.createElement("span",null,N.profile))}},{key:"roles",value:function(){var e=[];return this.state.roles&&this.state.roles.map((function(t){t.current?e.push(i.a.createElement("option",{value:t.id,key:"role"+t.id,selected:!0},t.title)):e.push(i.a.createElement("option",{value:t.id,key:"role"+t.id},t.title))})),e}},{key:"logged_in",value:function(e){var t=this;return e?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null," ",i.a.createElement("i",{className:"va ml-5 fa fa-tachometer"}),N.dashboard),i.a.createElement(l.r,{className:"fs-13"},i.a.createElement(l.t,{link:"/posts/",ignoreCache:!1,reloadCurrent:!1,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-pencil"}),i.a.createElement("span",null,N.posts)),i.a.createElement(l.t,{link:"/channels/",ignoreCache:!1,reloadCurrent:!1,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-bullhorn"}),i.a.createElement("span",null,N.channels)),i.a.createElement(l.t,{link:"/notifications/",ignoreCache:!1,reloadCurrent:!1,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-circle-o-notch"}),i.a.createElement("span",null,N.notifications)),i.a.createElement(l.t,{link:"/bookmarks/",ignoreCache:!1,reloadCurrent:!1,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-bookmark"}),i.a.createElement("span",null,N.bookmarks)),this.check_ability("view_rooms","rooms","vcard")),i.a.createElement(l.g,null,i.a.createElement("i",{className:"va ml-5 fa fa-cogs"}),N.user_settings),i.a.createElement(l.r,null,i.a.createElement(l.t,{link:"/privacy_settings/",ignoreCache:!0,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-user-secret"}),i.a.createElement("span",null,N.privacy_settings)),i.a.createElement(l.t,{link:"/notification_settings/",ignoreCache:!0,view:"#main-view",panelClose:!0},i.a.createElement("i",{className:"va ml-5 fa fa-cog"}),i.a.createElement("span",null,N.notification_settings)),this.profile(),i.a.createElement("li",{className:""},i.a.createElement("a",{className:"item-link panel-close smart-select smart-select-init","data-open-in":"popover"},i.a.createElement("select",{name:"superhero",onChange:function(e){t.changeRole(e.target.value)}},this.roles()),i.a.createElement("div",{className:"item-content"},i.a.createElement("div",{className:"item-inner"},i.a.createElement("div",{className:"item-title"},N.change_role))))),i.a.createElement(l.t,{view:"#main-view",panelClose:!0,onClick:this.logout},i.a.createElement("i",{className:"va ml-5 fa fa-power-off"}),i.a.createElement("span",null,N.logout))),i.a.createElement(l.g,null," ",i.a.createElement("i",{className:"va ml-5 fa fa-cog"}),N.settings),i.a.createElement(l.r,{className:"fs-13"},this.check_ability("change_role","roles","shield"))):i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.user_settings),i.a.createElement(l.r,null,i.a.createElement(l.t,{link:"/login/",title:N.login,view:"#main-view",panelClose:!0})))}},{key:"render",value:function(){var e=this.state.token;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.tavan}),this.logged_in(e))}}]),t}(a.Component)),P=function(e){var t=[i.a.createElement("option",{value:""})];if(e.content)for(var n=0;n<e.content.length;n++)t.push(i.a.createElement("option",{value:e.content[n].content[0].fid},e.content[n].content[0].value));return t},q=function(e){if(e.meta&&e.meta.meta_schema){for(var t=e.meta.meta_schema,n=[],a=function(a){switch(t[a].type){case"String":n.push(i.a.createElement(l.s,{label:t[a].label,type:"text",placeholder:"...",onInput:function(n){return e.onChangeValue(t[a].fid,n.target.value,e.meta.id)}}));break;case"Text":n.push(i.a.createElement(l.s,{label:t[a].name,type:"textarea",placeholder:"...",onInput:function(n){return e.onChangeValue(t[a].fid,n.target.value,e.meta.id)}}));break;case"Table":t[a].content&&n.push(i.a.createElement(l.t,{title:t[a].content.title,smartSelect:!0,smartSelectParams:{pageBackLinkText:N.back}},i.a.createElement("select",{name:"content",onChange:function(n){return e.onChangeValue(t[a].fid,n.target.value,e.meta.id)}},i.a.createElement(P,{content:t[a].content}))))}},o=0;o<t.length;o++)a(o);var r=null;return e.submit&&(r=i.a.createElement(l.k,null,i.a.createElement(l.q,null),i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit))),i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.form," ",e.meta.label),i.a.createElement(l.r,{form:!0},n,r))}return i.a.createElement("div",null)},W=n(9),U=n.n(W),F=function(e){var t=e.meta.meta_schema;if(e.meta&&e.actuals){for(var n=[i.a.createElement(l.g,null,e.meta.label)],a=[],o=e.actuals,r=function(r){c=o[r].content,a=[];for(var s=0;s<c.length;s++)a.push(i.a.createElement(l.s,{key:U.a.lib.WordArray.random(32),label:c[s].label,type:"text",defaultValue:c[s].value})),e.editable&&c[s]&&s==t.length-1&&e.meta.id==c[s].metaId&&a.push(i.a.createElement(l.h,{color:"gray",onClick:function(){return e.removeActual(o[r].uuid)}},i.a.createElement(l.p,{ios:"f7:trash",aurora:"f7:trash",md:"material:trash"})));n.push(i.a.createElement(l.i,null,i.a.createElement(l.r,{key:U.a.lib.WordArray.random(32)},a)))},s=0;s<o.length;s++){var c;r(s)}return i.a.createElement(i.a.Fragment,null,n)}return i.a.createElement("div",null)},G=n(129),$=n.n(G),B=function(e){return e.meta?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.title,": ",e.meta.title),i.a.createElement(l.r,{"simple-list":!0},i.a.createElement(l.t,{className:""},i.a.createElement($.a,{id:"json-pretty",data:JSON.stringify(e.meta.meta_schema)})))),i.a.createElement(F,{meta:e.meta,editable:!0,actuals:e.meta.actuals,removeActual:e.removeActual}),i.a.createElement(q,{meta:e.meta,submit:e.submit,onChangeValue:e.handleChangeValue})):null},J=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.submit=e.submit.bind(Object(x.a)(e)),e.removeActual=e.removeActual.bind(Object(x.a)(e)),e.state={meta:null,metaId:null,token:window.localStorage.getItem("token"),fields:[]},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.getInstance),V.on("deleted_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.getInstance),V.removeListener("deleted_instance",this.getInstance)}},{key:"componentDidMount",value:function(){S("metas",this.$f7route.params.metaId)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Meta"===t&&this.setState({meta:e,metaId:e.id})}},{key:"handleChangeValue",value:function(e,t){var n=this.state.fields;if(n.length>0)for(var a=0;a<n.length;a++)if(n[a].fid&&n[a].fid===e){var i=Object.assign({},this.state);i.fields[a]={fid:e,value:t},this.setState(i)}else this.setState({fields:this.state.fields.concat({fid:e,value:t})});else this.setState({fields:this.state.fields.concat({fid:e,value:t})})}},{key:"removeActual",value:function(e){C("actuals",{uuid:e})}},{key:"submit",value:function(){O("actuals",{meta_id:this.state.metaId,content:this.state.fields},this.state.token)}},{key:"fab",value:function(){if(this.state.meta)return i.a.createElement(l.o,{href:"/metas/"+this.state.meta.id+"/edit",target:"#main-view",position:"left-bottom",slot:"fixed",color:"lime"},i.a.createElement(l.p,{ios:"f7:edit",aurora:"f7:edit",md:"material:edit"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"}))}},{key:"render",value:function(){var e=this.state.meta;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.metas,backLink:N.back}),i.a.createElement(l.g,null),this.fab(),i.a.createElement(B,{meta:e,removeActual:this.removeActual,handleChangeValue:this.handleChangeValue,submit:this.submit}))}}]),t}(a.Component),z=function(e){return e.metas?i.a.createElement(l.r,{mediaList:!0},e.metas.map((function(e){return i.a.createElement(l.t,{key:U.a.lib.WordArray.random(32),link:"/metas/"+e.id,ignoreCache:!0,title:e.title,after:"",subtitle:"",text:""})}))):i.a.createElement("ul",null)},K=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.metas,backLink:N.back}),i.a.createElement(l.g,null,N.list),i.a.createElement(l.o,{href:"/metas/new",target:"#main-view",position:"left-bottom",slot:"fixed",color:"deeporange"},i.a.createElement(l.p,{ios:"f7:add",aurora:"f7:add",md:"material:add"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"})),i.a.createElement(z,{metas:e.metas}))},H=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.state={metas:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),_("metas",this.state.page)}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Meta"===t&&this.setState({metas:e})}},{key:"render",value:function(){var e=this.state.metas;return i.a.createElement(K,{metas:e})}}]),t}(i.a.Component),Q=function(e){return i.a.createElement(l.i,null,i.a.createElement(l.r,{form:!0},i.a.createElement(l.s,{label:N.title,type:"text",placeholder:"...",defaultValue:e.meta.title,onInput:function(t){e.handleChange({title:t.target.value})}}),i.a.createElement(l.s,{label:N.label,type:"text",placeholder:"...",defaultValue:e.meta.label,onInput:function(t){e.handleChange({label:t.target.value})}}),i.a.createElement(l.s,{label:"Schema",type:"text",inputStyle:{direction:"ltr"},defaultValue:JSON.stringify(e.meta.meta_schema),placeholder:"JSON",onInput:function(t){e.handleChange({metaSchema:t.target.value})}})),i.a.createElement(l.k,null,i.a.createElement(l.q,null),i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit)))},Y=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),meta:{},metaSchema:null,title:null,label:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){O("metas",{title:this.state.title,label:this.state.label,meta_schema:this.state.metaSchema},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/metas/")}},{key:"render",value:function(){var e=this.state.meta;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.meta_form,backLink:N.back}),i.a.createElement(l.g,null,N.meta_form),i.a.createElement(Q,{meta:e,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component),X=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.state={meta:{},title:null,metaSchema:null,id:null,label:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){j("metas",{id:this.state.id,title:this.state.title,label:this.state.label,meta_schema:this.state.metaSchema})}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),this.$f7route.params.metaId&&S("metas",this.$f7route.params.metaId)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();console.log(e),e&&"Meta"===t&&this.setState({title:e.title,id:e.id,meta:e,metaSchema:e.metaSchema,label:e.label})}},{key:"handleChangeValue",value:function(e){console.log(e),this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/metas/")}},{key:"render",value:function(){var e=this.state.meta;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.meta_form,backLink:N.back}),i.a.createElement(l.g,null,N.meta_form),i.a.createElement(Q,{meta:e,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component),Z=(n(292),n(16)),ee=n(40),te=function(e){return e.model?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.a,{id:"actions-two-groups-"+e.model.id},i.a.createElement(l.c,null,i.a.createElement(l.d,null,N.social_acts),i.a.createElement(l.b,{onClick:function(){return e.interaction("Bookmark",e.model.id,e.klass,e.sourceType,e.sourceId)}},i.a.createElement("i",{className:"va ml-5 fa fa-bookmark"}),N.bookmark," (",e.model.bookmarks,")"),i.a.createElement(l.b,{onClick:function(){return e.interaction("Like",e.model.id,e.klass,e.sourceType,e.sourceId)}},i.a.createElement("i",{className:"va ml-5 fa fa-heart"}),N.like," (",e.model.likes,")"),i.a.createElement(l.b,{onClick:function(){return e.interaction("Follow",e.model.id,e.klass,e.sourceType,e.sourceId)}},i.a.createElement("i",{className:"va ml-5 fa fa-link"}),N.follow," (",e.model.follows,")")),i.a.createElement(l.c,null,i.a.createElement(l.b,{color:"red"},N.cancel))),i.a.createElement(l.h,{tooltip:N.social_acts,className:"col",href:!1,actionsOpen:"#actions-two-groups-"+e.model.id},i.a.createElement("i",{className:"va fa fa-users"}))):null},ne=function(e){if(e.model){if(e.channels)for(var t=[],n=0;n<e.channels.length;n++)t.push(i.a.createElement("option",{value:e.channels[n].id},e.channels[n].title));return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.B,{className:"demo-sheet",opened:e.sheetOpened,onSheetClosed:function(){e.handleChange({sheetOpened:!1})}},i.a.createElement(l.H,null,i.a.createElement("div",{className:"left"}),i.a.createElement("div",{className:"right"},i.a.createElement(l.q,{sheetClose:!0},N.close))),i.a.createElement(l.x,null,i.a.createElement(l.r,null,i.a.createElement(l.s,{label:N.channel,type:"select",onChange:function(t){e.handleChange({selectedChannel:t.target.value})}},t)),i.a.createElement(l.f,{strong:!0},i.a.createElement(l.z,{tag:"p"},i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit))))),i.a.createElement(l.h,{className:"col",href:!1,sheetOpen:".demo-sheet"},i.a.createElement("i",{class:"va fa fa-retweet"})))}return null},ae=function(e){return i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.comment_form," ",function(){if(e.replyTo){var t="";return e.comments.map((function(n){n.id===e.replyTo&&(t=n.content)})),i.a.createElement(l.m,{text:N.in_reply_to+": "+t.substring(0,20),deleteable:!0,onClick:e.removeReply})}}()),i.a.createElement(l.r,null,i.a.createElement(l.s,{label:N.comment,inputId:"cm-form-"+e.rnd,type:"textarea",placeholder:"...",maxlength:"300",resizable:!0,clearButton:!0,onInput:function(t){e.handleChange({commentContent:t.target.value})}})),i.a.createElement(l.k,null,i.a.createElement(l.q,null),i.a.createElement(l.q,{className:"btn-notice"}),i.a.createElement(l.h,{className:"col btn",fill:!0,onClick:e.submit},N.submit)))},ie=n(31),oe=n.n(ie),re=(n(38),n(39),function(e){var t=[];function n(t){var n=[];return t.editable&&n.push(i.a.createElement(l.q,{onClick:function(){return e.deleteCommentConfirm(t.id)}},i.a.createElement("i",{className:"va ml-5 fa fa-trash"}))),n.push(i.a.createElement(l.q,{onClick:function(){return e.replyToComment(t.id)}},i.a.createElement("i",{className:"va ml-5 fa fa-reply"}))),n}function a(e){var t=[i.a.createElement("span",null,e.profile.fullname,": ")];return e.reply_to&&t.push(i.a.createElement("span",{className:"fs-10 f-color-gray"},N.in_reply_to," ",e.reply_to)),t}if(e.comments){for(var o=0;o<e.comments.length;o++){var r=new Date(new window.ODate(e.comments[o].created_at)),s=i.a.createElement(i.a.Fragment,null,n(e.comments[o]),i.a.createElement(oe.a,{locale:"fa",fromNow:!0,ago:!0},r),N.ago);t.push(i.a.createElement(l.t,{key:"comment"+e.comments[o].id,className:"fs-10",id:"cm-"+e.comments[o].id,text:s,title:a(e.comments[o]),subtitle:e.comments[o].content},i.a.createElement("img",{slot:"media",src:e.comments[o].profile.avatar,width:"44",height:"44"})))}return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.comments),i.a.createElement(l.r,{mediaList:!0,inset:!0},t),i.a.createElement(l.z,{noGap:!0},i.a.createElement(l.n,null),i.a.createElement(l.n,{className:"center"},i.a.createElement("a",{className:"gray-color",onClick:function(){return e.loadMore()}},N.more)),i.a.createElement(l.n,null)),i.a.createElement(l.g,null))}return i.a.createElement(l.g,null)}),se=n(77),le=n.n(se),ce=function(e){if(e.post&&e.post.draft){var t,n=function(t){return e.post.rating>=t?i.a.createElement("i",{class:"fa fa-star","aria-hidden":"true"}):i.a.createElement("i",{class:"fa fa-star-o","aria-hidden":"true"})},a=Object(Z.convertFromRaw)(e.post.draft),o=Z.EditorState.createWithContent(a);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.f,null,i.a.createElement(l.z,null,i.a.createElement(l.n,{width:"50",tabletWidth:"60"}),function(){if(e.deletable)return i.a.createElement(l.n,{width:"25",tabletWidth:"10",className:"ml-5"},i.a.createElement(l.h,{fill:!0,color:"red",onClick:function(){return e.deletePostConfirm()}},i.a.createElement("i",{class:"fa fa-trash-o","aria-hidden":"true"})))}(),i.a.createElement(l.n,{width:"25",tabletWidth:"15",className:"ml-5"},i.a.createElement(l.h,{tooltip:N.share,fill:!0},i.a.createElement(ne,(t={model:e.post,submit:e.submit,channels:e.channels,klass:"Post",sheetOpened:e.sheetOpened,handleChange:e.handleChange},Object(A.a)(t,"klass","Channel"),Object(A.a)(t,"interaction",e.interaction),t)))),i.a.createElement(l.n,{width:"25",tabletWidth:"15"},i.a.createElement(l.h,{tooltip:N.social_acts,fill:!0},i.a.createElement(te,{model:e.post,klass:"Post",interaction:e.interaction}))))),i.a.createElement(l.g,null,N.title),i.a.createElement(l.r,{"simple-list":!0},i.a.createElement(l.t,null,e.post.title)),function(){if(e.post.content.length>1)return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.content),i.a.createElement(ee.Editor,{editorState:o,toolbar:{options:[]},readOnly:!0}))}(),i.a.createElement(l.f,{strong:!0},i.a.createElement("a",{onClick:function(){return e.rating(1)}},n(1)),i.a.createElement("a",{onClick:function(){return e.rating(2)}},n(2)),i.a.createElement("a",{onClick:function(){return e.rating(3)}},n(3)),i.a.createElement("a",{onClick:function(){return e.rating(4)}},n(4)),i.a.createElement("a",{onClick:function(){return e.rating(5)}},n(5)),i.a.createElement("span",{className:"fs-11 mr-2"},"(",e.post.rated,")")),i.a.createElement(ae,{model:e.post,submit:e.submitComment,handleChange:e.handleChange,replyTo:e.replyTo,comments:e.comments,removeReply:e.removeReply,rnd:e.rnd}),i.a.createElement(re,{comments:e.comments,deleteCommentConfirm:e.deleteCommentConfirm,replyToComment:e.replyToComment}))}return null};function ue(){if(window.localStorage.getItem("token"))return!0;window.localStorage.setItem("url",window.location.href),this.$f7router.navigate("/login/")}var de=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.interaction=e.interaction.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.loggedIn=ue.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.submit=e.submit.bind(Object(x.a)(e)),e.submitComment=e.submitComment.bind(Object(x.a)(e)),e.deleteComment=e.deleteComment.bind(Object(x.a)(e)),e.deleteCommentConfirm=e.deleteCommentConfirm.bind(Object(x.a)(e)),e.replyToComment=e.replyToComment.bind(Object(x.a)(e)),e.removeReply=e.removeReply.bind(Object(x.a)(e)),e.loadMore=e.loadMore.bind(Object(x.a)(e)),e.rating=e.rating.bind(Object(x.a)(e)),e.deletePost=e.deletePost.bind(Object(x.a)(e)),e.deletePostConfirm=e.deletePostConfirm.bind(Object(x.a)(e)),e.state={post:null,id:null,page:1,channels:null,selectedChannel:null,channelId:null,sheetOpened:!1,commentContent:"",comments:null,token:window.localStorage.getItem("token"),rnd:U.a.lib.WordArray.random(32),replyTo:null,deletable:!1},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance),V.on("got_list",this.getList),V.on("deleted_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance),V.removeListener("got_list",this.getList),V.removeListener("deleted_instance",this.getInstance)}},{key:"componentDidMount",value:function(){this.loggedIn(),S("posts",this.$f7route.params.postId,this.state.token),_("channels/my",this.state.page,{},this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Post"===t&&this.setState({post:e,id:e.id,comments:e.comments,deletable:e.deletable}),"PostDelete"===t&&this.$f7router.navigate("/posts/")}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Channel"===t&&this.setState({channels:e}),e&&e[0]&&"Channel"===t&&this.setState({channelId:e[0].id})}},{key:"setInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Post"===t&&this.setState({post:e,comments:e.comments,page:1}),this.$$("#cm-form-"+this.state.rnd).val("")}},{key:"loadMore",value:function(){var e=this;this.setState({page:this.state.page+1},(function(){S("posts",e.$f7route.params.postId,e.state.token,e.state.page)}))}},{key:"fab",value:function(){if(this.state.post)return i.a.createElement(l.o,{href:"/posts/"+this.state.post.id+"/edit",target:"#main-view",position:"left-bottom",slot:"fixed",color:"lime"},i.a.createElement(l.p,{ios:"f7:edit",aurora:"f7:edit",md:"material:edit"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"}))}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"interaction",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o={interaction_type:e,interactionable_id:t,interactionable_type:n,source_type:a,source_id:i};O("interactions",o,this.state.token)}},{key:"rating",value:function(e){console.log("value: ",e),O("ratings",{post_id:this.state.id,value:e},this.state.token)}},{key:"submit",value:function(){O("shares",{post_id:this.state.id,channel_id:this.state.selectedChannel},this.state.token);this.$f7.sheet.close(".demo-sheet")}},{key:"submitComment",value:function(){O("comments",{post_id:this.state.id,content:this.state.commentContent,reply_id:this.state.replyTo},this.state.token)}},{key:"deleteCommentConfirm",value:function(e){var t=this;t.$f7.dialog.confirm(N.are_you_sure,N.alert,(function(){return t.deleteComment(e)}))}},{key:"deleteComment",value:function(e){C("comments",{id:e},this.state.token,this.state.page)}},{key:"replyToComment",value:function(e){this.setState({replyTo:e}),this.$$("#cm-form-"+this.state.rnd).focus()}},{key:"removeReply",value:function(){this.setState({replyTo:null})}},{key:"deletePost",value:function(){C("posts",{id:this.state.id},this.state.token,this.state.page)}},{key:"deletePostConfirm",value:function(){var e=this;e.$f7.dialog.confirm(N.are_you_sure,N.alert,(function(){return e.deletePost()}))}},{key:"render",value:function(){var e=this.state,t=e.post,n=(e.sheetOpened,e.channels),a=e.comments,o=(e.rating,e.rnd),r=e.replyTo,s=e.deletable;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.posts,backLink:N.back}),i.a.createElement(l.g,null),this.fab(),i.a.createElement(ce,{post:t,comments:a,rating:this.rating,rnd:o,channels:n,submitComment:this.submitComment,replyTo:r,deleteComment:this.deleteComment,submit:this.submit,deleteCommentConfirm:this.deleteCommentConfirm,replyToComment:this.replyToComment,removeReply:this.removeReply,deletable:s,interaction:this.interaction,handleChange:this.handleChangeValue,loadMore:this.loadMore,deletePost:this.deletePost,deletePostConfirm:this.deletePostConfirm}))}}]),t}(a.Component),me=function(e){return e.posts&&e.posts.length>0?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.z,{noGap:!0},e.posts.map((function(e){return i.a.createElement(l.n,{width:"100",tabletWidth:"33",key:U.a.lib.WordArray.random(16)},i.a.createElement(l.i,{className:"demo-facebook-card"},i.a.createElement(l.l,{className:"no-border"},i.a.createElement("div",{className:"demo-facebook-avatar"},i.a.createElement(l.q,{tooltip:e.profile.fullname,href:"/profiles/"+e.profile.id},i.a.createElement("img",{src:e.profile.avatar,height:"34"}))),i.a.createElement("div",{className:"demo-facebook-name "},i.a.createElement("div",{className:"demo-facebook-profile "},i.a.createElement(l.q,{className:"gray-color",href:"/profiles/"+e.profile.id},e.profile.fullname.substring(0,60))),i.a.createElement(l.q,{tooltip:e.title,className:"gray-color",href:"/posts/"+e.id},e.title.substring(0,20)+".."))),i.a.createElement(l.j,{className:"lightgray-color fs-12"},e.content.substring(0,150)+"..."),i.a.createElement(l.k,null,i.a.createElement("div",{className:"fs-10"},i.a.createElement("i",{className:"va fa fa-bookmark"}),"(",e.bookmarks,")",i.a.createElement("i",{className:"va fa fa-heart"}),"(",e.likes,")",i.a.createElement("i",{className:"va fa fa-link"}),"(",e.follows,")",i.a.createElement("i",{className:"va fa fa-star"}),"(",e.ratings_count,")",i.a.createElement("i",{className:"va fa fa-comment"}),"(",e.comments_count,")"),i.a.createElement(l.q,{className:"gray-color fs-10",href:"/posts/"+e.id},N.view,i.a.createElement("i",{className:"va fa fa-arrow-left mr-2"})))))})))):i.a.createElement("ul",null)},he=function(e){return i.a.createElement(l.w,{infinite:!0,infinitePreloader:e.showPreloader,onInfinite:e.loadMore},i.a.createElement(l.v,{title:N.posts},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"})),i.a.createElement(l.D,{inner:!1},i.a.createElement(l.A,{disableButtonText:N.cancel,placeholder:N.search,onChange:function(t){e.search({query:t.target.value})}}))),function(t){var n=[];return e.ability&&e.ability.map((function(e){e.title===t&&e.value&&n.push(i.a.createElement(l.o,{href:"/posts/new",target:"#main-view",position:"left-bottom",slot:"fixed",color:"deeporange"},i.a.createElement(l.p,{ios:"f7:add",aurora:"f7:add",md:"material:add"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"})))})),n}("new_post"),i.a.createElement("div",{style:{marginTop:"100px;"}},"|"),i.a.createElement(l.g,null),i.a.createElement(l.f,null,i.a.createElement(me,{posts:e.posts,interaction:e.interaction,loadMore:e.loadMore})))},fe=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.loggedIn=ue.bind(Object(x.a)(e)),e.interaction=e.interaction.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.search=e.search.bind(Object(x.a)(e)),e.loadMore=e.loadMore.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),posts:[],query:null,page:1,ability:null,profileId:null,allowInfinite:!0,showPreloader:!0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList),V.on("set_instance",this.setInstance),V.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList),V.removeListener("set_instance",this.setInstance),V.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){this.loggedIn(),this.loadData()}},{key:"loadData",value:function(){_("posts",this.state.page,{},this.state.token),S("users","role",this.state.token)}},{key:"search",value:function(e){var t=this;this.setState({posts:[],page:1}),this.setState(e,(function(){_("posts/search",t.state.page,{q:t.state.query},t.state.token)}))}},{key:"setInstance",value:function(){var e=V.getIntance();e&&this.setState({posts:this.state.posts.map((function(t){return t.id===e.id?Object.assign({},t,e):t}))})}},{key:"loadMore",value:function(){var e=this;this.state.query&&this.state.query.length>0?this.setState({page:this.state.page+1},(function(){_("posts/search",e.state.page,{q:e.state.query},e.state.token)})):(this.setState({page:this.state.page+1},(function(){_("posts",e.state.page,{},e.state.token)})),this.setState({showPreloader:!1}))}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e.length>0&&"PostSearch"===t&&this.setState({posts:e}),e.length>0&&"Post"===t&&this.setState({posts:this.state.posts.concat(e)}),this.setState({showPreloader:!0})}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"UserRole"===t&&this.setState({ability:e.the_ability,profileId:e.profile_id})}},{key:"interaction",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o={interaction_type:e,interactionable_id:t,interactionable_type:n,source_type:a,source_id:i};O("interactions",o,this.state.token)}},{key:"render",value:function(){var e=this.state,t=e.posts,n=e.ability,a=e.showPreloader;return i.a.createElement(he,{interaction:this.interaction,loadMore:this.loadMore,posts:t,search:this.search,ability:n,showPreloader:a})}}]),t}(i.a.Component),ge=function(e){var t=[i.a.createElement("option",{value:""})];if(e.content)for(var n=0;n<e.content.length;n++)t.push(i.a.createElement("option",{value:e.content[n].id},e.content[n].title));return t},pe=n(78),ve=n.n(pe),be=function(e){if(e.post){var t=null;return e.channels&&(t=i.a.createElement(l.t,{title:N.channel,smartSelect:!0,smartSelectParams:{pageBackLinkText:N.back,searchbar:!0,searchbarPlaceholder:N.search}},i.a.createElement("select",{name:"content",defaultValue:e.channelId,onChange:function(t){e.handleChange({channelId:t.target.value})}},i.a.createElement(ge,{content:e.channels})))),i.a.createElement(i.a.Fragment,null,i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.new_post),i.a.createElement(l.r,{form:!0},t,i.a.createElement(l.s,{label:N.title+"*",type:"text",placeholder:"...",maxlength:"65",value:e.title,onInput:function(t){e.handleChange({title:t.target.value})}}),i.a.createElement(ee.Editor,{editorState:e.editorState,placeholder:N.content,localization:{locale:"fa",translations:ve.a},toolbar:{options:["inline","list","link","image"],inline:{options:["bold","italic","underline"]},image:{uploadCallback:e.uploadImageCallBack,previewImage:!0}},onEditorStateChange:e.onEditorStateChange})),i.a.createElement(l.k,null,i.a.createElement(l.q,null),i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit))))}return null};function ke(e){return new Promise((function(t,n){var a=new XMLHttpRequest;a.open("POST","http://localhost:3001/v1/uploads"),a.setRequestHeader("Authorization","Client-ID 8d26ccd12712fca");var i=new FormData;i.append("upload[image]",e),a.send(i),a.addEventListener("load",(function(){var e=JSON.parse(a.responseText);t(e)})),a.addEventListener("error",(function(){var e=JSON.parse(a.responseText);n(e)}))}))}var ye=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.onEditorStateChange=e.onEditorStateChange.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.uploadImageCallBack=ke.bind(Object(x.a)(e)),e.state={post:{},channels:null,editorState:Z.EditorState.createEmpty(),token:window.localStorage.getItem("token"),title:null,channelId:null,interaction:null,page:0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance),V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance),V.removeListener("got_list",this.getList)}},{key:"submit",value:function(){var e=Object(Z.convertToRaw)(this.state.editorState.getCurrentContent()).blocks.map((function(e){return e.text.trim()?e.text:"\n"})).join("\n"),t={title:this.state.title,content:e,channel_id:this.state.channelId,draft:Object(Z.convertToRaw)(this.state.editorState.getCurrentContent())};if(this.state.title)O("posts",t,this.state.token);else{this.$f7.dialog.alert(N.incomplete_data,N.alert)}}},{key:"onEditorStateChange",value:function(e){this.setState({editorState:e})}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){_("channels/my",this.state.page,{},this.state.token)}},{key:"componentDidUpdate",value:function(e,t){}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Channel"===t&&this.setState({channels:e})}},{key:"setInstance",value:function(){this.$f7router.navigate("/posts/")}},{key:"render",value:function(){var e=this.state,t=e.post,n=e.editorState,a=e.channels;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.post_form}),i.a.createElement(be,{post:t,channels:a,editorState:n,onEditorStateChange:this.onEditorStateChange,submit:this.submit,handleChange:this.handleChangeValue,uploadImageCallBack:this.uploadImageCallBack}))}}]),t}(a.Component),Ee=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.onEditorStateChange=e.onEditorStateChange.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.uploadImageCallBack=ke.bind(Object(x.a)(e)),e.state={post:{title:"",draft:""},editorState:Z.EditorState.createEmpty(),token:window.localStorage.getItem("token"),id:null,title:null,draft:null,page:0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance),V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance),V.removeListener("got_list",this.getList)}},{key:"submit",value:function(){var e=Object(Z.convertToRaw)(this.state.editorState.getCurrentContent()).blocks.map((function(e){return e.text.trim()?e.text:"\n"})).join("\n"),t={id:this.state.id,title:this.state.title,content:e,channel_id:this.state.channelId,draft:Object(Z.convertToRaw)(this.state.editorState.getCurrentContent())};if(this.state.title)j("posts",t,this.state.token);else{this.$f7.dialog.alert(N.incomplete_data,N.alert)}}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),this.$f7route.params.postId&&S("posts",this.$f7route.params.postId,this.state.token)}},{key:"getList",value:function(){}},{key:"getInstance",value:function(){var e=V.getIntance();if(e){var t=Object(Z.convertFromRaw)(e.draft),n=Z.EditorState.createWithContent(t);this.setState({post:e,title:e.title,id:e.id,editorState:n})}console.log(e)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"onEditorStateChange",value:function(e){this.setState({editorState:e})}},{key:"setInstance",value:function(){this.$f7router.navigate("/posts/")}},{key:"render",value:function(){var e=this.state,t=e.post,n=e.title,a=e.editorState,o=e.channels;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.post_form}),i.a.createElement(be,{post:t,title:n,channels:o,editorState:a,onEditorStateChange:this.onEditorStateChange,submit:this.submit,handleChange:this.handleChangeValue,uploadImageCallBack:this.uploadImageCallBack}))}}]),t}(a.Component),_e=function(e){if(e.notifications&&e.notifications.length>0){var t=function(e){if(!e.seen)return"bg-blonde"};return i.a.createElement(l.i,null,i.a.createElement(l.l,null),i.a.createElement(l.j,null,i.a.createElement(l.r,{mediaList:!0},e.notifications.map((function(e){return i.a.createElement(l.t,{className:"fs-11 "+t(e),key:U.a.lib.WordArray.random(32),link:"/"+e.target_type+"/"+e.target_id,title:(n=e.profile,i.a.createElement(l.q,{href:"/profiles/"},n.fullname)),text:e.notification_text.title},i.a.createElement("img",{slot:"media",src:e.profile.avatar,width:"32",height:"32"}));var n})))),i.a.createElement(l.k,null))}return i.a.createElement("ul",null)},we=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.notifications},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(_e,{notifications:e.notifications,loadMore:e.loadMore}))},Se=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.loggedIn=ue.bind(Object(x.a)(e)),e.interaction=e.interaction.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.search=e.search.bind(Object(x.a)(e)),e.loadMore=e.loadMore.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),notifications:[],query:null,page:1},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList),V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList),V.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){this.loggedIn(),this.loadData()}},{key:"loadData",value:function(){_("notifications",this.state.page,{},this.state.token)}},{key:"search",value:function(e){var t=this;this.setState({notifications:[],page:1}),this.setState(e,(function(){_("notifications/search",t.state.page,{q:t.state.query})}))}},{key:"loadMore",value:function(){var e=this;this.state.query&&this.state.query.length>0?this.setState({page:this.state.page+1},(function(){_("notifications/search",e.state.page,{q:e.state.query},e.state.token)})):this.setState({page:this.state.page+1},(function(){_("notifications",e.state.page,{},e.state.token)}))}},{key:"setInstance",value:function(){var e=V.getIntance();e&&this.setState({notifications:this.state.notifications.map((function(t){return t.id===e.id?Object.assign({},t,e):t}))})}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e.length>0&&"Notification"===t&&this.setState({notifications:this.state.notifications.concat(e)});O("notifications",{},this.state.token)}},{key:"interaction",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o={interaction_type:e,interactionable_id:t,interactionable_type:n,source_type:a,source_id:i};O("interactions",o,this.state.token)}},{key:"render",value:function(){var e=this.state.notifications;return i.a.createElement(we,{interaction:this.interaction,loadMore:this.loadMore,notifications:e,search:this.search})}}]),t}(i.a.Component),Ce=function(e){return e.channel?(console.log(e.channel.posts),i.a.createElement(i.a.Fragment,null,i.a.createElement(l.f,null,i.a.createElement(l.z,{noGap:!0},i.a.createElement(l.n,{width:"80"}),i.a.createElement(l.n,{width:"20"},i.a.createElement(l.h,null,i.a.createElement(te,{model:e.channel,klass:"Channel",interaction:e.interaction,sourceType:"Channel",sourceId:e.channel.id}))))),i.a.createElement(l.z,{noGap:!0},i.a.createElement(l.n,{width:"100",tabletWidth:"50"},i.a.createElement(l.i,null,i.a.createElement(l.l,{className:"fs-12"},e.channel.title),i.a.createElement(l.j,{className:"lightgray-color fs-12"},e.channel.content))),i.a.createElement(l.n,{width:"100",tabletWidth:"50"},i.a.createElement(l.i,null,i.a.createElement(l.l,{className:"fs-12"},N.admins),i.a.createElement(l.j,null,i.a.createElement(l.q,{tooltip:e.channel.profile.fullname,href:"/profiles/"+e.channel.profile.id},i.a.createElement("div",{className:"demo-facebook-avatar"},i.a.createElement("img",{src:e.channel.profile.avatar,width:"34",height:"34"}))))))),i.a.createElement(l.g,null,N.recent_posts),i.a.createElement(me,{posts:e.channel.posts,interaction:e.interaction,sourceType:"Channel",sourceId:e.channel.id}))):null},Oe=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.interaction=e.interaction.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.loggedIn=ue.bind(Object(x.a)(e)),e.state={channel:null,sheetOpened:!1,token:window.localStorage.getItem("token")},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){this.loggedIn(),S("channels",this.$f7route.params.channelId,this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Channel"===t&&this.setState({channel:e}),console.log("channel",e)}},{key:"setInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Channel"===t&&this.setState({channel:e}),console.log(e)}},{key:"fab",value:function(){if(this.state.channel&&this.state.channel.editable)return i.a.createElement(l.o,{href:"/channels/"+this.state.channel.id+"/edit",target:"#main-view",position:"left-bottom",slot:"fixed",color:"lime"},i.a.createElement(l.p,{ios:"f7:edit",aurora:"f7:edit",md:"material:edit"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"}))}},{key:"interaction",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o={interaction_type:e,interactionable_id:t,interactionable_type:n,source_type:a,source_id:i};O("interactions",o,this.state.token)}},{key:"render",value:function(){var e=this.state,t=e.channel,n=e.sheetOpened;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.channels,backLink:N.back},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),this.fab(),i.a.createElement(Ce,{channel:t,sheetOpened:n,interaction:this.interaction}))}}]),t}(a.Component),je=function(e){return e.channels&&e.channels.length>0?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.z,{noGap:!0},e.channels.map((function(t){return i.a.createElement(l.n,{width:"100",tabletWidth:"33",key:U.a.lib.WordArray.random(16)},i.a.createElement(l.i,{className:"demo-facebook-card"},i.a.createElement(l.l,{className:"no-border"},i.a.createElement("div",{className:"demo-facebook-avatar"},i.a.createElement("img",{src:t.avatar,width:"34",height:"34"})),i.a.createElement("div",{className:"demo-facebook-title "},i.a.createElement(l.q,{tooltip:t.title,className:"gray-color",href:"/channels/"+t.id},t.title.substring(0,30))),i.a.createElement("div",{className:"demo-facebook-date"},i.a.createElement(te,{model:t,klass:"Channel",interaction:e.interaction,sourceType:"Channel",sourceId:t.id}))),i.a.createElement(l.j,{className:"lightgray-color"},i.a.createElement("span",{className:"fs-12"},t.content.substring(0,120)+"..."),i.a.createElement("div",{className:"demo-facebook-more"},i.a.createElement(l.q,{className:"gray-color",href:"/channels/"+t.id},N.view,i.a.createElement("i",{className:"va fa fa-arrow-left mr-2"}))))))})))):i.a.createElement("ul",null)},Ie=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.channels},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"})),i.a.createElement(l.D,{inner:!1},i.a.createElement(l.A,{disableButtonText:N.cancel,placeholder:N.search,onChange:function(t){e.search({query:t.target.value})}}))),i.a.createElement("div",{style:{marginTop:"100px;"}},"|"),i.a.createElement(l.g,null),function(t){var n=[];return e.ability&&e.ability.map((function(e){e.title===t&&e.value&&n.push(i.a.createElement(l.o,{href:"/channels/new",target:"#main-view",position:"left-bottom",slot:"fixed",color:"deeporange"},i.a.createElement(l.p,{ios:"f7:add",aurora:"f7:add",md:"material:add"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"})))})),n}("new_channel"),i.a.createElement(je,{channels:e.channels,interaction:e.interaction,loadMore:e.loadMore}))},Te=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.loggedIn=ue.bind(Object(x.a)(e)),e.interaction=e.interaction.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.search=e.search.bind(Object(x.a)(e)),e.loadMore=e.loadMore.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),channels:[],query:null,page:1,ability:null,profileId:null,allowInfinite:!0,showPreloader:!0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList),V.on("set_instance",this.setInstance),V.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList),V.removeListener("set_instance",this.setInstance),V.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){this.loggedIn(),this.loadData()}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"UserRole"===t&&this.setState({ability:e.the_ability,profileId:e.profile_id})}},{key:"loadData",value:function(){_("channels",this.state.page,{},this.state.token),S("users","role",this.state.token)}},{key:"search",value:function(e){var t=this;this.setState({channels:[],page:1}),this.setState(e,(function(){_("channels/search",t.state.page,{q:t.state.query},t.state.token)}))}},{key:"setInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Channel"===t&&this.setState({channels:this.state.channels.map((function(t){return t.id===e.id?Object.assign({},t,e):t}))})}},{key:"loadMore",value:function(){var e=this;this.state.query&&this.state.query.length>0?this.setState({page:this.state.page+1},(function(){_("channels/search",e.state.page,{q:e.state.query},e.state.token)})):(this.setState({page:this.state.page+1},(function(){_("channels",e.state.page,{},e.state.token)})),this.setState({showPreloader:!1}))}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e.length>0&&"ChannelSearch"===t&&this.setState({channels:e}),e.length>0&&"Channel"===t&&this.setState({channels:this.state.channels.concat(e)}),this.setState({showPreloader:!0})}},{key:"interaction",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o={interaction_type:e,interactionable_id:t,interactionable_type:n,source_type:a,source_id:i};O("interactions",o,this.state.token)}},{key:"render",value:function(){var e=this.state,t=e.channels,n=e.ability,a=(e.profileId,e.showPreloader);return i.a.createElement(Ie,{interaction:this.interaction,search:this.search,loadMore:this.loadMore,channels:t,ability:n,showPreloader:a})}}]),t}(i.a.Component),De=function(e){return e.channel?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.r,{form:!0},i.a.createElement(l.s,{label:N.title,type:"text",placeholder:"...",value:e.title,onInput:function(t){e.handleChange({title:t.target.value})}}),i.a.createElement(l.s,{label:N.details,type:"textarea",placeholder:"...",value:e.content,resizable:!0,onInput:function(t){e.handleChange({content:t.target.value})}})),i.a.createElement(l.f,{strong:!0,className:"minus-z"},i.a.createElement(l.z,{tag:"p"},i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit)))):null};function Le(e){return new Promise((function(t,n){var a=new XMLHttpRequest;a.open("POST","http://localhost:3001/v1/uploads"),a.setRequestHeader("Authorization","Client-ID 8d26ccd12712fca");var i=new FormData;i.append("upload[image]",e),a.send(i),a.addEventListener("load",(function(){var e=JSON.parse(a.responseText);t(e)})),a.addEventListener("error",(function(){var e=JSON.parse(a.responseText);n(e)}))}))}var Ae=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.onEditorStateChange=e.onEditorStateChange.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.uploadImageCallBack=Le.bind(Object(x.a)(e)),e.state={channel:{},editorState:Z.EditorState.createEmpty(),token:window.localStorage.getItem("token"),title:null,content:null,interaction:null,page:0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance),V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance),V.removeListener("got_list",this.getList)}},{key:"submit",value:function(){O("channels",{title:this.state.title,content:this.state.content},this.state.token)}},{key:"onEditorStateChange",value:function(e){this.setState({editorState:e})}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){}},{key:"getList",value:function(){}},{key:"setInstance",value:function(){this.$f7router.navigate("/channels/")}},{key:"render",value:function(){var e=this.state,t=e.channel,n=e.editorState;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.channel_form,backLink:N.back}),i.a.createElement(l.g,null,N.channel_form),i.a.createElement(De,{channel:t,editorState:n,onEditorStateChange:this.onEditorStateChange,submit:this.submit,handleChange:this.handleChangeValue,uploadImageCallBack:this.uploadImageCallBack}))}}]),t}(a.Component),Ne=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.onEditorStateChange=e.onEditorStateChange.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.state={channel:{title:"",draft:""},token:window.localStorage.getItem("token"),id:null,title:null,content:null,page:0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance),V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance),V.removeListener("got_list",this.getList)}},{key:"submit",value:function(){j("channels",{id:this.state.id,title:this.state.title,content:this.state.content},this.state.token)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),this.$f7route.params.channelId&&S("channels",this.$f7route.params.channelId,this.state.token)}},{key:"getList",value:function(){}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Channel"===t&&this.setState({channel:e,title:e.title,id:e.id,content:e.content})}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"onEditorStateChange",value:function(e){this.setState({editorState:e})}},{key:"setInstance",value:function(){this.$f7router.navigate("/channels/")}},{key:"render",value:function(){var e=this.state,t=e.channel,n=e.title,a=e.content;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.form,backLink:N.back}),i.a.createElement(l.g,null,N.channel_form),i.a.createElement(De,{channel:t,title:n,content:a,onEditorStateChange:this.onEditorStateChange,submit:this.submit,handleChange:this.handleChangeValue}))}}]),t}(a.Component),xe=function(e){var t=[i.a.createElement("option",{value:""})];if(e.users)for(var n=0;n<e.users.length;n++)t.push(i.a.createElement("option",{value:e.users[n].id},e.users[n].email));return t},Re=function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.assignment_form),i.a.createElement(l.r,{form:!0,inset:!0},i.a.createElement(l.t,{title:N.email,smartSelect:!0},i.a.createElement("select",{name:"content",onChange:function(t){e.handleChange({user_id:t.target.value})}},i.a.createElement(xe,{users:e.users})))),i.a.createElement(l.f,{strong:!0,inset:!0},i.a.createElement(l.z,{tag:"p"},i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit))))},Ve=function(e){var t=[];if(e.users){for(var n=function(n){[],t.push(i.a.createElement("tr",{key:U.a.lib.WordArray.random(32)},i.a.createElement("td",{key:U.a.lib.WordArray.random(32)},e.users[n].id),i.a.createElement("td",{key:U.a.lib.WordArray.random(32)},e.users[n].email),i.a.createElement("td",{className:"checkbox-cell",key:U.a.lib.WordArray.random(32)},i.a.createElement(l.h,{color:"gray",onClick:function(){return e.removeRole(e.users[n].id)}},i.a.createElement(l.p,{ios:"f7:trash",aurora:"f7:trash",md:"material:trash"})))))},a=0;a<e.users.length;a++){n(a)}return i.a.createElement("div",{className:"data-table card"},i.a.createElement("table",null,i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("td",null,"ID"),i.a.createElement("td",null,"Email"))),i.a.createElement("tbody",null,t)))}return null},Me=function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.access_control_form),i.a.createElement(l.r,{form:!0,inset:!0},i.a.createElement(l.s,{label:N.item,type:"text",placeholder:"...",onInput:function(t){e.handleChange({abilityTitle:t.target.value})}}),i.a.createElement(l.s,{label:N.value,type:"select",defaultValue:!0,placeholder:"Please choose...",onChange:function(t){e.handleChange({abilityValue:t.target.value})}},i.a.createElement("option",{value:!0},N.true),i.a.createElement("option",{value:!1},N.false))),i.a.createElement(l.f,{strong:!0,inset:!0},i.a.createElement(l.z,{tag:"p"},i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.addAbility},N.submit))))},Pe=function(e){var t=[];if(e.ability){for(var n=function(n){[],t.push(i.a.createElement("tr",{key:U.a.lib.WordArray.random(32)},i.a.createElement("td",{key:U.a.lib.WordArray.random(32)},e.ability[n].title),i.a.createElement("td",{key:U.a.lib.WordArray.random(32)},N[e.ability[n].value]),i.a.createElement("td",{className:"checkbox-cell",key:U.a.lib.WordArray.random(32)},i.a.createElement(l.h,{color:"gray",onClick:function(){return e.removeAbility(e.ability[n].title)}},i.a.createElement(l.p,{ios:"f7:trash",aurora:"f7:trash",md:"material:trash"})))))},a=0;a<e.ability.length;a++){n(a)}return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.access_control_list),i.a.createElement("div",{className:"data-table card"},i.a.createElement("table",null,i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("td",null,N.title),i.a.createElement("td",null,N.value))),i.a.createElement("tbody",null,t))))}return null},qe=function(e){return e.role?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.title),i.a.createElement(l.r,{"simple-list":!0},i.a.createElement(l.t,null,e.role.title)),i.a.createElement(Pe,{ability:e.ability,removeAbility:e.removeAbility}),i.a.createElement(Me,{addAbility:e.addAbility,handleChange:e.handleChange}),i.a.createElement(Ve,{users:e.assignedUsers,removeRole:e.removeRole}),i.a.createElement(Re,{users:e.users,submit:e.submit,handleChange:e.handleChange})):null},We=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.submit=e.submit.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.removeRole=e.removeRole.bind(Object(x.a)(e)),e.addAbility=e.addAbility.bind(Object(x.a)(e)),e.removeAbility=e.removeAbility.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),role:null,id:null,users:null,assignedUsers:null,user_id:null,abilityTitle:"",abilityValue:!0,ability:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.getInstance),V.on("got_list",this.getList),V.on("deleted_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.getInstance),V.removeListener("got_list",this.getList),V.removeListener("deleted_instance",this.getInstance)}},{key:"componentDidMount",value:function(){S("roles",this.$f7route.params.roleId,this.state.token),_("users",this.state.page,{},this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Role"===t&&this.setState({role:e,id:e.id,assignedUsers:e.users,ability:e.ability})}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"User"===t&&this.setState({users:e})}},{key:"submit",value:function(){O("users/assignments",{role_id:this.state.id,user_id:this.state.user_id},this.state.token)}},{key:"addAbility",value:function(){O("roles/abilities",{id:this.state.id,ability_title:this.state.abilityTitle,ability_value:this.state.abilityValue},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"fab",value:function(){if(this.state.role)return i.a.createElement(l.o,{href:"/roles/"+this.state.role.id+"/edit",target:"#main-view",position:"left-bottom",slot:"fixed",color:"lime"},i.a.createElement(l.p,{ios:"f7:edit",aurora:"f7:edit",md:"material:edit"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"}))}},{key:"removeRole",value:function(e){C("users/assignments",{user_id:e,role_id:this.state.id},this.state.token)}},{key:"removeAbility",value:function(e){C("roles/abilities",{id:this.state.id,title:e},this.state.token)}},{key:"render",value:function(){var e=this.state,t=e.role,n=e.users,a=e.assignedUsers,o=e.ability;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.roles,backLink:N.back}),i.a.createElement(l.g,null),this.fab(),i.a.createElement(qe,{role:t,users:n,ability:o,removeAbility:this.removeAbility,assignedUsers:a,addAbility:this.addAbility,removeRole:this.removeRole,submit:this.submit,handleChange:this.handleChangeValue}))}}]),t}(a.Component),Ue=function(e){return e.roles?i.a.createElement(l.r,{mediaList:!0},e.roles.map((function(e){return i.a.createElement(l.t,{key:U.a.lib.WordArray.random(32),link:"/roles/"+e.id,ignoreCache:!0,title:e.title,after:"",subtitle:"",text:""})}))):i.a.createElement("ul",null)},Fe=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.roles,backLink:N.back}),i.a.createElement(l.g,null,N.list),i.a.createElement(l.o,{href:"/roles/new",target:"#main-view",position:"left-bottom",slot:"fixed",color:"deeporange"},i.a.createElement(l.p,{ios:"f7:add",aurora:"f7:add",md:"material:add"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"})),i.a.createElement(Ue,{roles:e.roles}))},Ge=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),roles:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),_("roles",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Role"===t&&this.setState({roles:e})}},{key:"render",value:function(){var e=this.state.roles;return i.a.createElement(Fe,{roles:e})}}]),t}(i.a.Component),$e=function(e){if(e.defaultRole)var t=!0;else t=!1;return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.role),i.a.createElement(l.r,{form:!0},i.a.createElement(l.s,{label:N.title,type:"text",placeholder:"...",defaultValue:e.role.title,onInput:function(t){e.handleChange({title:t.target.value})}}),i.a.createElement(l.t,{radio:!0,value:!1,checked:!t,name:"defaultRole",title:N.NonDefault,onChange:function(t){console.log(t),e.handleChange({defaultRole:JSON.parse(t.target.value)})}}),i.a.createElement(l.t,{radio:!0,value:!0,checked:t,name:"defaultRole",title:N.Default,onChange:function(t){console.log(t),e.handleChange({defaultRole:JSON.parse(t.target.value)})}})),i.a.createElement(l.f,{strong:!0},i.a.createElement(l.z,{tag:"p"},i.a.createElement(l.h,{className:"col",fill:!0,disabled:!e.editing,onClick:e.submit},N.submit))))},Be=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),role:{},defaultRole:!0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){O("roles",{title:this.state.title,default_role:this.state.defaultRole},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/roles/")}},{key:"render",value:function(){var e=this.state,t=e.role,n=e.defaultRole;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.role_form,backLink:N.back}),i.a.createElement(l.g,null,N.role_form),i.a.createElement($e,{role:t,submit:this.submit,editing:!0,handleChange:this.handleChangeValue,defaultRole:n}))}}]),t}(a.Component),Je=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),role:{},defaultRole:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){j("roles",{id:this.state.id,title:this.state.title,default_role:this.state.defaultRole},this.state.token)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),this.$f7route.params.roleId&&S("roles",this.$f7route.params.roleId,this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Role"===t&&this.setState({title:e.title,id:e.id,role:e,defaultRole:e.default_role})}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/roles/")}},{key:"render",value:function(){var e=this.state,t=e.role,n=e.defaultRole;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.role_form,backLink:N.back}),i.a.createElement(l.g,null,N.role_form),i.a.createElement($e,{role:t,defaultRole:n,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component),ze=function(e){return e.setting?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.title),i.a.createElement(l.r,{"simple-list":!0},i.a.createElement(l.t,null,e.setting.title)),i.a.createElement(l.g,null,N.content),i.a.createElement(l.r,{"simple-list":!0},i.a.createElement(l.t,null,e.setting.content))):null},Ke=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.submit=e.submit.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.removeSetting=e.removeSetting.bind(Object(x.a)(e)),e.addAbility=e.addAbility.bind(Object(x.a)(e)),e.removeAbility=e.removeAbility.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),setting:null,id:null,users:null,assignedUsers:null,user_id:null,abilityTitle:"",abilityValue:!0,ability:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.getInstance),V.on("got_list",this.getList),V.on("deleted_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.getInstance),V.removeListener("got_list",this.getList),V.removeListener("deleted_instance",this.getInstance)}},{key:"componentDidMount",value:function(){S("settings",this.$f7route.params.settingId,this.state.token),_("users",this.state.page,{},this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Setting"===t&&this.setState({setting:e,id:e.id,assignedUsers:e.users,ability:e.ability})}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"User"===t&&this.setState({users:e})}},{key:"submit",value:function(){O("users/assignments",{setting_id:this.state.id,user_id:this.state.user_id},this.state.token)}},{key:"addAbility",value:function(){O("settings/abilities",{id:this.state.id,ability_title:this.state.abilityTitle,ability_value:this.state.abilityValue},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"fab",value:function(){if(this.state.setting)return i.a.createElement(l.o,{href:"/settings/"+this.state.setting.id+"/edit",target:"#main-view",position:"left-bottom",slot:"fixed",color:"lime"},i.a.createElement(l.p,{ios:"f7:edit",aurora:"f7:edit",md:"material:edit"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"}))}},{key:"removeSetting",value:function(e){C("users/assignments",{user_id:e,setting_id:this.state.id},this.state.token)}},{key:"removeAbility",value:function(e){C("settings/abilities",{id:this.state.id,title:e},this.state.token)}},{key:"render",value:function(){var e=this.state,t=e.setting,n=e.users,a=e.assignedUsers,o=e.ability;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.settings,backLink:N.back}),i.a.createElement(l.g,null),this.fab(),i.a.createElement(ze,{setting:t,users:n,ability:o,removeAbility:this.removeAbility,assignedUsers:a,addAbility:this.addAbility,removeSetting:this.removeSetting,submit:this.submit,handleChange:this.handleChangeValue}))}}]),t}(a.Component),He=function(e){return e.settings?i.a.createElement(l.r,{mediaList:!0},e.settings.map((function(e){return i.a.createElement(l.t,{key:U.a.lib.WordArray.random(32),link:"/settings/"+e.id,ignoreCache:!0,title:e.title,after:"",subtitle:"",text:""})}))):i.a.createElement("ul",null)},Qe=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.settings,backLink:N.back}),i.a.createElement(l.g,null,N.list),i.a.createElement(l.o,{href:"/settings/new",target:"#main-view",position:"left-bottom",slot:"fixed",color:"deeporange"},i.a.createElement(l.p,{ios:"f7:add",aurora:"f7:add",md:"material:add"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"})),i.a.createElement(He,{settings:e.settings}))},Ye=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),settings:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),_("settings",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Setting"===t&&this.setState({settings:e})}},{key:"render",value:function(){var e=this.state.settings;return i.a.createElement(Qe,{settings:e})}}]),t}(i.a.Component),Xe=function(e){return console.log(e),i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.setting),i.a.createElement(l.r,{form:!0},i.a.createElement(l.s,{label:"Title",inputStyle:{direction:"ltr"},type:"text",placeholder:"...",defaultValue:e.title,onInput:function(t){e.handleChange({title:t.target.value})}}),i.a.createElement(l.s,{label:"Schema",type:"text",inputStyle:{direction:"ltr"},value:e.content,placeholder:"JSON",onInput:function(t){e.handleChange({content:t.target.value})}})),i.a.createElement(l.f,{strong:!0},i.a.createElement(l.z,{tag:"p"},i.a.createElement(l.h,{className:"col",fill:!0,disabled:!e.editing,onClick:e.submit},N.submit))))},Ze=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),title:"",content:""},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){O("settings",{title:this.state.title,content:this.state.content},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/settings/")}},{key:"render",value:function(){var e=this.state,t=e.title,n=e.content;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.setting_form,backLink:N.back}),i.a.createElement(l.g,null,N.setting_form),i.a.createElement(Xe,{title:t,content:n,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component),et=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),title:"",id:null,content:""},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance),V.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance),V.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){S("settings",this.$f7route.params.settingId,this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Setting"===t&&this.setState({title:e.title,id:e.id,content:e.content})}},{key:"submit",value:function(){j("settings",{id:this.state.id,title:this.state.title,content:this.state.content},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/settings/")}},{key:"render",value:function(){var e=this.state,t=e.title,n=e.content;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.setting_form,backLink:N.back}),i.a.createElement(l.g,null,N.setting_form),i.a.createElement(Xe,{title:t,content:n,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component),tt=(n(277),function(e){return e.channels&&e.channels.length>0?(console.log(e.channels),i.a.createElement(i.a.Fragment,null,i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.channels),i.a.createElement(l.j,null,i.a.createElement(l.r,null,e.channels.map((function(e){return i.a.createElement(l.t,{link:"/channels/"+e.id,title:e.title.substring(0,30)})}))))))):i.a.createElement("ul",null)}),nt=function(e){return e.experties?e.editable?i.a.createElement(l.z,{noGap:!0},e.experties.map((function(t){return i.a.createElement("a",{onClick:function(){return e.removeExperties(t)}},i.a.createElement(l.m,{text:t,mediaBgColor:"orange"},i.a.createElement(l.p,{slot:"media",aurora:"fa:times"})))}))):i.a.createElement(l.z,{noGap:!0},e.experties.map((function(e){return i.a.createElement("a",{href:"/experties/"+e},i.a.createElement(l.m,{text:e}))}))):null},at=function(e){return e.profiles?i.a.createElement(l.r,null,e.profiles.map((function(e){return i.a.createElement(l.t,{title:e.fullname,subtitle:"...",link:"/profiles/"+e.id},i.a.createElement("img",{slot:"media",src:e.avatar,width:"25"}))}))):i.a.createElement("ul",null)},it=function(e){return console.log(e),e.followers?i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.followers),i.a.createElement(l.j,null,i.a.createElement(at,{profiles:e.followers}))):null},ot=function(e){return e.followees?i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.followees),i.a.createElement(l.j,null,i.a.createElement(at,{profiles:e.followees}))):null},rt=function(e){i.a.useMemo((function(){return[{label:"Series 1",data:[[0,1],[1,2],[2,4],[3,2],[4,7]]},{label:"Series 2",data:[[0,3],[1,1],[2,5],[3,6],[4,4]]}]}),[]),i.a.useMemo((function(){return[{primary:!0,type:"linear",position:"bottom"},{type:"linear",position:"left"}]}),[]);return e.profile?i.a.createElement(l.F,null,i.a.createElement(l.E,{id:"tab-1",className:"page-content",tabActive:!0},i.a.createElement(l.z,null,i.a.createElement(l.n,{width:"100",tabletWidth:"50"},i.a.createElement(l.i,null,i.a.createElement(l.l,null,i.a.createElement("img",{src:e.profile.avatar,width:"80"}),i.a.createElement("div",{className:"profile-card"},e.profile.fullname),i.a.createElement("div",{className:"demo-facebook-date"},i.a.createElement(te,{model:e.profile,klass:"Profile",interaction:e.interaction,sourceType:"Profile",sourceId:e.profile.id}))),i.a.createElement(l.j,null,i.a.createElement(nt,{experties:e.profile.experties}))),i.a.createElement(it,{followers:e.profile.followers,profile:e.profile})),i.a.createElement(l.n,{width:"100",tabletWidth:"50"},i.a.createElement(tt,{channels:e.channels}),i.a.createElement(ot,{followees:e.profile.followees,profile:e.profile})))),i.a.createElement(l.E,{id:"tab-2",className:"page-content"},i.a.createElement(l.z,{noGap:!0},i.a.createElement(l.n,{width:"100",tabletWidth:"50"},e.metas.map((function(t){return i.a.createElement(i.a.Fragment,null,i.a.createElement(F,{meta:t.meta,editable:!1,actuals:t.actuals,removeActual:e.removeActual}))}))))),i.a.createElement(l.E,{id:"tab-3",className:"page-content"},i.a.createElement("div",{className:"block-title"},"Only Tablet Side By Side"),i.a.createElement(l.z,null,i.a.createElement(l.n,{width:"100",tabletWidth:"100"},i.a.createElement("div",{className:"timeline timeline-sides"},i.a.createElement("div",{className:"timeline-item"},i.a.createElement("div",{className:"timeline-item-date"},"21 ",i.a.createElement("small",null,"DEC")),i.a.createElement("div",{className:"timeline-item-divider"}),i.a.createElement("div",{className:"timeline-item-content"},i.a.createElement("div",{className:"timeline-item-inner"},i.a.createElement("div",{className:"timeline-item-time"},"12:30"),i.a.createElement("div",{className:"timeline-item-title"},"Title"),i.a.createElement("div",{className:"timeline-item-subtitle"},"Subtitle"),i.a.createElement("div",{className:"timeline-item-text"},"Text")))),i.a.createElement("div",{className:"timeline-item"},i.a.createElement("div",{className:"timeline-item-date"},"21 ",i.a.createElement("small",null,"DEC")),i.a.createElement("div",{className:"timeline-item-divider"}),i.a.createElement("div",{className:"timeline-item-content"},i.a.createElement("div",{className:"timeline-item-inner"},i.a.createElement("div",{className:"timeline-item-time"},"12:30"),i.a.createElement("div",{className:"timeline-item-title"},"Title"),i.a.createElement("div",{className:"timeline-item-subtitle"},"Subtitle"),i.a.createElement("div",{className:"timeline-item-text"},"Text"))))))))):null},st=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.addTag=e.addTag.bind(Object(x.a)(e)),e.interaction=e.interaction.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),profile:null,id:null,actuals:null,metas:null,channels:null,editable:!1},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){S("profiles",this.$f7route.params.profileId,this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Profile"===t&&this.setState({profile:e,id:e.id,actuals:e.actuals,metas:e.metas,channels:e.channels,editable:e.editable})}},{key:"fab",value:function(){if(this.state.profile&&this.state.editable)return i.a.createElement(l.o,{href:"/profiles/"+this.state.profile.id+"/edit",target:"#main-view",position:"left-bottom",slot:"fixed",color:"lime"},i.a.createElement(l.p,{ios:"f7:edit",aurora:"f7:edit",md:"material:edit"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"}))}},{key:"addTag",value:function(){console.log("hey")}},{key:"interaction",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o={interaction_type:e,interactionable_id:t,interactionable_type:n,source_type:a,source_id:i};O("interactions",o,this.state.token)}},{key:"render",value:function(){var e=this.state,t=e.profile,n=e.actuals,a=e.metas,o=e.channels,r=e.editable;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.profiles,backLinkForce:!0,backLink:N.back}),i.a.createElement(l.H,{tabbar:!0,bottom:!0},i.a.createElement(l.q,{tabLink:"#tab-1",tabLinkActive:!0},i.a.createElement("i",{className:"va ml-5 fa fa-user-circle"})),i.a.createElement(l.q,{tabLink:"#tab-2"},i.a.createElement("i",{className:"va ml-5 fa fa-bar-chart"})),i.a.createElement(l.q,{tabLink:"#tab-3"},i.a.createElement("i",{className:"va ml-5 fa fa-list"}))),this.fab(),i.a.createElement(rt,{profile:t,actuals:n,channels:o,metas:a,addTag:this.addTag,interaction:this.interaction,editable:r}))}}]),t}(a.Component),lt=function(e){return e.profiles?i.a.createElement(l.r,{mediaList:!0},e.profiles.map((function(e){return i.a.createElement(l.t,{key:U.a.lib.WordArray.random(32),link:"/profiles/"+e.id,title:e.fullname,after:"",subtitle:"",text:""},i.a.createElement("img",{slot:"media",src:e.avatar,width:"40",height:"40"}))}))):i.a.createElement("ul",null)},ct=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.profiles},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"})),i.a.createElement(l.D,{inner:!1},i.a.createElement(l.A,{disableButtonText:N.cancel,placeholder:N.search,onChange:function(t){e.search({query:t.target.value})}}))),i.a.createElement(lt,{profiles:e.profiles,interaction:e.interaction}))},ut=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.search=e.search.bind(Object(x.a)(e)),e.interaction=e.interaction.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),profiles:null,query:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),_("profiles",this.state.page)}},{key:"search",value:function(e){var t=this;this.setState(e,(function(){_("profiles/search",t.state.page,{q:t.state.query})}))}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Profile"===t&&this.setState({profiles:e})}},{key:"interaction",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o={interaction_type:e,interactionable_id:t,interactionable_type:n,source_type:a,source_id:i};O("interactions",o,this.state.token)}},{key:"render",value:function(){var e=this.state.profiles;return i.a.createElement(ct,{profiles:e,interaction:this.interaction,search:this.search})}}]),t}(i.a.Component),dt=n(130),mt=n.n(dt),ht=function(e){return e.name&&e.metas&&e.editable?i.a.createElement(i.a.Fragment,null,i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.profile_info),i.a.createElement(l.j,null,i.a.createElement(l.r,{form:!0},i.a.createElement(l.s,{label:N.firstname,type:"text",placeholder:"...",defaultValue:e.name,onInput:function(t){e.handleChange({name:t.target.value})}}),i.a.createElement(l.s,{label:N.surename,type:"text",placeholder:"...",defaultValue:e.surename,onInput:function(t){e.handleChange({surename:t.target.value})}}))),i.a.createElement(l.k,null,i.a.createElement(l.q,null),i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit))),i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.experties),i.a.createElement(l.j,null,i.a.createElement(l.r,null,i.a.createElement(l.t,null,i.a.createElement(nt,{experties:e.experties,editable:!0,removeExperties:e.removeExperties}))),i.a.createElement(l.r,{form:!0},i.a.createElement(l.s,{label:N.new_experties,type:"text",placeholder:"...",defaultValue:e.expert,onInput:function(t){e.handleChange({expert:t.target.value})}}))),i.a.createElement(l.k,null,i.a.createElement(l.q,null),i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submitExperties},N.submit))),i.a.createElement(l.i,null,i.a.createElement(l.l,null,i.a.createElement("img",{src:e.avatar,width:"80"})),i.a.createElement(mt.a,{withIcon:!0,buttonText:N.choose_image,onChange:e.onDrop,buttonClassName:"upload-btn",imgExtension:[".jpg",".jpeg",".png"],maxFileSize:5242880})),e.metas.map((function(t){return i.a.createElement(i.a.Fragment,null,i.a.createElement(F,{meta:t.meta,editable:!0,actuals:t.actuals,removeActual:e.removeActual}),i.a.createElement(q,{meta:t.meta,submit:e.submitFields,onChangeValue:e.handleChangeValueFields}))}))):null},ft=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.handleChangeValueFields=e.handleChangeValueFields.bind(Object(x.a)(e)),e.removeActual=e.removeActual.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.submitFields=e.submitFields.bind(Object(x.a)(e)),e.onDrop=e.onDrop.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.state={profile:{},metas:null,token:window.localStorage.getItem("token"),fields:[],name:"dd",surename:"",pictures:[],avatar:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.getInstance),V.on("deleted_instance",this.getInstance),V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.getInstance),V.removeListener("deleted_instance",this.getInstance),V.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){_("metas",this.state.page)}},{key:"onDrop",value:function(e){console.log(e[0]),w("profiles",this.state.id,e[0],this.state.token)}},{key:"submit",value:function(){j("profiles",{id:this.state.id,name:this.state.name,surename:this.state.surename},this.state.token)}},{key:"submitFields",value:function(){O("actuals",{meta_id:this.state.metaId,content:this.state.fields},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"handleChangeValueFields",value:function(e,t,n){var a=this.state.fields;if(a.length>0)for(var i=0;i<a.length;i++)if(a[i].fid&&a[i].fid===e){var o=Object.assign({},this.state);o.fields[i]={fid:e,value:t,metaId:n},this.setState(o)}else this.setState({fields:this.state.fields.concat({fid:e,value:t,metaId:n})});else this.setState({fields:this.state.fields.concat({fid:e,value:t,metaId:n})})}},{key:"setInstance",value:function(){this.$f7router.navigate("/profiles/")}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Profile"===t&&this.setState({metas:e.metas,profile:e})}},{key:"removeActual",value:function(e){C("actuals",{uuid:e})}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Meta"===t&&this.setState({metas:e})}},{key:"render",value:function(){var e=this.state,t=(e.profile,e.metas),n=e.name,a=e.avatar,o=e.surename;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.profile_form,backLink:N.back}),i.a.createElement(l.g,null,N.profile_form),i.a.createElement(ht,{name:n,avatar:a,surename:o,metas:t,onDrop:this.onDrop,removeActual:this.removeActual,submitFields:this.submitFields,submit:this.submit,editing:!0,handleChangeValueFields:this.handleChangeValueFields,handleChange:this.handleChangeValue}))}}]),t}(a.Component),gt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.handleChangeValueFields=e.handleChangeValueFields.bind(Object(x.a)(e)),e.removeActual=e.removeActual.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.submitFields=e.submitFields.bind(Object(x.a)(e)),e.onDrop=e.onDrop.bind(Object(x.a)(e)),e.getList=e.getList.bind(Object(x.a)(e)),e.submitExperties=e.submitExperties.bind(Object(x.a)(e)),e.removeExperties=e.removeExperties.bind(Object(x.a)(e)),e.state={name:null,surename:null,metas:null,metaId:null,actuals:null,experties:null,expert:null,token:window.localStorage.getItem("token"),fields:[],id:null,pictures:[],avatar:null,editable:!1},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.getInstance),V.on("deleted_instance",this.getInstance),V.on("file_posted",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.getInstance),V.removeListener("deleted_instance",this.getInstance),V.removeListener("file_posted",this.getInstance)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){this.$f7route.params.profileId&&S("profiles",this.$f7route.params.profileId,this.state.token)}},{key:"onDrop",value:function(e){console.log(e[0]),w("profiles",this.state.id,e[0],this.state.token)}},{key:"submit",value:function(){j("profiles",{id:this.state.id,name:this.state.name,surename:this.state.surename},this.state.token)}},{key:"submitFields",value:function(){O("actuals",{meta_id:this.state.metaId,content:this.state.fields},this.state.token)}},{key:"submitExperties",value:function(){var e={id:this.state.id,experties:this.state.expert};O("profiles/add_experties/"+this.$f7route.params.profileId,e,this.state.token)}},{key:"removeExperties",value:function(e){var t={id:this.state.id,experties:e};O("profiles/remove_experties/"+this.$f7route.params.profileId,t,this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"handleChangeValueFields",value:function(e,t,n){var a=this.state.fields;if(a.length>0)for(var i=0;i<a.length;i++)if(a[i].fid&&a[i].fid===e){var o=Object.assign({},this.state);o.fields[i]={fid:e,value:t,metaId:n},this.setState(o)}else this.setState({fields:this.state.fields.concat({fid:e,value:t,metaId:n})});else this.setState({fields:this.state.fields.concat({fid:e,value:t,metaId:n})})}},{key:"setInstance",value:function(){this.$f7router.navigate("/profiles/")}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Profile"===t&&this.setState({id:e.id,metas:e.metas,name:e.name,surename:e.surename,avatar:e.avatar,editable:e.editable,experties:e.experties})}},{key:"removeActual",value:function(e){C("actuals",{uuid:e})}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Meta"===t&&this.setState({metas:e})}},{key:"render",value:function(){var e=this.state,t=e.name,n=e.surename,a=e.avatar,o=e.metas,r=(e.actuals,e.experties),s=e.editable;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.profile_form,backLink:N.back}),i.a.createElement(l.g,null,N.profile_form),i.a.createElement(ht,{name:t,avatar:a,surename:n,metas:o,experties:r,onDrop:this.onDrop,removeActual:this.removeActual,submitFields:this.submitFields,submit:this.submit,editing:!0,handleChangeValueFields:this.handleChangeValueFields,handleChange:this.handleChangeValue,submitExperties:this.submitExperties,removeExperties:this.removeExperties,editable:s}))}}]),t}(a.Component),pt=function(e){return e.friendship?i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.profiles,backLink:N.back},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(l.g,null),i.a.createElement(at,{profiles:e.friendship.followees})):null},vt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.loggedIn=ue.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),friendship:null,query:null,page:1},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){this.loggedIn(),this.loadData()}},{key:"loadData",value:function(){S("friendships",this.$f7route.params.sourceId,this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Friendship"===t&&this.setState({friendship:e,id:e.id}),console.log(e,t)}},{key:"render",value:function(){var e=this.state.friendship;return i.a.createElement(pt,{friendship:e})}}]),t}(i.a.Component),bt=function(e){if(e.profilePrivacy){var t=function(e,t){for(var n=0;n<e.length;n++)if(e[n].title==t)return e[n].value};return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.privacy_settings,backLink:N.back},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.settings),i.a.createElement(l.j,null,i.a.createElement(l.r,null,e.profilePrivacy.setting_schemas.map((function(n){return i.a.createElement(l.s,{label:n.label,type:"select",onChange:function(t){e.handleChangeValue(n.title,t.target.value)}},function(e,n,a){for(var o=[i.a.createElement("option",null)],r=!1,s=0;s<e.length;s++)r=e[s].title==t(a,n),o.push(i.a.createElement("option",{value:e[s].title,selected:r},e[s].label));return o}(n.options,n.title,e.privacySettings))})))),i.a.createElement(l.k,null,i.a.createElement(l.q,null),i.a.createElement(l.h,{className:"col",fill:!0,onClick:e.submit},N.submit))))}return null},kt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=e.getInstance.bind(Object(x.a)(e)),e.submit=e.submit.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),profilePrivacy:null,privacySettings:null,fields:[]},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){S("privacy",1,this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Privacy"===t&&this.setState({profilePrivacy:e,privacySettings:e.privacy_settings,fields:e.privacy_settings})}},{key:"setInstance",value:function(){this.$f7.dialog.alert(N.completed_successfully,N.message)}},{key:"submit",value:function(){O("privacy",{id:1,privacy:this.state.fields},this.state.token)}},{key:"handleChangeValue",value:function(e,t){var n=this.state.fields;if(n.length>0){for(var a=0;a<n.length;a++)if(n[a].title&&n[a].title==e){var i=Object.assign({},this.state);i.fields[a]={title:e,value:t},this.setState(i)}}else this.setState({fields:this.state.fields.concat({title:e,value:t})})}},{key:"render",value:function(){var e=this.state,t=e.profilePrivacy,n=e.privacySettings;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.privacy_settings,backLink:N.back}),i.a.createElement(bt,{profilePrivacy:t,privacySettings:n,handleChangeValue:this.handleChangeValue,submit:this.submit}))}}]),t}(a.Component),yt=function(e){return console.log(e.bookmarks),e.bookmarks?i.a.createElement(l.r,null,e.bookmarks.map((function(e){return i.a.createElement(l.t,{className:"fs-11 ",key:U.a.lib.WordArray.random(32),link:"/"+e.model+"/"+e.id,title:e.title})}))):i.a.createElement("ul",null)},Et=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.bookmarks},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(yt,{bookmarks:e.bookmarks,loadMore:e.loadMore}))},_t=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),bookmarks:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),_("bookmarks",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Bookmark"===t&&this.setState({bookmarks:e}),console.log(e,t)}},{key:"render",value:function(){var e=this.state.bookmarks;return i.a.createElement(Et,{bookmarks:e})}}]),t}(i.a.Component),wt=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.sign_up},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.login),i.a.createElement(l.j,{className:"mh-auto"},i.a.createElement(l.r,null,i.a.createElement(l.s,{label:N.email,type:"text",autofocus:!0,placeholder:N.enter_your_email,value:e.email,onInput:function(t){e.handleChange({email:t.target.value})}}))),i.a.createElement(l.k,null,i.a.createElement(l.q,{href:"/sign_up/",animate:!1,ignoreCache:!0},N.you_can_sign_up," "),i.a.createElement(l.h,{fill:!0,className:"fs-11 external f-color-black bg-teal",href:"https://auth.ut.ac.ir:8443/cas/login?service=https%3A%2F%2Fsn.ut.ac.ir%2Fusers%2Fservice",animate:!1,ignoreCache:!0},N.cas," "),i.a.createElement(l.q,{className:"btn-notice"}),i.a.createElement(l.h,{className:"col btn",fill:!0,onClick:e.submit},N.login))))},St=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),email:"",password:""},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){this.$f7route.params.token&&O("users/validate_token",{},this.$f7route.params.token),this.state.token&&this.state.token.length>10&&O("users/validate_token",{},this.state.token)}},{key:"submit",value:function(){O("users/login",{email:this.state.email,password:this.state.password})}},{key:"setInstance",value:function(){var e=V.getKlass();"Login"===e&&this.$f7router.navigate("/verification/"+this.state.email),"Validate"===e&&(this.$f7router.navigate("/"),window.location.reload()),console.log(e)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this.state;e.username,e.password;return i.a.createElement(wt,{submit:this.submit,handleChange:this.handleChangeValue})}}]),t}(i.a.Component),Ct=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.state={email:"",password:""},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){O("users/validate_token",{},this.$f7route.params.token)}},{key:"setInstance",value:function(){var e=V.getIntance();if("Validate"===V.getKlass()){window.localStorage.setItem("token",e.token);var t=window.localStorage.getItem("url");t&&t.length>5?(window.location.replace(t),window.localStorage.setItem("url",""),setTimeout((function(){window.location.reload()}))):(this.$f7router.navigate("/"),setTimeout((function(){window.location.reload()})))}else this.$f7router.navigate("/login_error/"),setTimeout((function(){window.location.reload()}))}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this.state;e.username,e.password;return i.a.createElement(wt,{submit:this.submit,handleChange:this.handleChangeValue})}}]),t}(i.a.Component),Ot=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.sign_up},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.sign_up),i.a.createElement(l.j,null,i.a.createElement(l.r,null,i.a.createElement(l.s,{label:N.firstname+" *",placeholder:N.enter_your_name,type:"text",name:U.a.lib.WordArray.random(32),onInput:function(t){e.handleChange({name:t.target.value})}}),i.a.createElement(l.s,{label:N.surename+" *",placeholder:N.enter_your_surename,type:"text",name:U.a.lib.WordArray.random(32),onInput:function(t){e.handleChange({surename:t.target.value})}}),i.a.createElement(l.s,{label:" * "+N.email,type:"email",validate:!0,placeholder:N.enter_your_email,className:"ltr",value:e.email,onInput:function(t){e.handleChange({email:t.target.value})}}))),i.a.createElement(l.k,null,i.a.createElement(l.q,{href:"/login/"},N.if_registered,"\xa0",N.you_can_login," "),i.a.createElement(l.q,{className:"btn-notice"}),i.a.createElement(l.h,{className:"col btn",fill:!0,onClick:e.submit},N.sign_up))))},jt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.state={email:"",name:"",surename:""},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){this.$$(".btn").hide(),this.$$(".btn-notice").text(N.submitting);var e={email:this.state.email,name:this.state.name,surename:this.state.surename};if(this.state.email&&this.state.email.length>0&&this.state.name&&this.state.name.length>0&&this.state.surename&&this.state.surename.length>0)O("users/sign_up",e);else{this.$f7.dialog.alert(N.incomplete_data,N.alert)}}},{key:"setInstance",value:function(){"SignUp"===V.getKlass()&&(this.$$(".btn").show(),this.$f7router.navigate("/verification/"+this.state.email))}},{key:"handleChangeValue",value:function(e){this.setState(e),console.log(e)}},{key:"render",value:function(){var e=this.state;e.username,e.password;return i.a.createElement(Ot,{submit:this.submit,handleChange:this.handleChangeValue})}}]),t}(i.a.Component),It=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.verification},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(l.i,null,i.a.createElement(l.l,null,N.login),i.a.createElement(l.j,null,i.a.createElement(l.r,null,i.a.createElement(l.s,{label:N.email,type:"text",autofocus:!0,placeholder:N.enter_your_email,value:e.email,onInput:function(t){e.handleChange({email:t.target.value})}}),i.a.createElement(l.s,{label:N.verification_code,type:"text",placeholder:N.enter_verification_code,onInput:function(t){e.handleChange({verificationCode:t.target.value})}}))),i.a.createElement(l.k,null,i.a.createElement(l.q,{href:"/sign_up/",animate:!1,ignoreCache:!0},N.you_can_sign_up," "),i.a.createElement(l.q,{className:"btn-notice"}),i.a.createElement(l.h,{className:"col btn",fill:!0,onClick:e.submit},N.login))))},Tt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.state={verificationCode:"",email:""},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){this.setState({email:this.$f7route.params.email})}},{key:"submit",value:function(){O("users/verify",{verification_code:this.state.verificationCode})}},{key:"setInstance",value:function(){var e=V.getIntance(),t=V.getKlass();if(e&&"Verify"==t){window.localStorage.setItem("token",e.token);var n=window.localStorage.getItem("url");n.length>5?(window.location.replace(n),window.localStorage.setItem("url",""),window.location.reload()):(this.$f7router.navigate("/"),window.location.reload())}}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this.state,t=(e.username,e.email);return i.a.createElement(It,{submit:this.submit,email:t,handleChange:this.handleChangeValue})}}]),t}(i.a.Component),Dt=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:function(){if(e.room)return e.room.title}(),backLink:N.back},i.a.createElement(l.q,{panelOpen:"right"},i.a.createElement(l.p,{f7:"bars"}))),i.a.createElement(l.D,{className:"bg-black subnavbar-black"},i.a.createElement("div",null),i.a.createElement("div",{className:""},i.a.createElement("a",{onClick:function(){return e.publishCamera()}},i.a.createElement("i",{class:"fa fa-video-camera ml-4","aria-hidden":"true"})),i.a.createElement("a",{onClick:function(){return e.publishMicrophone()}},i.a.createElement("i",{class:"fa fa-microphone ml-4","aria-hidden":"true"})),i.a.createElement("a",{onClick:function(){return e.sendData()}},i.a.createElement("i",{class:"fa fa-comment ml-4","aria-hidden":"true"})),i.a.createElement("a",{onClick:function(){return e.speakRequest()}},i.a.createElement("i",{class:"fa fa-hand-paper-o ml-4","aria-hidden":"true"})))),i.a.createElement("div",{style:{marginTop:"100px;"}},"|"),i.a.createElement(l.f,null,i.a.createElement(l.z,{className:"center",id:"hosts"},function(){var t=[];return e.feeds&&e.feeds.map((function(n){t.push(i.a.createElement("div",{class:"col-100 tablet-33",key:"container-"+n.id},i.a.createElement("video",{controls:!0,key:n.id,id:"video-"+n.id,src:"",width:"320",height:"240",autoPlay:!0,playsInline:!0,muted:e.muted}))),e.streamAttacher(n)})),t}())),i.a.createElement(l.f,{strong:!0},function(){var t=[];return e.requests&&e.requests.map((function(n){t.push(i.a.createElement("div",{className:"chip color-blue"},i.a.createElement("a",{onClick:function(){return e.acceptRequest(n.uuid)}},i.a.createElement("div",{className:"chip-media bg-color-orange"},i.a.createElement("i",{class:"fa fa-level-up","aria-hidden":"true"}))),i.a.createElement("div",{className:"chip-label  mr-2"},n.display),i.a.createElement("a",{onClick:function(){return e.removeRequest(n.uuid)},className:"chip-delete"})))})),t}(),i.a.createElement("hr",null),function(){var t=[];return e.participants&&e.participants.map((function(e){t.push(i.a.createElement("div",{className:"chip"},i.a.createElement("div",{className:"chip-label  mr-2"},e.display)))})),t}()),i.a.createElement(l.f,null,function(){var t=[];return e.lowFeeds&&e.lowFeeds.map((function(n){t.push(i.a.createElement("div",{class:"col-100 tablet-33",key:"container-"+n.id},i.a.createElement("video",{controls:!0,key:n.id,id:"lowVideo-"+n.id,src:"",width:"160",height:"120",autoPlay:!0,playsInline:!0,muted:e.muted}))),e.streamAttacher(n)})),t}()))},Lt=n(82),At=window.RTCRtpTransceiver;xt.sessions={},xt.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||xt.extension.isInstalled()}return!0};var Nt={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var n=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var a=new Error("NavigatorUserMediaError");a.name="You cancelled the request for permission, giving up...",n(a)}else n(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function xt(e){if((e=e||{}).success="function"==typeof e.success?e.success:xt.noop,e.error="function"==typeof e.error?e.error:xt.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:xt.noop,!xt.initDone)return e.error("Library not initialized"),{};if(!xt.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(xt.log("Library initialized: "+xt.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,n=null,a={},i=null,o=null,r=0,s=e.server;xt.isArray(s)?(xt.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,o=e.server,xt.debug(o)):0===s.indexOf("ws")?(t=!0,xt.log("Using WebSockets to contact Janus: "+s)):(t=!1,xt.log("Using REST API to contact Janus: "+s));var l=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],c=e.iceTransportPolicy,u=e.bundlePolicy,d=!0===e.ipv6,m=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(m=!0===e.withCredentials);var h=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(h=e.max_poll_events),h<1&&(h=1);var f=null;void 0!==e.token&&null!==e.token&&(f=e.token);var g=null;void 0!==e.apisecret&&null!==e.apisecret&&(g=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var p=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(p=e.keepAlivePeriod),isNaN(p)&&(p=25e3);var v=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(v=e.longPollTimeout),isNaN(v)&&(v=6e4);var k=!1,y=null,E={},_=this,w=0,S={};function C(){if(null!=y)if(xt.debug("Long poll..."),k){var t=s+"/"+y+"?rid="+(new Date).getTime();h&&(t=t+"&maxev="+h),f&&(t=t+"&token="+encodeURIComponent(f)),g&&(t=t+"&apisecret="+encodeURIComponent(g)),xt.httpAPICall(t,{verb:"GET",withCredentials:m,success:O,timeout:v,error:function(t,n){if(xt.error(t+":",n),++w>3)return k=!1,void e.error("Lost connection to the server (is it down?)");C()}})}else xt.warn("Is the server down? (connected=false)")}function O(e,a){if(w=0,t||void 0===y||null===y||!0===a||C(),t||!xt.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(l=e.sender))return void xt.warn("Missing sender...");if(!(u=E[l]))return void xt.debug("This handle is not attached to this session");var i=e.candidate;xt.debug("Got a trickled candidate on session "+y),xt.debug(i);var o=u.webrtcStuff;o.pc&&o.remoteSdp?(xt.debug("Adding remote candidate:",i),i&&!0!==i.completed?o.pc.addIceCandidate(i):o.pc.addIceCandidate(xt.endOfCandidates)):(xt.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(i),xt.debug(o.candidates))}else{if("webrtcup"===e.janus)return xt.debug("Got a webrtcup event on session "+y),xt.debug(e),(l=e.sender)?(u=E[l])?void u.webrtcState(!0):void xt.debug("This handle is not attached to this session"):void xt.warn("Missing sender...");if("hangup"===e.janus){if(xt.debug("Got a hangup event on session "+y),xt.debug(e),!(l=e.sender))return void xt.warn("Missing sender...");if(!(u=E[l]))return void xt.debug("This handle is not attached to this session");u.webrtcState(!1,e.reason),u.hangup()}else if("detached"===e.janus){if(xt.debug("Got a detached event on session "+y),xt.debug(e),!(l=e.sender))return void xt.warn("Missing sender...");if(!(u=E[l]))return;u.detached=!0,u.ondetached(),u.detach()}else if("media"===e.janus){if(xt.debug("Got a media event on session "+y),xt.debug(e),!(l=e.sender))return void xt.warn("Missing sender...");if(!(u=E[l]))return void xt.debug("This handle is not attached to this session");u.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(xt.debug("Got a slowlink event on session "+y),xt.debug(e),!(l=e.sender))return void xt.warn("Missing sender...");if(!(u=E[l]))return void xt.debug("This handle is not attached to this session");u.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var r,s;if(xt.error("Ooops: "+e.error.code+" "+e.error.reason),xt.debug(e),r=e.transaction)(s=S[r])&&s(e),delete S[r];return}if("event"===e.janus){var l;if(xt.debug("Got a plugin event on session "+y),xt.debug(e),!(l=e.sender))return void xt.warn("Missing sender...");var c=e.plugindata;if(!c)return void xt.warn("Missing plugindata...");xt.debug("  -- Event is coming from "+l+" ("+c.plugin+")");var u,d=c.data;if(xt.debug(d),!(u=E[l]))return void xt.warn("This handle is not attached to this session");var m=e.jsep;m&&(xt.debug("Handling SDP as well..."),xt.debug(m));var h=u.onmessage;h?(xt.debug("Notifying application..."),h(d,m)):xt.debug("No provided notification callback")}else{if("timeout"===e.janus)return xt.error("Timeout on session "+y),xt.debug(e),void(t&&n.close(3504,"Gateway timeout"));xt.warn("Unknown message/event  '"+e.janus+"' on session "+y),xt.debug(e)}}}else xt.debug("Got a success on session "+y),xt.debug(e),(r=e.transaction)&&((s=S[r])&&s(e),delete S[r]);else xt.debug("Got an ack on session "+y),xt.debug(e),(r=e.transaction)&&((s=S[r])&&s(e),delete S[r]);else xt.vdebug("Got a keepalive on session "+y);else for(var f=0;f<e.length;f++)O(e[f],!0)}function j(){if(s&&t&&k){i=setTimeout(j,p);var e={janus:"keepalive",session_id:y,transaction:xt.randomString(12)};f&&(e.token=f),g&&(e.apisecret=g),n.send(JSON.stringify(e))}}function I(l){var c=xt.randomString(12),u={janus:"create",transaction:c};if(l.reconnect&&(k=!1,u.janus="claim",u.session_id=y,n&&(n.onopen=null,n.onerror=null,n.onclose=null,i&&(clearTimeout(i),i=null))),f&&(u.token=f),g&&(u.apisecret=g),!s&&xt.isArray(o)&&(0===(s=o[r]).indexOf("ws")?(t=!0,xt.log("Server #"+(r+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,xt.log("Server #"+(r+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var d in n=xt.newWebSocket(s,"janus-protocol"),a={error:function(){if(xt.error("Error connecting to the Janus WebSockets server... "+s),xt.isArray(o)&&!l.reconnect)return++r===o.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){I(l)}),200));l.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){S[c]=function(e){if(xt.debug(e),"success"!==e.janus)return xt.error("Ooops: "+e.error.code+" "+e.error.reason),void l.error(e.error.reason);i=setTimeout(j,p),k=!0,y=e.session_id?e.session_id:e.data.id,l.reconnect?xt.log("Claimed session: "+y):xt.log("Created session: "+y),xt.sessions[y]=_,l.success()},n.send(JSON.stringify(u))},message:function(e){O(JSON.parse(e.data))},close:function(){s&&k&&(k=!1,e.error("Lost connection to the server (is it down?)"))}})n.addEventListener(d,a[d]);else xt.httpAPICall(s,{verb:"POST",withCredentials:m,body:u,success:function(e){if(xt.debug(e),"success"!==e.janus)return xt.error("Ooops: "+e.error.code+" "+e.error.reason),void l.error(e.error.reason);k=!0,y=e.session_id?e.session_id:e.data.id,l.reconnect?xt.log("Claimed session: "+y):xt.log("Created session: "+y),xt.sessions[y]=_,C(),l.success()},error:function(e,t){if(xt.error(e+":",t),xt.isArray(o)&&!l.reconnect)return++r===o.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){I(l)}),200));""===t?l.error(e+": Is the server down?"):l.error(e+": "+t)}})}function T(e,a){if((a=a||{}).success="function"==typeof a.success?a.success:xt.noop,a.error="function"==typeof a.error?a.error:xt.noop,!k)return xt.warn("Is the server down? (connected=false)"),void a.error("Is the server down? (connected=false)");var i=E[e];if(!i||!i.webrtcStuff)return xt.warn("Invalid handle"),void a.error("Invalid handle");var o=a.message,r=a.jsep,l=xt.randomString(12),c={janus:"message",body:o,transaction:l};if(i.token&&(c.token=i.token),g&&(c.apisecret=g),r&&(c.jsep={type:r.type,sdp:r.sdp},r.e2ee&&(c.jsep.e2ee=!0)),xt.debug("Sending message to plugin (handle="+e+"):"),xt.debug(c),t)return c.session_id=y,c.handle_id=e,S[l]=function(e){if(xt.debug("Message sent!"),xt.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return xt.warn("Request succeeded, but missing plugindata..."),void a.success();xt.log("Synchronous transaction successful ("+t.plugin+")");var n=t.data;return xt.debug(n),void a.success(n)}"ack"===e.janus?a.success():e.error?(xt.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(xt.error("Unknown error"),a.error("Unknown error"))},void n.send(JSON.stringify(c));xt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:c,success:function(e){if(xt.debug("Message sent!"),xt.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return xt.warn("Request succeeded, but missing plugindata..."),void a.success();xt.log("Synchronous transaction successful ("+t.plugin+")");var n=t.data;return xt.debug(n),void a.success(n)}"ack"===e.janus?a.success():e.error?(xt.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(xt.error("Unknown error"),a.error("Unknown error"))},error:function(e,t){xt.error(e+":",t),a.error(e+": "+t)}})}function D(e,a){if(k){var i=E[e];if(i&&i.webrtcStuff){var o={janus:"trickle",candidate:a,transaction:xt.randomString(12)};if(i.token&&(o.token=i.token),g&&(o.apisecret=g),xt.vdebug("Sending trickle candidate (handle="+e+"):"),xt.vdebug(o),t)return o.session_id=y,o.handle_id=e,void n.send(JSON.stringify(o));xt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:o,success:function(e){xt.vdebug("Candidate sent!"),xt.vdebug(e),"ack"===e.janus||xt.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){xt.error(e+":",t)}})}else xt.warn("Invalid handle")}else xt.warn("Is the server down? (connected=false)")}function L(e,t,n,a,i){var o=E[e];if(o&&o.webrtcStuff){var r=o.webrtcStuff,s=function(e){xt.log("Received state change on data channel:",e);var t=e.target.label,n=e.target.protocol,a=r.dataChannel[t]?r.dataChannel[t].readyState:"null";if(xt.log("State change on <"+t+"> data channel: "+a),"open"===a){if(r.dataChannel[t].pending&&r.dataChannel[t].pending.length>0){xt.log("Sending pending messages on <"+t+">:",r.dataChannel[t].pending.length);var i=!0,s=!1,l=void 0;try{for(var c,u=r.dataChannel[t].pending[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value;xt.log("Sending data on data channel <"+t+">"),xt.debug(d),r.dataChannel[t].send(d)}}catch(m){s=!0,l=m}finally{try{i||null==u.return||u.return()}finally{if(s)throw l}}r.dataChannel[t].pending=[]}o.ondataopen(t,n)}};if(a)r.dataChannel[t]=a;else{var l={ordered:!0};n&&(l.protocol=n),r.dataChannel[t]=r.pc.createDataChannel(t,l)}r.dataChannel[t].onmessage=function(e){xt.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},r.dataChannel[t].onopen=s,r.dataChannel[t].onclose=s,r.dataChannel[t].onerror=function(e){xt.error("Got error on data channel:",e)},r.dataChannel[t].pending=[],i&&r.dataChannel[t].pending.push(i)}else xt.warn("Invalid handle")}function A(e,t){(t=t||{}).success="function"==typeof t.success?t.success:xt.noop,t.error="function"==typeof t.error?t.error:xt.noop;var n=E[e];if(!n||!n.webrtcStuff)return xt.warn("Invalid handle"),void t.error("Invalid handle");var a=n.webrtcStuff,i=t.text||t.data;if(!i)return xt.warn("Invalid data"),void t.error("Invalid data");var o=t.label?t.label:xt.dataChanDefaultLabel;return a.dataChannel[o]?"open"!==a.dataChannel[o].readyState?(a.dataChannel[o].pending.push(i),void t.success()):(xt.log("Sending data on data channel <"+o+">"),xt.debug(i),a.dataChannel[o].send(i),void t.success()):(L(e,o,t.protocol,!1,i,t.protocol),void t.success())}function N(e,t){(t=t||{}).success="function"==typeof t.success?t.success:xt.noop,t.error="function"==typeof t.error?t.error:xt.noop;var n=E[e];if(!n||!n.webrtcStuff)return xt.warn("Invalid handle"),void t.error("Invalid handle");var a=n.webrtcStuff;if(!a.dtmfSender){if(a.pc){var i=a.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!i)return xt.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");a.dtmfSender=i.dtmf,a.dtmfSender&&(xt.log("Created DTMF Sender"),a.dtmfSender.ontonechange=function(e){xt.debug("Sent DTMF tone: "+e.tone)})}if(!a.dtmfSender)return xt.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(!o)return xt.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var r=o.tones;if(!r)return xt.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"===typeof o.duration?o.duration:500,l="number"===typeof o.gap?o.gap:50;xt.debug("Sending DTMF string "+r+" (duration "+s+"ms, gap "+l+"ms)"),a.dtmfSender.insertDTMF(r,s,l),t.success()}function x(e,a){(a=a||{}).success="function"==typeof a.success?a.success:xt.noop,a.error="function"==typeof a.error?a.error:xt.noop;var i=!0===a.noRequest;xt.log("Destroying handle "+e+" (only-locally="+i+")"),G(e);var o=E[e];if(!o||o.detached)return delete E[e],void a.success();if(i)return delete E[e],void a.success();if(!k)return xt.warn("Is the server down? (connected=false)"),void a.error("Is the server down? (connected=false)");var r={janus:"detach",transaction:xt.randomString(12)};if(o.token&&(r.token=o.token),g&&(r.apisecret=g),t)return r.session_id=y,r.handle_id=e,n.send(JSON.stringify(r)),delete E[e],void a.success();xt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:r,success:function(t){xt.log("Destroyed handle:"),xt.debug(t),"success"!==t.janus&&xt.error("Ooops: "+t.error.code+" "+t.error.reason),delete E[e],a.success()},error:function(t,n){xt.error(t+":",n),delete E[e],a.success()}})}function R(e,t,n,a,i){var o=E[e];if(!o||!o.webrtcStuff)return xt.warn("Invalid handle"),void a.error("Invalid handle");var r=o.webrtcStuff;xt.debug("streamsDone:",i),i&&(xt.debug("  -- Audio tracks:",i.getAudioTracks()),xt.debug("  -- Video tracks:",i.getVideoTracks()));var s=!1;if(r.myStream&&n.update&&!r.streamExternal){if((!n.update&&$(n)||n.update&&(n.addAudio||n.replaceAudio))&&i.getAudioTracks()&&i.getAudioTracks().length)if(r.myStream.addTrack(i.getAudioTracks()[0]),xt.unifiedPlan){xt.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",i.getAudioTracks()[0]);var m=null;if((k=r.pc.getTransceivers())&&k.length>0){var h=!0,f=!1,g=void 0;try{for(var p,v=k[Symbol.iterator]();!(h=(p=v.next()).done);h=!0){if((j=p.value).sender&&j.sender.track&&"audio"===j.sender.track.kind||j.receiver&&j.receiver.track&&"audio"===j.receiver.track.kind){m=j;break}}}catch(x){f=!0,g=x}finally{try{h||null==v.return||v.return()}finally{if(f)throw g}}}m&&m.sender?m.sender.replaceTrack(i.getAudioTracks()[0]):r.pc.addTrack(i.getAudioTracks()[0],i)}else xt.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",i.getAudioTracks()[0]),r.pc.addTrack(i.getAudioTracks()[0],i);if((!n.update&&J(n)||n.update&&(n.addVideo||n.replaceVideo))&&i.getVideoTracks()&&i.getVideoTracks().length)if(r.myStream.addTrack(i.getVideoTracks()[0]),xt.unifiedPlan){xt.log((n.replaceVideo?"Replacing":"Adding")+" video track:",i.getVideoTracks()[0]);var k,y=null;if((k=r.pc.getTransceivers())&&k.length>0){var _=!0,w=!1,S=void 0;try{for(var C,O=k[Symbol.iterator]();!(_=(C=O.next()).done);_=!0){var j;if((j=C.value).sender&&j.sender.track&&"video"===j.sender.track.kind||j.receiver&&j.receiver.track&&"video"===j.receiver.track.kind){y=j;break}}}catch(x){w=!0,S=x}finally{try{_||null==O.return||O.return()}finally{if(w)throw S}}}y&&y.sender?y.sender.replaceTrack(i.getVideoTracks()[0]):r.pc.addTrack(i.getVideoTracks()[0],i)}else xt.log((n.replaceVideo?"Replacing":"Adding")+" video track:",i.getVideoTracks()[0]),r.pc.addTrack(i.getVideoTracks()[0],i)}else r.myStream=i,s=!0;if(!r.pc){var I={iceServers:l,iceTransportPolicy:c,bundlePolicy:u};"chrome"===xt.webRTCAdapter.browserDetails.browser&&(I.sdpSemantics=xt.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var T={optional:[{DtlsSrtpKeyAgreement:!0}]};if(d&&T.optional.push({googIPv6:!0}),a.rtcConstraints&&"object"===typeof a.rtcConstraints)for(var A in xt.debug("Adding custom PeerConnection constraints:",a.rtcConstraints),a.rtcConstraints)T.optional.push(a.rtcConstraints[A]);"edge"===xt.webRTCAdapter.browserDetails.browser&&(I.bundlePolicy="max-bundle"),RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams&&(a.senderTransforms||a.receiverTransforms)&&(r.senderTransforms=a.senderTransforms,r.receiverTransforms=a.receiverTransforms,I.forceEncodedAudioInsertableStreams=!0,I.forceEncodedVideoInsertableStreams=!0,I.encodedInsertableStreams=!0),xt.log("Creating PeerConnection"),xt.debug(T),r.pc=new RTCPeerConnection(I,T),xt.debug(r.pc),r.pc.getStats&&(r.volume={},r.bitrate.value="0 kbits/sec"),xt.log("Preparing local SDP and gathering candidates (trickle="+r.trickle+")"),r.pc.oniceconnectionstatechange=function(e){r.pc&&o.iceState(r.pc.iceConnectionState)},r.pc.onicecandidate=function(t){if(!t.candidate||"edge"===xt.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)xt.log("End of candidates."),r.iceDone=!0,!0===r.trickle?D(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:xt.noop,t.error="function"==typeof t.error?t.error:xt.noop;var n=E[e];if(!n||!n.webrtcStuff)return void xt.warn("Invalid handle, not sending anything");var a=n.webrtcStuff;if(xt.log("Sending offer/answer SDP..."),!a.mySdp)return void xt.warn("Local SDP instance is invalid, not sending anything...");a.mySdp={type:a.pc.localDescription.type,sdp:a.pc.localDescription.sdp},!1===a.trickle&&(a.mySdp.trickle=!1);xt.debug(t),a.sdpSent=!0,t.success(a.mySdp)}(e,a);else{var n={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===r.trickle&&D(e,n)}},r.pc.ontrack=function(e){if(xt.log("Handling Remote Track"),xt.debug(e),e.streams&&(r.remoteStream=e.streams[0],o.onremotestream(r.remoteStream),!e.track.onended)){if(r.receiverTransforms){var t=null;"audio"===e.track.kind&&r.receiverTransforms.audio?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&r.receiverTransforms.video&&(t=e.receiver.createEncodedVideoStreams()),t&&t.readableStream.pipeThrough(r.receiverTransforms[e.track.kind]).pipeTo(t.writableStream)}var n=null;xt.log("Adding onended callback to track:",e.track),e.track.onended=function(e){xt.log("Remote track removed:",e),r.remoteStream&&(clearTimeout(n),r.remoteStream.removeTrack(e.target),o.onremotestream(r.remoteStream))},e.track.onmute=function(e){xt.log("Remote track muted:",e),r.remoteStream&&null==n&&(n=setTimeout((function(){xt.log("Removing remote track"),r.remoteStream.removeTrack(e.target),o.onremotestream(r.remoteStream),n=null}),2520))},e.track.onunmute=function(e){if(xt.log("Remote track flowing again:",e),null!=n)clearTimeout(n),n=null;else try{r.remoteStream.addTrack(e.target),o.onremotestream(r.remoteStream)}catch(t){xt.error(t)}}}}}if(s&&i){xt.log("Adding local stream");var N=!0===a.simulcast2;i.getTracks().forEach((function(e){if(xt.log("Adding local track:",e),N)if("audio"===e.kind)r.pc.addTrack(e,i);else{xt.log("Enabling rid-based simulcasting:",e);var t=b(a.simulcastMaxBitrates);r.pc.addTransceiver(e,{direction:"sendrecv",streams:[i],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else{var n=r.pc.addTrack(e,i);if(n&&r.senderTransforms){var o=null;"audio"===n.track.kind&&r.senderTransforms.audio?o=n.createEncodedAudioStreams():"video"===n.track.kind&&r.senderTransforms.video&&(o=n.createEncodedVideoStreams()),o&&o.readableStream.pipeThrough(r.senderTransforms[n.track.kind]).pipeTo(o.writableStream)}}}))}(function(e){if(xt.debug("isDataEnabled:",e),"edge"===xt.webRTCAdapter.browserDetails.browser)return xt.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(n)&&!r.dataChannel[xt.dataChanDefaultLabel]&&(xt.log("Creating default data channel"),L(e,xt.dataChanDefaultLabel,null,!1),r.pc.ondatachannel=function(t){xt.log("Data channel created by Janus:",t),L(e,t.channel.label,t.channel.protocol,t.channel)}),r.myStream&&o.onlocalstream(r.myStream),t?r.pc.setRemoteDescription(t).then((function(){if(xt.log("Remote description accepted!"),r.remoteSdp=t.sdp,r.candidates&&r.candidates.length>0){for(var i=0;i<r.candidates.length;i++){var o=r.candidates[i];xt.debug("Adding remote candidate:",o),o&&!0!==o.completed?r.pc.addIceCandidate(o):r.pc.addIceCandidate(xt.endOfCandidates)}r.candidates=[]}!function(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:xt.noop,n.error="function"==typeof n.error?n.error:xt.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:xt.noop;var a=E[e];if(!a||!a.webrtcStuff)return xt.warn("Invalid handle"),void n.error("Invalid handle");var i=a.webrtcStuff,o=!0===n.simulcast;o?xt.log("Creating answer (iceDone="+i.iceDone+", simulcast="+o+")"):xt.log("Creating answer (iceDone="+i.iceDone+")");var r=null;if(xt.unifiedPlan){r={};var s=null,l=null,c=i.pc.getTransceivers();if(c&&c.length>0){var u=!0,d=!1,m=void 0;try{for(var h,f=c[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var g=h.value;g.sender&&g.sender.track&&"audio"===g.sender.track.kind||g.receiver&&g.receiver.track&&"audio"===g.receiver.track.kind?s||(s=g):(g.sender&&g.sender.track&&"video"===g.sender.track.kind||g.receiver&&g.receiver.track&&"video"===g.receiver.track.kind)&&(l||(l=g))}}catch(x){d=!0,m=x}finally{try{u||null==f.return||f.return()}finally{if(d)throw m}}}var p=$(t),v=B(t);if(p||v){if(p&&v){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",xt.log("Setting audio transceiver to sendrecv:",s)}catch(O){xt.error(O)}}else if(p&&!v)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",xt.log("Setting audio transceiver to sendonly:",s))}catch(O){xt.error(O)}else if(!p&&v)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",xt.log("Setting audio transceiver to recvonly:",s)}catch(O){xt.error(O)}else s=i.pc.addTransceiver("audio",{direction:"recvonly"}),xt.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",xt.log("Setting audio transceiver to inactive:",s)}catch(O){xt.error(O)}var k=J(t),y=z(t);if(k||y){if(k&&y){if(l)try{l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",xt.log("Setting video transceiver to sendrecv:",l)}catch(O){xt.error(O)}}else if(k&&!y){if(l)try{l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",xt.log("Setting video transceiver to sendonly:",l)}catch(O){xt.error(O)}}else if(!k&&y)if(l)try{l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",xt.log("Setting video transceiver to recvonly:",l)}catch(O){xt.error(O)}else l=i.pc.addTransceiver("video",{direction:"recvonly"}),xt.log("Adding recvonly video transceiver:",l)}else if(t.removeVideo&&l)try{l.setDirection?l.setDirection("inactive"):l.direction="inactive",xt.log("Setting video transceiver to inactive:",l)}catch(O){xt.error(O)}}else r="firefox"===xt.webRTCAdapter.browserDetails.browser||"edge"===xt.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:B(t),offerToReceiveVideo:z(t)}:{mandatory:{OfferToReceiveAudio:B(t),OfferToReceiveVideo:z(t)}};xt.debug(r);var _=J(t);if(_&&o&&"firefox"===xt.webRTCAdapter.browserDetails.browser){xt.log("Enabling Simulcasting for Firefox (RID)");var w=i.pc.getSenders()[1];xt.log(w);var S=w.getParameters();xt.log(S);var C=b(n.simulcastMaxBitrates);w.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:C.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:C.medium},{rid:"low",active:!0,priority:"low",maxBitrate:C.low}]})}i.pc.createAnswer(r).then((function(e){xt.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,xt.log("Setting local description"),_&&o&&("chrome"===xt.webRTCAdapter.browserDetails.browser?xt.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==xt.webRTCAdapter.browserDetails.browser&&xt.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=e.sdp,i.pc.setLocalDescription(e).catch(n.error),i.mediaConstraints=r,i.iceDone||i.trickle?((i.senderTransforms||i.receiverTransforms)&&(e.e2ee=!0),n.success(e)):xt.log("Waiting for all candidates...")}),n.error)}(e,n,a)}),a.error):function(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:xt.noop,n.error="function"==typeof n.error?n.error:xt.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:xt.noop;var a=E[e];if(!a||!a.webrtcStuff)return xt.warn("Invalid handle"),void n.error("Invalid handle");var i=a.webrtcStuff,o=!0===n.simulcast;o?xt.log("Creating offer (iceDone="+i.iceDone+", simulcast="+o+")"):xt.log("Creating offer (iceDone="+i.iceDone+")");var r={};if(xt.unifiedPlan){var s=null,l=null,c=i.pc.getTransceivers();if(c&&c.length>0){var u=!0,d=!1,m=void 0;try{for(var h,f=c[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var g=h.value;g.sender&&g.sender.track&&"audio"===g.sender.track.kind||g.receiver&&g.receiver.track&&"audio"===g.receiver.track.kind?s||(s=g):(g.sender&&g.sender.track&&"video"===g.sender.track.kind||g.receiver&&g.receiver.track&&"video"===g.receiver.track.kind)&&(l||(l=g))}}catch(x){d=!0,m=x}finally{try{u||null==f.return||f.return()}finally{if(d)throw m}}}var p=$(t),v=B(t);p||v?p&&v?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",xt.log("Setting audio transceiver to sendrecv:",s)):p&&!v?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",xt.log("Setting audio transceiver to sendonly:",s)):!p&&v&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",xt.log("Setting audio transceiver to recvonly:",s)):(s=i.pc.addTransceiver("audio",{direction:"recvonly"}),xt.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",xt.log("Setting audio transceiver to inactive:",s));var k=J(t),y=z(t);k||y?k&&y?l&&(l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",xt.log("Setting video transceiver to sendrecv:",l)):k&&!y?l&&(l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",xt.log("Setting video transceiver to sendonly:",l)):!k&&y&&(l?(l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",xt.log("Setting video transceiver to recvonly:",l)):(l=i.pc.addTransceiver("video",{direction:"recvonly"}),xt.log("Adding recvonly video transceiver:",l))):t.removeVideo&&l&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive",xt.log("Setting video transceiver to inactive:",l))}else r.offerToReceiveAudio=B(t),r.offerToReceiveVideo=z(t);!0===n.iceRestart&&(r.iceRestart=!0);xt.debug(r);var _=J(t);if(_&&o&&"firefox"===xt.webRTCAdapter.browserDetails.browser){xt.log("Enabling Simulcasting for Firefox (RID)");var w=i.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(w){var S=w.getParameters();S||(S={});var C=b(n.simulcastMaxBitrates);S.encodings=[{rid:"h",active:!0,maxBitrate:C.high},{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:C.low,scaleResolutionDownBy:4}],w.setParameters(S)}}i.pc.createOffer(r).then((function(e){xt.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,xt.log("Setting local description"),_&&o&&("chrome"===xt.webRTCAdapter.browserDetails.browser||"safari"===xt.webRTCAdapter.browserDetails.browser?(xt.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),n=!1,a=[-1],i=[-1],o=null,r=null,s=null,l=null,c=-1,u=0;u<t.length;u++){if(m=t[u].match(/m=(\w+) */)){if("video"===m[1]){if(!(a[0]<0)){c=u;break}n=!0}else if(a[0]>-1){c=u;break}}else if(n){var d=t[u].match(/a=ssrc-group:FID (\d+) (\d+)/);if(d)a[0]=d[1],i[0]=d[2],t.splice(u,1),u--;else{if(a[0]){if((f=t[u].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=f[1]),(f=t[u].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(r=f[1]),(f=t[u].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=f[1]),(f=t[u].match("a=ssrc:"+a[0]+" label:(.+)"))&&(l=f[1]),0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+a[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}}if(a[0]<0){c=-1,n=!1;for(u=0;u<t.length;u++){var m;if(m=t[u].match(/m=(\w+) */)){if("video"===m[1]){if(!(a[0]<0)){c=u;break}n=!0}else if(a[0]>-1){c=u;break}}else if(n){if(a[0]<0){var h=t[u].match(/a=ssrc:(\d+)/);if(h){a[0]=h[1],t.splice(u,1),u--;continue}}else{var f;if((f=t[u].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=f[1]),(f=t[u].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(r=f[1]),(f=t[u].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=f[1]),(f=t[u].match("a=ssrc:"+a[0]+" label:(.+)"))&&(l=f[1]),0===t[u].indexOf("a=ssrc:"+i[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+a[0])){t.splice(u,1),u--;continue}}0!==t[u].length||(t.splice(u,1),u--)}}}if(a[0]<0)return xt.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=t.length);a[1]=Math.floor(4294967295*Math.random()),a[2]=Math.floor(4294967295*Math.random()),i[1]=Math.floor(4294967295*Math.random()),i[2]=Math.floor(4294967295*Math.random());for(u=0;u<a.length;u++)o&&(t.splice(c,0,"a=ssrc:"+a[u]+" cname:"+o),c++),r&&(t.splice(c,0,"a=ssrc:"+a[u]+" msid:"+r),c++),s&&(t.splice(c,0,"a=ssrc:"+a[u]+" mslabel:"+s),c++),l&&(t.splice(c,0,"a=ssrc:"+a[u]+" label:"+l),c++),o&&(t.splice(c,0,"a=ssrc:"+i[u]+" cname:"+o),c++),r&&(t.splice(c,0,"a=ssrc:"+i[u]+" msid:"+r),c++),s&&(t.splice(c,0,"a=ssrc:"+i[u]+" mslabel:"+s),c++),l&&(t.splice(c,0,"a=ssrc:"+i[u]+" label:"+l),c++);t.splice(c,0,"a=ssrc-group:FID "+a[2]+" "+i[2]),t.splice(c,0,"a=ssrc-group:FID "+a[1]+" "+i[1]),t.splice(c,0,"a=ssrc-group:FID "+a[0]+" "+i[0]),t.splice(c,0,"a=ssrc-group:SIM "+a[0]+" "+a[1]+" "+a[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==xt.webRTCAdapter.browserDetails.browser&&xt.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),i.mySdp=e.sdp,i.pc.setLocalDescription(e).catch(n.error),i.mediaConstraints=r,i.iceDone||i.trickle?((i.senderTransforms||i.receiverTransforms)&&(e.e2ee=!0),n.success(e)):xt.log("Waiting for all candidates...")}),n.error)}(e,n,a)}function V(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:xt.noop,n.error="function"==typeof n.error?n.error:F;var a=n.jsep;if(t&&a)return xt.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!t&&(!a||!a.type||!a.sdp))return xt.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media="object"===typeof n.media&&n.media?n.media:{audio:!0,video:!0};var i=n.media,o=E[e];if(!o||!o.webrtcStuff)return xt.warn("Invalid handle"),void n.error("Invalid handle");var r,s=o.webrtcStuff;if(s.trickle=(r=n.trickle,xt.debug("isTrickleEnabled:",r),!1!==r),s.pc){if(xt.log("Updating existing media session"),i.update=!0,n.stream)n.stream!==s.myStream&&xt.log("Renegotiation involves a new external stream");else{if(i.addAudio){if(i.keepAudio=!1,i.replaceAudio=!1,i.removeAudio=!1,i.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return xt.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else i.removeAudio?(i.keepAudio=!1,i.replaceAudio=!1,i.addAudio=!1,i.audioSend=!1):i.replaceAudio&&(i.keepAudio=!1,i.addAudio=!1,i.removeAudio=!1,i.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!$(i)||i.removeAudio||i.replaceAudio||(i.keepAudio=!0):(i.replaceAudio&&(i.keepAudio=!1,i.replaceAudio=!1,i.addAudio=!0,i.audioSend=!0),$(i)&&(i.keepAudio=!1,i.addAudio=!0)),i.addVideo){if(i.keepVideo=!1,i.replaceVideo=!1,i.removeVideo=!1,i.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return xt.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else i.removeVideo?(i.keepVideo=!1,i.replaceVideo=!1,i.addVideo=!1,i.videoSend=!1):i.replaceVideo&&(i.keepVideo=!1,i.addVideo=!1,i.removeVideo=!1,i.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!J(i)||i.removeVideo||i.replaceVideo||(i.keepVideo=!0):(i.replaceVideo&&(i.keepVideo=!1,i.replaceVideo=!1,i.addVideo=!0,i.videoSend=!0),J(i)&&(i.keepVideo=!1,i.addVideo=!0)),i.addData&&(i.data=!0)}if($(i)&&i.keepAudio&&J(i)&&i.keepVideo)return o.consentDialog(!1),void R(e,a,i,n,s.myStream)}else i.update=!1,i.keepAudio=!1,i.keepVideo=!1;if(i.update&&!s.streamExternal){if(i.removeAudio||i.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var l=s.myStream.getAudioTracks()[0];xt.log("Removing audio track:",l),s.myStream.removeTrack(l);try{l.stop()}catch(H){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var c=!0;if(i.replaceAudio&&xt.unifiedPlan&&(c=!1),c){var u=!0,d=!1,m=void 0;try{for(var h,f=s.pc.getSenders()[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var g=h.value;g&&g.track&&"audio"===g.track.kind&&(xt.log("Removing audio sender:",g),s.pc.removeTrack(g))}}catch(Q){d=!0,m=Q}finally{try{u||null==f.return||f.return()}finally{if(d)throw m}}}}}if(i.removeVideo||i.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var p=s.myStream.getVideoTracks()[0];xt.log("Removing video track:",p),s.myStream.removeTrack(p);try{p.stop()}catch(H){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var v=!0;if(i.replaceVideo&&xt.unifiedPlan&&(v=!1),v){var b=!0,k=!1,y=void 0;try{for(var _,w=s.pc.getSenders()[Symbol.iterator]();!(b=(_=w.next()).done);b=!0){var S=_.value;S&&S.track&&"video"===S.track.kind&&(xt.log("Removing video sender:",S),s.pc.removeTrack(S))}}catch(Q){k=!0,y=Q}finally{try{b||null==w.return||w.return()}finally{if(k)throw y}}}}}}if(n.stream){var C=n.stream;if(xt.log("MediaStream provided by the application"),xt.debug(C),i.update&&s.myStream&&s.myStream!==n.stream&&!s.streamExternal){try{var O=s.myStream.getTracks(),j=!0,I=!1,T=void 0;try{for(var D,L=O[Symbol.iterator]();!(j=(D=L.next()).done);j=!0){var A=D.value;xt.log(A),A&&A.stop()}}catch(Q){I=!0,T=Q}finally{try{j||null==L.return||L.return()}finally{if(I)throw T}}}catch(H){}s.myStream=null}return s.streamExternal=!0,o.consentDialog(!1),void R(e,a,i,n,C)}if($(i)||J(i)){if(!xt.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var N={mandatory:{},optional:[]};o.consentDialog(!0);var x=$(i);x&&i&&"object"===typeof i.audio&&(x=i.audio);var V=J(i);if(V&&i){var M=!0===n.simulcast,P=!0===n.simulcast2;if(!M&&!P||a||i.video||(i.video="hires"),i.video&&"screen"!=i.video&&"window"!=i.video)if("object"===typeof i.video)V=i.video;else{var q=0,W=0;"lowres"===i.video?(W=240,240,q=320):"lowres-16:9"===i.video?(W=180,180,q=320):"hires"===i.video||"hires-16:9"===i.video||"hdres"===i.video?(W=720,720,q=1280):"fhdres"===i.video?(W=1080,1080,q=1920):"4kres"===i.video?(W=2160,2160,q=3840):"stdres"===i.video?(W=480,480,q=640):"stdres-16:9"===i.video?(W=360,360,q=640):(xt.log("Default video setting is stdres 4:3"),W=480,480,q=640),xt.log("Adding media constraint:",i.video),V={height:{ideal:W},width:{ideal:q}},xt.log("Adding video constraint:",V)}else if("screen"===i.video||"window"===i.video){var U=function(t,r){o.consentDialog(!1),t?n.error(t):R(e,a,i,n,r)},G=function(e,t,n){xt.log("Adding media constraint (screen capture)"),xt.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){e.addTrack(n.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){o.consentDialog(!1),t(e)}))};if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return N.video={},i.screenshareFrameRate&&(N.video.frameRate=i.screenshareFrameRate),i.screenshareHeight&&(N.video.height=i.screenshareHeight),i.screenshareWidth&&(N.video.width=i.screenshareWidth),N.audio=i.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(N).then((function(t){o.consentDialog(!1),$(i)&&!i.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(o){t.addTrack(o.getAudioTracks()[0]),R(e,a,i,n,t)})):R(e,a,i,n,t)}),(function(e){o.consentDialog(!1),n.error(e)}));if("chrome"===xt.webRTCAdapter.browserDetails.browser){var B=xt.webRTCAdapter.browserDetails.version,z=33;window.navigator.userAgent.match("Linux")&&(z=35),B>=26&&B<=z?(N={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate,chromeMediaSource:"screen"}},audio:$(i)&&!i.keepAudio},G(N,U)):xt.extension.getScreen((function(e,t){if(e)return o.consentDialog(!1),n.error(e);(N={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:i.screenshareFrameRate,maxFrameRate:i.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,G(N,U,$(i)&&!i.keepAudio)}))}else if("firefox"===xt.webRTCAdapter.browserDetails.browser){if(!(xt.webRTCAdapter.browserDetails.version>=33)){var K=new Error("NavigatorUserMediaError");return K.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void n.error(K)}N={video:{mozMediaSource:i.video,mediaSource:i.video},audio:$(i)&&!i.keepAudio},G(N,(function(e,t){if(U(e,t),!e)var n=t.currentTime,a=window.setInterval((function(){t||window.clearInterval(a),t.currentTime==n&&(window.clearInterval(a),t.onended&&t.onended()),n=t.currentTime}),500)}))}return}}i&&"screen"===i.video||navigator.mediaDevices.enumerateDevices().then((function(t){var r=t.some((function(e){return"audioinput"===e.kind})),s=function(e){if(xt.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(i)||t.some((function(e){return"videoinput"===e.kind})),l=$(i),c=J(i),u=function(e){return xt.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(i),d=function(e){return xt.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(i);if(l||c||u||d){var m=!!l&&r,h=!!c&&s;if(!m&&!h)return o.consentDialog(!1),n.error("No capture device found"),!1;if(!m&&u)return o.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!h&&d)return o.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var f={audio:!(!r||i.keepAudio)&&x,video:!(!s||i.keepVideo)&&V};xt.debug("getUserMedia constraints",f),f.audio||f.video?navigator.mediaDevices.getUserMedia(f).then((function(t){o.consentDialog(!1),R(e,a,i,n,t)})).catch((function(e){o.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})):(o.consentDialog(!1),R(e,a,i,n,C))})).catch((function(e){o.consentDialog(!1),n.error("enumerateDevices error",e)}))}else R(e,a,i,n)}function M(e,t){(t=t||{}).success="function"==typeof t.success?t.success:xt.noop,t.error="function"==typeof t.error?t.error:F;var n=t.jsep,a=E[e];if(!a||!a.webrtcStuff)return xt.warn("Invalid handle"),void t.error("Invalid handle");var i=a.webrtcStuff;if(n){if(!i.pc)return xt.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");i.pc.setRemoteDescription(n).then((function(){if(xt.log("Remote description accepted!"),i.remoteSdp=n.sdp,i.candidates&&i.candidates.length>0){for(var e=0;e<i.candidates.length;e++){var a=i.candidates[e];xt.debug("Adding remote candidate:",a),a&&!0!==a.completed?i.pc.addIceCandidate(a):i.pc.addIceCandidate(xt.endOfCandidates)}i.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function P(e,t){var n=E[e];if(!n||!n.webrtcStuff)return xt.warn("Invalid handle"),0;var a=t?"remote":"local",i=n.webrtcStuff;return i.volume[a]||(i.volume[a]={value:0}),!i.pc.getStats||"chrome"!==xt.webRTCAdapter.browserDetails.browser&&"safari"!==xt.webRTCAdapter.browserDetails.browser?(xt.warn("Getting the "+a+" volume unsupported by browser"),0):t&&!i.remoteStream?(xt.warn("Remote stream unavailable"),0):t||i.myStream?i.volume[a].timer?i.volume[a].value:(xt.log("Starting "+a+" volume monitor"),i.volume[a].timer=setInterval((function(){i.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(i.volume[a].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(xt.warn("Local stream unavailable"),0)}function q(e,t){var n=E[e];if(!n||!n.webrtcStuff)return xt.warn("Invalid handle"),!0;var a=n.webrtcStuff;return a.pc?a.myStream?t?a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!a.myStream.getVideoTracks()[0].enabled:(xt.warn("No video track"),!0):a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!a.myStream.getAudioTracks()[0].enabled:(xt.warn("No audio track"),!0):(xt.warn("Invalid local MediaStream"),!0):(xt.warn("Invalid PeerConnection"),!0)}function W(e,t,n){var a=E[e];if(!a||!a.webrtcStuff)return xt.warn("Invalid handle"),!1;var i=a.webrtcStuff;return i.pc?i.myStream?t?i.myStream.getVideoTracks()&&0!==i.myStream.getVideoTracks().length?(i.myStream.getVideoTracks()[0].enabled=!n,!0):(xt.warn("No video track"),!1):i.myStream.getAudioTracks()&&0!==i.myStream.getAudioTracks().length?(i.myStream.getAudioTracks()[0].enabled=!n,!0):(xt.warn("No audio track"),!1):(xt.warn("Invalid local MediaStream"),!1):(xt.warn("Invalid PeerConnection"),!1)}function U(e){var t=E[e];if(!t||!t.webrtcStuff)return xt.warn("Invalid handle"),"Invalid handle";var n=t.webrtcStuff;return n.pc?n.pc.getStats?n.bitrate.timer?n.bitrate.value:(xt.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var a=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"===xt.webRTCAdapter.browserDetails.browser&&(a/=1e3);var i=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/a);"safari"===xt.webRTCAdapter.browserDetails.browser&&(i=parseInt(i/1e3)),n.bitrate.value=i+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(xt.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function F(e){xt.error("WebRTC error:",e)}function G(e,a){xt.log("Cleaning WebRTC stuff");var i=E[e];if(i){var o=i.webrtcStuff;if(o){if(!0===a){var r={janus:"hangup",transaction:xt.randomString(12)};i.token&&(r.token=i.token),g&&(r.apisecret=g),xt.debug("Sending hangup request (handle="+e+"):"),xt.debug(r),t?(r.session_id=y,r.handle_id=e,n.send(JSON.stringify(r))):xt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:r})}o.remoteStream=null,o.volume&&(o.volume.local&&o.volume.local.timer&&clearInterval(o.volume.local.timer),o.volume.remote&&o.volume.remote.timer&&clearInterval(o.volume.remote.timer)),o.volume={},o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null;try{if(!o.streamExternal&&o.myStream){xt.log("Stopping local stream tracks");var l=o.myStream.getTracks(),c=!0,u=!1,d=void 0;try{for(var h,f=l[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;xt.log(p),p&&p.stop()}}catch(v){u=!0,d=v}finally{try{c||null==f.return||f.return()}finally{if(u)throw d}}}}catch(b){}o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(b){}o.pc=null,o.candidates=null,o.mySdp=null,o.remoteSdp=null,o.iceDone=!1,o.dataChannel={},o.dtmfSender=null,o.senderTransforms=null,o.receiverTransforms=null}i.oncleanup()}}function $(e){return xt.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function B(e){return xt.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function J(e){return xt.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function z(e){return xt.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}I(e),this.getServer=function(){return s},this.isConnected=function(){return k},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:xt.noop,e.error="function"==typeof e.error?e.error:xt.noop,e.reconnect=!0,I(e)},this.getSessionId=function(){return y},this.destroy=function(o){!function(o){(o=o||{}).success="function"==typeof o.success?o.success:xt.noop,o.error="function"==typeof o.error?o.error:xt.noop;var r=!0===o.unload,l=!0;void 0!==o.notifyDestroyed&&null!==o.notifyDestroyed&&(l=!0===o.notifyDestroyed);var c=!0===o.cleanupHandles;if(xt.log("Destroying session "+y+" (unload="+r+")"),!y)return xt.warn("No session to destroy"),o.success(),void(l&&e.destroyed());if(c)for(var u in E)x(u,{noRequest:!0});if(!k)return xt.warn("Is the server down? (connected=false)"),y=null,void o.success();var d={janus:"destroy",transaction:xt.randomString(12)};f&&(d.token=f);g&&(d.apisecret=g);if(r)return t?(n.onclose=null,n.close(),n=null):navigator.sendBeacon(s+"/"+y,JSON.stringify(d)),xt.log("Destroyed session:"),y=null,k=!1,o.success(),void(l&&e.destroyed());if(t){d.session_id=y;var h=function(){for(var e in a)n.removeEventListener(e,a[e]);n.removeEventListener("message",p),n.removeEventListener("error",v),i&&clearTimeout(i),n.close()},p=function(t){var n=JSON.parse(t.data);n.session_id==d.session_id&&n.transaction==d.transaction&&(h(),o.success(),l&&e.destroyed())},v=function(t){h(),o.error("Failed to destroy the server: Is the server down?"),l&&e.destroyed()};return n.addEventListener("message",p),n.addEventListener("error",v),void n.send(JSON.stringify(d))}xt.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:m,body:d,success:function(t){xt.log("Destroyed session:"),xt.debug(t),y=null,k=!1,"success"!==t.janus&&xt.error("Ooops: "+t.error.code+" "+t.error.reason),o.success(),l&&e.destroyed()},error:function(t,n){xt.error(t+":",n),y=null,k=!1,o.success(),l&&e.destroyed()}})}(o)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:xt.noop,e.error="function"==typeof e.error?e.error:xt.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:xt.noop,e.iceState="function"==typeof e.iceState?e.iceState:xt.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:xt.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:xt.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:xt.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:xt.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:xt.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:xt.noop,e.ondata="function"==typeof e.ondata?e.ondata:xt.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:xt.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:xt.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:xt.noop,!k)return xt.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var a=e.plugin;if(!a)return xt.error("Invalid plugin"),void e.error("Invalid plugin");var i=e.opaqueId,o=e.token?e.token:f,r=xt.randomString(12),l={janus:"attach",plugin:a,opaque_id:i,transaction:r};o&&(l.token=o);g&&(l.apisecret=g);if(t)return S[r]=function(t){if(xt.debug(t),"success"!==t.janus)return xt.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var n=t.data.id;xt.log("Created handle: "+n);var i={session:_,plugin:a,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return P(n,!0)},getRemoteVolume:function(){return P(n,!0)},getLocalVolume:function(){return P(n,!1)},isAudioMuted:function(){return q(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return q(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return U(n)},send:function(e){T(n,e)},data:function(e){A(n,e)},dtmf:function(e){N(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){V(n,!0,e)},createAnswer:function(e){V(n,!1,e)},handleRemoteJsep:function(e){M(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(n,!0===e)},detach:function(e){x(n,e)}};E[n]=i,e.success(i)},l.session_id=y,void n.send(JSON.stringify(l));xt.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:m,body:l,success:function(t){if(xt.debug(t),"success"!==t.janus)return xt.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var n=t.data.id;xt.log("Created handle: "+n);var i={session:_,plugin:a,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return P(n,!0)},getRemoteVolume:function(){return P(n,!0)},getLocalVolume:function(){return P(n,!1)},isAudioMuted:function(){return q(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return q(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return U(n)},send:function(e){T(n,e)},data:function(e){A(n,e)},dtmf:function(e){N(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){V(n,!0,e)},createAnswer:function(e){V(n,!1,e)},handleRemoteJsep:function(e){M(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(n,!0===e)},detach:function(e){x(n,e)}};E[n]=i,e.success(i)},error:function(t,n){xt.error(t+":",n),""===n?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}(e)}}xt.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,n=e&&e.Promise||Promise,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new a(e,t)},extension:e&&e.extension||Nt,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||Lt.a,httpAPICall:function(e,a){var i={method:a.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===a.verb&&(i.headers["Content-Type"]="application/json"),void 0!==a.withCredentials&&(i.credentials=!0===a.withCredentials?"include":a.withCredentials?a.withCredentials:"omit"),a.body&&(i.body=JSON.stringify(a.body));var o=t(e,i).catch((function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})}));if(a.timeout){var r=new n((function(e,t){var n=setTimeout((function(){return clearTimeout(n),t({message:"Request timed out",timeout:a.timeout})}),a.timeout)}));o=n.race([o,r])}return o.then((function(e){return e.ok?typeof a.success===typeof xt.noop?e.json().then((function(e){a.success(e)})).catch((function(t){return n.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:n.reject({message:"API call failed",response:e})})).catch((function(e){typeof a.error===typeof xt.noop&&a.error(e.message||"<< internal error >>",e)})),o}}},xt.useOldDependencies=function(e){var t=e&&e.jQuery||le.a,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||Nt,webRTCAdapter:e&&e.adapter||Lt.a,httpAPICall:function(e,n){var a=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},i=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return t.ajax(t.extend(a,i,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){typeof n.success===typeof xt.noop&&n.success(e)},error:function(e,t,a){typeof n.error===typeof xt.noop&&n.error(t,a)}}))}}},xt.noop=function(){},xt.dataChanDefaultLabel="JanusDataChannel",xt.endOfCandidates=null,xt.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:xt.noop,xt.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),xt.trace=xt.noop,xt.debug=xt.noop,xt.vdebug=xt.noop,xt.log=xt.noop,xt.warn=xt.noop,xt.error=xt.noop,!0===e.debug||"all"===e.debug)xt.trace=console.trace.bind(console),xt.debug=console.debug.bind(console),xt.vdebug=console.debug.bind(console),xt.log=console.log.bind(console),xt.warn=console.warn.bind(console),xt.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t=!0,n=!1,a=void 0;try{for(var i,o=e.debug[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value;switch(r){case"trace":xt.trace=console.trace.bind(console);break;case"debug":xt.debug=console.debug.bind(console);break;case"vdebug":xt.vdebug=console.debug.bind(console);break;case"log":xt.log=console.log.bind(console);break;case"warn":xt.warn=console.warn.bind(console);break;case"error":xt.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+r+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(b){n=!0,a=b}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}xt.log("Initializing library");var s=e.dependencies||xt.useDefaultDependencies();xt.isArray=s.isArray,xt.webRTCAdapter=s.webRTCAdapter,xt.httpAPICall=s.httpAPICall,xt.newWebSocket=s.newWebSocket,xt.extension=s.extension,xt.extension.init(),xt.listDevices=function(e,t){e="function"==typeof e?e:xt.noop,null==t&&(t={audio:!0,video:!0}),xt.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){xt.debug(n),e(n);try{var a=t.getTracks(),i=!0,o=!1,r=void 0;try{for(var s,l=a[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;c&&c.stop()}}catch(b){o=!0,r=b}finally{try{i||null==l.return||l.return()}finally{if(o)throw r}}}catch(u){}}))})).catch((function(t){xt.error(t),e([])})):(xt.warn("navigator.mediaDevices unavailable"),e([]))},xt.attachMediaStream=function(e,t){try{e.srcObject=t}catch(n){try{e.src=URL.createObjectURL(t)}catch(n){xt.error("Error attaching stream to element"),console.log("Error attaching stream to element")}}},xt.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(n){try{e.src=t.src}catch(n){xt.error("Error reattaching stream to element")}}};var l=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",c=window["on"+l];if(window.addEventListener(l,(function(e){for(var t in xt.log("Closing window"),xt.sessions)xt.sessions[t]&&xt.sessions[t].destroyOnUnload&&(xt.log("Destroying session "+t),xt.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));c&&"function"==typeof c&&c()})),xt.safariVp8=!1,"safari"===xt.webRTCAdapter.browserDetails.browser&&xt.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var u=!0,d=!1,m=void 0;try{for(var h,f=RTCRtpSender.getCapabilities("video").codecs[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var g=h.value;if(g&&g.mimeType&&"video/vp8"===g.mimeType.toLowerCase()){xt.safariVp8=!0;break}}}catch(b){d=!0,m=b}finally{try{u||null==f.return||f.return()}finally{if(d)throw m}}xt.safariVp8?xt.log("This version of Safari supports VP8"):xt.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var p=new RTCPeerConnection({});p.createOffer({offerToReceiveVideo:!0}).then((function(e){xt.safariVp8=-1!==e.sdp.indexOf("VP8"),xt.safariVp8?xt.log("This version of Safari supports VP8"):xt.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),p.close(),p=null}))}if(xt.unifiedPlan=!1,"firefox"===xt.webRTCAdapter.browserDetails.browser&&xt.webRTCAdapter.browserDetails.version>=59)xt.unifiedPlan=!0;else if("chrome"===xt.webRTCAdapter.browserDetails.browser&&xt.webRTCAdapter.browserDetails.version<72)xt.unifiedPlan=!1;else if(window.RTCRtpTransceiver&&"currentDirection"in At.prototype){var v=new RTCPeerConnection;try{v.addTransceiver("audio"),xt.unifiedPlan=!0}catch(k){}v.close()}else xt.unifiedPlan=!1;xt.initDone=!0,e.callback()}},xt.isWebrtcSupported=function(){return!!window.RTCPeerConnection},xt.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},xt.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",a=0;a<e;a++){var i=Math.floor(Math.random()*t.length);n+=t.substring(i,i+1)}return n};var Rt=xt,Vt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.sessionCreate=e.sessionCreate.bind(Object(x.a)(e)),e.registerUsername=e.registerUsername.bind(Object(x.a)(e)),e.newRemoteFeed=e.newRemoteFeed.bind(Object(x.a)(e)),e.publishCamera=e.publishCamera.bind(Object(x.a)(e)),e.publishMicrophone=e.publishMicrophone.bind(Object(x.a)(e)),e.off=e.off.bind(Object(x.a)(e)),e.on=e.on.bind(Object(x.a)(e)),e.pageAfterIn=e.pageAfterIn.bind(Object(x.a)(e)),e.streamAttacher=e.streamAttacher.bind(Object(x.a)(e)),e.unmute=e.unmute.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.sendData=e.sendData.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.speakRequest=e.speakRequest.bind(Object(x.a)(e)),e.publishData=e.publishData.bind(Object(x.a)(e)),e.removeRequest=e.removeRequest.bind(Object(x.a)(e)),e.acceptRequest=e.acceptRequest.bind(Object(x.a)(e)),e.addParticipant=e.addParticipant.bind(Object(x.a)(e)),e.removeParticipant=e.removeParticipant.bind(Object(x.a)(e)),e.unPublishData=e.unPublishData.bind(Object(x.a)(e)),e.exisitingParticipant=e.exisitingParticipant.bind(Object(x.a)(e)),e.requestAccepted=e.requestAccepted.bind(Object(x.a)(e)),e.findParticpant=e.findParticpant.bind(Object(x.a)(e)),e.participantIndex=e.participantIndex.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),shortners:null,server:y.janusServer,janus:null,sfutest:null,opaqueId:"videoroomtest-"+Rt.randomString(12),roomId:null,myusername:null,myid:null,mystream:null,mypvtid:"videoroomtest-"+Rt.randomString(12),pin:null,feeds:[],activeFeeds:[],bitrateTimer:[],userUUID:null,fullname:null,urls:[],publisedCamera:!1,publishedMicrophone:!1,muted:!0,requests:[],lowFeeds:[],participants:[],room:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance),this.unPublishData()}},{key:"setInstance",value:function(){}},{key:"updateSubscribers",value:function(){O("subscribers",{room_id:this.state.roomId},this.state.token)}},{key:"renewSubscribers",value:function(){S("subscribers",this.state.roomId,this.state.token)}},{key:"sessionCreate",value:function(){var e=this;Rt.init({debug:"all",callback:function(){var t=new Rt({server:e.state.server,success:function(){t.attach({plugin:"janus.plugin.videoroom",opaqueId:e.state.opaqueId,success:function(n){e.setState({janus:t}),e.setState({sfutest:n}),Rt.log("Plugin attached! ("+e.state.sfutest.getPlugin()+", id="+e.state.sfutest.getId()+")"),Rt.log("  -- This is a publisher/manager"),e.registerUsername()},error:function(e){Rt.error("  -- Error attaching plugin...",e),window.alert("Error attaching plugin... "+e)},consentDialog:function(e){Rt.debug("Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){Rt.log("ICE state changed to "+e)},mediaState:function(e,t){Rt.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){Rt.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(t,n){Rt.log(" ::: Got a message (publisher) :::",t);var a=t.videoroom;if(Rt.debug("Event: "+a),a)if("joined"===a){if(console.log("joined"),e.setState({myid:t.id,mypvtid:t.private_id}),e.addParticipant(t.id,e.state.fullname+"\xa7"+e.state.userUUID),t.publishers){var i=t.publishers;for(var o in console.log("Got a list of available publishers/feeds:",i),i){var r=i[o].id,s=i[o].display,l=i[o].audio_codec,c=i[o].video_codec;Rt.debug("  >> ["+r+"] "+s+" (audio: "+l+", video: "+c+")"),e.addParticipant(i[o].id,i[o].display),e.newRemoteFeed(r,s,l,c)}}}else if("destroyed"===a)Rt.warn("The room has been destroyed!");else if("event"===a)if(t.publishers){i=t.publishers;for(var o in Rt.log("Got a list of available publishers/feeds:",i),i){r=i[o].id,s=i[o].display,l=i[o].audio_codec,c=i[o].video_codec;Rt.log("  >> ["+r+"] "+s+" (audio: "+l+", video: "+c+")"),e.addParticipant(i[o].id,i[o].display),e.newRemoteFeed(r,s,l,c)}}else if(t.leaving){var u=t.leaving;console.log("Publisher leaving: "+u),e.setState({feeds:e.state.feeds.filter((function(e){return e.rfid!=u}))},(function(){return console.log("feeds: >>>>",e.state.feeds)})),null!=(m=(h=e.state.feeds.filter((function(e){return e.rfid===u}))).shift())&&m.detach(),e.removeParticipant(u)}else if(t.unpublished){var d=t.unpublished;if(console.log("Publisher left: "+d),"ok"===d)return void e.state.sfutest.hangup();e.setState({feeds:e.state.feeds.filter((function(e){return e.rfid!=d}))});var m,h=e.state.feeds.filter((function(e){return e.rfid===d}));e.setState({lowFeeds:e.state.lowFeeds.filter((function(e){return e.rfid!=d}))}),null!=(m=h.shift())&&m.detach(),e.removeParticipant(d)}else t.error||t.configured||t.joining&&e.addParticipant(t.joining.id,t.joining.display);n&&(Rt.log("Handling SDP as well...",n),e.state.sfutest.handleRemoteJsep({jsep:n}))},onlocalstream:function(t){console.log(" ::: Got a local stream :::",t),console.log(e.state.sfutest.id),0===e.state.feeds.filter((function(t){return t.id===e.state.sfutest.id})).length&&e.setState({feeds:e.state.feeds.concat(e.state.sfutest)});var n=t.getVideoTracks();n&&0!==n.length?(e.$$("#video-"+e.state.sfutest.id).show(),Rt.attachMediaStream(document.getElementById("video-"+e.state.sfutest.id),t),document.getElementById("video-"+e.state.sfutest.id).muted=!0):e.$$("#video-"+e.state.sfutest.id).hide()},onremotestream:function(e){Rt.log(" ::: Got a remote stream :::",e)},ondata:function(e){Rt.debug("We got data from the DataChannel!",e)},oncleanup:function(){Rt.log(" ::: Got a cleanup notification: we are unpublished now :::")}})},error:function(e){Rt.error(e),window.alert(e,(function(){window.location.reload()}))},destroyed:function(){window.location.reload()}})}})}},{key:"registerUsername",value:function(){var e={request:"join",room:this.state.roomId,ptype:"publisher",display:this.state.fullname+" \xa7"+this.state.userUUID,pin:this.state.pin};this.state.sfutest.send({message:e}),this.publishData()}},{key:"addParticipant",value:function(e,t){var n=t.split("\xa7");this.exisitingParticipant(n[1])&&this.setState({participants:this.state.participants.concat({id:e,display:n[0],uuid:n[1],role:"listener"})}),console.log("participant added:",n[1])}},{key:"exisitingParticipant",value:function(e){return 0===this.state.participants.filter((function(t){return t.uuid===e})).length}},{key:"removeParticipant",value:function(e){this.setState({participants:this.state.participants.filter((function(t){return t.id!==e}))})}},{key:"newRemoteFeed",value:function(e,t,n,a,i){var o=this,r=null;o.state.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.state.opaqueId,success:function(t){(r=t).simulcastStarted=!1,Rt.log("Plugin attached! ("+r.getPlugin()+", id="+r.getId()+")"),Rt.log("  -- This is a subscriber");var n={request:"join",room:o.state.roomId,ptype:"subscriber",pin:o.state.pin,feed:e,private_id:o.state.mypvtid};"safari"!==Rt.webRTCAdapter.browserDetails.browser||"vp9"!==i&&("vp8"!==i||Rt.safariVp8)||(i&&(i=i.toUpperCase()),console.log("Publisher is using "+i+", but Safari doesn't support it: disabling video"),n.offer_video=!1),r.videoCodec=i,r.send({message:n})},error:function(e){Rt.error("  -- Error attaching plugin...",e),window.alert("Error attaching plugin... "+e)},onmessage:function(e,t){Rt.debug(" ::: Got a message (subscriber) :::",e);var n=e.videoroom;Rt.log("Event: "+n),e.error?window.alert(e.error):n&&"attached"===n&&(o.setState({feeds:o.state.feeds.concat(r)}),o.setState({lowFeeds:o.state.lowFeeds.concat(r)}),i&&a||(o.$$("#video-"+r.id).hide(),o.$$("#lowVideo-"+r.id).hide()),r.rfid=e.id,r.rfdisplay=e.display,Rt.log("Successfully attached to feed "+r.rfid+" ("+r.rfdisplay+") in room "+e.room)),t&&(Rt.log("Handling SDP as well...",t),r.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){Rt.log("Got SDP!",e);var t={request:"start",room:o.state.roomId};r.send({message:t,jsep:e})},error:function(e){Rt.log("WebRTC error:",e),window.alert("WebRTC error... "+e.message)}}))},iceState:function(e){Rt.log("ICE state of this WebRTC PeerConnection (feed #"+r.rfindex+") changed to "+e)},webrtcState:function(e){Rt.log("Janus says this WebRTC PeerConnection (feed #"+r.rfindex+") is "+(e?"up":"down")+" now"),"down"===e&&o.removeParticipant(r.rfid)},onlocalstream:function(e){console.log(">>>>>>>>>>>",e)},onremotestream:function(e){console.log("\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7\xa7",e);var t=e.getVideoTracks();t&&0!==t.length?(o.$$("#video-"+r.id).show(),o.$$("#lowVideo-"+r.id).show(),Rt.attachMediaStream(document.getElementById("video-"+r.id),e),Rt.attachMediaStream(document.getElementById("lowVideo-"+r.id),e)):(o.$$("#video-"+r.id).hide(),o.$$("#lowVideo-"+r.id).hide());var n=e.getAudioTracks();n&&0!==n.length?(o.$$("#video-"+r.id).hide(),Rt.attachMediaStream(document.getElementById("video-"+r.id),e)):o.$$("#video-"+r.id).hide()},ondata:function(e){var t=JSON.parse(e);0===o.state.requests.filter((function(e){return e.uuid===t.uuid})).length&&"up"===t.request&&o.setState({requests:o.state.requests.concat({display:t.display,uuid:t.uuid})}),"removeRequest"===t.request&&o.setState({requests:o.state.requests.filter((function(e){return e.uuid!=t.uuid}))}),"acceptRequest"===t.request&&(o.setState({requests:o.state.requests.filter((function(e){return e.uuid!=t.uuid}))}),o.requestAccepted(t.uuid),t.uuid===o.state.userUUID&&(o.state.publisedCamera?o.publishCamera(32):o.publishMicrophone()))},oncleanup:function(){Rt.log(" ::: Got a cleanup notification (remote feed "+e+") :::")}})}},{key:"requestAccepted",value:function(e){var t=Object.assign({},this.state),n=this.findParticpant(e),a=this.participantIndex(e);t.participants[a]={id:n.id,display:n.display,uuid:n.uuid,role:"speaker"},this.setState(t)}},{key:"findParticpant",value:function(e){var t=this.state.participants.filter((function(t){return t.uuid===e}));if(t&&t[0])return t[0]}},{key:"participantIndex",value:function(e){var t=this.state.participants.findIndex((function(t){return t.uuid===e}));if(t)return t}},{key:"participantIsSpeaker",value:function(e){var t=this.findParticpant(e);return!(!t||"speaker"!==t.role)}},{key:"streamAttacher",value:function(e){e.id&&e.webrtcStuff&&e.webrtcStuff.remoteStream&&Rt.attachMediaStream(document.getElementById("video-"+e.id),e.webrtcStuff.remoteStream)}},{key:"sendData",value:function(){var e={textroom:"message",transaction:Rt.randomString(12),room:this.state.roomId,text:"UUUUU"};this.state.sfutest.data({text:JSON.stringify(e),error:function(e){console.log(e)},success:function(){console.log("sent")}})}},{key:"speakRequest",value:function(){var e=this,t={textroom:"message",transaction:Rt.randomString(12),room:this.state.roomId,request:"up",uuid:this.state.userUUID,display:this.state.fullname};this.state.sfutest.data({text:JSON.stringify(t),error:function(e){console.log(e)},success:function(){console.log("request sent"),0===e.state.requests.filter((function(e){return e.uuid===t.uuid})).length&&"up"===t.request&&e.setState({requests:e.state.requests.concat({display:t.display,uuid:t.uuid})})}})}},{key:"publishData",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!1,audioSend:!1},success:function(t){if(Rt.debug("********* Got publisher SDP!",t),t){e.state.sfutest.send({message:{request:"publish",audio:!0,video:!0,data:!0},jsep:t})}},error:function(e){Rt.error("***** WebRTC error:",e)}})}},{key:"unPublishData",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!1,videoSend:!1,audioSend:!1},success:function(t){if(Rt.debug("********* Got publisher SDP!",t),t){e.state.sfutest.send({message:{request:"unpublish",audio:!1,video:!1,data:!1},jsep:t})}},error:function(e){Rt.error("***** WebRTC error:",e)}})}},{key:"publishCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=this;t.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!t.state.publisedCamera,removeVideo:t.state.publisedCamera,audioSend:t.state.publishedMicrophone},success:function(n){if(Rt.debug("********* Got publisher SDP!",n),n){var a={request:"configure",audio:t.state.publishedMicrophone,video:!t.state.publisedCamera,data:!0,bitrate:1e3*e,bitrate_cap:!0,videocodec:"vp8"};t.state.sfutest.send({message:a,jsep:n})}t.setState({publisedCamera:!t.state.publisedCamera})},error:function(e){Rt.error("***** WebRTC error:",e)}})}},{key:"publishMicrophone",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,audioSend:!e.state.publishedMicrophone,removeAudio:e.state.publishedMicrophone,videoSend:e.state.publisedCamera},success:function(t){if(Rt.debug("********* Got publisher SDP!",t),t){var n={request:"configure",data:!0,audio:!e.state.publishedMicrophone,video:e.state.publisedCamera};e.state.sfutest.send({message:n,jsep:t}),e.setState({publishedMicrophone:!e.state.publishedMicrophone})}},error:function(e){Rt.error("***** WebRTC error:",e)}})}},{key:"off",value:function(){console.log(this.state.feeds);var e={request:"switch",feed:this.state.feeds[1].rfid,video:!1};this.state.feeds[1].send({message:e})}},{key:"on",value:function(){console.log(this.state.feeds);var e={request:"switch",feed:this.state.feeds[1].rfid,video:!0};this.state.feeds[1].send({message:e})}},{key:"componentDidMount",value:function(){S("rooms",this.$f7route.params.roomId,this.state.token)}},{key:"getInstance",value:function(){var e=this,t=V.getIntance(),n=V.getKlass();t&&"Room"===n&&this.setState({room:t,id:t.id,roomId:t.room_id,pin:t.pin,userUUID:t.user_uuid,fullname:t.user_fullname,title:t.title},(function(){return e.pageAfterIn()})),this.$$(".btn").show()}},{key:"pageAfterIn",value:function(){setTimeout(function(){this.sessionCreate(),this.unmute()}.bind(this),1e4)}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),_("shortners",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Shortner"===t&&this.setState({shortners:e})}},{key:"unmute",value:function(){this.setState({muted:!1})}},{key:"acceptRequest",value:function(e){var t=this,n={textroom:"message",transaction:Rt.randomString(12),room:this.state.roomId,request:"acceptRequest",uuid:e};this.state.sfutest.data({text:JSON.stringify(n),error:function(e){console.log(e)},success:function(){t.setState({requests:t.state.requests.filter((function(t){return t.uuid!=e}))})}})}},{key:"removeRequest",value:function(e){var t=this,n={textroom:"message",transaction:Rt.randomString(12),room:this.state.roomId,request:"removeRequest",uuid:e};this.state.sfutest.data({text:JSON.stringify(n),error:function(e){console.log(e)},success:function(){t.setState({requests:t.state.requests.filter((function(t){return t.uuid!=e}))})}})}},{key:"render",value:function(){var e=this.state,t=e.shortners,n=e.urls,a=e.publishedMicrophone,o=e.publisedCamera,r=e.feeds,s=e.muted,l=e.lowFeeds,c=e.requests,u=e.participants,d=e.room;return i.a.createElement(Dt,{pageAfterIn:this.pageAfterIn,shortners:t,streamAttacher:this.streamAttacher,urls:n,off:this.off,on:this.on,feeds:r,muted:s,lowFeeds:l,requests:c,room:d,participants:u,unmute:this.unmute,publisedCamera:o,publishedMicrophone:a,publishCamera:this.publishCamera,publishMicrophone:this.publishMicrophone,sendData:this.sendData,speakRequest:this.speakRequest,accept:this.accept,removeRequest:this.removeRequest,acceptRequest:this.acceptRequest})}}]),t}(i.a.Component),Mt=function(e){return e.rooms?i.a.createElement(l.r,{mediaList:!0},e.rooms.map((function(e){return i.a.createElement(l.t,{key:U.a.lib.WordArray.random(32),link:"/rooms/"+e.id,ignoreCache:!0,title:e.title,after:"",subtitle:"",text:""})}))):i.a.createElement("ul",null)},Pt=function(e){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.rooms,backLink:N.back}),i.a.createElement(l.g,null,N.list),function(t){console.log(e.ability);var n=[];return e.ability&&e.ability.map((function(e){e.title===t&&e.value&&n.push(i.a.createElement(l.o,{href:"/rooms/new",target:"#main-view",position:"left-bottom",slot:"fixed",color:"deeporange"},i.a.createElement(l.p,{ios:"f7:add",aurora:"f7:add",md:"material:add"}),i.a.createElement(l.p,{ios:"f7:close",aurora:"f7:close",md:"material:close"})))})),n}("new_room"),i.a.createElement(Mt,{rooms:e.rooms}))},qt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).getList=e.getList.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),rooms:null,ability:null,profileId:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_list",this.getList),V.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_list",this.getList),V.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),_("rooms",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=V.getList(),t=V.getKlass();e&&"Room"===t&&this.setState({rooms:e})}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"UserRole"===t&&this.setState({ability:e.the_ability,profileId:e.profile_id})}},{key:"render",value:function(){var e=this.state,t=e.rooms,n=e.ability;return i.a.createElement(Pt,{rooms:t,ability:n})}}]),t}(i.a.Component),Wt=function(e){if(e.defaultRoom)var t=!0;else t=!1;return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.g,null,N.room),i.a.createElement(l.r,null,i.a.createElement(l.s,{label:N.title,key:"room-title",type:"text",placeholder:"...",defaultValue:e.room.title,onInput:function(t){e.handleChange({title:t.target.value})}}),i.a.createElement(l.s,{label:N.details,type:"textarea",placeholder:N.write_appropriate_description,value:e.details,onInput:function(t){e.handleChange({details:t.target.value})}}),i.a.createElement(l.t,{radio:!0,value:!1,checked:!t,name:"privateRoom",title:N.NonPrivate,onChange:function(t){console.log(t),e.handleChange({privateRoom:JSON.parse(t.target.value)})}}),i.a.createElement(l.t,{radio:!0,value:!0,checked:t,name:"privateRoom",title:N.Private,onChange:function(t){console.log(t),e.handleChange({privateRoom:JSON.parse(t.target.value)})}})),i.a.createElement(l.f,{strong:!0},i.a.createElement(l.z,{tag:"p"},i.a.createElement(l.q,{className:"btn-notice"}),i.a.createElement(l.h,{className:"col btn",fill:!0,disabled:!e.editing,onClick:e.submit},N.submit))))},Ut=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),room:{},defaultRoom:!0},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){O("rooms",{title:this.state.title,default_room:this.state.defaultRoom},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/rooms/")}},{key:"render",value:function(){var e=this.state,t=e.room,n=e.defaultRoom;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.room_form,backLink:N.back}),i.a.createElement(l.g,null,N.room_form),i.a.createElement(Wt,{room:t,defaultRoom:n,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component),Ft=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).submit=e.submit.bind(Object(x.a)(e)),e.setInstance=e.setInstance.bind(Object(x.a)(e)),e.getInstance=e.getInstance.bind(Object(x.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(x.a)(e)),e.state={token:window.localStorage.getItem("token"),room:{},defaultRoom:null},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance),V.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance),V.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){j("rooms",{id:this.state.id,title:this.state.title,default_room:this.state.defaultRoom},this.state.token)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){s.a.instance.toast.show({text:N.receiving,closeTimeout:2e3,position:"top"}),this.$f7route.params.roomId&&S("rooms",this.$f7route.params.roomId,this.state.token)}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"Room"===t&&this.setState({title:e.title,id:e.id,room:e,defaultRoom:e.default_room})}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/rooms/")}},{key:"render",value:function(){var e=this.state,t=e.room,n=e.defaultRoom;return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:N.room_form,backLink:N.back}),i.a.createElement(l.g,null,N.room_form),i.a.createElement(Wt,{room:t,defaultRoom:n,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component),Gt=function(e){var t=function(t){return!(!e.notification_setting||!e.notification_setting[t])||(e.notification_setting&&e.notification_setting[t],!1)};return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"data-table card"},i.a.createElement("table",{className:"fs-11"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("td",null,N.notification_type),i.a.createElement("td",null,N.mail_notification),i.a.createElement("td",null,N.push_notification),i.a.createElement("td",null,N.sms))),i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_comment_to_followed_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_comment_to_followed_posts_email"),onChange:function(t){return e.changeSetting(t,"add_comment_to_followed_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_comment_to_followed_posts_push"),onChange:function(t){return e.changeSetting(t,"add_comment_to_followed_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_comment_to_followed_posts_sms"),onChange:function(t){return e.changeSetting(t,"add_comment_to_followed_posts_sms")}}))),function(){var n=[];return e.ability&&e.ability.map((function(a){"new_post"===a.title&&n.push(i.a.createElement(i.a.Fragment,null,i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_comment_to_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_comment_to_posts_email"),onChange:function(t){return e.changeSetting(t,"add_comment_to_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_comment_to_posts_push"),onChange:function(t){return e.changeSetting(t,"add_comment_to_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_comment_to_posts_sms"),onChange:function(t){return e.changeSetting(t,"add_comment_to_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_comments_from_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_comment_from_posts_email"),onChange:function(t){return e.changeSetting(t,"remove_comment_from_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_comment_from_posts_push"),onChange:function(t){return e.changeSetting(t,"remove_comment_from_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_comment_from_posts_sms"),onChange:function(t){return e.changeSetting(t,"remove_comment_from_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_likes_to_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_likes_to_posts_email"),onChange:function(t){return e.changeSetting(t,"add_likes_to_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_likes_to_posts_push"),onChange:function(t){return e.changeSetting(t,"add_likes_to_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_likes_to_posts_sms"),onChange:function(t){return e.changeSetting(t,"add_likes_to_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_likes_from_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_likes_from_posts_email"),onChange:function(t){return e.changeSetting(t,"remove_likes_from_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_likes_from_posts_push"),onChange:function(t){return e.changeSetting(t,"remove_likes_from_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_likes_from_posts_sms"),onChange:function(t){return e.changeSetting(t,"remove_likes_from_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_bookmarks_to_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_bookmarks_to_posts_email"),onChange:function(t){return e.changeSetting(t,"add_bookmarks_to_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_bookmarks_to_posts_push"),onChange:function(t){return e.changeSetting(t,"add_bookmarks_to_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_bookmarks_to_posts_sms"),onChange:function(t){return e.changeSetting(t,"add_bookmarks_to_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_bookmarks_from_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_bookmarks_from_posts_email"),onChange:function(t){return e.changeSetting(t,"remove_bookmarks_from_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_bookmarks_from_posts_push"),onChange:function(t){return e.changeSetting(t,"remove_bookmarks_from_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_bookmarks_from_posts_sms"),onChange:function(t){return e.changeSetting(t,"remove_bookmarks_from_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_follows_to_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_follows_to_posts_email"),onChange:function(t){return e.changeSetting(t,"add_follows_to_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_follows_to_posts_push"),onChange:function(t){return e.changeSetting(t,"add_follows_to_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_follows_to_posts_sms"),onChange:function(t){return e.changeSetting(t,"add_follows_to_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_follows_from_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_follows_from_posts_email"),onChange:function(t){return e.changeSetting(t,"remove_follows_from_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_follows_from_posts_push"),onChange:function(t){return e.changeSetting(t,"remove_follows_from_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_follows_from_posts_sms"),onChange:function(t){return e.changeSetting(t,"remove_follows_from_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_shares_to_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_shares_to_posts_email"),onChange:function(t){return e.changeSetting(t,"add_shares_to_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_shares_to_posts_push"),onChange:function(t){return e.changeSetting(t,"add_shares_to_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_shares_to_posts_sms"),onChange:function(t){return e.changeSetting(t,"add_shares_to_posts_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_shares_from_posts),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_shares_from_posts_email"),onChange:function(t){return e.changeSetting(t,"remove_shares_from_posts_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_shares_from_posts_push"),onChange:function(t){return e.changeSetting(t,"remove_shares_from_posts_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_shares_from_posts_sms"),onChange:function(t){return e.changeSetting(t,"remove_shares_from_posts_sms")}})))))})),n}(),i.a.createElement("tr",null,i.a.createElement("td",null),i.a.createElement("td",null),i.a.createElement("td",null),i.a.createElement("td",null)),function(){var n=[];return e.ability&&e.ability.map((function(a){"new_channel"===a.title&&n.push(i.a.createElement(i.a.Fragment,null,i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_likes_to_channels),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_likes_to_channels_email"),onChange:function(t){return e.changeSetting(t,"add_likes_to_channels_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_likes_to_channels_push"),onChange:function(t){return e.changeSetting(t,"add_likes_to_channels_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_likes_to_channels_sms"),onChange:function(t){return e.changeSetting(t,"add_likes_to_channels_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_likes_from_channels),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_likes_from_channels_email"),onChange:function(t){return e.changeSetting(t,"remove_likes_from_channels_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_likes_from_channels_push"),onChange:function(t){return e.changeSetting(t,"remove_likes_from_channels_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_likes_from_channels_sms"),onChange:function(t){return e.changeSetting(t,"remove_likes_from_channels_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_bookmarks_to_channels),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_bookmarks_to_channels_email"),onChange:function(t){return e.changeSetting(t,"add_bookmarks_to_channels_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_bookmarks_to_channels_push"),onChange:function(t){return e.changeSetting(t,"add_bookmarks_to_channels_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_bookmarks_to_channels_sms"),onChange:function(t){return e.changeSetting(t,"add_bookmarks_to_channels_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_bookmarks_from_channels),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_bookmarks_from_channels_email"),onChange:function(t){return e.changeSetting(t,"remove_bookmarks_from_channels_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_bookmarks_from_channels_push"),onChange:function(t){return e.changeSetting(t,"remove_bookmarks_from_channels_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_bookmarks_from_channels_sms"),onChange:function(t){return e.changeSetting(t,"remove_bookmarks_from_channels_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_follows_to_channels),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_follows_to_channels_email"),onChange:function(t){return e.changeSetting(t,"add_follows_to_channels_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_follows_to_channels_push"),onChange:function(t){return e.changeSetting(t,"add_follows_to_channels_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_follows_to_channels_sms"),onChange:function(t){return e.changeSetting(t,"add_follows_to_channels_sms")}}))),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.remove_follows_from_channels),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_follows_from_channels_email"),onChange:function(t){return e.changeSetting(t,"remove_follows_from_channels_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_follows_from_channels_push"),onChange:function(t){return e.changeSetting(t,"remove_follows_from_channels_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("remove_follows_from_channels_sms"),onChange:function(t){return e.changeSetting(t,"remove_follows_from_channels_sms")}})))))})),n}(),i.a.createElement("tr",null,i.a.createElement("td",{className:"fs-11"},N.add_post_to_channels),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_post_to_channels_email"),onChange:function(t){return e.changeSetting(t,"add_post_to_channels_email")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_post_to_channels_push"),onChange:function(t){return e.changeSetting(t,"add_post_to_channels_push")}})),i.a.createElement("td",null,i.a.createElement(l.G,{className:"pd-5",checked:t("add_post_to_channels_sms"),onChange:function(t){return e.changeSetting(t,"add_post_to_channels_sms")}})))))))},$t=[{path:"/",component:fe},{path:"/login/",component:St},{path:"/sign_up/",component:jt},{path:"/verification/:email",component:Tt},{path:"/login_jwt/:token",component:Ct},{path:"/panel-right/",component:M},{path:"/bookmarks/",component:_t},{path:"/rooms/",component:qt},{path:"/rooms/:roomId/edit",component:Ft},{path:"/rooms/new",component:Ut},{path:"/rooms/:roomId",component:Vt},{path:"/metas/",component:H},{path:"/metas/:metaId/edit",component:X},{path:"/metas/new",component:Y},{path:"/metas/:metaId",component:J},{path:"/notifications/",component:Se},{path:"/posts/",component:fe},{path:"/posts/:postId/edit",component:Ee},{path:"/posts/new",component:ye},{path:"/posts/:postId",component:de},{path:"/channels/",component:Te},{path:"/channels/:channelId/edit",component:Ne},{path:"/channels/new",component:Ae},{path:"/channels/:channelId",component:Oe},{path:"/roles/",component:Ge},{path:"/roles/:roleId/edit",component:Je},{path:"/roles/new",component:Be},{path:"/roles/:roleId",component:We},{path:"/profiles/",component:ut},{path:"/profiles/:profileId/edit",component:gt},{path:"/profiles/new",component:ft},{path:"/profiles/:profileId",component:st},{path:"/friendships/:sourceId",component:vt},{path:"/privacy_settings/",component:kt},{path:"/settings/",component:Ye},{path:"/settings/:settingId/edit",component:et},{path:"/settings/new",component:Ze},{path:"/settings/:settingId",component:Ke},{path:"/notification_settings/",component:function(e){function t(){var e,n;return Object(m.a)(this,t),(n=Object(f.a)(this,Object(g.a)(t).call(this))).getInstance=n.getInstance.bind(Object(x.a)(n)),n.changeSetting=n.changeSetting.bind(Object(x.a)(n)),n.loadBlockList=n.loadBlockList.bind(Object(x.a)(n)),n.removeBlocked=n.removeBlocked.bind(Object(x.a)(n)),n.state=(e={token:window.localStorage.getItem("token"),setting:{},title:null,id:null},Object(A.a)(e,"setting",null),Object(A.a)(e,"notification_setting",[]),Object(A.a)(e,"blockList",[]),Object(A.a)(e,"ability",null),Object(A.a)(e,"profileId",null),e),n}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){V.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){V.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){S("notification_settings",1,this.state.token),S("users","role",this.state.token)}},{key:"pageAfterIn",value:function(){this.loadBlockList()}},{key:"loadBlockList",value:function(){var e=this,t=e.$f7;t.autocomplete.create({openIn:"popup",openerEl:"#user-blocklist",multiple:!0,valueProperty:"id",textProperty:"fullname",searchbarDisableText:N.cancel,popupCloseLinkText:N.close,notFoundText:N.not_found,limit:50,searchbarPlaceholder:N.search,source:function(e,n){var a=[];0!==e.length?t.request({url:y.server+"/profiles/search",method:"GET",dataType:"json",data:{q:e},success:function(e){for(var t=0;t<e.data.length;t++)a.push(e.data[t]);n(a)}}):n(a)},on:{change:function(t){t&&t[t.length-1]&&(e.setState({blockList:e.state.blockList.concat({fullname:t[t.length-1].fullname,id:t[t.length-1].id})}),O("notification_settings/add_block",{profile_id:t[t.length-1].id},e.state.token))}}})}},{key:"getInstance",value:function(){var e=V.getIntance(),t=V.getKlass();e&&"NotificationSetting"===t&&this.setState({title:e.title,id:e.id,notification_setting:e.notification_setting}),e&&"UserRole"===t&&this.setState({ability:e.the_ability,roles:e.the_roles,profileId:e.profile_id})}},{key:"changeSetting",value:function(e,t){var n={item:t};e.target.checked?(this.setState((function(e){var n=Object.assign({},e.notification_setting);return n[t]=!0,{notification_setting:n}})),O("notification_settings/add",n,this.state.token)):(this.setState((function(e){var n=Object.assign({},e.notification_setting);return n[t]=!1,{notification_setting:n}})),O("notification_settings/remove",n,this.state.token))}},{key:"removeBlocked",value:function(e){this.setState({blockList:this.state.blockList.filter((function(t){return t.id!==e}))}),O("notification_settings/remove_block",{profile_id:e},this.state.token)}},{key:"render",value:function(){var e=this.state,t=e.notification_setting,n=e.title,a=e.blockList,o=e.ability;return i.a.createElement(l.w,{onPageAfterIn:this.pageAfterIn.bind(this)},i.a.createElement(l.v,{title:N.work_form,backLink:N.back}),i.a.createElement(l.g,null,N.work_form),i.a.createElement(Gt,{notification_setting:t,ability:o,title:n,changeSetting:this.changeSetting,blockList:a,submit:this.submit,editing:!0,handleChange:this.handleChangeValue,removeBlocked:this.removeBlocked}))}}]),t}(a.Component)},{path:"(.*)",component:function(){return i.a.createElement(l.w,null,i.a.createElement(l.v,{title:"Not found",backLink:"Back"}),i.a.createElement(l.f,{strong:!0},i.a.createElement("p",null,"Sorry"),i.a.createElement("p",null,"Requested content not found.")))}}],Bt=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(f.a)(this,Object(g.a)(t).call(this))).state={token:window.localStorage.getItem("token")},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(t=this).$f7,D&&D.requestPermission().then(Object(d.a)(u.a.mark((function e(){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getToken();case 2:n=e.sent,a={token:n},t.state.token&&t.state.token.length>10&&O("devices",a,t.state.token);case 5:case"end":return e.stop()}}),e)})))).catch((function(e){console.log("Unable to get permission to notify.",e)})),navigator.serviceWorker.addEventListener("message",(function(e){n.notification.create({icon:"",title:e.data.firebaseMessaging.payload.notification.title,titleRightText:"",cssClass:"notification",subtitle:e.data.firebaseMessaging.payload.notification.body,closeTimeout:5e3}).open()}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e={id:"io.framework7.testapp",name:"Framework7",theme:"aurora",panel:{rightBreakpoint:960},view:{auroraPageLoadDelay:90,removeElements:!0},routes:$t};return i.a.createElement(l.e,{params:e},i.a.createElement(l.C,null),i.a.createElement(l.y,{right:!0,reveal:!0,themeDark:!0},i.a.createElement(l.I,{url:"/panel-right/"})),i.a.createElement(l.I,{id:"main-view",url:"/",pushState:!0,main:!0,className:"safe-areas"}))}}]),t}(i.a.Component);n(285),n(286),n(287),n(288),n(289),n(290),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.use(l.J),r.a.render(i.a.createElement(Bt),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},78:function(e,t){e.exports={"generic.add":"\u0627\u0641\u0632\u0648\u062f\u0646","generic.cancel":"\u0644\u063a\u0648","components.controls.blocktype.h1":"H1","components.controls.blocktype.h2":"H2","components.controls.blocktype.h3":"H3","components.controls.blocktype.h4":"H4","components.controls.blocktype.h5":"H5","components.controls.blocktype.h6":"H6","components.controls.blocktype.blockquote":"Blockquote","components.controls.blocktype.code":"Code","components.controls.blocktype.blocktype":"Block Type","components.controls.blocktype.normal":"Normal","components.controls.colorpicker.colorpicker":"Color Picker","components.controls.colorpicker.text":"Text","components.controls.colorpicker.background":"Highlight","components.controls.embedded.embedded":"Embedded","components.controls.embedded.embeddedlink":"Embedded Link","components.controls.embedded.enterlink":"Enter link","components.controls.emoji.emoji":"Emoji","components.controls.fontfamily.fontfamily":"Font","components.controls.fontsize.fontsize":"Font Size","components.controls.history.history":"History","components.controls.history.undo":"Undo","components.controls.history.redo":"Redo","components.controls.image.image":"\u0639\u06a9\u0633","components.controls.image.fileUpload":"\u0628\u0627\u0631\u06af\u0630\u0627\u0631\u06cc","components.controls.image.byURL":"\u067e\u06cc\u0648\u0646\u062f","components.controls.image.dropFileText":"\u0627\u06cc\u0646\u062c\u0627 \u0631\u0627 \u06a9\u0644\u06cc\u06a9 \u06a9\u0646\u06cc\u062f ","components.controls.inline.bold":"Bold","components.controls.inline.italic":"Italic","components.controls.inline.underline":"Underline","components.controls.inline.strikethrough":"Strikethrough","components.controls.inline.monospace":"Monospace","components.controls.inline.superscript":"Superscript","components.controls.inline.subscript":"Subscript","components.controls.link.linkTitle":"\u0639\u0646\u0648\u0627\u0646 \u067e\u06cc\u0648\u0646\u062f","components.controls.link.linkTarget":"\u0622\u062f\u0631\u0633","components.controls.link.linkTargetOption":"\u062f\u0631 \u067e\u0646\u062c\u0631\u0647 \u062c\u062f\u06cc\u062f \u0628\u0627\u0632 \u06a9\u0646","components.controls.link.link":"\u067e\u06cc\u0648\u0646\u062f","components.controls.link.unlink":"\u0644\u063a\u0648 \u067e\u06cc\u0648\u0646\u062f","components.controls.list.list":"List","components.controls.list.unordered":"Unordered","components.controls.list.ordered":"Ordered","components.controls.list.indent":"Indent","components.controls.list.outdent":"Outdent","components.controls.remove.remove":"Remove","components.controls.textalign.textalign":"Text Align","components.controls.textalign.left":"Left","components.controls.textalign.center":"Center","components.controls.textalign.right":"Right","components.controls.textalign.justify":"Justify"}}},[[132,1,2]]]);
//# sourceMappingURL=main.645d4f26.chunk.js.map