(this["webpackJsonpelearn-tools-client"]=this["webpackJsonpelearn-tools-client"]||[]).push([[0],{114:function(e,t){},138:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(62),o=a.n(i),s=(a(85),a(36)),c=a(8),d=(a(86),a(87),a(10)),l=a(11),u=a(4),f=a(13),m=a(12),p=a(63),v=new(a(64).Dispatcher),h=new(function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).list=[],e.instance=null,e.klass=null,e.reason=null,e}return Object(l.a)(a,[{key:"listModel",value:function(e){this.list=[],this.klass=e.klass;for(var t=0,a=e.data.length;t<a;++t)this.list.push(e.data[t]),t===a-1&&this.emit("got_list");0==e.data.length&&this.emit("got_list")}},{key:"showIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("got_instance")}},{key:"setIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("set_instance")}},{key:"deleteIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("deleted_instance")}},{key:"postFile",value:function(e){console.log(e),this.klass=e.klass,this.instance=e.data,this.emit("file_posted")}},{key:"setIntanceFailure",value:function(e){console.log(e),this.reason="Error",this.klass="",this.emit("set_instance")}},{key:"getReason",value:function(){return this.reason}},{key:"getIntance",value:function(){return this.instance}},{key:"getList",value:function(){return this.list}},{key:"getListnKlass",value:function(){return[this.list,this.klass]}},{key:"getKlass",value:function(){return this.klass}},{key:"handleActions",value:function(e){switch(e.type){case"LIST_MODEL_SUCCESS":this.listModel(e.list);break;case"GET_INSTANCE_SUCCESS":this.showIntance(e.instance);break;case"DELETE_INSTANCE_SUCCESS":this.deleteIntance(e.instance);break;case"SET_INSTANCE_SUCCESS":this.setIntance(e.instance);break;case"POST_FILE_SUCCESS":this.postFile(e.instance);break;case"SET_INSTANCE_FAILURE":console.log(e),this.setIntanceFailure(e.reason)}}}]),a}(p.EventEmitter));v.register(h.handleActions.bind(h));var g=h,b=a(20),y=a.n(b),k="/v1",S="https://kaarafarinan.ir:8089/janus",w=k;function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,r=Object.keys(a).map((function(e){return e+"="+a[e]})).join("&");y.a.get(w+"/"+e+"?page="+t+"&"+r,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"LIST_MODEL_SUCCESS",list:e.data})})).catch((function(e){console.log(e)}))}function C(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;y.a.get(w+"/"+e+"/"+t+"?page="+n,{headers:{"Content-Type":"application/json",Authorization:"bearer "+a}}).then((function(e){v.dispatch({type:"GET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function T(e,t,a){y.a.post(w+"/"+e+"/",t,{headers:{"Content-Type":"application/json",Authorization:"bearer "+a}}).then((function(e){v.dispatch({type:"SET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){v.dispatch({type:"SET_INSTANCE_FAILURE",instance:e.reason}),console.log(e)}))}var D={home:"\u062e\u0627\u0646\u0647",choose_a_file:"\u0627\u0646\u062a\u062e\u0627\u0628 \u0641\u0627\u06cc\u0644 PDF",file_preparation_service:"\u0622\u0645\u0627\u062f\u0647 \u0633\u0627\u0632\u06cc \u0641\u0627\u06cc\u0644 \u0628\u0631\u0627\u06cc \u0646\u0631\u0645 \u0627\u0641\u0632\u0627\u0631 \u0627\u062f\u0648\u0628\u06cc \u06a9\u0627\u0646\u06a9\u062a",login:"\u0648\u0631\u0648\u062f",your_uuid_is:"\u06a9\u062f \u0631\u0647\u06af\u06cc\u0631\u06cc \u0634\u0645\u0627",processing_may_take_some_time:"\u062f\u0631 \u062d\u0627\u0644 \u062a\u0628\u062f\u06cc\u0644 \u0641\u0627\u06cc\u0644 \u0645\u0645\u06a9\u0646 \u0627\u0633\u062a \u06a9\u0645\u06cc \u0637\u0648\u0644 \u0628\u06a9\u0634\u062f",download:"\u062f\u0631\u06cc\u0627\u0641\u062a",again:"\u0628\u0627\u0631\u06af\u0632\u0627\u0631\u06cc \u062f\u06cc\u06af\u0631"},I=function(e){Object(c.f)();return r.a.createElement("nav",{id:"navbar",class:"bd-navbar navbar has-shadow is-spaced"},r.a.createElement("div",{class:"container"},r.a.createElement("div",{class:"navbar-brand"},r.a.createElement("a",{class:"navbar-item",href:"https://bulma.io"},r.a.createElement("img",{src:"/connect.png",alt:"Bulma: Free, open source, and modern CSS framework based on Flexbox",height:"38"}))),r.a.createElement("div",{class:"navbar-menu"},r.a.createElement("div",{class:"navbar-start"},r.a.createElement("a",{href:"#/rooms",class:"navbar-item"},r.a.createElement("i",{className:"fas fa-home mr-1"}),r.a.createElement("span",null,"Home")),r.a.createElement("a",{href:"#/rooms",class:"navbar-item"},r.a.createElement("i",{className:"fas fa-door-open mr-1"}),r.a.createElement("span",null,"Rooms"))))),r.a.createElement("div",{class:"level-right"},!e.token||e.token.length<5?r.a.createElement("p",{class:"level-item"},r.a.createElement("a",{href:"#/login",class:"button is-primary"},"Login")):r.a.createElement("p",{class:"level-item"},r.a.createElement("a",{onClick:function(){return console.log("Signing Out ..."),window.localStorage.setItem("token",""),void(window.location.href="/")},class:"button is-light"},"Sign Out"))))},R=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).getList=n.getList.bind(Object(u.a)(n)),n.roomCards=n.roomCards.bind(Object(u.a)(n)),n.state={token:window.localStorage.getItem("token"),rooms:null},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){g.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.state.token&&this.state.token.length>5&&E("rooms",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=g.getList(),t=g.getKlass();e&&"Room"===t&&this.setState({rooms:e}),console.log(e)}},{key:"roomCards",value:function(){var e=[];return this.state.rooms&&this.state.rooms.map((function(t){return e.push(r.a.createElement("div",{class:"column is-3"},r.a.createElement("div",{class:"card has-background-white-ter"},r.a.createElement("header",{class:"card-header"},r.a.createElement("p",{class:"card-header-title"},t.title)),r.a.createElement("div",{class:"card-content"},r.a.createElement("div",{class:"content"},t.description?t.description:"The creator did not provide a desctiption. You can join to find out more about this room.")),r.a.createElement("footer",{class:"card-footer"},r.a.createElement("a",{href:"#/rooms/"+t.id,class:"card-footer-item"},"Join")))))})),e}},{key:"createCard",value:function(){if(this.state.token)return r.a.createElement("div",{class:"column is-3"},r.a.createElement("div",{class:"card has-background-info-light"},r.a.createElement("header",{class:"card-header"},r.a.createElement("p",{class:"card-header-title"},"Create New Room")),r.a.createElement("div",{class:"card-content"},r.a.createElement("div",{class:"content"},"You can create rooms. Participants in a room can share their videos, voices and ideas with each other.")),r.a.createElement("footer",{class:"card-footer"},r.a.createElement("a",{href:"#/rooms/new",class:"card-footer-item"},"Create"))))}},{key:"render",value:function(){var e=this.state.token;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,{token:e}),r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{class:"columns is-multiline"},this.createCard(),this.roomCards()))))}}]),a}(r.a.Component),A=a(39),j=a.n(A),N=a(66),O=a(18),P=a.n(O),M=a(19),x=a(45),q=window.RTCRtpTransceiver;_.sessions={},_.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||_.extension.isInstalled()}return!0};var U={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var a=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",a(n)}else a(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function _(e){if((e=e||{}).success="function"==typeof e.success?e.success:_.noop,e.error="function"==typeof e.error?e.error:_.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:_.noop,!_.initDone)return e.error("Library not initialized"),{};if(!_.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(_.log("Library initialized: "+_.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,a=null,n={},r=null,i=null,o=0,s=e.server;_.isArray(s)?(_.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,_.debug(i)):0===s.indexOf("ws")?(t=!0,_.log("Using WebSockets to contact Janus: "+s)):(t=!1,_.log("Using REST API to contact Janus: "+s));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],d=e.iceTransportPolicy,l=e.bundlePolicy,u=!0===e.ipv6,f=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(f=!0===e.withCredentials);var m=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(m=e.max_poll_events),m<1&&(m=1);var p=null;void 0!==e.token&&null!==e.token&&(p=e.token);var v=null;void 0!==e.apisecret&&null!==e.apisecret&&(v=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var h=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(h=e.keepAlivePeriod),isNaN(h)&&(h=25e3);var g=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(g=e.longPollTimeout),isNaN(g)&&(g=6e4);var y=!1,k=null,S={},w=this,E=0,C={};function T(){if(null!=k)if(_.debug("Long poll..."),y){var t=s+"/"+k+"?rid="+(new Date).getTime();m&&(t=t+"&maxev="+m),p&&(t=t+"&token="+encodeURIComponent(p)),v&&(t=t+"&apisecret="+encodeURIComponent(v)),_.httpAPICall(t,{verb:"GET",withCredentials:f,success:D,timeout:g,error:function(t,a){if(_.error(t+":",a),++E>3)return y=!1,void e.error("Lost connection to the server (is it down?)");T()}})}else _.warn("Is the server down? (connected=false)")}function D(e,n){if(E=0,t||void 0===k||null===k||!0===n||T(),t||!_.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(c=e.sender))return void _.warn("Missing sender...");if(!(l=S[c]))return void _.debug("This handle is not attached to this session");var r=e.candidate;_.debug("Got a trickled candidate on session "+k),_.debug(r);var i=l.webrtcStuff;i.pc&&i.remoteSdp?(_.debug("Adding remote candidate:",r),r&&!0!==r.completed?i.pc.addIceCandidate(r):i.pc.addIceCandidate(_.endOfCandidates)):(_.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(r),_.debug(i.candidates))}else{if("webrtcup"===e.janus)return _.debug("Got a webrtcup event on session "+k),_.debug(e),(c=e.sender)?(l=S[c])?void l.webrtcState(!0):void _.debug("This handle is not attached to this session"):void _.warn("Missing sender...");if("hangup"===e.janus){if(_.debug("Got a hangup event on session "+k),_.debug(e),!(c=e.sender))return void _.warn("Missing sender...");if(!(l=S[c]))return void _.debug("This handle is not attached to this session");l.webrtcState(!1,e.reason),l.hangup()}else if("detached"===e.janus){if(_.debug("Got a detached event on session "+k),_.debug(e),!(c=e.sender))return void _.warn("Missing sender...");if(!(l=S[c]))return;l.detached=!0,l.ondetached(),l.detach()}else if("media"===e.janus){if(_.debug("Got a media event on session "+k),_.debug(e),!(c=e.sender))return void _.warn("Missing sender...");if(!(l=S[c]))return void _.debug("This handle is not attached to this session");l.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(_.debug("Got a slowlink event on session "+k),_.debug(e),!(c=e.sender))return void _.warn("Missing sender...");if(!(l=S[c]))return void _.debug("This handle is not attached to this session");l.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var o,s;if(_.error("Ooops: "+e.error.code+" "+e.error.reason),_.debug(e),o=e.transaction)(s=C[o])&&s(e),delete C[o];return}if("event"===e.janus){var c;if(_.debug("Got a plugin event on session "+k),_.debug(e),!(c=e.sender))return void _.warn("Missing sender...");var d=e.plugindata;if(!d)return void _.warn("Missing plugindata...");_.debug("  -- Event is coming from "+c+" ("+d.plugin+")");var l,u=d.data;if(_.debug(u),!(l=S[c]))return void _.warn("This handle is not attached to this session");var f=e.jsep;f&&(_.debug("Handling SDP as well..."),_.debug(f));var m=l.onmessage;m?(_.debug("Notifying application..."),m(u,f)):_.debug("No provided notification callback")}else{if("timeout"===e.janus)return _.error("Timeout on session "+k),_.debug(e),void(t&&a.close(3504,"Gateway timeout"));_.warn("Unknown message/event  '"+e.janus+"' on session "+k),_.debug(e)}}}else _.debug("Got a success on session "+k),_.debug(e),(o=e.transaction)&&((s=C[o])&&s(e),delete C[o]);else _.debug("Got an ack on session "+k),_.debug(e),(o=e.transaction)&&((s=C[o])&&s(e),delete C[o]);else _.debug("Got info on the Janus instance"),_.debug(e),(o=e.transaction)&&((s=C[o])&&s(e),delete C[o]);else _.vdebug("Got a keepalive on session "+k);else for(var p=0;p<e.length;p++)D(e[p],!0)}function I(){if(s&&t&&y){r=setTimeout(I,h);var e={janus:"keepalive",session_id:k,transaction:_.randomString(12)};p&&(e.token=p),v&&(e.apisecret=v),a.send(JSON.stringify(e))}}function R(c){var d=_.randomString(12),l={janus:"create",transaction:d};if(c.reconnect&&(y=!1,l.janus="claim",l.session_id=k,a&&(a.onopen=null,a.onerror=null,a.onclose=null,r&&(clearTimeout(r),r=null))),p&&(l.token=p),v&&(l.apisecret=v),!s&&_.isArray(i)&&(0===(s=i[o]).indexOf("ws")?(t=!0,_.log("Server #"+(o+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,_.log("Server #"+(o+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var u in a=_.newWebSocket(s,"janus-protocol"),n={error:function(){if(_.error("Error connecting to the Janus WebSockets server... "+s),_.isArray(i)&&!c.reconnect)return++o===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){R(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){C[d]=function(e){if(_.debug(e),"success"!==e.janus)return _.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);r=setTimeout(I,h),y=!0,k=e.session_id?e.session_id:e.data.id,c.reconnect?_.log("Claimed session: "+k):_.log("Created session: "+k),_.sessions[k]=w,c.success()},a.send(JSON.stringify(l))},message:function(e){D(JSON.parse(e.data))},close:function(){s&&y&&(y=!1,e.error("Lost connection to the server (is it down?)"))}})a.addEventListener(u,n[u]);else _.httpAPICall(s,{verb:"POST",withCredentials:f,body:l,success:function(e){if(_.debug(e),"success"!==e.janus)return _.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);y=!0,k=e.session_id?e.session_id:e.data.id,c.reconnect?_.log("Claimed session: "+k):_.log("Created session: "+k),_.sessions[k]=w,T(),c.success()},error:function(e,t){if(_.error(e+":",t),_.isArray(i)&&!c.reconnect)return++o===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){R(c)}),200));""===t?c.error(e+": Is the server down?"):c.error(e+": "+t)}})}function A(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:_.noop,n.error="function"==typeof n.error?n.error:_.noop,!y)return _.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var r=S[e];if(!r||!r.webrtcStuff)return _.warn("Invalid handle"),void n.error("Invalid handle");var i=n.message,o=n.jsep,c=_.randomString(12),d={janus:"message",body:i,transaction:c};if(r.token&&(d.token=r.token),v&&(d.apisecret=v),o&&(d.jsep={type:o.type,sdp:o.sdp},o.e2ee&&(d.jsep.e2ee=!0),"hml"!==o.rid_order&&"lmh"!==o.rid_order||(d.jsep.rid_order=o.rid_order)),_.debug("Sending message to plugin (handle="+e+"):"),_.debug(d),t)return d.session_id=k,d.handle_id=e,C[c]=function(e){if(_.debug("Message sent!"),_.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return _.warn("Request succeeded, but missing plugindata..."),void n.success();_.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return _.debug(a),void n.success(a)}"ack"===e.janus?n.success():e.error?(_.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(_.error("Unknown error"),n.error("Unknown error"))},void a.send(JSON.stringify(d));_.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:d,success:function(e){if(_.debug("Message sent!"),_.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return _.warn("Request succeeded, but missing plugindata..."),void n.success();_.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return _.debug(a),void n.success(a)}"ack"===e.janus?n.success():e.error?(_.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(_.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){_.error(e+":",t),n.error(e+": "+t)}})}function j(e,n){if(y){var r=S[e];if(r&&r.webrtcStuff){var i={janus:"trickle",candidate:n,transaction:_.randomString(12)};if(r.token&&(i.token=r.token),v&&(i.apisecret=v),_.vdebug("Sending trickle candidate (handle="+e+"):"),_.vdebug(i),t)return i.session_id=k,i.handle_id=e,void a.send(JSON.stringify(i));_.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:i,success:function(e){_.vdebug("Candidate sent!"),_.vdebug(e),"ack"===e.janus||_.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){_.error(e+":",t)}})}else _.warn("Invalid handle")}else _.warn("Is the server down? (connected=false)")}function N(e,t,a,n,r){var i=S[e];if(i&&i.webrtcStuff){var o=i.webrtcStuff;if(o.pc){var s=function(e){_.log("Received state change on data channel:",e);var t=e.target.label,a=e.target.protocol,n=o.dataChannel[t]?o.dataChannel[t].readyState:"null";if(_.log("State change on <"+t+"> data channel: "+n),"open"===n){if(o.dataChannel[t].pending&&o.dataChannel[t].pending.length>0){_.log("Sending pending messages on <"+t+">:",o.dataChannel[t].pending.length);var r,s=Object(M.a)(o.dataChannel[t].pending);try{for(s.s();!(r=s.n()).done;){var c=r.value;_.log("Sending data on data channel <"+t+">"),_.debug(c),o.dataChannel[t].send(c)}}catch(d){s.e(d)}finally{s.f()}o.dataChannel[t].pending=[]}i.ondataopen(t,a)}};if(n)o.dataChannel[t]=n;else{var c={ordered:!0};a&&(c.protocol=a),o.dataChannel[t]=o.pc.createDataChannel(t,c)}o.dataChannel[t].onmessage=function(e){_.log("Received message on data channel:",e);var t=e.target.label;i.ondata(e.data,t)},o.dataChannel[t].onopen=s,o.dataChannel[t].onclose=s,o.dataChannel[t].onerror=function(e){_.error("Got error on data channel:",e)},o.dataChannel[t].pending=[],r&&o.dataChannel[t].pending.push(r)}else _.warn("Invalid PeerConnection")}else _.warn("Invalid handle")}function O(e,t){(t=t||{}).success="function"==typeof t.success?t.success:_.noop,t.error="function"==typeof t.error?t.error:_.noop;var a=S[e];if(!a||!a.webrtcStuff)return _.warn("Invalid handle"),void t.error("Invalid handle");var n=a.webrtcStuff,r=t.text||t.data;if(!r)return _.warn("Invalid data"),void t.error("Invalid data");var i=t.label?t.label:_.dataChanDefaultLabel;return n.dataChannel[i]?"open"!==n.dataChannel[i].readyState?(n.dataChannel[i].pending.push(r),void t.success()):(_.log("Sending data on data channel <"+i+">"),_.debug(r),n.dataChannel[i].send(r),void t.success()):(N(e,i,t.protocol,!1,r,t.protocol),void t.success())}function P(e,t){(t=t||{}).success="function"==typeof t.success?t.success:_.noop,t.error="function"==typeof t.error?t.error:_.noop;var a=S[e];if(!a||!a.webrtcStuff)return _.warn("Invalid handle"),void t.error("Invalid handle");var n=a.webrtcStuff;if(!n.dtmfSender){if(n.pc){var r=n.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!r)return _.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=r.dtmf,n.dtmfSender&&(_.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){_.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return _.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var i=t.dtmf;if(!i)return _.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var o=i.tones;if(!o)return _.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"===typeof i.duration?i.duration:500,c="number"===typeof i.gap?i.gap:50;_.debug("Sending DTMF string "+o+" (duration "+s+"ms, gap "+c+"ms)"),n.dtmfSender.insertDTMF(o,s,c),t.success()}function x(e,n){(n=n||{}).success="function"==typeof n.success?n.success:_.noop,n.error="function"==typeof n.error?n.error:_.noop;var r=!0===n.noRequest;_.log("Destroying handle "+e+" (only-locally="+r+")"),G(e);var i=S[e];if(!i||i.detached)return delete S[e],void n.success();if(r)return delete S[e],void n.success();if(!y)return _.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var o={janus:"detach",transaction:_.randomString(12)};if(i.token&&(o.token=i.token),v&&(o.apisecret=v),t)return o.session_id=k,o.handle_id=e,a.send(JSON.stringify(o)),delete S[e],void n.success();_.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:o,success:function(t){_.log("Destroyed handle:"),_.debug(t),"success"!==t.janus&&_.error("Ooops: "+t.error.code+" "+t.error.reason),delete S[e],n.success()},error:function(t,a){_.error(t+":",a),delete S[e],n.success()}})}function q(e,t,a,n,r){var i=S[e];if(!i||!i.webrtcStuff)return _.warn("Invalid handle"),n.stream||_.stopAllTracks(r),void n.error("Invalid handle");var o=i.webrtcStuff;_.debug("streamsDone:",r),r&&(_.debug("  -- Audio tracks:",r.getAudioTracks()),_.debug("  -- Video tracks:",r.getVideoTracks()));var s=!1;if(o.myStream&&a.update&&!o.streamExternal){if((!a.update&&z(a)||a.update&&(a.addAudio||a.replaceAudio))&&r.getAudioTracks()&&r.getAudioTracks().length)if(o.myStream.addTrack(r.getAudioTracks()[0]),_.unifiedPlan){_.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]);var f=null;if((v=o.pc.getTransceivers())&&v.length>0){var m,p=Object(M.a)(v);try{for(p.s();!(m=p.n()).done;){if((k=m.value).sender&&k.sender.track&&"audio"===k.sender.track.kind||k.receiver&&k.receiver.track&&"audio"===k.receiver.track.kind){f=k;break}}}catch(D){p.e(D)}finally{p.f()}}f&&f.sender?f.sender.replaceTrack(r.getAudioTracks()[0]):o.pc.addTrack(r.getAudioTracks()[0],r)}else _.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]),o.pc.addTrack(r.getAudioTracks()[0],r);if((!a.update&&K(a)||a.update&&(a.addVideo||a.replaceVideo))&&r.getVideoTracks()&&r.getVideoTracks().length)if(o.myStream.addTrack(r.getVideoTracks()[0]),_.unifiedPlan){_.log((a.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]);var v,h=null;if((v=o.pc.getTransceivers())&&v.length>0){var g,y=Object(M.a)(v);try{for(y.s();!(g=y.n()).done;){var k;if((k=g.value).sender&&k.sender.track&&"video"===k.sender.track.kind||k.receiver&&k.receiver.track&&"video"===k.receiver.track.kind){h=k;break}}}catch(D){y.e(D)}finally{y.f()}}h&&h.sender?h.sender.replaceTrack(r.getVideoTracks()[0]):o.pc.addTrack(r.getVideoTracks()[0],r)}else _.log((a.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]),o.pc.addTrack(r.getVideoTracks()[0],r)}else o.myStream=r,s=!0;if(!o.pc){var w={iceServers:c,iceTransportPolicy:d,bundlePolicy:l};"chrome"===_.webRTCAdapter.browserDetails.browser&&(w.sdpSemantics=_.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var E={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&E.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"===typeof n.rtcConstraints)for(var C in _.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)E.optional.push(n.rtcConstraints[C]);"edge"===_.webRTCAdapter.browserDetails.browser&&(w.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(n.senderTransforms||n.receiverTransforms)&&(o.senderTransforms=n.senderTransforms,o.receiverTransforms=n.receiverTransforms,w.forceEncodedAudioInsertableStreams=!0,w.forceEncodedVideoInsertableStreams=!0,w.encodedInsertableStreams=!0),_.log("Creating PeerConnection"),_.debug(E),o.pc=new RTCPeerConnection(w,E),_.debug(o.pc),o.pc.getStats&&(o.volume={},o.bitrate.value="0 kbits/sec"),_.log("Preparing local SDP and gathering candidates (trickle="+o.trickle+")"),o.pc.oniceconnectionstatechange=function(e){o.pc&&i.iceState(o.pc.iceConnectionState)},o.pc.onicecandidate=function(t){if(!t.candidate||"edge"===_.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)_.log("End of candidates."),o.iceDone=!0,!0===o.trickle?j(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:_.noop,t.error="function"==typeof t.error?t.error:_.noop;var a=S[e];if(!a||!a.webrtcStuff)return void _.warn("Invalid handle, not sending anything");var n=a.webrtcStuff;if(_.log("Sending offer/answer SDP..."),!n.mySdp)return void _.warn("Local SDP instance is invalid, not sending anything...");n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1);_.debug(t),n.sdpSent=!0,t.success(n.mySdp)}(e,n);else{var a={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===o.trickle&&j(e,a)}},o.pc.ontrack=function(e){if(_.log("Handling Remote Track"),_.debug(e),e.streams&&(o.remoteStream=e.streams[0],i.onremotestream(o.remoteStream),!e.track.onended)){if(o.receiverTransforms){var t=null;RTCRtpSender.prototype.createEncodedStreams?t=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&o.receiverTransforms.audio?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&o.receiverTransforms.video&&(t=e.receiver.createEncodedVideoStreams())),t&&(console.log(t),t.readableStream&&t.writableStream?t.readableStream.pipeThrough(o.receiverTransforms[e.track.kind]).pipeTo(t.writableStream):t.readable&&t.writable&&t.readable.pipeThrough(o.receiverTransforms[e.track.kind]).pipeTo(t.writable))}var a=null;_.log("Adding onended callback to track:",e.track),e.track.onended=function(e){_.log("Remote track removed:",e),o.remoteStream&&(clearTimeout(a),o.remoteStream.removeTrack(e.target),i.onremotestream(o.remoteStream))},e.track.onmute=function(e){_.log("Remote track muted:",e),o.remoteStream&&null==a&&(a=setTimeout((function(){_.log("Removing remote track"),o.remoteStream&&(o.remoteStream.removeTrack(e.target),i.onremotestream(o.remoteStream)),a=null}),2520))},e.track.onunmute=function(e){if(_.log("Remote track flowing again:",e),null!=a)clearTimeout(a),a=null;else try{o.remoteStream.addTrack(e.target),i.onremotestream(o.remoteStream)}catch(t){_.error(t)}}}}}if(s&&r){_.log("Adding local stream");var T=!0===n.simulcast2;r.getTracks().forEach((function(e){_.log("Adding local track:",e);var t=null;if(T&&"audio"!==e.kind){_.log("Enabling rid-based simulcasting:",e);var a=b(n.simulcastMaxBitrates),i=o.pc.addTransceiver(e,{direction:"sendrecv",streams:[r],sendEncodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:a.high},{rid:"m",active:!0,maxBitrate:a.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:a.low,scaleResolutionDownBy:4}]});i&&(t=i.sender)}else t=o.pc.addTrack(e,r);if(t&&o.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&o.senderTransforms.audio?s=t.createEncodedAudioStreams():"video"===t.track.kind&&o.senderTransforms.video&&(s=t.createEncodedVideoStreams())),s&&(console.log(s),s.readableStream&&s.writableStream?s.readableStream.pipeThrough(o.senderTransforms[t.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(o.senderTransforms[t.track.kind]).pipeTo(s.writable))}}))}(function(e){if(_.debug("isDataEnabled:",e),"edge"===_.webRTCAdapter.browserDetails.browser)return _.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(a)&&!o.dataChannel[_.dataChanDefaultLabel]&&(_.log("Creating default data channel"),N(e,_.dataChanDefaultLabel,null,!1),o.pc.ondatachannel=function(t){_.log("Data channel created by Janus:",t),N(e,t.channel.label,t.channel.protocol,t.channel)}),o.myStream&&i.onlocalstream(o.myStream),t?o.pc.setRemoteDescription(t).then((function(){if(_.log("Remote description accepted!"),o.remoteSdp=t.sdp,o.candidates&&o.candidates.length>0){for(var r=0;r<o.candidates.length;r++){var i=o.candidates[r];_.debug("Adding remote candidate:",i),i&&!0!==i.completed?o.pc.addIceCandidate(i):o.pc.addIceCandidate(_.endOfCandidates)}o.candidates=[]}!function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:_.noop,a.error="function"==typeof a.error?a.error:_.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:_.noop;var n=S[e];if(!n||!n.webrtcStuff)return _.warn("Invalid handle"),void a.error("Invalid handle");var r=n.webrtcStuff,i=!0===a.simulcast;i?_.log("Creating answer (iceDone="+r.iceDone+", simulcast="+i+")"):_.log("Creating answer (iceDone="+r.iceDone+")");var o=null;if(_.unifiedPlan){o={};var s=null,c=null,d=r.pc.getTransceivers();if(d&&d.length>0){var l,u=Object(M.a)(d);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(c||(c=f))}}catch(D){u.e(D)}finally{u.f()}}var m=z(t),p=H(t);if(m||p){if(m&&p){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",_.log("Setting audio transceiver to sendrecv:",s)}catch(E){_.error(E)}}else if(m&&!p)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",_.log("Setting audio transceiver to sendonly:",s))}catch(E){_.error(E)}else if(!m&&p)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",_.log("Setting audio transceiver to recvonly:",s)}catch(E){_.error(E)}else s=r.pc.addTransceiver("audio",{direction:"recvonly"}),_.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",_.log("Setting audio transceiver to inactive:",s)}catch(E){_.error(E)}var v=K(t),h=Y(t);if(v||h){if(v&&h){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",_.log("Setting video transceiver to sendrecv:",c)}catch(E){_.error(E)}}else if(v&&!h){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",_.log("Setting video transceiver to sendonly:",c)}catch(E){_.error(E)}}else if(!v&&h)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",_.log("Setting video transceiver to recvonly:",c)}catch(E){_.error(E)}else c=r.pc.addTransceiver("video",{direction:"recvonly"}),_.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",_.log("Setting video transceiver to inactive:",c)}catch(E){_.error(E)}}else o="firefox"===_.webRTCAdapter.browserDetails.browser||"edge"===_.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:H(t),offerToReceiveVideo:Y(t)}:{mandatory:{OfferToReceiveAudio:H(t),OfferToReceiveVideo:Y(t)}};_.debug(o);var g=K(t);if(g&&i&&"firefox"===_.webRTCAdapter.browserDetails.browser){_.log("Enabling Simulcasting for Firefox (RID)");var y=r.pc.getSenders()[1];_.log(y);var k=y.getParameters();_.log(k);var w=b(a.simulcastMaxBitrates);y.setParameters({encodings:a.sendEncodings||[{rid:"h",active:!0,maxBitrate:w.high},{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:w.low,scaleResolutionDownBy:4}]})}r.pc.createAnswer(o).then((function(e){_.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,_.log("Setting local description"),g&&i&&("chrome"===_.webRTCAdapter.browserDetails.browser?_.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==_.webRTCAdapter.browserDetails.browser&&_.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(a.error),r.mediaConstraints=o,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),a.success(e)):_.log("Waiting for all candidates...")}),a.error)}(e,a,n)}),n.error):function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:_.noop,a.error="function"==typeof a.error?a.error:_.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:_.noop;var n=S[e];if(!n||!n.webrtcStuff)return _.warn("Invalid handle"),void a.error("Invalid handle");var r=n.webrtcStuff,i=!0===a.simulcast;i?_.log("Creating offer (iceDone="+r.iceDone+", simulcast="+i+")"):_.log("Creating offer (iceDone="+r.iceDone+")");var o={};if(_.unifiedPlan){var s=null,c=null,d=r.pc.getTransceivers();if(d&&d.length>0){var l,u=Object(M.a)(d);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(c||(c=f))}}catch(D){u.e(D)}finally{u.f()}}var m=z(t),p=H(t);m||p?m&&p?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",_.log("Setting audio transceiver to sendrecv:",s)):m&&!p?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",_.log("Setting audio transceiver to sendonly:",s)):!m&&p&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",_.log("Setting audio transceiver to recvonly:",s)):(s=r.pc.addTransceiver("audio",{direction:"recvonly"}),_.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",_.log("Setting audio transceiver to inactive:",s));var v=K(t),h=Y(t);v||h?v&&h?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",_.log("Setting video transceiver to sendrecv:",c)):v&&!h?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",_.log("Setting video transceiver to sendonly:",c)):!v&&h&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",_.log("Setting video transceiver to recvonly:",c)):(c=r.pc.addTransceiver("video",{direction:"recvonly"}),_.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",_.log("Setting video transceiver to inactive:",c))}else o.offerToReceiveAudio=H(t),o.offerToReceiveVideo=Y(t);!0===a.iceRestart&&(o.iceRestart=!0);_.debug(o);var g=K(t);if(g&&i&&"firefox"===_.webRTCAdapter.browserDetails.browser){_.log("Enabling Simulcasting for Firefox (RID)");var y=r.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(y){var k=y.getParameters();k||(k={});var w=b(a.simulcastMaxBitrates);k.encodings=a.sendEncodings||[{rid:"h",active:!0,maxBitrate:w.high},{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:w.low,scaleResolutionDownBy:4}],y.setParameters(k)}}r.pc.createOffer(o).then((function(e){_.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,_.log("Setting local description"),g&&i&&("chrome"===_.webRTCAdapter.browserDetails.browser||"safari"===_.webRTCAdapter.browserDetails.browser?(_.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),a=!1,n=[-1],r=[-1],i=null,o=null,s=null,c=null,d=-1,l=0;l<t.length;l++){if(f=t[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(n[0]<0)){d=l;break}a=!0}else if(n[0]>-1){d=l;break}}else if(a){var u=t[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)n[0]=u[1],r[0]=u[2],t.splice(l,1),l--;else{if(n[0]){if((p=t[l].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(i=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(o=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=p[1]),0===t[l].indexOf("a=ssrc:"+r[0])){t.splice(l,1),l--;continue}if(0===t[l].indexOf("a=ssrc:"+n[0])){t.splice(l,1),l--;continue}}0!=t[l].length||(t.splice(l,1),l--)}}}if(n[0]<0){d=-1,a=!1;for(l=0;l<t.length;l++){var f;if(f=t[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(n[0]<0)){d=l;break}a=!0}else if(n[0]>-1){d=l;break}}else if(a){if(n[0]<0){var m=t[l].match(/a=ssrc:(\d+)/);if(m){n[0]=m[1],t.splice(l,1),l--;continue}}else{var p;if((p=t[l].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(i=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(o=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=p[1]),0===t[l].indexOf("a=ssrc:"+r[0])){t.splice(l,1),l--;continue}if(0===t[l].indexOf("a=ssrc:"+n[0])){t.splice(l,1),l--;continue}}0!==t[l].length||(t.splice(l,1),l--)}}}if(n[0]<0)return _.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=t.length);n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random());for(l=0;l<n.length;l++)i&&(t.splice(d,0,"a=ssrc:"+n[l]+" cname:"+i),d++),o&&(t.splice(d,0,"a=ssrc:"+n[l]+" msid:"+o),d++),s&&(t.splice(d,0,"a=ssrc:"+n[l]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+n[l]+" label:"+c),d++),i&&(t.splice(d,0,"a=ssrc:"+r[l]+" cname:"+i),d++),o&&(t.splice(d,0,"a=ssrc:"+r[l]+" msid:"+o),d++),s&&(t.splice(d,0,"a=ssrc:"+r[l]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+r[l]+" label:"+c),d++);t.splice(d,0,"a=ssrc-group:FID "+n[2]+" "+r[2]),t.splice(d,0,"a=ssrc-group:FID "+n[1]+" "+r[1]),t.splice(d,0,"a=ssrc-group:FID "+n[0]+" "+r[0]),t.splice(d,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==_.webRTCAdapter.browserDetails.browser&&_.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(a.error),r.mediaConstraints=o,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),a.success(e)):_.log("Waiting for all candidates...")}),a.error)}(e,a,n)}function U(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:_.noop,a.error="function"==typeof a.error?a.error:J;var n=a.jsep;if(t&&n)return _.error("Provided a JSEP to a createOffer"),void a.error("Provided a JSEP to a createOffer");if(!t&&(!n||!n.type||!n.sdp))return _.error("A valid JSEP is required for createAnswer"),void a.error("A valid JSEP is required for createAnswer");a.media="object"===typeof a.media&&a.media?a.media:{audio:!0,video:!0};var r=a.media,i=S[e];if(!i||!i.webrtcStuff)return _.warn("Invalid handle"),void a.error("Invalid handle");var o,s=i.webrtcStuff;if(s.trickle=(o=a.trickle,_.debug("isTrickleEnabled:",o),!1!==o),s.pc){if(_.log("Updating existing media session"),r.update=!0,a.stream)a.stream!==s.myStream&&_.log("Renegotiation involves a new external stream");else{if(r.addAudio){if(r.keepAudio=!1,r.replaceAudio=!1,r.removeAudio=!1,r.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return _.error("Can't add audio stream, there already is one"),void a.error("Can't add audio stream, there already is one")}else r.removeAudio?(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!1,r.audioSend=!1):r.replaceAudio&&(r.keepAudio=!1,r.addAudio=!1,r.removeAudio=!1,r.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!z(r)||r.removeAudio||r.replaceAudio||(r.keepAudio=!0):(r.replaceAudio&&(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!0,r.audioSend=!0),z(r)&&(r.keepAudio=!1,r.addAudio=!0)),r.addVideo){if(r.keepVideo=!1,r.replaceVideo=!1,r.removeVideo=!1,r.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return _.error("Can't add video stream, there already is one"),void a.error("Can't add video stream, there already is one")}else r.removeVideo?(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!1,r.videoSend=!1):r.replaceVideo&&(r.keepVideo=!1,r.addVideo=!1,r.removeVideo=!1,r.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!K(r)||r.removeVideo||r.replaceVideo||(r.keepVideo=!0):(r.replaceVideo&&(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!0,r.videoSend=!0),K(r)&&(r.keepVideo=!1,r.addVideo=!0)),r.addData&&(r.data=!0)}if(z(r)&&r.keepAudio&&K(r)&&r.keepVideo)return i.consentDialog(!1),void q(e,n,r,a,s.myStream)}else r.update=!1,r.keepAudio=!1,r.keepVideo=!1;if(r.update&&!s.streamExternal){if(r.removeAudio||r.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var c=s.myStream.getAudioTracks()[0];_.log("Removing audio track:",c),s.myStream.removeTrack(c);try{c.stop()}catch(O){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var d=!0;if(r.replaceAudio&&_.unifiedPlan&&(d=!1),d){var l,u=Object(M.a)(s.pc.getSenders());try{for(u.s();!(l=u.n()).done;){var f=l.value;f&&f.track&&"audio"===f.track.kind&&(_.log("Removing audio sender:",f),s.pc.removeTrack(f))}}catch(P){u.e(P)}finally{u.f()}}}}if(r.removeVideo||r.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var m=s.myStream.getVideoTracks()[0];_.log("Removing video track:",m),s.myStream.removeTrack(m);try{m.stop()}catch(O){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var p=!0;if(r.replaceVideo&&_.unifiedPlan&&(p=!1),p){var v,h=Object(M.a)(s.pc.getSenders());try{for(h.s();!(v=h.n()).done;){var g=v.value;g&&g.track&&"video"===g.track.kind&&(_.log("Removing video sender:",g),s.pc.removeTrack(g))}}catch(P){h.e(P)}finally{h.f()}}}}}if(a.stream){var b=a.stream;return _.log("MediaStream provided by the application"),_.debug(b),r.update&&s.myStream&&s.myStream!==a.stream&&!s.streamExternal&&(_.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,i.consentDialog(!1),void q(e,n,r,a,b)}if(z(r)||K(r)){if(!_.isGetUserMediaAvailable())return void a.error("getUserMedia not available");var y={mandatory:{},optional:[]};i.consentDialog(!0);var k=z(r);k&&r&&"object"===typeof r.audio&&(k=r.audio);var w=K(r);if(w&&r){var E=!0===a.simulcast,C=!0===a.simulcast2;if(!E&&!C||n||r.video||(r.video="hires"),r.video&&"screen"!=r.video&&"window"!=r.video)if("object"===typeof r.video)w=r.video;else{var T=0,D=0;"lowres"===r.video?(D=240,240,T=320):"lowres-16:9"===r.video?(D=180,180,T=320):"hires"===r.video||"hires-16:9"===r.video||"hdres"===r.video?(D=720,720,T=1280):"fhdres"===r.video?(D=1080,1080,T=1920):"4kres"===r.video?(D=2160,2160,T=3840):"stdres"===r.video?(D=480,480,T=640):"stdres-16:9"===r.video?(D=360,360,T=640):(_.log("Default video setting is stdres 4:3"),D=480,480,T=640),_.log("Adding media constraint:",r.video),w={height:{ideal:D},width:{ideal:T}},_.log("Adding video constraint:",w)}else if("screen"===r.video||"window"===r.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return y.video={},r.screenshareFrameRate&&(y.video.frameRate=r.screenshareFrameRate),r.screenshareHeight&&(y.video.height=r.screenshareHeight),r.screenshareWidth&&(y.video.width=r.screenshareWidth),y.audio=r.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(y).then((function(t){i.consentDialog(!1),z(r)&&!r.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){t.addTrack(i.getAudioTracks()[0]),q(e,n,r,a,t)})):q(e,n,r,a,t)}),(function(e){i.consentDialog(!1),a.error(e)}));function I(t,o){i.consentDialog(!1),t?a.error(t):q(e,n,r,a,o)}function R(e,t,a){_.log("Adding media constraint (screen capture)"),_.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){a?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(a){e.addTrack(a.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){i.consentDialog(!1),t(e)}))}if("chrome"===_.webRTCAdapter.browserDetails.browser){var A=_.webRTCAdapter.browserDetails.version,j=33;window.navigator.userAgent.match("Linux")&&(j=35),A>=26&&A<=j?R(y={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate,chromeMediaSource:"screen"}},audio:z(r)&&!r.keepAudio},I):_.extension.getScreen((function(e,t){if(e)return i.consentDialog(!1),a.error(e);(y={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,R(y,I,z(r)&&!r.keepAudio)}))}else if("firefox"===_.webRTCAdapter.browserDetails.browser){if(!(_.webRTCAdapter.browserDetails.version>=33)){var N=new Error("NavigatorUserMediaError");return N.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void a.error(N)}R(y={video:{mozMediaSource:r.video,mediaSource:r.video},audio:z(r)&&!r.keepAudio},(function(e,t){if(I(e,t),!e)var a=t.currentTime,n=window.setInterval((function(){t||window.clearInterval(n),t.currentTime==a&&(window.clearInterval(n),t.onended&&t.onended()),a=t.currentTime}),500)}))}return}}r&&"screen"===r.video||navigator.mediaDevices.enumerateDevices().then((function(t){var o=t.some((function(e){return"audioinput"===e.kind})),s=function(e){if(_.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(r)||t.some((function(e){return"videoinput"===e.kind})),c=z(r),d=K(r),l=function(e){return _.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(r),u=function(e){return _.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(r);if(c||d||l||u){var f=!!c&&o,m=!!d&&s;if(!f&&!m)return i.consentDialog(!1),a.error("No capture device found"),!1;if(!f&&l)return i.consentDialog(!1),a.error("Audio capture is required, but no capture device found"),!1;if(!m&&u)return i.consentDialog(!1),a.error("Video capture is required, but no capture device found"),!1}var p={audio:!(!o||r.keepAudio)&&k,video:!(!s||r.keepVideo)&&w};_.debug("getUserMedia constraints",p),p.audio||p.video?navigator.mediaDevices.getUserMedia(p).then((function(t){i.consentDialog(!1),q(e,n,r,a,t)})).catch((function(e){i.consentDialog(!1),a.error({code:e.code,name:e.name,message:e.message})})):(i.consentDialog(!1),q(e,n,r,a,b))})).catch((function(e){i.consentDialog(!1),a.error(e)}))}else q(e,n,r,a)}function V(e,t){(t=t||{}).success="function"==typeof t.success?t.success:_.noop,t.error="function"==typeof t.error?t.error:J;var a=t.jsep,n=S[e];if(!n||!n.webrtcStuff)return _.warn("Invalid handle"),void t.error("Invalid handle");var r=n.webrtcStuff;if(a){if(!r.pc)return _.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");r.pc.setRemoteDescription(a).then((function(){if(_.log("Remote description accepted!"),r.remoteSdp=a.sdp,r.candidates&&r.candidates.length>0){for(var e=0;e<r.candidates.length;e++){var n=r.candidates[e];_.debug("Adding remote candidate:",n),n&&!0!==n.completed?r.pc.addIceCandidate(n):r.pc.addIceCandidate(_.endOfCandidates)}r.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function L(e,t){var a=S[e];if(!a||!a.webrtcStuff)return _.warn("Invalid handle"),0;var n=t?"remote":"local",r=a.webrtcStuff;return r.volume[n]||(r.volume[n]={value:0}),!r.pc.getStats||"chrome"!==_.webRTCAdapter.browserDetails.browser&&"safari"!==_.webRTCAdapter.browserDetails.browser?(_.warn("Getting the "+n+" volume unsupported by browser"),0):t&&!r.remoteStream?(_.warn("Remote stream unavailable"),0):t||r.myStream?r.volume[n].timer?r.volume[n].value:(_.log("Starting "+n+" volume monitor"),r.volume[n].timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(r.volume[n].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(_.warn("Local stream unavailable"),0)}function B(e,t){var a=S[e];if(!a||!a.webrtcStuff)return _.warn("Invalid handle"),!0;var n=a.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(_.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(_.warn("No audio track"),!0):(_.warn("Invalid local MediaStream"),!0):(_.warn("Invalid PeerConnection"),!0)}function F(e,t,a){var n=S[e];if(!n||!n.webrtcStuff)return _.warn("Invalid handle"),!1;var r=n.webrtcStuff;return r.pc?r.myStream?t?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?(r.myStream.getVideoTracks()[0].enabled=!a,!0):(_.warn("No video track"),!1):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?(r.myStream.getAudioTracks()[0].enabled=!a,!0):(_.warn("No audio track"),!1):(_.warn("Invalid local MediaStream"),!1):(_.warn("Invalid PeerConnection"),!1)}function W(e){var t=S[e];if(!t||!t.webrtcStuff)return _.warn("Invalid handle"),"Invalid handle";var a=t.webrtcStuff;return a.pc?a.pc.getStats?a.bitrate.timer?a.bitrate.value:(_.log("Starting bitrate timer (via getStats)"),a.bitrate.timer=setInterval((function(){a.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(a.bitrate.bsnow=e.bytesReceived,a.bitrate.tsnow=e.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var n=a.bitrate.tsnow-a.bitrate.tsbefore;"safari"===_.webRTCAdapter.browserDetails.browser&&(n/=1e3);var r=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/n);"safari"===_.webRTCAdapter.browserDetails.browser&&(r=parseInt(r/1e3)),a.bitrate.value=r+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(_.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function J(e){_.error("WebRTC error:",e)}function G(e,n){_.log("Cleaning WebRTC stuff");var r=S[e];if(r){var i=r.webrtcStuff;if(i){if(!0===n){var o={janus:"hangup",transaction:_.randomString(12)};r.token&&(o.token=r.token),v&&(o.apisecret=v),_.debug("Sending hangup request (handle="+e+"):"),_.debug(o),t?(o.session_id=k,o.handle_id=e,a.send(JSON.stringify(o))):_.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:f,body:o})}i.remoteStream=null,i.volume&&(i.volume.local&&i.volume.local.timer&&clearInterval(i.volume.local.timer),i.volume.remote&&i.volume.remote.timer&&clearInterval(i.volume.remote.timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null,!i.streamExternal&&i.myStream&&(_.log("Stopping local stream tracks"),_.stopAllTracks(i.myStream)),i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(c){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null,i.senderTransforms=null,i.receiverTransforms=null}r.oncleanup()}}function z(e){return _.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function H(e){return _.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function K(e){return _.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function Y(e){return _.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}R(e),this.getServer=function(){return s},this.isConnected=function(){return y},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:_.noop,e.error="function"==typeof e.error?e.error:_.noop,e.reconnect=!0,R(e)},this.getSessionId=function(){return k},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:_.noop,e.error="function"==typeof e.error?e.error:_.noop,_.log("Getting info on Janus instance"),!y)return _.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=_.randomString(12),r={janus:"info",transaction:n};p&&(r.token=p);v&&(r.apisecret=v);if(t)return C[n]=function(t){_.log("Server info:"),_.debug(t),"server_info"!==t.janus&&_.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},void a.send(JSON.stringify(r));_.httpAPICall(s,{verb:"POST",withCredentials:f,body:r,success:function(t){_.log("Server info:"),_.debug(t),"server_info"!==t.janus&&_.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,a){_.error(t+":",a),""===a?e.error(t+": Is the server down?"):e.error(t+": "+a)}})}(e)},this.destroy=function(i){!function(i){(i=i||{}).success="function"==typeof i.success?i.success:_.noop,i.error="function"==typeof i.error?i.error:_.noop;var o=!0===i.unload,c=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(c=!0===i.notifyDestroyed);var d=!0===i.cleanupHandles;if(_.log("Destroying session "+k+" (unload="+o+")"),!k)return _.warn("No session to destroy"),i.success(),void(c&&e.destroyed());if(d)for(var l in S)x(l,{noRequest:!0});if(!y)return _.warn("Is the server down? (connected=false)"),k=null,void i.success();var u={janus:"destroy",transaction:_.randomString(12)};p&&(u.token=p);v&&(u.apisecret=v);if(o)return t?(a.onclose=null,a.close(),a=null):navigator.sendBeacon(s+"/"+k,JSON.stringify(u)),_.log("Destroyed session:"),k=null,y=!1,i.success(),void(c&&e.destroyed());if(t){u.session_id=k;var m=function(){for(var e in n)a.removeEventListener(e,n[e]);a.removeEventListener("message",h),a.removeEventListener("error",g),r&&clearTimeout(r),a.close()},h=function(t){var a=JSON.parse(t.data);a.session_id==u.session_id&&a.transaction==u.transaction&&(m(),i.success(),c&&e.destroyed())},g=function(t){m(),i.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return a.addEventListener("message",h),a.addEventListener("error",g),void(1===a.readyState?a.send(JSON.stringify(u)):g())}_.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:f,body:u,success:function(t){_.log("Destroyed session:"),_.debug(t),k=null,y=!1,"success"!==t.janus&&_.error("Ooops: "+t.error.code+" "+t.error.reason),i.success(),c&&e.destroyed()},error:function(t,a){_.error(t+":",a),k=null,y=!1,i.success(),c&&e.destroyed()}})}(i)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:_.noop,e.error="function"==typeof e.error?e.error:_.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:_.noop,e.iceState="function"==typeof e.iceState?e.iceState:_.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:_.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:_.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:_.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:_.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:_.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:_.noop,e.ondata="function"==typeof e.ondata?e.ondata:_.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:_.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:_.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:_.noop,!y)return _.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return _.error("Invalid plugin"),void e.error("Invalid plugin");var r=e.opaqueId,i=e.token?e.token:p,o=_.randomString(12),c={janus:"attach",plugin:n,opaque_id:r,transaction:o};i&&(c.token=i);v&&(c.apisecret=v);if(t)return C[o]=function(t){if(_.debug(t),"success"!==t.janus)return _.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;_.log("Created handle: "+a);var r={session:w,plugin:n,id:a,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return n},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return B(a,!1)},muteAudio:function(){return F(a,!1,!0)},unmuteAudio:function(){return F(a,!1,!1)},isVideoMuted:function(){return B(a,!0)},muteVideo:function(){return F(a,!0,!0)},unmuteVideo:function(){return F(a,!0,!1)},getBitrate:function(){return W(a)},send:function(e){A(a,e)},data:function(e){O(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(a,!0,e)},createAnswer:function(e){U(a,!1,e)},handleRemoteJsep:function(e){V(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(a,!0===e)},detach:function(e){x(a,e)}};S[a]=r,e.success(r)},c.session_id=k,void a.send(JSON.stringify(c));_.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:f,body:c,success:function(t){if(_.debug(t),"success"!==t.janus)return _.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;_.log("Created handle: "+a);var r={session:w,plugin:n,id:a,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return n},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return B(a,!1)},muteAudio:function(){return F(a,!1,!0)},unmuteAudio:function(){return F(a,!1,!1)},isVideoMuted:function(){return B(a,!0)},muteVideo:function(){return F(a,!0,!0)},unmuteVideo:function(){return F(a,!0,!1)},getBitrate:function(){return W(a)},send:function(e){A(a,e)},data:function(e){O(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(a,!0,e)},createAnswer:function(e){U(a,!1,e)},handleRemoteJsep:function(e){V(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(a,!0===e)},detach:function(e){x(a,e)}};S[a]=r,e.success(r)},error:function(t,a){_.error(t+":",a),""===a?e.error(t+": Is the server down?"):e.error(t+": "+a)}})}(e)}}_.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,a=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||U,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||x.a,httpAPICall:function(e,n){var r={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(r.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(r.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(r.body=JSON.stringify(n.body));var i=t(e,r).catch((function(e){return a.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var o=new a((function(e,t){var a=setTimeout((function(){return clearTimeout(a),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));i=a.race([i,o])}return i.then((function(e){return e.ok?typeof n.success===typeof _.noop?e.json().then((function(e){n.success(e)})).catch((function(t){return a.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:a.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error===typeof _.noop&&n.error(e.message||"<< internal error >>",e)})),i}}},_.useOldDependencies=function(e){var t=e&&e.jQuery||P.a,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new a(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||U,webRTCAdapter:e&&e.adapter||x.a,httpAPICall:function(e,a){var n=void 0!==a.body?{contentType:"application/json",data:JSON.stringify(a.body)}:{},r=void 0!==a.withCredentials?{xhrFields:{withCredentials:a.withCredentials}}:{};return t.ajax(t.extend(n,r,{url:e,type:a.verb,cache:!1,dataType:"json",async:a.async,timeout:a.timeout,success:function(e){typeof a.success===typeof _.noop&&a.success(e)},error:function(e,t,n){typeof a.error===typeof _.noop&&a.error(t,n)}}))}}},_.noop=function(){},_.dataChanDefaultLabel="JanusDataChannel",_.endOfCandidates=null,_.stopAllTracks=function(e){try{var t,a=e.getTracks(),n=Object(M.a)(a);try{for(n.s();!(t=n.n()).done;){var r=t.value;_.log(r),r&&r.stop()}}catch(i){n.e(i)}finally{n.f()}}catch(o){}},_.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:_.noop,_.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),_.trace=_.noop,_.debug=_.noop,_.vdebug=_.noop,_.log=_.noop,_.warn=_.noop,_.error=_.noop,!0===e.debug||"all"===e.debug)_.trace=console.trace.bind(console),_.debug=console.debug.bind(console),_.vdebug=console.debug.bind(console),_.log=console.log.bind(console),_.warn=console.warn.bind(console),_.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t,a=Object(M.a)(e.debug);try{for(a.s();!(t=a.n()).done;){var n=t.value;switch(n){case"trace":_.trace=console.trace.bind(console);break;case"debug":_.debug=console.debug.bind(console);break;case"vdebug":_.vdebug=console.debug.bind(console);break;case"log":_.log=console.log.bind(console);break;case"warn":_.warn=console.warn.bind(console);break;case"error":_.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(f){a.e(f)}finally{a.f()}}_.log("Initializing library");var r=e.dependencies||_.useDefaultDependencies();_.isArray=r.isArray,_.webRTCAdapter=r.webRTCAdapter,_.httpAPICall=r.httpAPICall,_.newWebSocket=r.newWebSocket,_.extension=r.extension,_.extension.init(),_.listDevices=function(e,t){e="function"==typeof e?e:_.noop,null==t&&(t={audio:!0,video:!0}),_.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(a){_.debug(a),e(a),_.stopAllTracks(t)}))})).catch((function(t){_.error(t),e([])})):(_.warn("navigator.mediaDevices unavailable"),e([]))},_.attachMediaStream=function(e,t){try{e.srcObject=t}catch(a){try{e.src=URL.createObjectURL(t)}catch(a){_.error("Error attaching stream to element")}}},_.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(a){try{e.src=t.src}catch(a){_.error("Error reattaching stream to element")}}};var i=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",o=window["on"+i];if(window.addEventListener(i,(function(e){for(var t in _.log("Closing window"),_.sessions)_.sessions[t]&&_.sessions[t].destroyOnUnload&&(_.log("Destroying session "+t),_.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));o&&"function"==typeof o&&o()})),_.safariVp8=!1,"safari"===_.webRTCAdapter.browserDetails.browser&&_.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var s,c=Object(M.a)(RTCRtpSender.getCapabilities("video").codecs);try{for(c.s();!(s=c.n()).done;){var d=s.value;if(d&&d.mimeType&&"video/vp8"===d.mimeType.toLowerCase()){_.safariVp8=!0;break}}}catch(f){c.e(f)}finally{c.f()}_.safariVp8?_.log("This version of Safari supports VP8"):_.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var l=new RTCPeerConnection({});l.createOffer({offerToReceiveVideo:!0}).then((function(e){_.safariVp8=-1!==e.sdp.indexOf("VP8"),_.safariVp8?_.log("This version of Safari supports VP8"):_.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),l.close(),l=null}))}if(_.unifiedPlan=!1,"firefox"===_.webRTCAdapter.browserDetails.browser&&_.webRTCAdapter.browserDetails.version>=59)_.unifiedPlan=!0;else if("chrome"===_.webRTCAdapter.browserDetails.browser&&_.webRTCAdapter.browserDetails.version>=72)_.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in q.prototype){var u=new RTCPeerConnection;try{u.addTransceiver("audio"),_.unifiedPlan=!0}catch(m){}u.close()}else _.unifiedPlan=!1;_.initDone=!0,e.callback()}},_.isWebrtcSupported=function(){return!!window.RTCPeerConnection},_.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},_.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++){var r=Math.floor(Math.random()*t.length);a+=t.substring(r,r+1)}return a};var V=_,L=a(40),B=a.n(L),F=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).handleKeyDown=function(e){"Enter"===e.key&&(n.props.sendChat(e.target.value),P()("#chat-input").val(""),console.log("do validate",e.target.value))},n.participantTag=n.participantTag.bind(Object(u.a)(n)),n.chatsBody=n.chatsBody.bind(Object(u.a)(n)),n.panelBlocks=n.panelBlocks.bind(Object(u.a)(n)),n.upload=n.upload.bind(Object(u.a)(n)),n.getList=n.getList.bind(Object(u.a)(n)),n.sharesBody=n.sharesBody.bind(Object(u.a)(n)),n.state={token:window.localStorage.getItem("token"),chats:[],panel:[],file:null,progress:0,progressShow:!1,uploads:null,room:null,uploaded:!1,currentBlock:"participants"},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){g.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){}},{key:"getList",value:function(){var e=this,t=g.getList(),a=g.getKlass();t&&"Upload"===a&&this.setState({uploads:t},(function(){return e.panelBlocks("shares")})),console.log("uploads",t)}},{key:"componentDidUpdate",value:function(e){e.chats!==this.props.chats&&"chat"===this.state.currentBlock&&this.panelBlocks("chat"),e.participants!==this.props.participants&&this.panelBlocks("participants"),e.requests!==this.props.requests&&this.panelBlocks("participants"),e.uploads!==this.props.uploads&&this.panelBlocks("shares"),e.room!==this.props.room&&(console.log("room id:",this.props.roomId),this.setState({room:this.props.room}),E("uploads",this.state.page,{room_id:this.props.room.id},this.state.token))}},{key:"upload",value:function(e){var t=this,a=this;console.log(e),a.setState({progressShow:!0},(function(){return a.panelBlocks("shares")}));var n={onUploadProgress:function(e){var t=Math.round(100*e.loaded/e.total);console.log(t),a.setState({progress:t},(function(){return a.panelBlocks("shares")}))},headers:{"Content-Type":"application/json",Authorization:"bearer "+a.state.token}},r=new FormData;r.append("upload[attached_document]",e),r.append("upload[room_id]",a.state.room.id),y.a.post(k+"/uploads",r,n).then((function(e){a.setState({progressShow:!1},(function(){return a.panelBlocks("shares")})),E("uploads",t.state.page,{room_id:t.props.room.id},t.state.token),a.props.fileUploaded()})).catch((function(e){return a.setState({progressShow:!1},(function(){return a.panelBlocks("shares")}))}))}},{key:"requestIcon",value:function(e){var t=this;if(this.props.participantHasRequest(e)&&this.props.isOwner)return r.a.createElement("a",{className:"tag  is-info",onClick:function(){return t.props.acceptRequest(e)}},r.a.createElement("i",{className:"fas fa-check","aria-hidden":"true"}))}},{key:"participantTag",value:function(){var e=this,t=[];return this.props.participants&&this.props.participants.map((function(a){console.log(e.props.participantHasRequest(a.uuid)),t.push(r.a.createElement("div",{class:"row is-full"},r.a.createElement("div",{className:"tags has-addons  p-1"},r.a.createElement("span",{className:"tag w-150"},a.display),r.a.createElement("a",{className:"tag  is-warning"},r.a.createElement("i",{className:"fas fa-search","aria-hidden":"true"})),e.requestIcon(a.uuid),r.a.createElement("a",{className:"tag  is-dark"},r.a.createElement("i",{className:"fas fa-times","aria-hidden":"true"})))))})),t}},{key:"chatsBody",value:function(){var e=[];return this.props.chats&&this.props.chats.map((function(t){console.log(t),e.push(r.a.createElement("article",{class:"media"},r.a.createElement("div",{class:"media-content"},r.a.createElement("div",{class:"content"},r.a.createElement("p",null,r.a.createElement("strong",null,t.display)," ",r.a.createElement("small",null," ",r.a.createElement(B.a,{fromNow:!0,ago:!0},t.time)),r.a.createElement("br",null),t.body)))))})),console.log(e),e}},{key:"sharesBody",value:function(){var e=[];return this.state.uploads&&this.state.uploads.map((function(t){e.push(r.a.createElement("article",{className:"media"},r.a.createElement("div",{className:"media-content"},r.a.createElement("div",{className:"content"},r.a.createElement("p",null,r.a.createElement("strong",null,t.uploader)," ",r.a.createElement("small",null," ",r.a.createElement(B.a,{fromNow:!0,ago:!0},t.created_at)),r.a.createElement("br",null),r.a.createElement("a",{target:"_blank",href:t.link,className:"fs-10"},r.a.createElement("i",{className:"fa fa-download","aria-hidden":"true"})," Download!"))))))})),console.log(e),e}},{key:"panelBlocks",value:function(e){var t=this;this.setState({currentBlock:e});var a=[];switch(e){case"chat":a.push(r.a.createElement("div",{className:"w-100"},r.a.createElement("div",{className:"control is-expanded has-icons-left "},r.a.createElement("input",{id:"chat-input",className:"input mb-4",type:"text",placeholder:"Type here!",onKeyDown:this.handleKeyDown}),r.a.createElement("span",{className:"icon is-left mb-4"},r.a.createElement("i",{className:"fas fa-comment","aria-hidden":"true"})),this.chatsBody())));break;case"shares":a.push(r.a.createElement("div",{className:"w-100 d-block"},r.a.createElement("div",{className:"w-100 mt-4"},r.a.createElement("div",{className:"field "},r.a.createElement("div",{className:"file is-small"},r.a.createElement("label",{className:"file-label mrl-auto"},r.a.createElement("input",{className:"file-input",type:"file",name:"resume",onInput:function(e){return t.upload(e.target.files[0])}}),r.a.createElement("span",{className:"file-cta"},r.a.createElement("span",{className:"file-icon"},r.a.createElement("i",{className:"fas fa-upload"})),r.a.createElement("span",{className:"file-label"},"Choose a file to upload !")))))),r.a.createElement("div",{className:"row mt-2"},r.a.createElement("progress",{className:this.state.progressShow?"progress is-primary ":"progress is-primary is-hidden",value:this.state.progress,max:"100"},this.state.progress)),this.sharesBody()));break;case"polls":break;default:a.push(r.a.createElement("div",{className:"w-100"},r.a.createElement("div",{class:"rows"},this.participantTag())))}console.log(a),this.setState({panel:a})}},{key:"render",value:function(){var e=this;this.state.token;return r.a.createElement("div",{className:"column is-3 is-inline-block-mobile p-0"},r.a.createElement("nav",{className:"panel mt-4 p-2 ml-2 h-100"},r.a.createElement("div",{className:"panel-block"},r.a.createElement("p",{className:"control has-icons-left"},r.a.createElement("input",{className:"input",type:"text",placeholder:"Search"}),r.a.createElement("span",{className:"icon is-left"},r.a.createElement("i",{className:"fas fa-search","aria-hidden":"true"})))),r.a.createElement("p",{className:"panel-tabs"},r.a.createElement("a",{className:"is-active"},"!"),r.a.createElement("a",{onClick:function(){return e.panelBlocks("participants")}},"Participants",r.a.createElement("span",{className:"badge bg-red"})),r.a.createElement("a",{onClick:function(){return e.panelBlocks("chat")}},"Chat"),r.a.createElement("a",{onClick:function(){return e.panelBlocks("shares")}},"Shares"),r.a.createElement("a",null,"Polls")),r.a.createElement("div",{id:"panel-block",className:"panel-block is-justify-content-left is-fullwidth ai-b"},this.state.panel)))}}]),a}(r.a.Component),W=(a(78),a(79),a(137),function(e){function t(t,a){var n="140",i="120";return"high"===t&&(n="240",i=""),"present"===t&&(n="640",i=""),r.a.createElement("div",{class:"column is-horizontal-center has-text-centered"},r.a.createElement("video",{controls:!0,key:a,id:"video-"+a,src:"",width:n,height:i,autoPlay:!0,playsInline:!0,muted:e.muted,poster:"https://picsum.photos/300/200"}))}function a(e,t){return e?r.a.createElement("span",{class:"fa-stack"},r.a.createElement("i",{class:"fas fa-"+t+" fa-stack-1x"}),r.a.createElement("i",{class:"fas fa-slash fa-stack-1x",style:{textShadow:"0.1em 0.15em white"}})):r.a.createElement("span",{class:"fa-stack"},r.a.createElement("i",{className:"fas fa-"+t}))}return e.room?r.a.createElement("aside",{className:"column pl-0 aside hero is-fullheight"},r.a.createElement("div",{className:"media-bar p-2 pl-4 has-background-dark has-text-white-ter"},r.a.createElement("a",{onClick:function(){return e.toggleMicrophone()},className:"has-text-white-bis"},a(e.publishedMicrophone,"microphone")),r.a.createElement("a",{onClick:function(){return e.toggleCamera()},className:"has-text-white-bis"},a(e.publishedCamera,"camera")),r.a.createElement("a",{onClick:function(){return e.toggleDesktop()},className:"has-text-white-bis ml-2"},a(e.publishedDesktop,"desktop")),r.a.createElement("a",{onClick:function(){return e.speakRequest()},className:"has-text-white-bis ml-2"},r.a.createElement("i",{className:"fas fa-hand-paper va-2","aria-hidden":"true"}))),r.a.createElement("div",{className:"container p-4"},function(){if(e.notification&&"cameraSwitch"===e.notification.type){var t="";return"screen sharing"===e.notification.from&&(t=r.a.createElement("button",{className:"button deactivate-btn",onClick:function(){return e.toggleDesktop()}},"Deactivate")),"camera"===e.notification.from&&(t=r.a.createElement("button",{className:"button deactivate-btn",onClick:function(){return e.toggleCamera()}},"Deactivate")),r.a.createElement("div",{className:"notification is-warning"},r.a.createElement("button",{className:"delete"}),"You must deactivate your ",r.a.createElement("strong",null,e.notification.from)," in order to activate ",r.a.createElement("strong",null,e.notification.to),".",t)}return null}(),r.a.createElement("div",{className:"columns mt-2 is-mobile is-multiline is-centered p-4"},function(){var a=[];return e.feeds&&e.feeds.map((function(n){"speaker"===e.feedToRole(n.id)&&(console.log(n.id,"is a speaker"),a.push(t("high","h-"+n.id)))})),a}()),r.a.createElement("div",{className:"columns mt-2 is-mobile is-multiline is-centered p-4 is-horizontal-center"},function(){var a=[];return e.feeds&&e.feeds.map((function(n){"presenter"===e.feedToRole(n.id)&&(console.log(n.id,"is a presenter"),a.push(t("present","p-"+n.id)))})),a}()),r.a.createElement("div",{className:"columns is-mobile is-multiline has-background-white-bis p-4"},r.a.createElement("div",{className:"column is-narrow"},function(){var a=[];return e.feeds&&e.feeds.map((function(n){"listener"===e.feedToRole(n.id)&&(console.log(n.id,"is a listener"),a.push(t("low",n.id)))})),a}())))):null}),J=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).getList=e.getList.bind(Object(u.a)(e)),e.sessionCreate=e.sessionCreate.bind(Object(u.a)(e)),e.registerUsername=e.registerUsername.bind(Object(u.a)(e)),e.newRemoteFeed=e.newRemoteFeed.bind(Object(u.a)(e)),e.publishCamera=e.publishCamera.bind(Object(u.a)(e)),e.publishMicrophone=e.publishMicrophone.bind(Object(u.a)(e)),e.off=e.off.bind(Object(u.a)(e)),e.on=e.on.bind(Object(u.a)(e)),e.pageAfterIn=e.pageAfterIn.bind(Object(u.a)(e)),e.streamAttacher=e.streamAttacher.bind(Object(u.a)(e)),e.streamDettacher=e.streamDettacher.bind(Object(u.a)(e)),e.unmute=e.unmute.bind(Object(u.a)(e)),e.getInstance=e.getInstance.bind(Object(u.a)(e)),e.sendData=e.sendData.bind(Object(u.a)(e)),e.setInstance=e.setInstance.bind(Object(u.a)(e)),e.speakRequest=e.speakRequest.bind(Object(u.a)(e)),e.publishData=e.publishData.bind(Object(u.a)(e)),e.removeRequest=e.removeRequest.bind(Object(u.a)(e)),e.acceptRequest=e.acceptRequest.bind(Object(u.a)(e)),e.addParticipant=e.addParticipant.bind(Object(u.a)(e)),e.removeParticipant=e.removeParticipant.bind(Object(u.a)(e)),e.unPublishData=e.unPublishData.bind(Object(u.a)(e)),e.exisitingParticipant=e.exisitingParticipant.bind(Object(u.a)(e)),e.requestAccepted=e.requestAccepted.bind(Object(u.a)(e)),e.findParticpantByUuid=e.findParticpantByUuid.bind(Object(u.a)(e)),e.participantIndex=e.participantIndex.bind(Object(u.a)(e)),e.findParticpantById=e.findParticpantById.bind(Object(u.a)(e)),e.findFeedByRfid=e.findFeedByRfid.bind(Object(u.a)(e)),e.findFeedById=e.findFeedById.bind(Object(u.a)(e)),e.feedToRole=e.feedToRole.bind(Object(u.a)(e)),e.attachMedia=e.attachMedia.bind(Object(u.a)(e)),e.unPublishCamera=e.unPublishCamera.bind(Object(u.a)(e)),e.beforeRemove=e.beforeRemove.bind(Object(u.a)(e)),e.toggleCamera=e.toggleCamera.bind(Object(u.a)(e)),e.toggleMicrophone=e.toggleMicrophone.bind(Object(u.a)(e)),e.submitParticipation=e.submitParticipation.bind(Object(u.a)(e)),e.publishDesktop=e.publishDesktop.bind(Object(u.a)(e)),e.presentMessage=e.presentMessage.bind(Object(u.a)(e)),e.unPublishDesktop=e.unPublishDesktop.bind(Object(u.a)(e)),e.cameraPublisher=e.cameraPublisher.bind(Object(u.a)(e)),e.toggleDesktop=e.toggleDesktop.bind(Object(u.a)(e)),e.changeParticipantRole=e.changeParticipantRole.bind(Object(u.a)(e)),e.sendChat=e.sendChat.bind(Object(u.a)(e)),e.participantHasRequest=e.participantHasRequest.bind(Object(u.a)(e)),e.fileUploaded=e.fileUploaded.bind(Object(u.a)(e)),e.state={token:window.localStorage.getItem("token"),shortners:null,server:S,janus:null,sfutest:null,opaqueId:"videoroomtest-"+V.randomString(12),roomId:null,myusername:null,myid:null,mystream:null,mypvtid:"videoroomtest-"+V.randomString(12),pin:null,feeds:[],activeFeeds:[],bitrateTimer:[],userUUID:null,fullname:null,isOwner:!1,urls:[],publishedCamera:!1,publishedMicrophone:!1,publishedDesktop:!1,muted:!0,requests:[],lowFeeds:[],participants:[],room:null,notification:{},chats:[]},e}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("got_instance",this.getInstance),g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("got_instance",this.getInstance),g.removeListener("set_instance",this.setInstance),window.removeEventListener("beforeunload",this.unPublishData)}},{key:"updateSubscribers",value:function(){T("subscribers",{room_id:this.state.roomId},this.state.token)}},{key:"renewSubscribers",value:function(){C("subscribers",this.state.roomId,this.state.token)}},{key:"sessionCreate",value:function(){var e=this;V.init({debug:"none",callback:function(){var t=new V({server:e.state.server,success:function(){t.attach({plugin:"janus.plugin.videoroom",opaqueId:e.state.opaqueId,success:function(a){e.setState({janus:t}),e.setState({sfutest:a}),V.log("Plugin attached! ("+e.state.sfutest.getPlugin()+", id="+e.state.sfutest.getId()+")"),V.log("  -- This is a publisher/manager"),e.registerUsername()},error:function(e){V.error("  -- Error attaching plugin...",e),window.alert("Error attaching plugin... "+e)},consentDialog:function(e){V.debug("Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){V.log("ICE state changed to "+e)},mediaState:function(e,t){V.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){V.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(t,a){V.log(" ::: Got a message (publisher) :::",t);var n=t.videoroom;if(V.debug("Event: "+n),n)if("joined"===n){if(console.log("joined"),e.setState({myid:t.id,mypvtid:t.private_id}),e.addParticipant(t.id,e.state.fullname+"\xa7"+e.state.userUUID),t.publishers){var r=t.publishers;for(var i in console.log("Got a list of available publishers/feeds:",r),r){var o=r[i].id,s=r[i].display,c=r[i].audio_codec,d=r[i].video_codec;V.debug("  >> ["+o+"] "+s+" (audio: "+c+", video: "+d+")"),e.addParticipant(r[i].id,r[i].display),e.newRemoteFeed(o,s,c,d)}}}else if("destroyed"===n)V.warn("The room has been destroyed!");else if("event"===n)if(t.publishers){r=t.publishers;for(var i in V.log("Got a list of available publishers/feeds:",r),r){o=r[i].id,s=r[i].display,c=r[i].audio_codec,d=r[i].video_codec;V.log("  >> ["+o+"] "+s+" (audio: "+c+", video: "+d+")"),e.addParticipant(r[i].id,r[i].display),e.newRemoteFeed(o,s,c,d)}}else if(t.leaving){var l=t.leaving;console.log("Publisher leaving: "+l),e.setState({feeds:e.state.feeds.filter((function(e){return e.rfid!=l}))},(function(){return console.log("feeds: >>>>",e.state.feeds)})),null!=(f=(m=e.state.feeds.filter((function(e){return e.rfid===l}))).shift())&&f.detach(),e.removeParticipant(l)}else if(t.unpublished){var u=t.unpublished;if(console.log("Publisher left: "+u),"ok"===u)return e.state.sfutest.hangup(),void e.streamDettacher(e.state.sfutest);e.setState({feeds:e.state.feeds.filter((function(e){return e.rfid!=u}))});var f,m=e.state.feeds.filter((function(e){return e.rfid===u}));e.setState({lowFeeds:e.state.lowFeeds.filter((function(e){return e.rfid!=u}))}),null!=(f=m.shift())&&(f.detach(),e.streamDettacher(f)),e.removeParticipant(u)}else t.error||t.configured||t.joining&&(console.log("Somebodu joining"),e.addParticipant(t.joining.id,t.joining.display));a&&(V.log("Handling SDP as well...",a),e.state.sfutest.handleRemoteJsep({jsep:a}))},onlocalstream:function(t){console.log(" ::: Got a local stream :::",t),console.log(e.state.sfutest.id),0===e.state.feeds.filter((function(t){return t.id===e.state.sfutest.id})).length&&(e.state.sfutest.rfid=e.state.myid,e.setState({feeds:e.state.feeds.concat(e.state.sfutest)}),e.state.isOwner&&e.requestAccepted(e.state.userUUID));var a=t.getVideoTracks();a&&0!==a.length?(console.log(e.state.participants),e.streamAttacher(e.state.sfutest)):e.streamDettacher(e.state.sfutest)},onremotestream:function(e){V.log(" ::: Got a remote stream :::",e)},ondata:function(e){V.debug("We got data from the DataChannel!",e)},oncleanup:function(){V.log(" ::: Got a cleanup notification: we are unpublished now :::")}})},error:function(e){V.error(e),window.alert(e,(function(){window.location.reload()}))},destroyed:function(){window.location.reload()}})}})}},{key:"registerUsername",value:function(){var e={request:"join",room:this.state.roomId,ptype:"publisher",display:this.state.fullname+" \xa7"+this.state.userUUID,pin:this.state.pin};this.state.sfutest.send({message:e}),setTimeout(function(){this.publishData()}.bind(this),3e3)}},{key:"findFeedByRfid",value:function(e){var t=this.state.feeds.filter((function(t){return t.rfid===e}));if(t&&t[0])return t[0]}},{key:"findFeedById",value:function(e){var t=this.state.feeds.filter((function(t){return t.id===e}));if(t&&t[0])return t[0]}},{key:"feedIdToRfid",value:function(e){var t=this.state.feeds.filter((function(t){return t.id===e}));if(t&&t[0])return t[0].rfid}},{key:"addParticipant",value:function(e,t){console.log("Adding Participants ...",e,t);var a=t.split("\xa7");this.exisitingParticipant(a[1])&&this.setState({participants:this.state.participants.concat({id:e,display:a[0],uuid:a[1],role:"listener"})}),console.log("participant added:",a[1])}},{key:"exisitingParticipant",value:function(e){return 0===this.state.participants.filter((function(t){return t.uuid===e})).length}},{key:"findParticpantById",value:function(e){var t=this.state.participants.filter((function(t){return t.id===e}));if(t&&t[0])return t[0]}},{key:"findParticpantByUuid",value:function(e){var t=this.state.participants.filter((function(t){return t.uuid===e}));if(t&&t[0])return t[0]}},{key:"removeParticipant",value:function(e){this.setState({participants:this.state.participants.filter((function(t){return t.id!==e}))})}},{key:"newRemoteFeed",value:function(e,t,a,n,r){var i=this,o=null;i.state.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.state.opaqueId,success:function(t){(o=t).simulcastStarted=!1,V.log("Plugin attached! ("+o.getPlugin()+", id="+o.getId()+")"),V.log("  -- This is a subscriber");var a={request:"join",room:i.state.roomId,ptype:"subscriber",pin:i.state.pin,feed:e,private_id:i.state.mypvtid};"safari"!==V.webRTCAdapter.browserDetails.browser||"vp9"!==r&&("vp8"!==r||V.safariVp8)||(r&&(r=r.toUpperCase()),console.log("Publisher is using "+r+", but Safari doesn't support it: disabling video"),a.offer_video=!1),o.videoCodec=r,o.send({message:a})},error:function(e){V.error("  -- Error attaching plugin...",e),window.alert("Error attaching plugin... "+e)},onmessage:function(e,t){V.debug(" ::: Got a message (subscriber) :::",e);var a=e.videoroom;V.log("Event: "+a),e.error?window.alert(e.error):a&&"attached"===a&&(o.rfid=e.id,o.rfdisplay=e.display,i.setState({feeds:i.state.feeds.concat(o)}),i.setState({lowFeeds:i.state.lowFeeds.concat(o)}),r||i.streamDettacher(o),V.log("Successfully attached to feed "+o.rfid+" ("+o.rfdisplay+") in room "+e.room)),t&&(V.log("Handling SDP as well...",t),o.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){V.log("Got SDP!",e);var t={request:"start",room:i.state.roomId};o.send({message:t,jsep:e})},error:function(e){V.log("WebRTC error:",e),window.alert("WebRTC error... "+e.message)}}))},iceState:function(e){V.log("ICE state of this WebRTC PeerConnection (feed #"+o.rfindex+") changed to "+e)},webrtcState:function(e){V.log("Janus says this WebRTC PeerConnection (feed #"+o.rfindex+") is "+(e?"up":"down")+" now"),"down"===e&&i.removeParticipant(o.rfid)},onlocalstream:function(e){console.log(">>>>>>>>>>>",e)},onremotestream:function(e){i.streamAttacher(o)},ondata:function(e){console.log(e);var t=JSON.parse(e);0===i.state.requests.filter((function(e){return e.uuid===t.uuid})).length&&"up"===t.request&&i.setState({requests:i.state.requests.concat({display:t.display,uuid:t.uuid})}),"present"===t.request&&(console.log(t),i.requestAccepted(t.uuid,"presenter")),"chat"===t.request&&i.state.userUUID!==t.uuid&&i.setState({chats:i.state.chats.concat({display:t.display,uuid:t.uuid,body:t.body,time:t.time})}),"removeRequest"===t.request&&i.setState({requests:i.state.requests.filter((function(e){return e.uuid!=t.uuid}))}),"fileUploaded"===t.request&&(console.log("fileUploaded"),E("uploads",i.state.page,{room_id:i.state.room.id},i.state.token)),"acceptRequest"===t.request&&(i.setState({requests:i.state.requests.filter((function(e){return e.uuid!=t.uuid}))}),i.requestAccepted(t.uuid),t.uuid===i.state.userUUID&&(i.state.publishedCamera||i.publishMicrophone()))},oncleanup:function(){V.log(" ::: Got a cleanup notification (remote feed "+e+") :::")}})}},{key:"feedToRole",value:function(e){var t=this.findFeedById(e);if(t&&t.rfid)var a=this.findParticpantById(t.rfid);if(a)return a.role}},{key:"attachMedia",value:function(e,t,a){V.attachMediaStream(document.getElementById(e+"-"+t),a)}},{key:"requestAccepted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"speaker";this.changeParticipantRole(e,t)}},{key:"changeParticipantRole",value:function(e,t){var a=this,n=Object.assign({},this.state),r=this.findParticpantByUuid(e),i=this.participantIndex(e);n.participants[i]={id:r.id,display:r.display,uuid:r.uuid,role:t},this.setState(n,(function(){var e=a.findFeedByRfid(r.id);e&&a.streamAttacher(e)}))}},{key:"participantIndex",value:function(e){var t=this.state.participants.findIndex((function(t){return t.uuid===e}));if(console.log(t),Number.isInteger(t))return t}},{key:"participantIsSpeaker",value:function(e){var t=this.findParticpantByUuid(e);return!(!t||"speaker"!==t.role)}},{key:"streamAttacher",value:function(e){console.log("Attaching "+e.id),P()("#video-h-"+e.id).show(),P()("#video-"+e.id).show(),P()("#video-p-"+e.id).show();var t="";switch(console.log("The role is "+this.feedToRole(e.id)),this.feedToRole(e.id)){case"speaker":t="video-h-";break;case"presenter":t="video-p-";break;default:t="video-"}e.id&&e.webrtcStuff&&e.webrtcStuff.remoteStream&&V.attachMediaStream(document.getElementById(t+e.id),e.webrtcStuff.remoteStream),e.id&&e.webrtcStuff&&e.webrtcStuff.myStream&&V.attachMediaStream(document.getElementById(t+e.id),e.webrtcStuff.myStream),this.unmute()}},{key:"streamDettacher",value:function(e){e.id&&(console.log("Dettaching "+e.id),P()("#video-h-"+e.id).hide(),P()("#video-p-"+e.id).hide(),P()("#video-"+e.id).hide())}},{key:"sendData",value:function(){var e={textroom:"message",transaction:V.randomString(12),room:this.state.roomId,text:"UUUUU"};this.state.sfutest.data({text:JSON.stringify(e),error:function(e){console.log(e)},success:function(){console.log("sent")}})}},{key:"sendChat",value:function(e){var t=this,a={textroom:"message",transaction:V.randomString(12),room:this.state.roomId,request:"chat",uuid:this.state.userUUID,display:this.state.fullname,body:e,time:Date.now()};this.state.sfutest.data({text:JSON.stringify(a),error:function(e){console.log(e)},success:function(){console.log(a),t.setState({chats:t.state.chats.concat({display:a.display,uuid:a.uuid,body:a.body,time:a.time})})}})}},{key:"speakRequest",value:function(){var e=this,t={textroom:"message",transaction:V.randomString(12),room:this.state.roomId,request:"up",uuid:this.state.userUUID,display:this.state.fullname};this.state.sfutest.data({text:JSON.stringify(t),error:function(e){console.log(e)},success:function(){console.log("request sent"),0===e.state.requests.filter((function(e){return e.uuid===t.uuid})).length&&"up"===t.request&&e.setState({requests:e.state.requests.concat({display:t.display,uuid:t.uuid})})}})}},{key:"presentMessage",value:function(){var e={textroom:"message",transaction:V.randomString(12),room:this.state.roomId,request:"present",uuid:this.state.userUUID,display:this.state.fullname};this.state.sfutest.data({text:JSON.stringify(e),error:function(e){console.log(e)},success:function(){console.log("present request sent")}})}},{key:"publishData",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!1,audioSend:!1},success:function(t){if(V.debug("********* Got publisher SDP!",t),t){e.state.sfutest.send({message:{request:"publish",audio:!0,video:!0,data:!0},jsep:t})}console.log("Data published ...")},error:function(e){V.error("***** WebRTC error:",e)}})}},{key:"unPublishData",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!1,videoSend:!1,audioSend:!1},success:function(t){if(V.debug("********* Got publisher SDP!",t),t){e.state.sfutest.send({message:{request:"unpublish",audio:!1,video:!1,data:!1},jsep:t})}},error:function(e){V.error("***** WebRTC error:",e)}})}},{key:"publishCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=this;(console.log("publishedDesktop? ",t.state.publishedDesktop),t.state.publishedDesktop)?t.setState({notification:{type:"cameraSwitch",from:"screen sharing",to:"camera"}}):(t=this).state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!0,audioSend:t.state.publishedMicrophone},success:function(a){if(V.debug("********* Got publisher SDP!",a),console.log("switching to "+e),a){var n={request:"configure",audio:t.state.publishedMicrophone,video:!0,data:!0,bitrate:8e3*e,bitrate_cap:!0,videocodec:"vp8"};t.state.sfutest.send({message:n,jsep:a})}t.setState({publishedCamera:!0});var r=t.state.sfutest.webrtcStuff.myStream.getTracks();console.log(r),t.state.isOwner&&t.acceptRequest(t.state.userUUID)},error:function(e){V.error("***** WebRTC error:",e)}})}},{key:"cameraPublisher",value:function(){}},{key:"publishDesktop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=this;t.state.publishedCamera?t.setState({notification:{type:"cameraSwitch",to:"screen sharing",from:"camera"}}):t.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!0,video:"screen",screenshareFrameRate:6,audioSend:t.state.publishedMicrophone},success:function(a){if(V.debug("********* Got publisher SDP!",a),console.log("switching to "+e),a){var n={request:"configure",audio:t.state.publishedMicrophone,video:!0,data:!0,bitrate:5e5,publishers:1,videocodec:"vp8"};t.state.sfutest.send({message:n,jsep:a})}t.setState({publishedDesktop:!0}),t.changeParticipantRole(t.state.userUUID,"presenter"),t.presentMessage()},error:function(e){V.error("***** WebRTC error:",e)}})}},{key:"toggleCamera",value:function(){this.state.publishedCamera?this.unPublishCamera():this.participantIsSpeaker(this.state.userUUID)?this.publishCamera(32):this.publishCamera(16)}},{key:"toggleDesktop",value:function(){this.state.publishedDesktop?this.unPublishDesktop():this.publishDesktop()}},{key:"unPublishCamera",value:function(){console.log("unPublishing .."),this.setState({notification:{}});var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!1,audioSend:e.state.publishedMicrophone},success:function(t){if(V.debug("********* Got publisher SDP!",t),t){var a={request:"unpublish",audio:e.state.publishedMicrophone,video:!1,data:!0};e.state.sfutest.send({message:a,jsep:t})}e.setState({publishedCamera:!1}),e.setState({publishedData:!1}),e.streamDettacher(e.state.sfutest),e.state.sfutest.webrtcStuff.myStream.getTracks().forEach((function(e){"video"===e.kind&&e.stop()})),setTimeout(function(){e.publishData()}.bind(this),2e3),e.state.publishedMicrophone&&e.publishMicrophone()},error:function(e){V.error("***** WebRTC error:",e)}})}},{key:"unPublishDesktop",value:function(){var e=Object(N.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("unPublishing Desktop ..."),this.setState({notification:{}}),(t=this).state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!1,audioSend:t.state.publishedMicrophone},success:function(e){if(V.debug("********* Got publisher SDP!",e),e){var a={request:"unpublish",audio:t.state.publishedMicrophone,video:!1,data:!0};t.state.sfutest.send({message:a,jsep:e})}t.setState({publishedDesktop:!1}),t.setState({publishedData:!1}),setTimeout(function(){t.publishData()}.bind(this),2e3),t.state.publishedMicrophone&&t.publishMicrophone()},error:function(e){V.error("***** WebRTC error:",e)}});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleMicrophone",value:function(){console.log("Microphone state",this.state.publishedMicrophone),this.state.publishedMicrophone?this.unPublishMicrophone():this.publishMicrophone()}},{key:"publishMicrophone",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,audioSend:!0,removeAudio:!1,videoSend:e.state.publishedCamera},success:function(t){if(V.debug("********* Got publisher SDP!",t),t){var a={request:"configure",data:!0,audio:!0,video:e.state.publishedCamera};e.state.sfutest.send({message:a,jsep:t})}e.setState({publishedMicrophone:!0})},error:function(e){V.error("***** WebRTC error:",e)}})}},{key:"unPublishMicrophone",value:function(){console.log("Unpublishing audio ...");var e=this,t=!1;(e.state.publishedCamera||e.state.publishedDesktop)&&(t=!0),e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,audioSend:!1,removeAudio:!0,videoSend:t},success:function(a){if(V.debug("********* Got publisher SDP!",a),a){var n={request:"configure",data:!0,audio:!1,video:t};e.state.sfutest.send({message:n,jsep:a})}e.setState({publishedMicrophone:!1}),e.state.sfutest.webrtcStuff.myStream.getTracks().forEach((function(e){e.kind}))},error:function(e){V.error("***** WebRTC error:",e)}})}},{key:"off",value:function(){console.log(this.state.feeds);var e={request:"switch",feed:this.state.feeds[1].rfid,video:!1};this.state.feeds[1].send({message:e})}},{key:"on",value:function(){console.log(this.state.feeds);var e={request:"switch",feed:this.state.feeds[1].rfid,video:!0};this.state.feeds[1].send({message:e})}},{key:"componentDidMount",value:function(){C("rooms",this.props.match.params.id,this.state.token),window.addEventListener("beforeunload",this.unPublishData)}},{key:"submitParticipation",value:function(e){T("participations",{room_id:this.state.id,activity:e},this.state.token)}},{key:"getInstance",value:function(){var e=this,t=g.getIntance(),a=g.getKlass();t&&"Room"===a&&this.setState({room:t,id:t.id,roomId:t.room_id,pin:t.pin,fullname:t.user_fullname,title:t.title,isOwner:t.is_owner},(function(){return e.submitParticipation("joined")})),console.log(t)}},{key:"pageAfterIn",value:function(){this.sessionCreate()}},{key:"setInstance",value:function(){var e=this,t=g.getIntance(),a=g.getKlass();t&&"Participation"===a&&this.setState({userUUID:t.uuid},(function(){return e.pageAfterIn()})),console.log(t)}},{key:"loadData",value:function(){Framework7.instance.toast.show({text:D.receiving,closeTimeout:2e3,position:"top"}),E("shortners",this.state.page,{},this.state.token)}},{key:"localQualityChange",value:function(){}},{key:"getList",value:function(){var e=g.getList(),t=g.getKlass();e&&"Shortner"===t&&this.setState({shortners:e})}},{key:"unmute",value:function(){this.setState({muted:!1})}},{key:"acceptRequest",value:function(e){var t=this,a={textroom:"message",transaction:V.randomString(12),room:this.state.roomId,request:"acceptRequest",uuid:e};this.state.sfutest.data({text:JSON.stringify(a),error:function(e){console.log(e)},success:function(){t.setState({requests:t.state.requests.filter((function(t){return t.uuid!=e}))}),t.requestAccepted(e)}})}},{key:"fileUploaded",value:function(){var e={textroom:"message",transaction:V.randomString(12),room:this.state.roomId,request:"fileUploaded"};this.state.sfutest.data({text:JSON.stringify(e),error:function(e){console.log(e)},success:function(){console.log("Upload message sent")}})}},{key:"removeRequest",value:function(e){var t=this,a={textroom:"message",transaction:V.randomString(12),room:this.state.roomId,request:"removeRequest",uuid:e};this.state.sfutest.data({text:JSON.stringify(a),error:function(e){console.log(e)},success:function(){t.setState({requests:t.state.requests.filter((function(t){return t.uuid!=e}))})}})}},{key:"participantHasRequest",value:function(e){var t=this.state.requests.filter((function(t){return t.uuid==e})),a=this.state.participants.filter((function(t){return t.uuid==e}));return!!(t&&a&&t[0]&&a[0]&&t[0].uuid==a[0].uuid)}},{key:"beforeRemove",value:function(){console.log("removing ..."),this.unPublishCamera()}},{key:"render",value:function(){var e=this.state,t=e.token,a=e.shortners,n=e.urls,i=e.publishedMicrophone,o=e.publishedCamera,s=e.publishedDesktop,c=e.feeds,d=e.muted,l=e.lowFeeds,u=e.requests,f=e.participants,m=e.room,p=e.notification,v=e.chats,h=e.isOwner;e.roomId;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,{token:t}),r.a.createElement("div",{class:"columns "},r.a.createElement(F,{room:this.state.room,participants:f,sendChat:this.sendChat,chats:v,requests:u,isOwner:h,acceptRequest:this.acceptRequest,participantHasRequest:this.participantHasRequest,fileUploaded:this.fileUploaded}),r.a.createElement(W,{beforeRemove:this.beforeRemove,pageAfterIn:this.pageAfterIn,shortners:a,streamAttacher:this.streamAttacher,findParticpantById:this.findParticpantById,participantIsSpeaker:this.participantIsSpeaker,feedToRole:this.feedToRole,urls:n,off:this.off,on:this.on,feeds:c,muted:d,lowFeeds:l,requests:u,room:m,participants:f,unmute:this.unmute,publishedCamera:o,toggleCamera:this.toggleCamera,toggleMicrophone:this.toggleMicrophone,publishedMicrophone:i,publishCamera:this.publishCamera,publishMicrophone:this.publishMicrophone,sendData:this.sendData,speakRequest:this.speakRequest,accept:this.accept,removeRequest:this.removeRequest,acceptRequest:this.acceptRequest,toggleDesktop:this.toggleDesktop,publishedDesktop:s,notification:p})))}}]),a}(r.a.Component),G=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).submit=n.submit.bind(Object(u.a)(n)),n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.setInstance=n.setInstance.bind(Object(u.a)(n)),n.state={email:"",password:""},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){}},{key:"submit",value:function(){var e={email:this.state.email,password:this.state.password};console.log(e),T("users/login",e)}},{key:"setInstance",value:function(){var e=g.getKlass(),t=g.getIntance();t&&"Login"===e&&(window.localStorage.setItem("token",t.token),this.props.history.push("/")),console.log(t)}},{key:"handleChange",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"hero is-primary is-fullheight"},r.a.createElement("div",{className:"hero-body"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"columns is-centered"},r.a.createElement("div",{className:"column is-5-tablet is-4-desktop is-3-widescreen"},r.a.createElement("div",{action:"",className:"box"},r.a.createElement("p",{className:"mb-4"},"Login"),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Email"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"email",placeholder:"e.g. bobsmith@gmail.com",className:"input",required:!0,onInput:function(t){e.handleChange({email:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-envelope"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Password"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"password",placeholder:"*******",className:"input",required:!0,onInput:function(t){e.handleChange({password:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-lock"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"checkbox"},r.a.createElement("input",{type:"checkbox"}),r.a.createElement("span",null," Remember me"))),r.a.createElement("div",{className:"field "},r.a.createElement("div",{className:"control"},r.a.createElement("button",{className:"button is-link is-success",onClick:this.submit},"Login"))),r.a.createElement("div",{className:"control"},r.a.createElement("a",{href:"#/signup",className:" is-link is-light"},"or you can Signup!")))))))))}}]),a}(r.a.Component),z=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).submit=n.submit.bind(Object(u.a)(n)),n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.setInstance=n.setInstance.bind(Object(u.a)(n)),n.reasonBlock=n.reasonBlock.bind(Object(u.a)(n)),n.state={nickname:"",email:"",password:"",reason:null},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){}},{key:"submit",value:function(){var e={email:this.state.email,password:this.state.password,nickname:this.state.nickname};console.log(e),T("users/sign_up",e)}},{key:"setInstance",value:function(){var e=g.getKlass(),t=g.getIntance(),a=g.getReason();t&&"SignUp"===e&&(window.localStorage.setItem("token",t.token),this.props.history.push("/")),a&&this.setState({reason:a}),console.log(a)}},{key:"handleChange",value:function(e){this.setState(e)}},{key:"reasonBlock",value:function(){if(this.state.reason)return r.a.createElement("article",{className:"message is-danger p-0"},r.a.createElement("div",{className:"message-body"},this.state.reason))}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"hero is-primary has-background-grey-light is-fullheight"},r.a.createElement("div",{className:"hero-body"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"columns is-centered"},r.a.createElement("div",{className:"column is-5-tablet is-4-desktop is-3-widescreen"},this.reasonBlock(),r.a.createElement("div",{action:"",className:"box"},r.a.createElement("p",{className:"mb-4"},"Sign Up"),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Nickname"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"email",placeholder:"e.g. Bob Smith",className:"input",required:!0,onInput:function(t){e.handleChange({nickname:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-user"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Email"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"email",placeholder:"e.g. bobsmith@gmail.com",className:"input",required:!0,onInput:function(t){e.handleChange({email:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-envelope"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Password"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"password",placeholder:"*******",className:"input",required:!0,onInput:function(t){e.handleChange({password:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-lock"})))),r.a.createElement("div",{className:"field"},r.a.createElement("button",{className:"button is-success",onClick:this.submit},"Signup")),r.a.createElement("div",{className:"control"},r.a.createElement("a",{href:"#/login",className:" is-link is-light"},"Login if you already signed up!")))))))))}}]),a}(r.a.Component),H=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).submit=n.submit.bind(Object(u.a)(n)),n.setInstance=n.setInstance.bind(Object(u.a)(n)),n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.state={token:window.localStorage.getItem("token"),title:null},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){}},{key:"submit",value:function(){T("rooms",{title:this.state.title},this.state.token)}},{key:"handleChange",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.props.history.push("/rooms")}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,null),r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Name"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"text",placeholder:"Text input",onInput:function(t){e.handleChange({title:t.target.value})}}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Room Type"),r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select"},r.a.createElement("select",null,r.a.createElement("option",null,"Private"),r.a.createElement("option",null,"Public"))))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Description"),r.a.createElement("div",{className:"control"},r.a.createElement("textarea",{className:"textarea",placeholder:"Textarea"}))),r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{type:"checkbox"}),r.a.createElement("span",{className:"ml-2"},"I agree to the ",r.a.createElement("a",{href:"#"},"terms and conditions"))))),r.a.createElement("div",{class:"buttons"},r.a.createElement("button",{class:"button is-link",onClick:this.submit},"Submit"),r.a.createElement("a",{href:"#/rooms",class:"button is-light"},"Cancel")))),"\xce")}}]),a}(r.a.Component);function K(){return r.a.createElement("div",{className:"App"},r.a.createElement(s.a,null,r.a.createElement(c.c,null,r.a.createElement(c.a,{path:"/",exact:!0,component:R}),r.a.createElement(c.a,{path:"/rooms",exact:!0,component:R}),r.a.createElement(c.a,{path:"/rooms/new",exact:!0,component:H}),r.a.createElement(c.a,{path:"/rooms/:id",exact:!0,component:J}),r.a.createElement(c.a,{path:"/login",exact:!0,component:G}),r.a.createElement(c.a,{path:"/signup",exact:!0,component:z}))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},80:function(e,t,a){e.exports=a(138)},85:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){}},[[80,1,2]]]);
//# sourceMappingURL=main.b7a79f90.chunk.js.map