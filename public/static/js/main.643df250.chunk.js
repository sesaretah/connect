(this["webpackJsonpelearn-tools-client"]=this["webpackJsonpelearn-tools-client"]||[]).push([[0],{114:function(e,t){},138:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(62),i=a.n(o),s=(a(85),a(36)),c=a(8),d=(a(86),a(87),a(10)),l=a(11),u=a(4),m=a(13),f=a(12),p=a(63),v=new(a(64).Dispatcher),h=new(function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).list=[],e.instance=null,e.klass=null,e}return Object(l.a)(a,[{key:"listModel",value:function(e){this.list=[],this.klass=e.klass;for(var t=0,a=e.data.length;t<a;++t)this.list.push(e.data[t]),t===a-1&&this.emit("got_list");0==e.data.length&&this.emit("got_list")}},{key:"showIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("got_instance")}},{key:"setIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("set_instance")}},{key:"deleteIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("deleted_instance")}},{key:"postFile",value:function(e){console.log(e),this.klass=e.klass,this.instance=e.data,this.emit("file_posted")}},{key:"getIntance",value:function(){return this.instance}},{key:"getList",value:function(){return this.list}},{key:"getListnKlass",value:function(){return[this.list,this.klass]}},{key:"getKlass",value:function(){return this.klass}},{key:"handleActions",value:function(e){switch(e.type){case"LIST_MODEL_SUCCESS":this.listModel(e.list);break;case"GET_INSTANCE_SUCCESS":this.showIntance(e.instance);break;case"DELETE_INSTANCE_SUCCESS":this.deleteIntance(e.instance);break;case"SET_INSTANCE_SUCCESS":this.setIntance(e.instance);break;case"POST_FILE_SUCCESS":this.postFile(e.instance)}}}]),a}(p.EventEmitter));v.register(h.handleActions.bind(h));var g=h,b=a(20),y=a.n(b),k="http://localhost:3001/v1",S="https://kaarafarinan.ir:8089/janus",w=k;function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,r=Object.keys(a).map((function(e){return e+"="+a[e]})).join("&");y.a.get(w+"/"+e+"?page="+t+"&"+r,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"LIST_MODEL_SUCCESS",list:e.data})})).catch((function(e){console.log(e)}))}function C(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;y.a.get(w+"/"+e+"/"+t+"?page="+n,{headers:{"Content-Type":"application/json",Authorization:"bearer "+a}}).then((function(e){v.dispatch({type:"GET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function T(e,t,a){y.a.post(w+"/"+e+"/",t,{headers:{"Content-Type":"application/json",Authorization:"bearer "+a}}).then((function(e){v.dispatch({type:"SET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}var D={home:"\u062e\u0627\u0646\u0647",choose_a_file:"\u0627\u0646\u062a\u062e\u0627\u0628 \u0641\u0627\u06cc\u0644 PDF",file_preparation_service:"\u0622\u0645\u0627\u062f\u0647 \u0633\u0627\u0632\u06cc \u0641\u0627\u06cc\u0644 \u0628\u0631\u0627\u06cc \u0646\u0631\u0645 \u0627\u0641\u0632\u0627\u0631 \u0627\u062f\u0648\u0628\u06cc \u06a9\u0627\u0646\u06a9\u062a",login:"\u0648\u0631\u0648\u062f",your_uuid_is:"\u06a9\u062f \u0631\u0647\u06af\u06cc\u0631\u06cc \u0634\u0645\u0627",processing_may_take_some_time:"\u062f\u0631 \u062d\u0627\u0644 \u062a\u0628\u062f\u06cc\u0644 \u0641\u0627\u06cc\u0644 \u0645\u0645\u06a9\u0646 \u0627\u0633\u062a \u06a9\u0645\u06cc \u0637\u0648\u0644 \u0628\u06a9\u0634\u062f",download:"\u062f\u0631\u06cc\u0627\u0641\u062a",again:"\u0628\u0627\u0631\u06af\u0632\u0627\u0631\u06cc \u062f\u06cc\u06af\u0631"},I=function(e){var t=Object(c.f)();return r.a.createElement("nav",{id:"navbar",class:"bd-navbar navbar has-shadow is-spaced"},r.a.createElement("div",{class:"container"},r.a.createElement("div",{class:"navbar-brand"},r.a.createElement("a",{class:"navbar-item",href:"https://bulma.io"},r.a.createElement("img",{src:"https://bulma.io/images/bulma-logo.png",alt:"Bulma: Free, open source, and modern CSS framework based on Flexbox",width:"112",height:"28"}))),r.a.createElement("div",{class:"navbar-menu"},r.a.createElement("div",{class:"navbar-start"},r.a.createElement("a",{href:"/rooms",class:"navbar-item"},r.a.createElement("i",{className:"fas fa-home mr-1"}),r.a.createElement("span",null,"Home")),r.a.createElement("a",{href:"/rooms",class:"navbar-item"},r.a.createElement("i",{className:"fas fa-door-open mr-1"}),r.a.createElement("span",null,"Rooms"))))),r.a.createElement("div",{class:"level-right"},!e.token||e.token.length<5?r.a.createElement("p",{class:"level-item"},r.a.createElement("a",{href:"/login",class:"button is-primary"},"Login")):r.a.createElement("p",{class:"level-item"},r.a.createElement("a",{onClick:function(){return console.log("Signing Out ..."),window.localStorage.setItem("token",""),void t.push("/")},class:"button is-light"},"Sign Out"))))},R=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).getList=n.getList.bind(Object(u.a)(n)),n.roomCards=n.roomCards.bind(Object(u.a)(n)),n.state={token:window.localStorage.getItem("token"),rooms:null},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){g.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.state.token&&this.state.token.length>5&&E("rooms",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=g.getList(),t=g.getKlass();e&&"Room"===t&&this.setState({rooms:e}),console.log(e)}},{key:"roomCards",value:function(){var e=[];return this.state.rooms&&this.state.rooms.map((function(t){return e.push(r.a.createElement("div",{class:"column is-3"},r.a.createElement("div",{class:"card has-background-white-ter"},r.a.createElement("header",{class:"card-header"},r.a.createElement("p",{class:"card-header-title"},t.title)),r.a.createElement("div",{class:"card-content"},r.a.createElement("div",{class:"content"},t.description?t.description:"The creator did not provide a desctiption. You can join to find out more about this room.")),r.a.createElement("footer",{class:"card-footer"},r.a.createElement("a",{href:"/rooms/"+t.id,class:"card-footer-item"},"Join")))))})),e}},{key:"render",value:function(){var e=this.state.token;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,{token:e}),r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{class:"columns is-multiline"},r.a.createElement("div",{class:"column is-3"},r.a.createElement("div",{class:"card has-background-info-light"},r.a.createElement("header",{class:"card-header"},r.a.createElement("p",{class:"card-header-title"},"Create New Room")),r.a.createElement("div",{class:"card-content"},r.a.createElement("div",{class:"content"},"You can create rooms. Participants in a room can share their videos, voices and ideas with each other.")),r.a.createElement("footer",{class:"card-footer"},r.a.createElement("a",{href:"/rooms/new",class:"card-footer-item"},"Create")))),this.roomCards()))))}}]),a}(r.a.Component),A=a(39),j=a.n(A),O=a(66),N=a(18),P=a.n(N),M=a(19),x=a(45),V=window.RTCRtpTransceiver;q.sessions={},q.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||q.extension.isInstalled()}return!0};var _={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var a=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",a(n)}else a(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function q(e){if((e=e||{}).success="function"==typeof e.success?e.success:q.noop,e.error="function"==typeof e.error?e.error:q.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:q.noop,!q.initDone)return e.error("Library not initialized"),{};if(!q.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(q.log("Library initialized: "+q.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,a=null,n={},r=null,o=null,i=0,s=e.server;q.isArray(s)?(q.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,o=e.server,q.debug(o)):0===s.indexOf("ws")?(t=!0,q.log("Using WebSockets to contact Janus: "+s)):(t=!1,q.log("Using REST API to contact Janus: "+s));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],d=e.iceTransportPolicy,l=e.bundlePolicy,u=!0===e.ipv6,m=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(m=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var p=null;void 0!==e.token&&null!==e.token&&(p=e.token);var v=null;void 0!==e.apisecret&&null!==e.apisecret&&(v=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var h=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(h=e.keepAlivePeriod),isNaN(h)&&(h=25e3);var g=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(g=e.longPollTimeout),isNaN(g)&&(g=6e4);var y=!1,k=null,S={},w=this,E=0,C={};function T(){if(null!=k)if(q.debug("Long poll..."),y){var t=s+"/"+k+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),p&&(t=t+"&token="+encodeURIComponent(p)),v&&(t=t+"&apisecret="+encodeURIComponent(v)),q.httpAPICall(t,{verb:"GET",withCredentials:m,success:D,timeout:g,error:function(t,a){if(q.error(t+":",a),++E>3)return y=!1,void e.error("Lost connection to the server (is it down?)");T()}})}else q.warn("Is the server down? (connected=false)")}function D(e,n){if(E=0,t||void 0===k||null===k||!0===n||T(),t||!q.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(c=e.sender))return void q.warn("Missing sender...");if(!(l=S[c]))return void q.debug("This handle is not attached to this session");var r=e.candidate;q.debug("Got a trickled candidate on session "+k),q.debug(r);var o=l.webrtcStuff;o.pc&&o.remoteSdp?(q.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(q.endOfCandidates)):(q.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(r),q.debug(o.candidates))}else{if("webrtcup"===e.janus)return q.debug("Got a webrtcup event on session "+k),q.debug(e),(c=e.sender)?(l=S[c])?void l.webrtcState(!0):void q.debug("This handle is not attached to this session"):void q.warn("Missing sender...");if("hangup"===e.janus){if(q.debug("Got a hangup event on session "+k),q.debug(e),!(c=e.sender))return void q.warn("Missing sender...");if(!(l=S[c]))return void q.debug("This handle is not attached to this session");l.webrtcState(!1,e.reason),l.hangup()}else if("detached"===e.janus){if(q.debug("Got a detached event on session "+k),q.debug(e),!(c=e.sender))return void q.warn("Missing sender...");if(!(l=S[c]))return;l.detached=!0,l.ondetached(),l.detach()}else if("media"===e.janus){if(q.debug("Got a media event on session "+k),q.debug(e),!(c=e.sender))return void q.warn("Missing sender...");if(!(l=S[c]))return void q.debug("This handle is not attached to this session");l.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(q.debug("Got a slowlink event on session "+k),q.debug(e),!(c=e.sender))return void q.warn("Missing sender...");if(!(l=S[c]))return void q.debug("This handle is not attached to this session");l.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var i,s;if(q.error("Ooops: "+e.error.code+" "+e.error.reason),q.debug(e),i=e.transaction)(s=C[i])&&s(e),delete C[i];return}if("event"===e.janus){var c;if(q.debug("Got a plugin event on session "+k),q.debug(e),!(c=e.sender))return void q.warn("Missing sender...");var d=e.plugindata;if(!d)return void q.warn("Missing plugindata...");q.debug("  -- Event is coming from "+c+" ("+d.plugin+")");var l,u=d.data;if(q.debug(u),!(l=S[c]))return void q.warn("This handle is not attached to this session");var m=e.jsep;m&&(q.debug("Handling SDP as well..."),q.debug(m));var f=l.onmessage;f?(q.debug("Notifying application..."),f(u,m)):q.debug("No provided notification callback")}else{if("timeout"===e.janus)return q.error("Timeout on session "+k),q.debug(e),void(t&&a.close(3504,"Gateway timeout"));q.warn("Unknown message/event  '"+e.janus+"' on session "+k),q.debug(e)}}}else q.debug("Got a success on session "+k),q.debug(e),(i=e.transaction)&&((s=C[i])&&s(e),delete C[i]);else q.debug("Got an ack on session "+k),q.debug(e),(i=e.transaction)&&((s=C[i])&&s(e),delete C[i]);else q.debug("Got info on the Janus instance"),q.debug(e),(i=e.transaction)&&((s=C[i])&&s(e),delete C[i]);else q.vdebug("Got a keepalive on session "+k);else for(var p=0;p<e.length;p++)D(e[p],!0)}function I(){if(s&&t&&y){r=setTimeout(I,h);var e={janus:"keepalive",session_id:k,transaction:q.randomString(12)};p&&(e.token=p),v&&(e.apisecret=v),a.send(JSON.stringify(e))}}function R(c){var d=q.randomString(12),l={janus:"create",transaction:d};if(c.reconnect&&(y=!1,l.janus="claim",l.session_id=k,a&&(a.onopen=null,a.onerror=null,a.onclose=null,r&&(clearTimeout(r),r=null))),p&&(l.token=p),v&&(l.apisecret=v),!s&&q.isArray(o)&&(0===(s=o[i]).indexOf("ws")?(t=!0,q.log("Server #"+(i+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,q.log("Server #"+(i+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var u in a=q.newWebSocket(s,"janus-protocol"),n={error:function(){if(q.error("Error connecting to the Janus WebSockets server... "+s),q.isArray(o)&&!c.reconnect)return++i===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){R(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){C[d]=function(e){if(q.debug(e),"success"!==e.janus)return q.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);r=setTimeout(I,h),y=!0,k=e.session_id?e.session_id:e.data.id,c.reconnect?q.log("Claimed session: "+k):q.log("Created session: "+k),q.sessions[k]=w,c.success()},a.send(JSON.stringify(l))},message:function(e){D(JSON.parse(e.data))},close:function(){s&&y&&(y=!1,e.error("Lost connection to the server (is it down?)"))}})a.addEventListener(u,n[u]);else q.httpAPICall(s,{verb:"POST",withCredentials:m,body:l,success:function(e){if(q.debug(e),"success"!==e.janus)return q.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);y=!0,k=e.session_id?e.session_id:e.data.id,c.reconnect?q.log("Claimed session: "+k):q.log("Created session: "+k),q.sessions[k]=w,T(),c.success()},error:function(e,t){if(q.error(e+":",t),q.isArray(o)&&!c.reconnect)return++i===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){R(c)}),200));""===t?c.error(e+": Is the server down?"):c.error(e+": "+t)}})}function A(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:q.noop,n.error="function"==typeof n.error?n.error:q.noop,!y)return q.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var r=S[e];if(!r||!r.webrtcStuff)return q.warn("Invalid handle"),void n.error("Invalid handle");var o=n.message,i=n.jsep,c=q.randomString(12),d={janus:"message",body:o,transaction:c};if(r.token&&(d.token=r.token),v&&(d.apisecret=v),i&&(d.jsep={type:i.type,sdp:i.sdp},i.e2ee&&(d.jsep.e2ee=!0),"hml"!==i.rid_order&&"lmh"!==i.rid_order||(d.jsep.rid_order=i.rid_order)),q.debug("Sending message to plugin (handle="+e+"):"),q.debug(d),t)return d.session_id=k,d.handle_id=e,C[c]=function(e){if(q.debug("Message sent!"),q.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return q.warn("Request succeeded, but missing plugindata..."),void n.success();q.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return q.debug(a),void n.success(a)}"ack"===e.janus?n.success():e.error?(q.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(q.error("Unknown error"),n.error("Unknown error"))},void a.send(JSON.stringify(d));q.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:m,body:d,success:function(e){if(q.debug("Message sent!"),q.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return q.warn("Request succeeded, but missing plugindata..."),void n.success();q.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return q.debug(a),void n.success(a)}"ack"===e.janus?n.success():e.error?(q.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(q.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){q.error(e+":",t),n.error(e+": "+t)}})}function j(e,n){if(y){var r=S[e];if(r&&r.webrtcStuff){var o={janus:"trickle",candidate:n,transaction:q.randomString(12)};if(r.token&&(o.token=r.token),v&&(o.apisecret=v),q.vdebug("Sending trickle candidate (handle="+e+"):"),q.vdebug(o),t)return o.session_id=k,o.handle_id=e,void a.send(JSON.stringify(o));q.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:m,body:o,success:function(e){q.vdebug("Candidate sent!"),q.vdebug(e),"ack"===e.janus||q.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){q.error(e+":",t)}})}else q.warn("Invalid handle")}else q.warn("Is the server down? (connected=false)")}function O(e,t,a,n,r){var o=S[e];if(o&&o.webrtcStuff){var i=o.webrtcStuff;if(i.pc){var s=function(e){q.log("Received state change on data channel:",e);var t=e.target.label,a=e.target.protocol,n=i.dataChannel[t]?i.dataChannel[t].readyState:"null";if(q.log("State change on <"+t+"> data channel: "+n),"open"===n){if(i.dataChannel[t].pending&&i.dataChannel[t].pending.length>0){q.log("Sending pending messages on <"+t+">:",i.dataChannel[t].pending.length);var r,s=Object(M.a)(i.dataChannel[t].pending);try{for(s.s();!(r=s.n()).done;){var c=r.value;q.log("Sending data on data channel <"+t+">"),q.debug(c),i.dataChannel[t].send(c)}}catch(d){s.e(d)}finally{s.f()}i.dataChannel[t].pending=[]}o.ondataopen(t,a)}};if(n)i.dataChannel[t]=n;else{var c={ordered:!0};a&&(c.protocol=a),i.dataChannel[t]=i.pc.createDataChannel(t,c)}i.dataChannel[t].onmessage=function(e){q.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},i.dataChannel[t].onopen=s,i.dataChannel[t].onclose=s,i.dataChannel[t].onerror=function(e){q.error("Got error on data channel:",e)},i.dataChannel[t].pending=[],r&&i.dataChannel[t].pending.push(r)}else q.warn("Invalid PeerConnection")}else q.warn("Invalid handle")}function N(e,t){(t=t||{}).success="function"==typeof t.success?t.success:q.noop,t.error="function"==typeof t.error?t.error:q.noop;var a=S[e];if(!a||!a.webrtcStuff)return q.warn("Invalid handle"),void t.error("Invalid handle");var n=a.webrtcStuff,r=t.text||t.data;if(!r)return q.warn("Invalid data"),void t.error("Invalid data");var o=t.label?t.label:q.dataChanDefaultLabel;return n.dataChannel[o]?"open"!==n.dataChannel[o].readyState?(n.dataChannel[o].pending.push(r),void t.success()):(q.log("Sending data on data channel <"+o+">"),q.debug(r),n.dataChannel[o].send(r),void t.success()):(O(e,o,t.protocol,!1,r,t.protocol),void t.success())}function P(e,t){(t=t||{}).success="function"==typeof t.success?t.success:q.noop,t.error="function"==typeof t.error?t.error:q.noop;var a=S[e];if(!a||!a.webrtcStuff)return q.warn("Invalid handle"),void t.error("Invalid handle");var n=a.webrtcStuff;if(!n.dtmfSender){if(n.pc){var r=n.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!r)return q.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=r.dtmf,n.dtmfSender&&(q.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){q.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return q.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(!o)return q.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var i=o.tones;if(!i)return q.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"===typeof o.duration?o.duration:500,c="number"===typeof o.gap?o.gap:50;q.debug("Sending DTMF string "+i+" (duration "+s+"ms, gap "+c+"ms)"),n.dtmfSender.insertDTMF(i,s,c),t.success()}function x(e,n){(n=n||{}).success="function"==typeof n.success?n.success:q.noop,n.error="function"==typeof n.error?n.error:q.noop;var r=!0===n.noRequest;q.log("Destroying handle "+e+" (only-locally="+r+")"),G(e);var o=S[e];if(!o||o.detached)return delete S[e],void n.success();if(r)return delete S[e],void n.success();if(!y)return q.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var i={janus:"detach",transaction:q.randomString(12)};if(o.token&&(i.token=o.token),v&&(i.apisecret=v),t)return i.session_id=k,i.handle_id=e,a.send(JSON.stringify(i)),delete S[e],void n.success();q.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:m,body:i,success:function(t){q.log("Destroyed handle:"),q.debug(t),"success"!==t.janus&&q.error("Ooops: "+t.error.code+" "+t.error.reason),delete S[e],n.success()},error:function(t,a){q.error(t+":",a),delete S[e],n.success()}})}function V(e,t,a,n,r){var o=S[e];if(!o||!o.webrtcStuff)return q.warn("Invalid handle"),n.stream||q.stopAllTracks(r),void n.error("Invalid handle");var i=o.webrtcStuff;q.debug("streamsDone:",r),r&&(q.debug("  -- Audio tracks:",r.getAudioTracks()),q.debug("  -- Video tracks:",r.getVideoTracks()));var s=!1;if(i.myStream&&a.update&&!i.streamExternal){if((!a.update&&z(a)||a.update&&(a.addAudio||a.replaceAudio))&&r.getAudioTracks()&&r.getAudioTracks().length)if(i.myStream.addTrack(r.getAudioTracks()[0]),q.unifiedPlan){q.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]);var m=null;if((v=i.pc.getTransceivers())&&v.length>0){var f,p=Object(M.a)(v);try{for(p.s();!(f=p.n()).done;){if((k=f.value).sender&&k.sender.track&&"audio"===k.sender.track.kind||k.receiver&&k.receiver.track&&"audio"===k.receiver.track.kind){m=k;break}}}catch(D){p.e(D)}finally{p.f()}}m&&m.sender?m.sender.replaceTrack(r.getAudioTracks()[0]):i.pc.addTrack(r.getAudioTracks()[0],r)}else q.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]),i.pc.addTrack(r.getAudioTracks()[0],r);if((!a.update&&H(a)||a.update&&(a.addVideo||a.replaceVideo))&&r.getVideoTracks()&&r.getVideoTracks().length)if(i.myStream.addTrack(r.getVideoTracks()[0]),q.unifiedPlan){q.log((a.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]);var v,h=null;if((v=i.pc.getTransceivers())&&v.length>0){var g,y=Object(M.a)(v);try{for(y.s();!(g=y.n()).done;){var k;if((k=g.value).sender&&k.sender.track&&"video"===k.sender.track.kind||k.receiver&&k.receiver.track&&"video"===k.receiver.track.kind){h=k;break}}}catch(D){y.e(D)}finally{y.f()}}h&&h.sender?h.sender.replaceTrack(r.getVideoTracks()[0]):i.pc.addTrack(r.getVideoTracks()[0],r)}else q.log((a.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]),i.pc.addTrack(r.getVideoTracks()[0],r)}else i.myStream=r,s=!0;if(!i.pc){var w={iceServers:c,iceTransportPolicy:d,bundlePolicy:l};"chrome"===q.webRTCAdapter.browserDetails.browser&&(w.sdpSemantics=q.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var E={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&E.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"===typeof n.rtcConstraints)for(var C in q.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)E.optional.push(n.rtcConstraints[C]);"edge"===q.webRTCAdapter.browserDetails.browser&&(w.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(n.senderTransforms||n.receiverTransforms)&&(i.senderTransforms=n.senderTransforms,i.receiverTransforms=n.receiverTransforms,w.forceEncodedAudioInsertableStreams=!0,w.forceEncodedVideoInsertableStreams=!0,w.encodedInsertableStreams=!0),q.log("Creating PeerConnection"),q.debug(E),i.pc=new RTCPeerConnection(w,E),q.debug(i.pc),i.pc.getStats&&(i.volume={},i.bitrate.value="0 kbits/sec"),q.log("Preparing local SDP and gathering candidates (trickle="+i.trickle+")"),i.pc.oniceconnectionstatechange=function(e){i.pc&&o.iceState(i.pc.iceConnectionState)},i.pc.onicecandidate=function(t){if(!t.candidate||"edge"===q.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)q.log("End of candidates."),i.iceDone=!0,!0===i.trickle?j(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:q.noop,t.error="function"==typeof t.error?t.error:q.noop;var a=S[e];if(!a||!a.webrtcStuff)return void q.warn("Invalid handle, not sending anything");var n=a.webrtcStuff;if(q.log("Sending offer/answer SDP..."),!n.mySdp)return void q.warn("Local SDP instance is invalid, not sending anything...");n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1);q.debug(t),n.sdpSent=!0,t.success(n.mySdp)}(e,n);else{var a={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===i.trickle&&j(e,a)}},i.pc.ontrack=function(e){if(q.log("Handling Remote Track"),q.debug(e),e.streams&&(i.remoteStream=e.streams[0],o.onremotestream(i.remoteStream),!e.track.onended)){if(i.receiverTransforms){var t=null;RTCRtpSender.prototype.createEncodedStreams?t=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&i.receiverTransforms.audio?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&i.receiverTransforms.video&&(t=e.receiver.createEncodedVideoStreams())),t&&(console.log(t),t.readableStream&&t.writableStream?t.readableStream.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(t.writableStream):t.readable&&t.writable&&t.readable.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(t.writable))}var a=null;q.log("Adding onended callback to track:",e.track),e.track.onended=function(e){q.log("Remote track removed:",e),i.remoteStream&&(clearTimeout(a),i.remoteStream.removeTrack(e.target),o.onremotestream(i.remoteStream))},e.track.onmute=function(e){q.log("Remote track muted:",e),i.remoteStream&&null==a&&(a=setTimeout((function(){q.log("Removing remote track"),i.remoteStream&&(i.remoteStream.removeTrack(e.target),o.onremotestream(i.remoteStream)),a=null}),2520))},e.track.onunmute=function(e){if(q.log("Remote track flowing again:",e),null!=a)clearTimeout(a),a=null;else try{i.remoteStream.addTrack(e.target),o.onremotestream(i.remoteStream)}catch(t){q.error(t)}}}}}if(s&&r){q.log("Adding local stream");var T=!0===n.simulcast2;r.getTracks().forEach((function(e){q.log("Adding local track:",e);var t=null;if(T&&"audio"!==e.kind){q.log("Enabling rid-based simulcasting:",e);var a=b(n.simulcastMaxBitrates),o=i.pc.addTransceiver(e,{direction:"sendrecv",streams:[r],sendEncodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:a.high},{rid:"m",active:!0,maxBitrate:a.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:a.low,scaleResolutionDownBy:4}]});o&&(t=o.sender)}else t=i.pc.addTrack(e,r);if(t&&i.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&i.senderTransforms.audio?s=t.createEncodedAudioStreams():"video"===t.track.kind&&i.senderTransforms.video&&(s=t.createEncodedVideoStreams())),s&&(console.log(s),s.readableStream&&s.writableStream?s.readableStream.pipeThrough(i.senderTransforms[t.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(i.senderTransforms[t.track.kind]).pipeTo(s.writable))}}))}(function(e){if(q.debug("isDataEnabled:",e),"edge"===q.webRTCAdapter.browserDetails.browser)return q.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(a)&&!i.dataChannel[q.dataChanDefaultLabel]&&(q.log("Creating default data channel"),O(e,q.dataChanDefaultLabel,null,!1),i.pc.ondatachannel=function(t){q.log("Data channel created by Janus:",t),O(e,t.channel.label,t.channel.protocol,t.channel)}),i.myStream&&o.onlocalstream(i.myStream),t?i.pc.setRemoteDescription(t).then((function(){if(q.log("Remote description accepted!"),i.remoteSdp=t.sdp,i.candidates&&i.candidates.length>0){for(var r=0;r<i.candidates.length;r++){var o=i.candidates[r];q.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(q.endOfCandidates)}i.candidates=[]}!function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:q.noop,a.error="function"==typeof a.error?a.error:q.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:q.noop;var n=S[e];if(!n||!n.webrtcStuff)return q.warn("Invalid handle"),void a.error("Invalid handle");var r=n.webrtcStuff,o=!0===a.simulcast;o?q.log("Creating answer (iceDone="+r.iceDone+", simulcast="+o+")"):q.log("Creating answer (iceDone="+r.iceDone+")");var i=null;if(q.unifiedPlan){i={};var s=null,c=null,d=r.pc.getTransceivers();if(d&&d.length>0){var l,u=Object(M.a)(d);try{for(u.s();!(l=u.n()).done;){var m=l.value;m.sender&&m.sender.track&&"audio"===m.sender.track.kind||m.receiver&&m.receiver.track&&"audio"===m.receiver.track.kind?s||(s=m):(m.sender&&m.sender.track&&"video"===m.sender.track.kind||m.receiver&&m.receiver.track&&"video"===m.receiver.track.kind)&&(c||(c=m))}}catch(D){u.e(D)}finally{u.f()}}var f=z(t),p=K(t);if(f||p){if(f&&p){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",q.log("Setting audio transceiver to sendrecv:",s)}catch(E){q.error(E)}}else if(f&&!p)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",q.log("Setting audio transceiver to sendonly:",s))}catch(E){q.error(E)}else if(!f&&p)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",q.log("Setting audio transceiver to recvonly:",s)}catch(E){q.error(E)}else s=r.pc.addTransceiver("audio",{direction:"recvonly"}),q.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",q.log("Setting audio transceiver to inactive:",s)}catch(E){q.error(E)}var v=H(t),h=Y(t);if(v||h){if(v&&h){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",q.log("Setting video transceiver to sendrecv:",c)}catch(E){q.error(E)}}else if(v&&!h){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",q.log("Setting video transceiver to sendonly:",c)}catch(E){q.error(E)}}else if(!v&&h)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",q.log("Setting video transceiver to recvonly:",c)}catch(E){q.error(E)}else c=r.pc.addTransceiver("video",{direction:"recvonly"}),q.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",q.log("Setting video transceiver to inactive:",c)}catch(E){q.error(E)}}else i="firefox"===q.webRTCAdapter.browserDetails.browser||"edge"===q.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:K(t),offerToReceiveVideo:Y(t)}:{mandatory:{OfferToReceiveAudio:K(t),OfferToReceiveVideo:Y(t)}};q.debug(i);var g=H(t);if(g&&o&&"firefox"===q.webRTCAdapter.browserDetails.browser){q.log("Enabling Simulcasting for Firefox (RID)");var y=r.pc.getSenders()[1];q.log(y);var k=y.getParameters();q.log(k);var w=b(a.simulcastMaxBitrates);y.setParameters({encodings:a.sendEncodings||[{rid:"h",active:!0,maxBitrate:w.high},{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:w.low,scaleResolutionDownBy:4}]})}r.pc.createAnswer(i).then((function(e){q.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,q.log("Setting local description"),g&&o&&("chrome"===q.webRTCAdapter.browserDetails.browser?q.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==q.webRTCAdapter.browserDetails.browser&&q.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(a.error),r.mediaConstraints=i,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),a.success(e)):q.log("Waiting for all candidates...")}),a.error)}(e,a,n)}),n.error):function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:q.noop,a.error="function"==typeof a.error?a.error:q.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:q.noop;var n=S[e];if(!n||!n.webrtcStuff)return q.warn("Invalid handle"),void a.error("Invalid handle");var r=n.webrtcStuff,o=!0===a.simulcast;o?q.log("Creating offer (iceDone="+r.iceDone+", simulcast="+o+")"):q.log("Creating offer (iceDone="+r.iceDone+")");var i={};if(q.unifiedPlan){var s=null,c=null,d=r.pc.getTransceivers();if(d&&d.length>0){var l,u=Object(M.a)(d);try{for(u.s();!(l=u.n()).done;){var m=l.value;m.sender&&m.sender.track&&"audio"===m.sender.track.kind||m.receiver&&m.receiver.track&&"audio"===m.receiver.track.kind?s||(s=m):(m.sender&&m.sender.track&&"video"===m.sender.track.kind||m.receiver&&m.receiver.track&&"video"===m.receiver.track.kind)&&(c||(c=m))}}catch(D){u.e(D)}finally{u.f()}}var f=z(t),p=K(t);f||p?f&&p?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",q.log("Setting audio transceiver to sendrecv:",s)):f&&!p?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",q.log("Setting audio transceiver to sendonly:",s)):!f&&p&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",q.log("Setting audio transceiver to recvonly:",s)):(s=r.pc.addTransceiver("audio",{direction:"recvonly"}),q.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",q.log("Setting audio transceiver to inactive:",s));var v=H(t),h=Y(t);v||h?v&&h?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",q.log("Setting video transceiver to sendrecv:",c)):v&&!h?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",q.log("Setting video transceiver to sendonly:",c)):!v&&h&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",q.log("Setting video transceiver to recvonly:",c)):(c=r.pc.addTransceiver("video",{direction:"recvonly"}),q.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",q.log("Setting video transceiver to inactive:",c))}else i.offerToReceiveAudio=K(t),i.offerToReceiveVideo=Y(t);!0===a.iceRestart&&(i.iceRestart=!0);q.debug(i);var g=H(t);if(g&&o&&"firefox"===q.webRTCAdapter.browserDetails.browser){q.log("Enabling Simulcasting for Firefox (RID)");var y=r.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(y){var k=y.getParameters();k||(k={});var w=b(a.simulcastMaxBitrates);k.encodings=a.sendEncodings||[{rid:"h",active:!0,maxBitrate:w.high},{rid:"m",active:!0,maxBitrate:w.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:w.low,scaleResolutionDownBy:4}],y.setParameters(k)}}r.pc.createOffer(i).then((function(e){q.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,q.log("Setting local description"),g&&o&&("chrome"===q.webRTCAdapter.browserDetails.browser||"safari"===q.webRTCAdapter.browserDetails.browser?(q.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),a=!1,n=[-1],r=[-1],o=null,i=null,s=null,c=null,d=-1,l=0;l<t.length;l++){if(m=t[l].match(/m=(\w+) */)){if("video"===m[1]){if(!(n[0]<0)){d=l;break}a=!0}else if(n[0]>-1){d=l;break}}else if(a){var u=t[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)n[0]=u[1],r[0]=u[2],t.splice(l,1),l--;else{if(n[0]){if((p=t[l].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(o=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(i=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=p[1]),0===t[l].indexOf("a=ssrc:"+r[0])){t.splice(l,1),l--;continue}if(0===t[l].indexOf("a=ssrc:"+n[0])){t.splice(l,1),l--;continue}}0!=t[l].length||(t.splice(l,1),l--)}}}if(n[0]<0){d=-1,a=!1;for(l=0;l<t.length;l++){var m;if(m=t[l].match(/m=(\w+) */)){if("video"===m[1]){if(!(n[0]<0)){d=l;break}a=!0}else if(n[0]>-1){d=l;break}}else if(a){if(n[0]<0){var f=t[l].match(/a=ssrc:(\d+)/);if(f){n[0]=f[1],t.splice(l,1),l--;continue}}else{var p;if((p=t[l].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(o=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(i=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[l].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=p[1]),0===t[l].indexOf("a=ssrc:"+r[0])){t.splice(l,1),l--;continue}if(0===t[l].indexOf("a=ssrc:"+n[0])){t.splice(l,1),l--;continue}}0!==t[l].length||(t.splice(l,1),l--)}}}if(n[0]<0)return q.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=t.length);n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random());for(l=0;l<n.length;l++)o&&(t.splice(d,0,"a=ssrc:"+n[l]+" cname:"+o),d++),i&&(t.splice(d,0,"a=ssrc:"+n[l]+" msid:"+i),d++),s&&(t.splice(d,0,"a=ssrc:"+n[l]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+n[l]+" label:"+c),d++),o&&(t.splice(d,0,"a=ssrc:"+r[l]+" cname:"+o),d++),i&&(t.splice(d,0,"a=ssrc:"+r[l]+" msid:"+i),d++),s&&(t.splice(d,0,"a=ssrc:"+r[l]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+r[l]+" label:"+c),d++);t.splice(d,0,"a=ssrc-group:FID "+n[2]+" "+r[2]),t.splice(d,0,"a=ssrc-group:FID "+n[1]+" "+r[1]),t.splice(d,0,"a=ssrc-group:FID "+n[0]+" "+r[0]),t.splice(d,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==q.webRTCAdapter.browserDetails.browser&&q.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(a.error),r.mediaConstraints=i,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),a.success(e)):q.log("Waiting for all candidates...")}),a.error)}(e,a,n)}function _(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:q.noop,a.error="function"==typeof a.error?a.error:J;var n=a.jsep;if(t&&n)return q.error("Provided a JSEP to a createOffer"),void a.error("Provided a JSEP to a createOffer");if(!t&&(!n||!n.type||!n.sdp))return q.error("A valid JSEP is required for createAnswer"),void a.error("A valid JSEP is required for createAnswer");a.media="object"===typeof a.media&&a.media?a.media:{audio:!0,video:!0};var r=a.media,o=S[e];if(!o||!o.webrtcStuff)return q.warn("Invalid handle"),void a.error("Invalid handle");var i,s=o.webrtcStuff;if(s.trickle=(i=a.trickle,q.debug("isTrickleEnabled:",i),!1!==i),s.pc){if(q.log("Updating existing media session"),r.update=!0,a.stream)a.stream!==s.myStream&&q.log("Renegotiation involves a new external stream");else{if(r.addAudio){if(r.keepAudio=!1,r.replaceAudio=!1,r.removeAudio=!1,r.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return q.error("Can't add audio stream, there already is one"),void a.error("Can't add audio stream, there already is one")}else r.removeAudio?(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!1,r.audioSend=!1):r.replaceAudio&&(r.keepAudio=!1,r.addAudio=!1,r.removeAudio=!1,r.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!z(r)||r.removeAudio||r.replaceAudio||(r.keepAudio=!0):(r.replaceAudio&&(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!0,r.audioSend=!0),z(r)&&(r.keepAudio=!1,r.addAudio=!0)),r.addVideo){if(r.keepVideo=!1,r.replaceVideo=!1,r.removeVideo=!1,r.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return q.error("Can't add video stream, there already is one"),void a.error("Can't add video stream, there already is one")}else r.removeVideo?(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!1,r.videoSend=!1):r.replaceVideo&&(r.keepVideo=!1,r.addVideo=!1,r.removeVideo=!1,r.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!H(r)||r.removeVideo||r.replaceVideo||(r.keepVideo=!0):(r.replaceVideo&&(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!0,r.videoSend=!0),H(r)&&(r.keepVideo=!1,r.addVideo=!0)),r.addData&&(r.data=!0)}if(z(r)&&r.keepAudio&&H(r)&&r.keepVideo)return o.consentDialog(!1),void V(e,n,r,a,s.myStream)}else r.update=!1,r.keepAudio=!1,r.keepVideo=!1;if(r.update&&!s.streamExternal){if(r.removeAudio||r.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var c=s.myStream.getAudioTracks()[0];q.log("Removing audio track:",c),s.myStream.removeTrack(c);try{c.stop()}catch(N){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var d=!0;if(r.replaceAudio&&q.unifiedPlan&&(d=!1),d){var l,u=Object(M.a)(s.pc.getSenders());try{for(u.s();!(l=u.n()).done;){var m=l.value;m&&m.track&&"audio"===m.track.kind&&(q.log("Removing audio sender:",m),s.pc.removeTrack(m))}}catch(P){u.e(P)}finally{u.f()}}}}if(r.removeVideo||r.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var f=s.myStream.getVideoTracks()[0];q.log("Removing video track:",f),s.myStream.removeTrack(f);try{f.stop()}catch(N){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var p=!0;if(r.replaceVideo&&q.unifiedPlan&&(p=!1),p){var v,h=Object(M.a)(s.pc.getSenders());try{for(h.s();!(v=h.n()).done;){var g=v.value;g&&g.track&&"video"===g.track.kind&&(q.log("Removing video sender:",g),s.pc.removeTrack(g))}}catch(P){h.e(P)}finally{h.f()}}}}}if(a.stream){var b=a.stream;return q.log("MediaStream provided by the application"),q.debug(b),r.update&&s.myStream&&s.myStream!==a.stream&&!s.streamExternal&&(q.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,o.consentDialog(!1),void V(e,n,r,a,b)}if(z(r)||H(r)){if(!q.isGetUserMediaAvailable())return void a.error("getUserMedia not available");var y={mandatory:{},optional:[]};o.consentDialog(!0);var k=z(r);k&&r&&"object"===typeof r.audio&&(k=r.audio);var w=H(r);if(w&&r){var E=!0===a.simulcast,C=!0===a.simulcast2;if(!E&&!C||n||r.video||(r.video="hires"),r.video&&"screen"!=r.video&&"window"!=r.video)if("object"===typeof r.video)w=r.video;else{var T=0,D=0;"lowres"===r.video?(D=240,240,T=320):"lowres-16:9"===r.video?(D=180,180,T=320):"hires"===r.video||"hires-16:9"===r.video||"hdres"===r.video?(D=720,720,T=1280):"fhdres"===r.video?(D=1080,1080,T=1920):"4kres"===r.video?(D=2160,2160,T=3840):"stdres"===r.video?(D=480,480,T=640):"stdres-16:9"===r.video?(D=360,360,T=640):(q.log("Default video setting is stdres 4:3"),D=480,480,T=640),q.log("Adding media constraint:",r.video),w={height:{ideal:D},width:{ideal:T}},q.log("Adding video constraint:",w)}else if("screen"===r.video||"window"===r.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return y.video={},r.screenshareFrameRate&&(y.video.frameRate=r.screenshareFrameRate),r.screenshareHeight&&(y.video.height=r.screenshareHeight),r.screenshareWidth&&(y.video.width=r.screenshareWidth),y.audio=r.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(y).then((function(t){o.consentDialog(!1),z(r)&&!r.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(o){t.addTrack(o.getAudioTracks()[0]),V(e,n,r,a,t)})):V(e,n,r,a,t)}),(function(e){o.consentDialog(!1),a.error(e)}));function I(t,i){o.consentDialog(!1),t?a.error(t):V(e,n,r,a,i)}function R(e,t,a){q.log("Adding media constraint (screen capture)"),q.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){a?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(a){e.addTrack(a.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){o.consentDialog(!1),t(e)}))}if("chrome"===q.webRTCAdapter.browserDetails.browser){var A=q.webRTCAdapter.browserDetails.version,j=33;window.navigator.userAgent.match("Linux")&&(j=35),A>=26&&A<=j?R(y={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate,chromeMediaSource:"screen"}},audio:z(r)&&!r.keepAudio},I):q.extension.getScreen((function(e,t){if(e)return o.consentDialog(!1),a.error(e);(y={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,R(y,I,z(r)&&!r.keepAudio)}))}else if("firefox"===q.webRTCAdapter.browserDetails.browser){if(!(q.webRTCAdapter.browserDetails.version>=33)){var O=new Error("NavigatorUserMediaError");return O.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void a.error(O)}R(y={video:{mozMediaSource:r.video,mediaSource:r.video},audio:z(r)&&!r.keepAudio},(function(e,t){if(I(e,t),!e)var a=t.currentTime,n=window.setInterval((function(){t||window.clearInterval(n),t.currentTime==a&&(window.clearInterval(n),t.onended&&t.onended()),a=t.currentTime}),500)}))}return}}r&&"screen"===r.video||navigator.mediaDevices.enumerateDevices().then((function(t){var i=t.some((function(e){return"audioinput"===e.kind})),s=function(e){if(q.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(r)||t.some((function(e){return"videoinput"===e.kind})),c=z(r),d=H(r),l=function(e){return q.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(r),u=function(e){return q.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(r);if(c||d||l||u){var m=!!c&&i,f=!!d&&s;if(!m&&!f)return o.consentDialog(!1),a.error("No capture device found"),!1;if(!m&&l)return o.consentDialog(!1),a.error("Audio capture is required, but no capture device found"),!1;if(!f&&u)return o.consentDialog(!1),a.error("Video capture is required, but no capture device found"),!1}var p={audio:!(!i||r.keepAudio)&&k,video:!(!s||r.keepVideo)&&w};q.debug("getUserMedia constraints",p),p.audio||p.video?navigator.mediaDevices.getUserMedia(p).then((function(t){o.consentDialog(!1),V(e,n,r,a,t)})).catch((function(e){o.consentDialog(!1),a.error({code:e.code,name:e.name,message:e.message})})):(o.consentDialog(!1),V(e,n,r,a,b))})).catch((function(e){o.consentDialog(!1),a.error(e)}))}else V(e,n,r,a)}function U(e,t){(t=t||{}).success="function"==typeof t.success?t.success:q.noop,t.error="function"==typeof t.error?t.error:J;var a=t.jsep,n=S[e];if(!n||!n.webrtcStuff)return q.warn("Invalid handle"),void t.error("Invalid handle");var r=n.webrtcStuff;if(a){if(!r.pc)return q.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");r.pc.setRemoteDescription(a).then((function(){if(q.log("Remote description accepted!"),r.remoteSdp=a.sdp,r.candidates&&r.candidates.length>0){for(var e=0;e<r.candidates.length;e++){var n=r.candidates[e];q.debug("Adding remote candidate:",n),n&&!0!==n.completed?r.pc.addIceCandidate(n):r.pc.addIceCandidate(q.endOfCandidates)}r.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function L(e,t){var a=S[e];if(!a||!a.webrtcStuff)return q.warn("Invalid handle"),0;var n=t?"remote":"local",r=a.webrtcStuff;return r.volume[n]||(r.volume[n]={value:0}),!r.pc.getStats||"chrome"!==q.webRTCAdapter.browserDetails.browser&&"safari"!==q.webRTCAdapter.browserDetails.browser?(q.warn("Getting the "+n+" volume unsupported by browser"),0):t&&!r.remoteStream?(q.warn("Remote stream unavailable"),0):t||r.myStream?r.volume[n].timer?r.volume[n].value:(q.log("Starting "+n+" volume monitor"),r.volume[n].timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(r.volume[n].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(q.warn("Local stream unavailable"),0)}function B(e,t){var a=S[e];if(!a||!a.webrtcStuff)return q.warn("Invalid handle"),!0;var n=a.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(q.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(q.warn("No audio track"),!0):(q.warn("Invalid local MediaStream"),!0):(q.warn("Invalid PeerConnection"),!0)}function F(e,t,a){var n=S[e];if(!n||!n.webrtcStuff)return q.warn("Invalid handle"),!1;var r=n.webrtcStuff;return r.pc?r.myStream?t?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?(r.myStream.getVideoTracks()[0].enabled=!a,!0):(q.warn("No video track"),!1):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?(r.myStream.getAudioTracks()[0].enabled=!a,!0):(q.warn("No audio track"),!1):(q.warn("Invalid local MediaStream"),!1):(q.warn("Invalid PeerConnection"),!1)}function W(e){var t=S[e];if(!t||!t.webrtcStuff)return q.warn("Invalid handle"),"Invalid handle";var a=t.webrtcStuff;return a.pc?a.pc.getStats?a.bitrate.timer?a.bitrate.value:(q.log("Starting bitrate timer (via getStats)"),a.bitrate.timer=setInterval((function(){a.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(a.bitrate.bsnow=e.bytesReceived,a.bitrate.tsnow=e.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var n=a.bitrate.tsnow-a.bitrate.tsbefore;"safari"===q.webRTCAdapter.browserDetails.browser&&(n/=1e3);var r=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/n);"safari"===q.webRTCAdapter.browserDetails.browser&&(r=parseInt(r/1e3)),a.bitrate.value=r+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(q.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function J(e){q.error("WebRTC error:",e)}function G(e,n){q.log("Cleaning WebRTC stuff");var r=S[e];if(r){var o=r.webrtcStuff;if(o){if(!0===n){var i={janus:"hangup",transaction:q.randomString(12)};r.token&&(i.token=r.token),v&&(i.apisecret=v),q.debug("Sending hangup request (handle="+e+"):"),q.debug(i),t?(i.session_id=k,i.handle_id=e,a.send(JSON.stringify(i))):q.httpAPICall(s+"/"+k+"/"+e,{verb:"POST",withCredentials:m,body:i})}o.remoteStream=null,o.volume&&(o.volume.local&&o.volume.local.timer&&clearInterval(o.volume.local.timer),o.volume.remote&&o.volume.remote.timer&&clearInterval(o.volume.remote.timer)),o.volume={},o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null,!o.streamExternal&&o.myStream&&(q.log("Stopping local stream tracks"),q.stopAllTracks(o.myStream)),o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(c){}o.pc=null,o.candidates=null,o.mySdp=null,o.remoteSdp=null,o.iceDone=!1,o.dataChannel={},o.dtmfSender=null,o.senderTransforms=null,o.receiverTransforms=null}r.oncleanup()}}function z(e){return q.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function K(e){return q.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function H(e){return q.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function Y(e){return q.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}R(e),this.getServer=function(){return s},this.isConnected=function(){return y},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:q.noop,e.error="function"==typeof e.error?e.error:q.noop,e.reconnect=!0,R(e)},this.getSessionId=function(){return k},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:q.noop,e.error="function"==typeof e.error?e.error:q.noop,q.log("Getting info on Janus instance"),!y)return q.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=q.randomString(12),r={janus:"info",transaction:n};p&&(r.token=p);v&&(r.apisecret=v);if(t)return C[n]=function(t){q.log("Server info:"),q.debug(t),"server_info"!==t.janus&&q.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},void a.send(JSON.stringify(r));q.httpAPICall(s,{verb:"POST",withCredentials:m,body:r,success:function(t){q.log("Server info:"),q.debug(t),"server_info"!==t.janus&&q.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,a){q.error(t+":",a),""===a?e.error(t+": Is the server down?"):e.error(t+": "+a)}})}(e)},this.destroy=function(o){!function(o){(o=o||{}).success="function"==typeof o.success?o.success:q.noop,o.error="function"==typeof o.error?o.error:q.noop;var i=!0===o.unload,c=!0;void 0!==o.notifyDestroyed&&null!==o.notifyDestroyed&&(c=!0===o.notifyDestroyed);var d=!0===o.cleanupHandles;if(q.log("Destroying session "+k+" (unload="+i+")"),!k)return q.warn("No session to destroy"),o.success(),void(c&&e.destroyed());if(d)for(var l in S)x(l,{noRequest:!0});if(!y)return q.warn("Is the server down? (connected=false)"),k=null,void o.success();var u={janus:"destroy",transaction:q.randomString(12)};p&&(u.token=p);v&&(u.apisecret=v);if(i)return t?(a.onclose=null,a.close(),a=null):navigator.sendBeacon(s+"/"+k,JSON.stringify(u)),q.log("Destroyed session:"),k=null,y=!1,o.success(),void(c&&e.destroyed());if(t){u.session_id=k;var f=function(){for(var e in n)a.removeEventListener(e,n[e]);a.removeEventListener("message",h),a.removeEventListener("error",g),r&&clearTimeout(r),a.close()},h=function(t){var a=JSON.parse(t.data);a.session_id==u.session_id&&a.transaction==u.transaction&&(f(),o.success(),c&&e.destroyed())},g=function(t){f(),o.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return a.addEventListener("message",h),a.addEventListener("error",g),void(1===a.readyState?a.send(JSON.stringify(u)):g())}q.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:m,body:u,success:function(t){q.log("Destroyed session:"),q.debug(t),k=null,y=!1,"success"!==t.janus&&q.error("Ooops: "+t.error.code+" "+t.error.reason),o.success(),c&&e.destroyed()},error:function(t,a){q.error(t+":",a),k=null,y=!1,o.success(),c&&e.destroyed()}})}(o)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:q.noop,e.error="function"==typeof e.error?e.error:q.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:q.noop,e.iceState="function"==typeof e.iceState?e.iceState:q.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:q.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:q.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:q.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:q.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:q.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:q.noop,e.ondata="function"==typeof e.ondata?e.ondata:q.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:q.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:q.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:q.noop,!y)return q.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return q.error("Invalid plugin"),void e.error("Invalid plugin");var r=e.opaqueId,o=e.token?e.token:p,i=q.randomString(12),c={janus:"attach",plugin:n,opaque_id:r,transaction:i};o&&(c.token=o);v&&(c.apisecret=v);if(t)return C[i]=function(t){if(q.debug(t),"success"!==t.janus)return q.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;q.log("Created handle: "+a);var r={session:w,plugin:n,id:a,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return n},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return B(a,!1)},muteAudio:function(){return F(a,!1,!0)},unmuteAudio:function(){return F(a,!1,!1)},isVideoMuted:function(){return B(a,!0)},muteVideo:function(){return F(a,!0,!0)},unmuteVideo:function(){return F(a,!0,!1)},getBitrate:function(){return W(a)},send:function(e){A(a,e)},data:function(e){N(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){_(a,!0,e)},createAnswer:function(e){_(a,!1,e)},handleRemoteJsep:function(e){U(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(a,!0===e)},detach:function(e){x(a,e)}};S[a]=r,e.success(r)},c.session_id=k,void a.send(JSON.stringify(c));q.httpAPICall(s+"/"+k,{verb:"POST",withCredentials:m,body:c,success:function(t){if(q.debug(t),"success"!==t.janus)return q.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;q.log("Created handle: "+a);var r={session:w,plugin:n,id:a,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return n},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return B(a,!1)},muteAudio:function(){return F(a,!1,!0)},unmuteAudio:function(){return F(a,!1,!1)},isVideoMuted:function(){return B(a,!0)},muteVideo:function(){return F(a,!0,!0)},unmuteVideo:function(){return F(a,!0,!1)},getBitrate:function(){return W(a)},send:function(e){A(a,e)},data:function(e){N(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){_(a,!0,e)},createAnswer:function(e){_(a,!1,e)},handleRemoteJsep:function(e){U(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(a,!0===e)},detach:function(e){x(a,e)}};S[a]=r,e.success(r)},error:function(t,a){q.error(t+":",a),""===a?e.error(t+": Is the server down?"):e.error(t+": "+a)}})}(e)}}q.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,a=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||_,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||x.a,httpAPICall:function(e,n){var r={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(r.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(r.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(r.body=JSON.stringify(n.body));var o=t(e,r).catch((function(e){return a.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var i=new a((function(e,t){var a=setTimeout((function(){return clearTimeout(a),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));o=a.race([o,i])}return o.then((function(e){return e.ok?typeof n.success===typeof q.noop?e.json().then((function(e){n.success(e)})).catch((function(t){return a.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:a.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error===typeof q.noop&&n.error(e.message||"<< internal error >>",e)})),o}}},q.useOldDependencies=function(e){var t=e&&e.jQuery||P.a,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new a(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||_,webRTCAdapter:e&&e.adapter||x.a,httpAPICall:function(e,a){var n=void 0!==a.body?{contentType:"application/json",data:JSON.stringify(a.body)}:{},r=void 0!==a.withCredentials?{xhrFields:{withCredentials:a.withCredentials}}:{};return t.ajax(t.extend(n,r,{url:e,type:a.verb,cache:!1,dataType:"json",async:a.async,timeout:a.timeout,success:function(e){typeof a.success===typeof q.noop&&a.success(e)},error:function(e,t,n){typeof a.error===typeof q.noop&&a.error(t,n)}}))}}},q.noop=function(){},q.dataChanDefaultLabel="JanusDataChannel",q.endOfCandidates=null,q.stopAllTracks=function(e){try{var t,a=e.getTracks(),n=Object(M.a)(a);try{for(n.s();!(t=n.n()).done;){var r=t.value;q.log(r),r&&r.stop()}}catch(o){n.e(o)}finally{n.f()}}catch(i){}},q.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:q.noop,q.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),q.trace=q.noop,q.debug=q.noop,q.vdebug=q.noop,q.log=q.noop,q.warn=q.noop,q.error=q.noop,!0===e.debug||"all"===e.debug)q.trace=console.trace.bind(console),q.debug=console.debug.bind(console),q.vdebug=console.debug.bind(console),q.log=console.log.bind(console),q.warn=console.warn.bind(console),q.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t,a=Object(M.a)(e.debug);try{for(a.s();!(t=a.n()).done;){var n=t.value;switch(n){case"trace":q.trace=console.trace.bind(console);break;case"debug":q.debug=console.debug.bind(console);break;case"vdebug":q.vdebug=console.debug.bind(console);break;case"log":q.log=console.log.bind(console);break;case"warn":q.warn=console.warn.bind(console);break;case"error":q.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(m){a.e(m)}finally{a.f()}}q.log("Initializing library");var r=e.dependencies||q.useDefaultDependencies();q.isArray=r.isArray,q.webRTCAdapter=r.webRTCAdapter,q.httpAPICall=r.httpAPICall,q.newWebSocket=r.newWebSocket,q.extension=r.extension,q.extension.init(),q.listDevices=function(e,t){e="function"==typeof e?e:q.noop,null==t&&(t={audio:!0,video:!0}),q.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(a){q.debug(a),e(a),q.stopAllTracks(t)}))})).catch((function(t){q.error(t),e([])})):(q.warn("navigator.mediaDevices unavailable"),e([]))},q.attachMediaStream=function(e,t){try{e.srcObject=t}catch(a){try{e.src=URL.createObjectURL(t)}catch(a){q.error("Error attaching stream to element")}}},q.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(a){try{e.src=t.src}catch(a){q.error("Error reattaching stream to element")}}};var o=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",i=window["on"+o];if(window.addEventListener(o,(function(e){for(var t in q.log("Closing window"),q.sessions)q.sessions[t]&&q.sessions[t].destroyOnUnload&&(q.log("Destroying session "+t),q.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));i&&"function"==typeof i&&i()})),q.safariVp8=!1,"safari"===q.webRTCAdapter.browserDetails.browser&&q.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var s,c=Object(M.a)(RTCRtpSender.getCapabilities("video").codecs);try{for(c.s();!(s=c.n()).done;){var d=s.value;if(d&&d.mimeType&&"video/vp8"===d.mimeType.toLowerCase()){q.safariVp8=!0;break}}}catch(m){c.e(m)}finally{c.f()}q.safariVp8?q.log("This version of Safari supports VP8"):q.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var l=new RTCPeerConnection({});l.createOffer({offerToReceiveVideo:!0}).then((function(e){q.safariVp8=-1!==e.sdp.indexOf("VP8"),q.safariVp8?q.log("This version of Safari supports VP8"):q.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),l.close(),l=null}))}if(q.unifiedPlan=!1,"firefox"===q.webRTCAdapter.browserDetails.browser&&q.webRTCAdapter.browserDetails.version>=59)q.unifiedPlan=!0;else if("chrome"===q.webRTCAdapter.browserDetails.browser&&q.webRTCAdapter.browserDetails.version>=72)q.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in V.prototype){var u=new RTCPeerConnection;try{u.addTransceiver("audio"),q.unifiedPlan=!0}catch(f){}u.close()}else q.unifiedPlan=!1;q.initDone=!0,e.callback()}},q.isWebrtcSupported=function(){return!!window.RTCPeerConnection},q.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},q.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++){var r=Math.floor(Math.random()*t.length);a+=t.substring(r,r+1)}return a};var U=q,L=a(40),B=a.n(L),F=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).handleKeyDown=function(e){"Enter"===e.key&&(n.props.sendChat(e.target.value),P()("#chat-input").val(""),console.log("do validate",e.target.value))},n.participantTag=n.participantTag.bind(Object(u.a)(n)),n.chatsBody=n.chatsBody.bind(Object(u.a)(n)),n.panelBlocks=n.panelBlocks.bind(Object(u.a)(n)),n.upload=n.upload.bind(Object(u.a)(n)),n.getList=n.getList.bind(Object(u.a)(n)),n.sharesBody=n.sharesBody.bind(Object(u.a)(n)),n.state={token:window.localStorage.getItem("token"),chats:[],panel:[],file:null,progress:0,progressShow:!1,uploads:null,room:null,uploaded:!1,currentBlock:"participants"},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){g.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){}},{key:"getList",value:function(){var e=this,t=g.getList(),a=g.getKlass();t&&"Upload"===a&&this.setState({uploads:t},(function(){return e.panelBlocks("shares")})),console.log("uploads",t)}},{key:"componentDidUpdate",value:function(e){e.chats!==this.props.chats&&"chat"===this.state.currentBlock&&this.panelBlocks("chat"),e.participants!==this.props.participants&&this.panelBlocks("participants"),e.uploads!==this.props.uploads&&this.panelBlocks("shares"),e.room!==this.props.room&&(console.log("room id:",this.props.roomId),this.setState({room:this.props.room}),E("uploads",this.state.page,{room_id:this.props.room.id},this.state.token))}},{key:"upload",value:function(e){var t=this,a=this;console.log(e),a.setState({progressShow:!0},(function(){return a.panelBlocks("shares")}));var n={onUploadProgress:function(e){var t=Math.round(100*e.loaded/e.total);console.log(t),a.setState({progress:t},(function(){return a.panelBlocks("shares")}))},headers:{"Content-Type":"application/json",Authorization:"bearer "+a.state.token}},r=new FormData;r.append("upload[attached_document]",e),r.append("upload[room_id]",a.state.room.id),y.a.post(k+"/uploads",r,n).then((function(e){a.setState({progressShow:!1},(function(){return a.panelBlocks("shares")})),E("uploads",t.state.page,{room_id:t.props.room.id},t.state.token)})).catch((function(e){return a.setState({progressShow:!1},(function(){return a.panelBlocks("shares")}))}))}},{key:"participantTag",value:function(){var e=[];return this.props.participants&&this.props.participants.map((function(t){return e.push(r.a.createElement("div",{class:"row is-full"},r.a.createElement("div",{className:"tags has-addons  p-1"},r.a.createElement("span",{className:"tag w-150"},t.display),r.a.createElement("a",{className:"tag  is-warning"},r.a.createElement("i",{className:"fas fa-search","aria-hidden":"true"})),r.a.createElement("a",{className:"tag  is-info"},r.a.createElement("i",{className:"fas fa-check","aria-hidden":"true"})),r.a.createElement("a",{className:"tag  is-dark"},r.a.createElement("i",{className:"fas fa-times","aria-hidden":"true"})))))})),e}},{key:"chatsBody",value:function(){var e=[];return this.props.chats&&this.props.chats.map((function(t){console.log(t),e.push(r.a.createElement("article",{class:"media"},r.a.createElement("div",{class:"media-content"},r.a.createElement("div",{class:"content"},r.a.createElement("p",null,r.a.createElement("strong",null,t.display)," ",r.a.createElement("small",null," ",r.a.createElement(B.a,{fromNow:!0,ago:!0},t.time)),r.a.createElement("br",null),t.body)))))})),console.log(e),e}},{key:"sharesBody",value:function(){var e=[];return this.state.uploads&&this.state.uploads.map((function(t){e.push(r.a.createElement("article",{className:"media"},r.a.createElement("div",{className:"media-content"},r.a.createElement("div",{className:"content"},r.a.createElement("p",null,r.a.createElement("strong",null,t.uploader)," ",r.a.createElement("small",null," ",r.a.createElement(B.a,{fromNow:!0,ago:!0},t.created_at)),r.a.createElement("br",null),r.a.createElement("a",{target:"_blank",href:t.link,className:"fs-10"},r.a.createElement("i",{className:"fa fa-download","aria-hidden":"true"})," Download!"))))))})),console.log(e),e}},{key:"panelBlocks",value:function(e){var t=this;this.setState({currentBlock:e});var a=[];switch(e){case"chat":a.push(r.a.createElement("div",{className:"w-100"},r.a.createElement("div",{className:"control is-expanded has-icons-left "},r.a.createElement("input",{id:"chat-input",className:"input mb-4",type:"text",placeholder:"Type here!",onKeyDown:this.handleKeyDown}),r.a.createElement("span",{className:"icon is-left mb-4"},r.a.createElement("i",{className:"fas fa-comment","aria-hidden":"true"})),this.chatsBody())));break;case"shares":a.push(r.a.createElement("div",{className:"w-100 d-block"},r.a.createElement("div",{className:"w-100 mt-4"},r.a.createElement("div",{className:"field "},r.a.createElement("div",{className:"file is-small"},r.a.createElement("label",{className:"file-label mrl-auto"},r.a.createElement("input",{className:"file-input",type:"file",name:"resume",onInput:function(e){return t.upload(e.target.files[0])}}),r.a.createElement("span",{className:"file-cta"},r.a.createElement("span",{className:"file-icon"},r.a.createElement("i",{className:"fas fa-upload"})),r.a.createElement("span",{className:"file-label"},"Choose a file to upload !")))))),r.a.createElement("div",{className:"row mt-2"},r.a.createElement("progress",{className:this.state.progressShow?"progress is-primary ":"progress is-primary is-hidden",value:this.state.progress,max:"100"},this.state.progress)),this.sharesBody()));break;case"polls":break;default:a.push(r.a.createElement("div",{className:"w-100"},r.a.createElement("div",{class:"rows"},this.participantTag())))}console.log(a),this.setState({panel:a})}},{key:"render",value:function(){var e=this;this.state.token;return r.a.createElement("div",{className:"column is-3 is-inline-block-mobile p-0"},r.a.createElement("nav",{className:"panel mt-4 p-2 ml-2 h-100"},r.a.createElement("div",{className:"panel-block"},r.a.createElement("p",{className:"control has-icons-left"},r.a.createElement("input",{className:"input",type:"text",placeholder:"Search"}),r.a.createElement("span",{className:"icon is-left"},r.a.createElement("i",{className:"fas fa-search","aria-hidden":"true"})))),r.a.createElement("p",{className:"panel-tabs"},r.a.createElement("a",{className:"is-active"},"!"),r.a.createElement("a",{onClick:function(){return e.panelBlocks("participants")}},"Participants",r.a.createElement("span",{className:"badge bg-red"})),r.a.createElement("a",{onClick:function(){return e.panelBlocks("chat")}},"Chat"),r.a.createElement("a",{onClick:function(){return e.panelBlocks("shares")}},"Shares"),r.a.createElement("a",null,"Polls")),r.a.createElement("div",{id:"panel-block",className:"panel-block is-justify-content-left is-fullwidth ai-b"},this.state.panel)))}}]),a}(r.a.Component),W=(a(78),a(79),a(137),function(e){function t(t,a){var n="140",o="120";return"high"===t&&(n="240",o=""),"present"===t&&(n="640",o=""),r.a.createElement("div",{class:"column is-horizontal-center has-text-centered"},r.a.createElement("video",{controls:!0,key:a,id:"video-"+a,src:"",width:n,height:o,autoPlay:!0,playsInline:!0,muted:e.muted,poster:"https://picsum.photos/300/200"}))}function a(e,t){return e?r.a.createElement("span",{class:"fa-stack"},r.a.createElement("i",{class:"fas fa-"+t+" fa-stack-1x"}),r.a.createElement("i",{class:"fas fa-slash fa-stack-1x",style:{textShadow:"0.1em 0.15em white"}})):r.a.createElement("span",{class:"fa-stack"},r.a.createElement("i",{className:"fas fa-"+t}))}return e.room?r.a.createElement("aside",{className:"column pl-0 aside hero is-fullheight"},r.a.createElement("div",{className:"media-bar p-2 pl-4 has-background-dark has-text-white-ter"},r.a.createElement("a",{onClick:function(){return e.toggleMicrophone()},className:"has-text-white-bis"},a(e.publishedMicrophone,"microphone")),r.a.createElement("a",{onClick:function(){return e.toggleCamera()},className:"has-text-white-bis"},a(e.publishedCamera,"camera")),r.a.createElement("a",{onClick:function(){return e.toggleDesktop()},className:"has-text-white-bis ml-2"},a(e.publishedDesktop,"desktop")),r.a.createElement("a",{onClick:function(){return e.toggleDesktop()},className:"has-text-white-bis ml-2"},r.a.createElement("i",{className:"fas fa-hand-paper va-2","aria-hidden":"true"}))),r.a.createElement("div",{className:"container p-4"},function(){if(e.notification&&"cameraSwitch"===e.notification.type){var t="";return"screen sharing"===e.notification.from&&(t=r.a.createElement("button",{className:"button deactivate-btn",onClick:function(){return e.toggleDesktop()}},"Deactivate")),"camera"===e.notification.from&&(t=r.a.createElement("button",{className:"button deactivate-btn",onClick:function(){return e.toggleCamera()}},"Deactivate")),r.a.createElement("div",{className:"notification is-warning"},r.a.createElement("button",{className:"delete"}),"You must deactivate your ",r.a.createElement("strong",null,e.notification.from)," in order to activate ",r.a.createElement("strong",null,e.notification.to),".",t)}return null}(),r.a.createElement("div",{className:"columns mt-2 is-mobile is-multiline is-centered p-4"},function(){var a=[];return e.feeds&&e.feeds.map((function(n){"speaker"===e.feedToRole(n.id)&&(console.log(n.id,"is a speaker"),a.push(t("high","h-"+n.id)))})),a}()),r.a.createElement("div",{className:"columns mt-2 is-mobile is-multiline is-centered p-4 is-horizontal-center"},function(){var a=[];return e.feeds&&e.feeds.map((function(n){"presenter"===e.feedToRole(n.id)&&(console.log(n.id,"is a presenter"),a.push(t("present","p-"+n.id)))})),a}()),r.a.createElement("div",{className:"columns is-mobile is-multiline has-background-white-bis p-4"},r.a.createElement("div",{className:"column is-narrow"},function(){var a=[];return e.feeds&&e.feeds.map((function(n){"listener"===e.feedToRole(n.id)&&(console.log(n.id,"is a listener"),a.push(t("low",n.id)))})),a}())))):null}),J=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).getList=e.getList.bind(Object(u.a)(e)),e.sessionCreate=e.sessionCreate.bind(Object(u.a)(e)),e.registerUsername=e.registerUsername.bind(Object(u.a)(e)),e.newRemoteFeed=e.newRemoteFeed.bind(Object(u.a)(e)),e.publishCamera=e.publishCamera.bind(Object(u.a)(e)),e.publishMicrophone=e.publishMicrophone.bind(Object(u.a)(e)),e.off=e.off.bind(Object(u.a)(e)),e.on=e.on.bind(Object(u.a)(e)),e.pageAfterIn=e.pageAfterIn.bind(Object(u.a)(e)),e.streamAttacher=e.streamAttacher.bind(Object(u.a)(e)),e.streamDettacher=e.streamDettacher.bind(Object(u.a)(e)),e.unmute=e.unmute.bind(Object(u.a)(e)),e.getInstance=e.getInstance.bind(Object(u.a)(e)),e.sendData=e.sendData.bind(Object(u.a)(e)),e.setInstance=e.setInstance.bind(Object(u.a)(e)),e.speakRequest=e.speakRequest.bind(Object(u.a)(e)),e.publishData=e.publishData.bind(Object(u.a)(e)),e.removeRequest=e.removeRequest.bind(Object(u.a)(e)),e.acceptRequest=e.acceptRequest.bind(Object(u.a)(e)),e.addParticipant=e.addParticipant.bind(Object(u.a)(e)),e.removeParticipant=e.removeParticipant.bind(Object(u.a)(e)),e.unPublishData=e.unPublishData.bind(Object(u.a)(e)),e.exisitingParticipant=e.exisitingParticipant.bind(Object(u.a)(e)),e.requestAccepted=e.requestAccepted.bind(Object(u.a)(e)),e.findParticpantByUuid=e.findParticpantByUuid.bind(Object(u.a)(e)),e.participantIndex=e.participantIndex.bind(Object(u.a)(e)),e.findParticpantById=e.findParticpantById.bind(Object(u.a)(e)),e.findFeedByRfid=e.findFeedByRfid.bind(Object(u.a)(e)),e.findFeedById=e.findFeedById.bind(Object(u.a)(e)),e.feedToRole=e.feedToRole.bind(Object(u.a)(e)),e.attachMedia=e.attachMedia.bind(Object(u.a)(e)),e.unPublishCamera=e.unPublishCamera.bind(Object(u.a)(e)),e.beforeRemove=e.beforeRemove.bind(Object(u.a)(e)),e.toggleCamera=e.toggleCamera.bind(Object(u.a)(e)),e.toggleMicrophone=e.toggleMicrophone.bind(Object(u.a)(e)),e.submitParticipation=e.submitParticipation.bind(Object(u.a)(e)),e.publishDesktop=e.publishDesktop.bind(Object(u.a)(e)),e.presentMessage=e.presentMessage.bind(Object(u.a)(e)),e.unPublishDesktop=e.unPublishDesktop.bind(Object(u.a)(e)),e.cameraPublisher=e.cameraPublisher.bind(Object(u.a)(e)),e.toggleDesktop=e.toggleDesktop.bind(Object(u.a)(e)),e.changeParticipantRole=e.changeParticipantRole.bind(Object(u.a)(e)),e.sendChat=e.sendChat.bind(Object(u.a)(e)),e.state={token:window.localStorage.getItem("token"),shortners:null,server:S,janus:null,sfutest:null,opaqueId:"videoroomtest-"+U.randomString(12),roomId:null,myusername:null,myid:null,mystream:null,mypvtid:"videoroomtest-"+U.randomString(12),pin:null,feeds:[],activeFeeds:[],bitrateTimer:[],userUUID:null,fullname:null,isOwner:!1,urls:[],publishedCamera:!1,publishedMicrophone:!1,publishedDesktop:!1,muted:!0,requests:[],lowFeeds:[],participants:[],room:null,notification:{},chats:[]},e}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("got_instance",this.getInstance),g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("got_instance",this.getInstance),g.removeListener("set_instance",this.setInstance),window.removeEventListener("beforeunload",this.unPublishData)}},{key:"updateSubscribers",value:function(){T("subscribers",{room_id:this.state.roomId},this.state.token)}},{key:"renewSubscribers",value:function(){C("subscribers",this.state.roomId,this.state.token)}},{key:"sessionCreate",value:function(){var e=this;U.init({debug:"none",callback:function(){var t=new U({server:e.state.server,success:function(){t.attach({plugin:"janus.plugin.videoroom",opaqueId:e.state.opaqueId,success:function(a){e.setState({janus:t}),e.setState({sfutest:a}),U.log("Plugin attached! ("+e.state.sfutest.getPlugin()+", id="+e.state.sfutest.getId()+")"),U.log("  -- This is a publisher/manager"),e.registerUsername()},error:function(e){U.error("  -- Error attaching plugin...",e),window.alert("Error attaching plugin... "+e)},consentDialog:function(e){U.debug("Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){U.log("ICE state changed to "+e)},mediaState:function(e,t){U.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){U.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(t,a){U.log(" ::: Got a message (publisher) :::",t);var n=t.videoroom;if(U.debug("Event: "+n),n)if("joined"===n){if(console.log("joined"),e.setState({myid:t.id,mypvtid:t.private_id}),e.addParticipant(t.id,e.state.fullname+"\xa7"+e.state.userUUID),t.publishers){var r=t.publishers;for(var o in console.log("Got a list of available publishers/feeds:",r),r){var i=r[o].id,s=r[o].display,c=r[o].audio_codec,d=r[o].video_codec;U.debug("  >> ["+i+"] "+s+" (audio: "+c+", video: "+d+")"),e.addParticipant(r[o].id,r[o].display),e.newRemoteFeed(i,s,c,d)}}}else if("destroyed"===n)U.warn("The room has been destroyed!");else if("event"===n)if(t.publishers){r=t.publishers;for(var o in U.log("Got a list of available publishers/feeds:",r),r){i=r[o].id,s=r[o].display,c=r[o].audio_codec,d=r[o].video_codec;U.log("  >> ["+i+"] "+s+" (audio: "+c+", video: "+d+")"),e.addParticipant(r[o].id,r[o].display),e.newRemoteFeed(i,s,c,d)}}else if(t.leaving){var l=t.leaving;console.log("Publisher leaving: "+l),e.setState({feeds:e.state.feeds.filter((function(e){return e.rfid!=l}))},(function(){return console.log("feeds: >>>>",e.state.feeds)})),null!=(m=(f=e.state.feeds.filter((function(e){return e.rfid===l}))).shift())&&m.detach(),e.removeParticipant(l)}else if(t.unpublished){var u=t.unpublished;if(console.log("Publisher left: "+u),"ok"===u)return e.state.sfutest.hangup(),void e.streamDettacher(e.state.sfutest);e.setState({feeds:e.state.feeds.filter((function(e){return e.rfid!=u}))});var m,f=e.state.feeds.filter((function(e){return e.rfid===u}));e.setState({lowFeeds:e.state.lowFeeds.filter((function(e){return e.rfid!=u}))}),null!=(m=f.shift())&&(m.detach(),e.streamDettacher(m)),e.removeParticipant(u)}else t.error||t.configured||t.joining&&(console.log("Somebodu joining"),e.addParticipant(t.joining.id,t.joining.display));a&&(U.log("Handling SDP as well...",a),e.state.sfutest.handleRemoteJsep({jsep:a}))},onlocalstream:function(t){console.log(" ::: Got a local stream :::",t),console.log(e.state.sfutest.id),0===e.state.feeds.filter((function(t){return t.id===e.state.sfutest.id})).length&&(e.state.sfutest.rfid=e.state.myid,e.setState({feeds:e.state.feeds.concat(e.state.sfutest)}),e.state.isOwner&&e.requestAccepted(e.state.userUUID));var a=t.getVideoTracks();a&&0!==a.length?(console.log(e.state.participants),e.streamAttacher(e.state.sfutest)):e.streamDettacher(e.state.sfutest)},onremotestream:function(e){U.log(" ::: Got a remote stream :::",e)},ondata:function(e){U.debug("We got data from the DataChannel!",e)},oncleanup:function(){U.log(" ::: Got a cleanup notification: we are unpublished now :::")}})},error:function(e){U.error(e),window.alert(e,(function(){window.location.reload()}))},destroyed:function(){window.location.reload()}})}})}},{key:"registerUsername",value:function(){var e={request:"join",room:this.state.roomId,ptype:"publisher",display:this.state.fullname+" \xa7"+this.state.userUUID,pin:this.state.pin};this.state.sfutest.send({message:e}),setTimeout(function(){this.publishData()}.bind(this),3e3)}},{key:"findFeedByRfid",value:function(e){var t=this.state.feeds.filter((function(t){return t.rfid===e}));if(t&&t[0])return t[0]}},{key:"findFeedById",value:function(e){var t=this.state.feeds.filter((function(t){return t.id===e}));if(t&&t[0])return t[0]}},{key:"feedIdToRfid",value:function(e){var t=this.state.feeds.filter((function(t){return t.id===e}));if(t&&t[0])return t[0].rfid}},{key:"addParticipant",value:function(e,t){console.log("Adding Participants ...",e,t);var a=t.split("\xa7");this.exisitingParticipant(a[1])&&this.setState({participants:this.state.participants.concat({id:e,display:a[0],uuid:a[1],role:"listener"})}),console.log("participant added:",a[1])}},{key:"exisitingParticipant",value:function(e){return 0===this.state.participants.filter((function(t){return t.uuid===e})).length}},{key:"findParticpantById",value:function(e){var t=this.state.participants.filter((function(t){return t.id===e}));if(t&&t[0])return t[0]}},{key:"findParticpantByUuid",value:function(e){var t=this.state.participants.filter((function(t){return t.uuid===e}));if(t&&t[0])return t[0]}},{key:"removeParticipant",value:function(e){this.setState({participants:this.state.participants.filter((function(t){return t.id!==e}))})}},{key:"newRemoteFeed",value:function(e,t,a,n,r){var o=this,i=null;o.state.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.state.opaqueId,success:function(t){(i=t).simulcastStarted=!1,U.log("Plugin attached! ("+i.getPlugin()+", id="+i.getId()+")"),U.log("  -- This is a subscriber");var a={request:"join",room:o.state.roomId,ptype:"subscriber",pin:o.state.pin,feed:e,private_id:o.state.mypvtid};"safari"!==U.webRTCAdapter.browserDetails.browser||"vp9"!==r&&("vp8"!==r||U.safariVp8)||(r&&(r=r.toUpperCase()),console.log("Publisher is using "+r+", but Safari doesn't support it: disabling video"),a.offer_video=!1),i.videoCodec=r,i.send({message:a})},error:function(e){U.error("  -- Error attaching plugin...",e),window.alert("Error attaching plugin... "+e)},onmessage:function(e,t){U.debug(" ::: Got a message (subscriber) :::",e);var a=e.videoroom;U.log("Event: "+a),e.error?window.alert(e.error):a&&"attached"===a&&(i.rfid=e.id,i.rfdisplay=e.display,o.setState({feeds:o.state.feeds.concat(i)}),o.setState({lowFeeds:o.state.lowFeeds.concat(i)}),r||o.streamDettacher(i),U.log("Successfully attached to feed "+i.rfid+" ("+i.rfdisplay+") in room "+e.room)),t&&(U.log("Handling SDP as well...",t),i.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){U.log("Got SDP!",e);var t={request:"start",room:o.state.roomId};i.send({message:t,jsep:e})},error:function(e){U.log("WebRTC error:",e),window.alert("WebRTC error... "+e.message)}}))},iceState:function(e){U.log("ICE state of this WebRTC PeerConnection (feed #"+i.rfindex+") changed to "+e)},webrtcState:function(e){U.log("Janus says this WebRTC PeerConnection (feed #"+i.rfindex+") is "+(e?"up":"down")+" now"),"down"===e&&o.removeParticipant(i.rfid)},onlocalstream:function(e){console.log(">>>>>>>>>>>",e)},onremotestream:function(e){o.streamAttacher(i)},ondata:function(e){console.log(e);var t=JSON.parse(e);0===o.state.requests.filter((function(e){return e.uuid===t.uuid})).length&&"up"===t.request&&o.setState({requests:o.state.requests.concat({display:t.display,uuid:t.uuid})}),"present"===t.request&&(console.log(t),o.requestAccepted(t.uuid,"presenter")),"chat"===t.request&&o.state.userUUID!==t.uuid&&o.setState({chats:o.state.chats.concat({display:t.display,uuid:t.uuid,body:t.body,time:t.time})}),"removeRequest"===t.request&&o.setState({requests:o.state.requests.filter((function(e){return e.uuid!=t.uuid}))}),"acceptRequest"===t.request&&(o.setState({requests:o.state.requests.filter((function(e){return e.uuid!=t.uuid}))}),o.requestAccepted(t.uuid),t.uuid===o.state.userUUID&&(console.log("\xa7\xa7\xa7\xa7\xa7\xa7\xa7",o.state.publishedCamera),o.state.publishedCamera?(o.unPublishCamera(),o.publishCamera(32)):o.publishMicrophone()))},oncleanup:function(){U.log(" ::: Got a cleanup notification (remote feed "+e+") :::")}})}},{key:"feedToRole",value:function(e){var t=this.findFeedById(e);if(t&&t.rfid)var a=this.findParticpantById(t.rfid);if(a)return a.role}},{key:"attachMedia",value:function(e,t,a){U.attachMediaStream(document.getElementById(e+"-"+t),a)}},{key:"requestAccepted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"speaker";this.changeParticipantRole(e,t)}},{key:"changeParticipantRole",value:function(e,t){var a=this,n=Object.assign({},this.state),r=this.findParticpantByUuid(e),o=this.participantIndex(e);n.participants[o]={id:r.id,display:r.display,uuid:r.uuid,role:t},this.setState(n,(function(){var e=a.findFeedByRfid(r.id);e&&a.streamAttacher(e)}))}},{key:"participantIndex",value:function(e){var t=this.state.participants.findIndex((function(t){return t.uuid===e}));if(console.log(t),Number.isInteger(t))return t}},{key:"participantIsSpeaker",value:function(e){var t=this.findParticpantByUuid(e);return!(!t||"speaker"!==t.role)}},{key:"streamAttacher",value:function(e){console.log("Attaching "+e.id),P()("#video-h-"+e.id).show(),P()("#video-"+e.id).show(),P()("#video-p-"+e.id).show();var t="";switch(console.log("The role is "+this.feedToRole(e.id)),this.feedToRole(e.id)){case"speaker":t="video-h-";break;case"presenter":t="video-p-";break;default:t="video-"}e.id&&e.webrtcStuff&&e.webrtcStuff.remoteStream&&U.attachMediaStream(document.getElementById(t+e.id),e.webrtcStuff.remoteStream),e.id&&e.webrtcStuff&&e.webrtcStuff.myStream&&U.attachMediaStream(document.getElementById(t+e.id),e.webrtcStuff.myStream),this.unmute()}},{key:"streamDettacher",value:function(e){e.id&&(console.log("Dettaching "+e.id),P()("#video-h-"+e.id).hide(),P()("#video-p-"+e.id).hide(),P()("#video-"+e.id).hide())}},{key:"sendData",value:function(){var e={textroom:"message",transaction:U.randomString(12),room:this.state.roomId,text:"UUUUU"};this.state.sfutest.data({text:JSON.stringify(e),error:function(e){console.log(e)},success:function(){console.log("sent")}})}},{key:"sendChat",value:function(e){var t=this,a={textroom:"message",transaction:U.randomString(12),room:this.state.roomId,request:"chat",uuid:this.state.userUUID,display:this.state.fullname,body:e,time:Date.now()};this.state.sfutest.data({text:JSON.stringify(a),error:function(e){console.log(e)},success:function(){console.log(a),t.setState({chats:t.state.chats.concat({display:a.display,uuid:a.uuid,body:a.body,time:a.time})})}})}},{key:"speakRequest",value:function(){var e=this,t={textroom:"message",transaction:U.randomString(12),room:this.state.roomId,request:"up",uuid:this.state.userUUID,display:this.state.fullname};this.state.sfutest.data({text:JSON.stringify(t),error:function(e){console.log(e)},success:function(){console.log("request sent"),0===e.state.requests.filter((function(e){return e.uuid===t.uuid})).length&&"up"===t.request&&e.setState({requests:e.state.requests.concat({display:t.display,uuid:t.uuid})})}})}},{key:"presentMessage",value:function(){var e={textroom:"message",transaction:U.randomString(12),room:this.state.roomId,request:"present",uuid:this.state.userUUID,display:this.state.fullname};this.state.sfutest.data({text:JSON.stringify(e),error:function(e){console.log(e)},success:function(){console.log("present request sent")}})}},{key:"publishData",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!1,audioSend:!1},success:function(t){if(U.debug("********* Got publisher SDP!",t),t){e.state.sfutest.send({message:{request:"publish",audio:!0,video:!0,data:!0},jsep:t})}console.log("Data published ...")},error:function(e){U.error("***** WebRTC error:",e)}})}},{key:"unPublishData",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!1,videoSend:!1,audioSend:!1},success:function(t){if(U.debug("********* Got publisher SDP!",t),t){e.state.sfutest.send({message:{request:"unpublish",audio:!1,video:!1,data:!1},jsep:t})}},error:function(e){U.error("***** WebRTC error:",e)}})}},{key:"publishCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=this;(console.log("publishedDesktop? ",t.state.publishedDesktop),t.state.publishedDesktop)?t.setState({notification:{type:"cameraSwitch",from:"screen sharing",to:"camera"}}):(t=this).state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!0,audioSend:t.state.publishedMicrophone},success:function(a){if(U.debug("********* Got publisher SDP!",a),console.log("switching to "+e),a){var n={request:"configure",audio:t.state.publishedMicrophone,video:!0,data:!0,bitrate:8e3*e,bitrate_cap:!0,videocodec:"vp8"};t.state.sfutest.send({message:n,jsep:a})}t.setState({publishedCamera:!0});var r=t.state.sfutest.webrtcStuff.myStream.getTracks();console.log(r)},error:function(e){U.error("***** WebRTC error:",e)}})}},{key:"cameraPublisher",value:function(){}},{key:"publishDesktop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=this;t.state.publishedCamera?t.setState({notification:{type:"cameraSwitch",to:"screen sharing",from:"camera"}}):t.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!0,video:"screen",screenshareFrameRate:6,audioSend:t.state.publishedMicrophone},success:function(a){if(U.debug("********* Got publisher SDP!",a),console.log("switching to "+e),a){var n={request:"configure",audio:t.state.publishedMicrophone,video:!0,data:!0,bitrate:5e5,publishers:1,videocodec:"vp8"};t.state.sfutest.send({message:n,jsep:a})}t.setState({publishedDesktop:!0}),t.changeParticipantRole(t.state.userUUID,"presenter"),t.presentMessage()},error:function(e){U.error("***** WebRTC error:",e)}})}},{key:"toggleCamera",value:function(){this.state.publishedCamera?this.unPublishCamera():this.participantIsSpeaker(this.state.userUUID)?this.publishCamera(32):this.publishCamera(16)}},{key:"toggleDesktop",value:function(){this.state.publishedDesktop?this.unPublishDesktop():this.publishDesktop()}},{key:"unPublishCamera",value:function(){console.log("unPublishing .."),this.setState({notification:{}});var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!1,audioSend:e.state.publishedMicrophone},success:function(t){if(U.debug("********* Got publisher SDP!",t),t){var a={request:"unpublish",audio:e.state.publishedMicrophone,video:!1,data:!0};e.state.sfutest.send({message:a,jsep:t})}e.setState({publishedCamera:!1}),e.setState({publishedData:!1}),e.streamDettacher(e.state.sfutest),e.state.sfutest.webrtcStuff.myStream.getTracks().forEach((function(e){"video"===e.kind&&e.stop()})),setTimeout(function(){e.publishData()}.bind(this),2e3),e.state.publishedMicrophone&&e.publishMicrophone()},error:function(e){U.error("***** WebRTC error:",e)}})}},{key:"unPublishDesktop",value:function(){var e=Object(O.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("unPublishing Desktop ..."),this.setState({notification:{}}),(t=this).state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,videoSend:!1,audioSend:t.state.publishedMicrophone},success:function(e){if(U.debug("********* Got publisher SDP!",e),e){var a={request:"unpublish",audio:t.state.publishedMicrophone,video:!1,data:!0};t.state.sfutest.send({message:a,jsep:e})}t.setState({publishedDesktop:!1}),t.setState({publishedData:!1}),setTimeout(function(){t.publishData()}.bind(this),2e3),t.state.publishedMicrophone&&t.publishMicrophone()},error:function(e){U.error("***** WebRTC error:",e)}});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleMicrophone",value:function(){console.log("Microphone state",this.state.publishedMicrophone),this.state.publishedMicrophone?this.unPublishMicrophone():this.publishMicrophone()}},{key:"publishMicrophone",value:function(){var e=this;e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,audioSend:!0,removeAudio:!1,videoSend:e.state.publishedCamera},success:function(t){if(U.debug("********* Got publisher SDP!",t),t){var a={request:"configure",data:!0,audio:!0,video:e.state.publishedCamera};e.state.sfutest.send({message:a,jsep:t})}e.setState({publishedMicrophone:!0})},error:function(e){U.error("***** WebRTC error:",e)}})}},{key:"unPublishMicrophone",value:function(){console.log("Unpublishing audio ...");var e=this,t=!1;(e.state.publishedCamera||e.state.publishedDesktop)&&(t=!0),e.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!0,audioSend:!1,removeAudio:!0,videoSend:t},success:function(a){if(U.debug("********* Got publisher SDP!",a),a){var n={request:"configure",data:!0,audio:!1,video:t};e.state.sfutest.send({message:n,jsep:a})}e.setState({publishedMicrophone:!1}),e.state.sfutest.webrtcStuff.myStream.getTracks().forEach((function(e){e.kind}))},error:function(e){U.error("***** WebRTC error:",e)}})}},{key:"off",value:function(){console.log(this.state.feeds);var e={request:"switch",feed:this.state.feeds[1].rfid,video:!1};this.state.feeds[1].send({message:e})}},{key:"on",value:function(){console.log(this.state.feeds);var e={request:"switch",feed:this.state.feeds[1].rfid,video:!0};this.state.feeds[1].send({message:e})}},{key:"componentDidMount",value:function(){C("rooms",this.props.match.params.id,this.state.token),window.addEventListener("beforeunload",this.unPublishData)}},{key:"submitParticipation",value:function(e){T("participations",{room_id:this.state.id,activity:e},this.state.token)}},{key:"getInstance",value:function(){var e=this,t=g.getIntance(),a=g.getKlass();t&&"Room"===a&&this.setState({room:t,id:t.id,roomId:t.room_id,pin:t.pin,fullname:t.user_fullname,title:t.title,isOwner:t.is_owner},(function(){return e.submitParticipation("joined")})),console.log(t)}},{key:"pageAfterIn",value:function(){this.sessionCreate()}},{key:"setInstance",value:function(){var e=this,t=g.getIntance(),a=g.getKlass();t&&"Participation"===a&&this.setState({userUUID:t.uuid},(function(){return e.pageAfterIn()})),console.log(t)}},{key:"loadData",value:function(){Framework7.instance.toast.show({text:D.receiving,closeTimeout:2e3,position:"top"}),E("shortners",this.state.page,{},this.state.token)}},{key:"localQualityChange",value:function(){}},{key:"getList",value:function(){var e=g.getList(),t=g.getKlass();e&&"Shortner"===t&&this.setState({shortners:e})}},{key:"unmute",value:function(){this.setState({muted:!1})}},{key:"acceptRequest",value:function(e){var t=this,a={textroom:"message",transaction:U.randomString(12),room:this.state.roomId,request:"acceptRequest",uuid:e};this.state.sfutest.data({text:JSON.stringify(a),error:function(e){console.log(e)},success:function(){t.setState({requests:t.state.requests.filter((function(t){return t.uuid!=e}))}),t.requestAccepted(e)}})}},{key:"removeRequest",value:function(e){var t=this,a={textroom:"message",transaction:U.randomString(12),room:this.state.roomId,request:"removeRequest",uuid:e};this.state.sfutest.data({text:JSON.stringify(a),error:function(e){console.log(e)},success:function(){t.setState({requests:t.state.requests.filter((function(t){return t.uuid!=e}))})}})}},{key:"beforeRemove",value:function(){console.log("removing ..."),this.unPublishCamera()}},{key:"render",value:function(){var e=this.state,t=e.token,a=e.shortners,n=e.urls,o=e.publishedMicrophone,i=e.publishedCamera,s=e.publishedDesktop,c=e.feeds,d=e.muted,l=e.lowFeeds,u=e.requests,m=e.participants,f=e.room,p=e.notification,v=e.chats;e.roomId;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,{token:t}),r.a.createElement("div",{class:"columns "},r.a.createElement(F,{room:this.state.room,participants:m,sendChat:this.sendChat,chats:v}),r.a.createElement(W,{beforeRemove:this.beforeRemove,pageAfterIn:this.pageAfterIn,shortners:a,streamAttacher:this.streamAttacher,findParticpantById:this.findParticpantById,participantIsSpeaker:this.participantIsSpeaker,feedToRole:this.feedToRole,urls:n,off:this.off,on:this.on,feeds:c,muted:d,lowFeeds:l,requests:u,room:f,participants:m,unmute:this.unmute,publishedCamera:i,toggleCamera:this.toggleCamera,toggleMicrophone:this.toggleMicrophone,publishedMicrophone:o,publishCamera:this.publishCamera,publishMicrophone:this.publishMicrophone,sendData:this.sendData,speakRequest:this.speakRequest,accept:this.accept,removeRequest:this.removeRequest,acceptRequest:this.acceptRequest,toggleDesktop:this.toggleDesktop,publishedDesktop:s,notification:p})))}}]),a}(r.a.Component),G=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).submit=n.submit.bind(Object(u.a)(n)),n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.setInstance=n.setInstance.bind(Object(u.a)(n)),n.state={email:"",password:""},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){}},{key:"submit",value:function(){var e={email:this.state.email,password:this.state.password};console.log(e),T("users/login",e)}},{key:"setInstance",value:function(){var e=g.getKlass(),t=g.getIntance();t&&"Login"===e&&(window.localStorage.setItem("token",t.token),this.props.history.push("/")),console.log(t)}},{key:"handleChange",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"hero is-primary is-fullheight"},r.a.createElement("div",{className:"hero-body"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"columns is-centered"},r.a.createElement("div",{className:"column is-5-tablet is-4-desktop is-3-widescreen"},r.a.createElement("div",{action:"",className:"box"},r.a.createElement("p",{className:"mb-4"},"Login"),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Email"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"email",placeholder:"e.g. bobsmith@gmail.com",className:"input",required:!0,onInput:function(t){e.handleChange({email:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-envelope"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Password"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"password",placeholder:"*******",className:"input",required:!0,onInput:function(t){e.handleChange({password:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-lock"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"checkbox"},r.a.createElement("input",{type:"checkbox"}),r.a.createElement("span",null," Remember me"))),r.a.createElement("div",{className:"field"},r.a.createElement("button",{className:"button is-success",onClick:this.submit},"Login"),r.a.createElement("a",{href:"/signup",className:"ml-2 button is-link"},"Signup")))))))))}}]),a}(r.a.Component),z=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).submit=n.submit.bind(Object(u.a)(n)),n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.setInstance=n.setInstance.bind(Object(u.a)(n)),n.state={nickname:"",email:"",password:""},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){}},{key:"submit",value:function(){var e={email:this.state.email,password:this.state.password,nickname:this.state.nickname};console.log(e),T("users/sign_up",e)}},{key:"setInstance",value:function(){var e=g.getKlass(),t=g.getIntance();t&&"SignUp"===e&&(window.localStorage.setItem("token",t.token),this.props.history.push("/")),console.log(t)}},{key:"handleChange",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"hero is-primary has-background-grey-light is-fullheight"},r.a.createElement("div",{className:"hero-body"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"columns is-centered"},r.a.createElement("div",{className:"column is-5-tablet is-4-desktop is-3-widescreen"},r.a.createElement("div",{action:"",className:"box"},r.a.createElement("p",{className:"mb-4"},"Sign Up"),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Nickname"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"email",placeholder:"e.g. Bob Smith",className:"input",required:!0,onInput:function(t){e.handleChange({nickname:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-user"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Email"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"email",placeholder:"e.g. bobsmith@gmail.com",className:"input",required:!0,onInput:function(t){e.handleChange({email:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-envelope"})))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{for:"",className:"label"},"Password"),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:"password",placeholder:"*******",className:"input",required:!0,onInput:function(t){e.handleChange({password:t.target.value})}}),r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fa fa-lock"})))),r.a.createElement("div",{className:"field"},r.a.createElement("button",{className:"button is-success",onClick:this.submit},"Signup"),r.a.createElement("a",{href:"/login",className:"ml-2 button is-link"},"Login")))))))))}}]),a}(r.a.Component),K=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).submit=n.submit.bind(Object(u.a)(n)),n.setInstance=n.setInstance.bind(Object(u.a)(n)),n.handleChange=n.handleChange.bind(Object(u.a)(n)),n.state={token:window.localStorage.getItem("token"),title:null},n}return Object(l.a)(a,[{key:"componentWillMount",value:function(){g.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){g.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){}},{key:"submit",value:function(){T("rooms",{title:this.state.title},this.state.token)}},{key:"handleChange",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.props.history.push("/rooms")}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,null),r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Name"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"text",placeholder:"Text input",onInput:function(t){e.handleChange({title:t.target.value})}}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Room Type"),r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select"},r.a.createElement("select",null,r.a.createElement("option",null,"Private"),r.a.createElement("option",null,"Public"))))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Description"),r.a.createElement("div",{className:"control"},r.a.createElement("textarea",{className:"textarea",placeholder:"Textarea"}))),r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{type:"checkbox"}),r.a.createElement("span",{className:"ml-2"},"I agree to the ",r.a.createElement("a",{href:"#"},"terms and conditions"))))),r.a.createElement("div",{class:"buttons"},r.a.createElement("button",{class:"button is-link",onClick:this.submit},"Submit"),r.a.createElement("a",{href:"/rooms",class:"button is-light"},"Cancel")))),"\xce")}}]),a}(r.a.Component);function H(){return r.a.createElement("div",{className:"App"},r.a.createElement(s.a,{basename:"/ui/"},r.a.createElement(c.c,null,r.a.createElement(c.a,{path:"/",exact:!0,component:R}),r.a.createElement(c.a,{path:"/rooms",exact:!0,component:R}),r.a.createElement(c.a,{path:"/rooms/new",exact:!0,component:K}),r.a.createElement(c.a,{path:"/rooms/:id",exact:!0,component:J}),r.a.createElement(c.a,{path:"/login",exact:!0,component:G}),r.a.createElement(c.a,{path:"/signup",exact:!0,component:z}))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(H,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},80:function(e,t,a){e.exports=a(138)},85:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){}},[[80,1,2]]]);
//# sourceMappingURL=main.643df250.chunk.js.map