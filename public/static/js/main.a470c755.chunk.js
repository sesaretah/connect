(window["webpackJsonpd1-react"]=window["webpackJsonpd1-react"]||[]).push([[0],{222:function(e,t){},225:function(e,t,n){e.exports=n(494)},409:function(e,t){},485:function(e,t,n){},486:function(e,t,n){},487:function(e,t,n){},488:function(e,t,n){},490:function(e,t,n){},491:function(e,t,n){},492:function(e,t,n){},493:function(e,t,n){},494:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(28),i=n.n(o),s=n(35),c=n(9),l=n(3),d=n(6),u=n(1),m=n(4),f=n(2),p=n(5),h=n(200),g=(n(234),n(201)),v=new(n(202).Dispatcher),b=new(function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).list=[],e.multipleList=[],e.instance=null,e.klass=null,e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"listModel",value:function(e){this.list=[],this.klass=e.klass;for(var t=0,n=e.data.length;t<n;++t)this.list.push(e.data[t]),t===n-1&&this.emit("got_list");0==e.data.length&&this.emit("got_list")}},{key:"listMultipleModel",value:function(e){console.log(e),this.multipleList=e.data,this.klass=e.klass,this.emit("got_multiple_list")}},{key:"showIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("got_instance")}},{key:"setIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("set_instance")}},{key:"deleteIntance",value:function(e){this.klass=e.klass,this.instance=e.data,this.emit("deleted_instance")}},{key:"postFile",value:function(e){console.log(e),this.klass=e.klass,this.instance=e.data,this.emit("file_posted")}},{key:"getIntance",value:function(){return this.instance}},{key:"getList",value:function(){return this.list}},{key:"getMutipleList",value:function(){return this.multipleList}},{key:"getListnKlass",value:function(){return[this.list,this.klass]}},{key:"getKlass",value:function(){return this.klass}},{key:"handleActions",value:function(e){switch(e.type){case"LIST_MODEL_SUCCESS":this.listModel(e.list);break;case"MULTIPLE_LIST_MODEL_SUCCESS":this.listMultipleModel(e.list);break;case"GET_INSTANCE_SUCCESS":this.showIntance(e.instance);break;case"DELETE_INSTANCE_SUCCESS":this.deleteIntance(e.instance);break;case"SET_INSTANCE_SUCCESS":this.setIntance(e.instance);break;case"POST_FILE_SUCCESS":this.postFile(e.instance)}}}]),t}(g.EventEmitter));v.register(b.handleActions.bind(b));var w=b,y=n(40),k=n.n(y),S={server:"/v1",socketIOServer:"https://connect.ut.ac.ir/",socketServer:"wss://kaarafarinan.ir/ws",ionSignalServer:"wss://sync.ut.ac.ir:7000/ws",janusServer:"https://sync.ut.ac.ir:8089/janus"},C=S.server;function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=Object.keys(n).map((function(e){return e+"="+n[e]})).join("&");k.a.get(C+"/"+e+"?page="+t+"&"+r,{headers:{"Content-Type":"application/json",Authorization:"bearer "+a}}).then((function(e){v.dispatch({type:"LIST_MODEL_SUCCESS",list:e.data})})).catch((function(e){console.log(e)}))}function j(e,t,n,a){var r=C+"/"+e+"/"+t,o=new FormData;o.append("profile[avatar]",n),o.append("profile[id]",t);var i={headers:{"content-type":"multipart/form-data",Authorization:"bearer "+a}};Object(y.put)(r,o,i).then((function(e){v.dispatch({type:"POST_FILE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function O(e,t,n){k.a.get(C+"/"+e+"/"+t,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"GET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function T(e,t,n){k.a.post(C+"/"+e+"/",t,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"SET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}function D(e,t,n){k.a.put(C+"/"+e+"/"+t.id,t,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"SET_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}var I=n(127),x=(n(497),I.initializeApp({apiKey:"AIzaSyAbQ1NDkKB_E_SbfgHY3w-esVWhjwj9DeE",authDomain:"tavan-e768d.firebaseapp.com",databaseURL:"https://tavan-e768d.firebaseio.com",projectId:"tavan-e768d",storageBucket:"tavan-e768d.appspot.com",messagingSenderId:"498708095861",appId:"1:498708095861:web:00428b1330b24e1eece93c",measurementId:"G-55DLXZ4VZY"}));I.messaging.isSupported()&&x.messaging().usePublicVapidKey("BGtSQdySGVQOeOwFha6rSVdmtfIUo_V33Eq-RTRb5kUNLvvwM7AVGCLtChjnGlD50fudRx8D4Aw-7br71Qfefrc");n(142);var A=n(20),R=n.n(A),_=n(65),P=window.RTCRtpTransceiver;V.sessions={},V.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||V.extension.isInstalled()}return!0};var M={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var n=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var a=new Error("NavigatorUserMediaError");a.name="You cancelled the request for permission, giving up...",n(a)}else n(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function V(e){if((e=e||{}).success="function"==typeof e.success?e.success:V.noop,e.error="function"==typeof e.error?e.error:V.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:V.noop,!V.initDone)return e.error("Library not initialized"),{};if(!V.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(V.log("Library initialized: "+V.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,n=null,a={},r=null,o=null,i=0,s=e.server;V.isArray(s)?(V.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,o=e.server,V.debug(o)):0===s.indexOf("ws")?(t=!0,V.log("Using WebSockets to contact Janus: "+s)):(t=!1,V.log("Using REST API to contact Janus: "+s));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],l=e.iceTransportPolicy,d=e.bundlePolicy,u=!0===e.ipv6,m=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(m=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var p=null;void 0!==e.token&&null!==e.token&&(p=e.token);var h=null;void 0!==e.apisecret&&null!==e.apisecret&&(h=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var v=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(v=e.longPollTimeout),isNaN(v)&&(v=6e4);var w=!1,y=null,k={},S=this,C=0,E={};function j(){if(null!=y)if(V.debug("Long poll..."),w){var t=s+"/"+y+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),p&&(t=t+"&token="+encodeURIComponent(p)),h&&(t=t+"&apisecret="+encodeURIComponent(h)),V.httpAPICall(t,{verb:"GET",withCredentials:m,success:O,timeout:v,error:function(t,n){if(V.error(t+":",n),++C>3)return w=!1,void e.error("Lost connection to the server (is it down?)");j()}})}else V.warn("Is the server down? (connected=false)")}function O(e,a){if(C=0,t||void 0===y||null===y||!0===a||j(),t||!V.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(c=e.sender))return void V.warn("Missing sender...");if(!(d=k[c]))return void V.debug("This handle is not attached to this session");var r=e.candidate;V.debug("Got a trickled candidate on session "+y),V.debug(r);var o=d.webrtcStuff;o.pc&&o.remoteSdp?(V.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(V.endOfCandidates)):(V.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(r),V.debug(o.candidates))}else{if("webrtcup"===e.janus)return V.debug("Got a webrtcup event on session "+y),V.debug(e),(c=e.sender)?(d=k[c])?void d.webrtcState(!0):void V.debug("This handle is not attached to this session"):void V.warn("Missing sender...");if("hangup"===e.janus){if(V.debug("Got a hangup event on session "+y),V.debug(e),!(c=e.sender))return void V.warn("Missing sender...");if(!(d=k[c]))return void V.debug("This handle is not attached to this session");d.webrtcState(!1,e.reason),d.hangup()}else if("detached"===e.janus){if(V.debug("Got a detached event on session "+y),V.debug(e),!(c=e.sender))return void V.warn("Missing sender...");if(!(d=k[c]))return;d.detached=!0,d.ondetached(),d.detach()}else if("media"===e.janus){if(V.debug("Got a media event on session "+y),V.debug(e),!(c=e.sender))return void V.warn("Missing sender...");if(!(d=k[c]))return void V.debug("This handle is not attached to this session");d.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(V.debug("Got a slowlink event on session "+y),V.debug(e),!(c=e.sender))return void V.warn("Missing sender...");if(!(d=k[c]))return void V.debug("This handle is not attached to this session");d.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var i,s;if(V.error("Ooops: "+e.error.code+" "+e.error.reason),V.debug(e),i=e.transaction)(s=E[i])&&s(e),delete E[i];return}if("event"===e.janus){var c;if(V.debug("Got a plugin event on session "+y),V.debug(e),!(c=e.sender))return void V.warn("Missing sender...");var l=e.plugindata;if(!l)return void V.warn("Missing plugindata...");V.debug("  -- Event is coming from "+c+" ("+l.plugin+")");var d,u=l.data;if(V.debug(u),!(d=k[c]))return void V.warn("This handle is not attached to this session");var m=e.jsep;m&&(V.debug("Handling SDP as well..."),V.debug(m));var f=d.onmessage;f?(V.debug("Notifying application..."),f(u,m)):V.debug("No provided notification callback")}else{if("timeout"===e.janus)return V.error("Timeout on session "+y),V.debug(e),void(t&&n.close(3504,"Gateway timeout"));V.warn("Unknown message/event  '"+e.janus+"' on session "+y),V.debug(e)}}}else V.debug("Got a success on session "+y),V.debug(e),(i=e.transaction)&&((s=E[i])&&s(e),delete E[i]);else V.debug("Got an ack on session "+y),V.debug(e),(i=e.transaction)&&((s=E[i])&&s(e),delete E[i]);else V.debug("Got info on the Janus instance"),V.debug(e),(i=e.transaction)&&((s=E[i])&&s(e),delete E[i]);else V.vdebug("Got a keepalive on session "+y);else for(var p=0;p<e.length;p++)O(e[p],!0)}function T(){if(s&&t&&w){r=setTimeout(T,g);var e={janus:"keepalive",session_id:y,transaction:V.randomString(12)};p&&(e.token=p),h&&(e.apisecret=h),n.send(JSON.stringify(e))}}function D(c){var l=V.randomString(12),d={janus:"create",transaction:l};if(c.reconnect&&(w=!1,d.janus="claim",d.session_id=y,n&&(n.onopen=null,n.onerror=null,n.onclose=null,r&&(clearTimeout(r),r=null))),p&&(d.token=p),h&&(d.apisecret=h),!s&&V.isArray(o)&&(0===(s=o[i]).indexOf("ws")?(t=!0,V.log("Server #"+(i+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,V.log("Server #"+(i+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var u in n=V.newWebSocket(s,"janus-protocol"),a={error:function(){if(V.error("Error connecting to the Janus WebSockets server... "+s),V.isArray(o)&&!c.reconnect)return++i===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){D(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){E[l]=function(e){if(V.debug(e),"success"!==e.janus)return V.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);r=setTimeout(T,g),w=!0,y=e.session_id?e.session_id:e.data.id,c.reconnect?V.log("Claimed session: "+y):V.log("Created session: "+y),V.sessions[y]=S,c.success()},n.send(JSON.stringify(d))},message:function(e){O(JSON.parse(e.data))},close:function(){s&&w&&(w=!1,e.error("Lost connection to the server (is it down?)"))}})n.addEventListener(u,a[u]);else V.httpAPICall(s,{verb:"POST",withCredentials:m,body:d,success:function(e){if(V.debug(e),"success"!==e.janus)return V.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);w=!0,y=e.session_id?e.session_id:e.data.id,c.reconnect?V.log("Claimed session: "+y):V.log("Created session: "+y),V.sessions[y]=S,j(),c.success()},error:function(e,t){if(V.error(e+":",t),V.isArray(o)&&!c.reconnect)return++i===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){D(c)}),200));""===t?c.error(e+": Is the server down?"):c.error(e+": "+t)}})}function I(e,a){if((a=a||{}).success="function"==typeof a.success?a.success:V.noop,a.error="function"==typeof a.error?a.error:V.noop,!w)return V.warn("Is the server down? (connected=false)"),void a.error("Is the server down? (connected=false)");var r=k[e];if(!r||!r.webrtcStuff)return V.warn("Invalid handle"),void a.error("Invalid handle");var o=a.message,i=a.jsep,c=V.randomString(12),l={janus:"message",body:o,transaction:c};if(r.token&&(l.token=r.token),h&&(l.apisecret=h),i&&(l.jsep={type:i.type,sdp:i.sdp},i.e2ee&&(l.jsep.e2ee=!0),"hml"!==i.rid_order&&"lmh"!==i.rid_order||(l.jsep.rid_order=i.rid_order)),V.debug("Sending message to plugin (handle="+e+"):"),V.debug(l),t)return l.session_id=y,l.handle_id=e,E[c]=function(e){if(V.debug("Message sent!"),V.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return V.warn("Request succeeded, but missing plugindata..."),void a.success();V.log("Synchronous transaction successful ("+t.plugin+")");var n=t.data;return V.debug(n),void a.success(n)}"ack"===e.janus?a.success():e.error?(V.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(V.error("Unknown error"),a.error("Unknown error"))},void n.send(JSON.stringify(l));V.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:l,success:function(e){if(V.debug("Message sent!"),V.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return V.warn("Request succeeded, but missing plugindata..."),void a.success();V.log("Synchronous transaction successful ("+t.plugin+")");var n=t.data;return V.debug(n),void a.success(n)}"ack"===e.janus?a.success():e.error?(V.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(V.error("Unknown error"),a.error("Unknown error"))},error:function(e,t){V.error(e+":",t),a.error(e+": "+t)}})}function x(e,a){if(w){var r=k[e];if(r&&r.webrtcStuff){var o={janus:"trickle",candidate:a,transaction:V.randomString(12)};if(r.token&&(o.token=r.token),h&&(o.apisecret=h),V.vdebug("Sending trickle candidate (handle="+e+"):"),V.vdebug(o),t)return o.session_id=y,o.handle_id=e,void n.send(JSON.stringify(o));V.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:o,success:function(e){V.vdebug("Candidate sent!"),V.vdebug(e),"ack"===e.janus||V.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){V.error(e+":",t)}})}else V.warn("Invalid handle")}else V.warn("Is the server down? (connected=false)")}function A(e,t,n,a,r){var o=k[e];if(o&&o.webrtcStuff){var i=o.webrtcStuff;if(i.pc){var s=function(e){V.log("Received state change on data channel:",e);var t=e.target.label,n=e.target.protocol,a=i.dataChannel[t]?i.dataChannel[t].readyState:"null";if(V.log("State change on <"+t+"> data channel: "+a),"open"===a){if(i.dataChannel[t].pending&&i.dataChannel[t].pending.length>0){V.log("Sending pending messages on <"+t+">:",i.dataChannel[t].pending.length);var r=!0,s=!1,c=void 0;try{for(var l,d=i.dataChannel[t].pending[Symbol.iterator]();!(r=(l=d.next()).done);r=!0){var u=l.value;V.log("Sending data on data channel <"+t+">"),V.debug(u),i.dataChannel[t].send(u)}}catch(m){s=!0,c=m}finally{try{r||null==d.return||d.return()}finally{if(s)throw c}}i.dataChannel[t].pending=[]}o.ondataopen(t,n)}};if(a)i.dataChannel[t]=a;else{var c={ordered:!0};n&&(c.protocol=n),i.dataChannel[t]=i.pc.createDataChannel(t,c)}i.dataChannel[t].onmessage=function(e){V.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},i.dataChannel[t].onopen=s,i.dataChannel[t].onclose=s,i.dataChannel[t].onerror=function(e){V.error("Got error on data channel:",e)},i.dataChannel[t].pending=[],r&&i.dataChannel[t].pending.push(r)}else V.warn("Invalid PeerConnection")}else V.warn("Invalid handle")}function R(e,t){(t=t||{}).success="function"==typeof t.success?t.success:V.noop,t.error="function"==typeof t.error?t.error:V.noop;var n=k[e];if(!n||!n.webrtcStuff)return V.warn("Invalid handle"),void t.error("Invalid handle");var a=n.webrtcStuff,r=t.text||t.data;if(!r)return V.warn("Invalid data"),void t.error("Invalid data");var o=t.label?t.label:V.dataChanDefaultLabel;return a.dataChannel[o]?"open"!==a.dataChannel[o].readyState?(a.dataChannel[o].pending.push(r),void t.success()):(V.log("Sending data on data channel <"+o+">"),V.debug(r),a.dataChannel[o].send(r),void t.success()):(A(e,o,t.protocol,!1,r,t.protocol),void t.success())}function _(e,t){(t=t||{}).success="function"==typeof t.success?t.success:V.noop,t.error="function"==typeof t.error?t.error:V.noop;var n=k[e];if(!n||!n.webrtcStuff)return V.warn("Invalid handle"),void t.error("Invalid handle");var a=n.webrtcStuff;if(!a.dtmfSender){if(a.pc){var r=a.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!r)return V.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");a.dtmfSender=r.dtmf,a.dtmfSender&&(V.log("Created DTMF Sender"),a.dtmfSender.ontonechange=function(e){V.debug("Sent DTMF tone: "+e.tone)})}if(!a.dtmfSender)return V.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(!o)return V.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var i=o.tones;if(!i)return V.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"===typeof o.duration?o.duration:500,c="number"===typeof o.gap?o.gap:50;V.debug("Sending DTMF string "+i+" (duration "+s+"ms, gap "+c+"ms)"),a.dtmfSender.insertDTMF(i,s,c),t.success()}function P(e,a){(a=a||{}).success="function"==typeof a.success?a.success:V.noop,a.error="function"==typeof a.error?a.error:V.noop;var r=!0===a.noRequest;V.log("Destroying handle "+e+" (only-locally="+r+")"),z(e);var o=k[e];if(!o||o.detached)return delete k[e],void a.success();if(r)return delete k[e],void a.success();if(!w)return V.warn("Is the server down? (connected=false)"),void a.error("Is the server down? (connected=false)");var i={janus:"detach",transaction:V.randomString(12)};if(o.token&&(i.token=o.token),h&&(i.apisecret=h),t)return i.session_id=y,i.handle_id=e,n.send(JSON.stringify(i)),delete k[e],void a.success();V.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:i,success:function(t){V.log("Destroyed handle:"),V.debug(t),"success"!==t.janus&&V.error("Ooops: "+t.error.code+" "+t.error.reason),delete k[e],a.success()},error:function(t,n){V.error(t+":",n),delete k[e],a.success()}})}function M(e,t,n,a,r){var o=k[e];if(!o||!o.webrtcStuff)return V.warn("Invalid handle"),a.stream||V.stopAllTracks(r),void a.error("Invalid handle");var i=o.webrtcStuff;V.debug("streamsDone:",r),r&&(V.debug("  -- Audio tracks:",r.getAudioTracks()),V.debug("  -- Video tracks:",r.getVideoTracks()));var s=!1;if(i.myStream&&n.update&&!i.streamExternal){if((!n.update&&J(n)||n.update&&(n.addAudio||n.replaceAudio))&&r.getAudioTracks()&&r.getAudioTracks().length)if(i.myStream.addTrack(r.getAudioTracks()[0]),V.unifiedPlan){V.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]);var m=null;if((w=i.pc.getTransceivers())&&w.length>0){var f=!0,p=!1,h=void 0;try{for(var g,v=w[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){if((T=g.value).sender&&T.sender.track&&"audio"===T.sender.track.kind||T.receiver&&T.receiver.track&&"audio"===T.receiver.track.kind){m=T;break}}}catch(P){p=!0,h=P}finally{try{f||null==v.return||v.return()}finally{if(p)throw h}}}m&&m.sender?m.sender.replaceTrack(r.getAudioTracks()[0]):i.pc.addTrack(r.getAudioTracks()[0],r)}else V.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]),i.pc.addTrack(r.getAudioTracks()[0],r);if((!n.update&&G(n)||n.update&&(n.addVideo||n.replaceVideo))&&r.getVideoTracks()&&r.getVideoTracks().length)if(i.myStream.addTrack(r.getVideoTracks()[0]),V.unifiedPlan){V.log((n.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]);var w,y=null;if((w=i.pc.getTransceivers())&&w.length>0){var S=!0,C=!1,E=void 0;try{for(var j,O=w[Symbol.iterator]();!(S=(j=O.next()).done);S=!0){var T;if((T=j.value).sender&&T.sender.track&&"video"===T.sender.track.kind||T.receiver&&T.receiver.track&&"video"===T.receiver.track.kind){y=T;break}}}catch(P){C=!0,E=P}finally{try{S||null==O.return||O.return()}finally{if(C)throw E}}}y&&y.sender?y.sender.replaceTrack(r.getVideoTracks()[0]):i.pc.addTrack(r.getVideoTracks()[0],r)}else V.log((n.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]),i.pc.addTrack(r.getVideoTracks()[0],r)}else i.myStream=r,s=!0;if(!i.pc){var D={iceServers:c,iceTransportPolicy:l,bundlePolicy:d};"chrome"===V.webRTCAdapter.browserDetails.browser&&(D.sdpSemantics=V.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var I={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&I.optional.push({googIPv6:!0}),a.rtcConstraints&&"object"===typeof a.rtcConstraints)for(var R in V.debug("Adding custom PeerConnection constraints:",a.rtcConstraints),a.rtcConstraints)I.optional.push(a.rtcConstraints[R]);"edge"===V.webRTCAdapter.browserDetails.browser&&(D.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(a.senderTransforms||a.receiverTransforms)&&(i.senderTransforms=a.senderTransforms,i.receiverTransforms=a.receiverTransforms,D.forceEncodedAudioInsertableStreams=!0,D.forceEncodedVideoInsertableStreams=!0,D.encodedInsertableStreams=!0),V.log("Creating PeerConnection"),V.debug(I),i.pc=new RTCPeerConnection(D,I),V.debug(i.pc),i.pc.getStats&&(i.volume={},i.bitrate.value="0 kbits/sec"),V.log("Preparing local SDP and gathering candidates (trickle="+i.trickle+")"),i.pc.oniceconnectionstatechange=function(e){i.pc&&o.iceState(i.pc.iceConnectionState)},i.pc.onicecandidate=function(t){if(!t.candidate||"edge"===V.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)V.log("End of candidates."),i.iceDone=!0,!0===i.trickle?x(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:V.noop,t.error="function"==typeof t.error?t.error:V.noop;var n=k[e];if(!n||!n.webrtcStuff)return void V.warn("Invalid handle, not sending anything");var a=n.webrtcStuff;if(V.log("Sending offer/answer SDP..."),!a.mySdp)return void V.warn("Local SDP instance is invalid, not sending anything...");a.mySdp={type:a.pc.localDescription.type,sdp:a.pc.localDescription.sdp},!1===a.trickle&&(a.mySdp.trickle=!1);V.debug(t),a.sdpSent=!0,t.success(a.mySdp)}(e,a);else{var n={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===i.trickle&&x(e,n)}},i.pc.ontrack=function(e){if(V.log("Handling Remote Track"),V.debug(e),e.streams&&(i.remoteStream=e.streams[0],o.onremotestream(i.remoteStream),!e.track.onended)){if(i.receiverTransforms){var t=null;RTCRtpSender.prototype.createEncodedStreams?t=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&i.receiverTransforms.audio?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&i.receiverTransforms.video&&(t=e.receiver.createEncodedVideoStreams())),t&&(console.log(t),t.readableStream&&t.writableStream?t.readableStream.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(t.writableStream):t.readable&&t.writable&&t.readable.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(t.writable))}var n=null;V.log("Adding onended callback to track:",e.track),e.track.onended=function(e){V.log("Remote track removed:",e),i.remoteStream&&(clearTimeout(n),i.remoteStream.removeTrack(e.target),o.onremotestream(i.remoteStream))},e.track.onmute=function(e){V.log("Remote track muted:",e),i.remoteStream&&null==n&&(n=setTimeout((function(){V.log("Removing remote track"),i.remoteStream&&(i.remoteStream.removeTrack(e.target),o.onremotestream(i.remoteStream)),n=null}),2520))},e.track.onunmute=function(e){if(V.log("Remote track flowing again:",e),null!=n)clearTimeout(n),n=null;else try{i.remoteStream.addTrack(e.target),o.onremotestream(i.remoteStream)}catch(t){V.error(t)}}}}}if(s&&r){V.log("Adding local stream");var _=!0===a.simulcast2;r.getTracks().forEach((function(e){V.log("Adding local track:",e);var t=null;if(_&&"audio"!==e.kind){V.log("Enabling rid-based simulcasting:",e);var n=b(a.simulcastMaxBitrates),o=i.pc.addTransceiver(e,{direction:"sendrecv",streams:[r],sendEncodings:a.sendEncodings||[{rid:"h",active:!0,maxBitrate:n.high},{rid:"m",active:!0,maxBitrate:n.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:n.low,scaleResolutionDownBy:4}]});o&&(t=o.sender)}else t=i.pc.addTrack(e,r);if(t&&i.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&i.senderTransforms.audio?s=t.createEncodedAudioStreams():"video"===t.track.kind&&i.senderTransforms.video&&(s=t.createEncodedVideoStreams())),s&&(console.log(s),s.readableStream&&s.writableStream?s.readableStream.pipeThrough(i.senderTransforms[t.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(i.senderTransforms[t.track.kind]).pipeTo(s.writable))}}))}(function(e){if(V.debug("isDataEnabled:",e),"edge"===V.webRTCAdapter.browserDetails.browser)return V.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(n)&&!i.dataChannel[V.dataChanDefaultLabel]&&(V.log("Creating default data channel"),A(e,V.dataChanDefaultLabel,null,!1),i.pc.ondatachannel=function(t){V.log("Data channel created by Janus:",t),A(e,t.channel.label,t.channel.protocol,t.channel)}),i.myStream&&o.onlocalstream(i.myStream),t?i.pc.setRemoteDescription(t).then((function(){if(V.log("Remote description accepted!"),i.remoteSdp=t.sdp,i.candidates&&i.candidates.length>0){for(var r=0;r<i.candidates.length;r++){var o=i.candidates[r];V.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(V.endOfCandidates)}i.candidates=[]}!function(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:V.noop,n.error="function"==typeof n.error?n.error:V.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:V.noop;var a=k[e];if(!a||!a.webrtcStuff)return V.warn("Invalid handle"),void n.error("Invalid handle");var r=a.webrtcStuff,o=!0===n.simulcast;o?V.log("Creating answer (iceDone="+r.iceDone+", simulcast="+o+")"):V.log("Creating answer (iceDone="+r.iceDone+")");var i=null;if(V.unifiedPlan){i={};var s=null,c=null,l=r.pc.getTransceivers();if(l&&l.length>0){var d=!0,u=!1,m=void 0;try{for(var f,p=l[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind?s||(s=h):(h.sender&&h.sender.track&&"video"===h.sender.track.kind||h.receiver&&h.receiver.track&&"video"===h.receiver.track.kind)&&(c||(c=h))}}catch(P){u=!0,m=P}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}}var g=J(t),v=q(t);if(g||v){if(g&&v){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",V.log("Setting audio transceiver to sendrecv:",s)}catch(O){V.error(O)}}else if(g&&!v)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",V.log("Setting audio transceiver to sendonly:",s))}catch(O){V.error(O)}else if(!g&&v)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",V.log("Setting audio transceiver to recvonly:",s)}catch(O){V.error(O)}else s=r.pc.addTransceiver("audio",{direction:"recvonly"}),V.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",V.log("Setting audio transceiver to inactive:",s)}catch(O){V.error(O)}var w=G(t),y=H(t);if(w||y){if(w&&y){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",V.log("Setting video transceiver to sendrecv:",c)}catch(O){V.error(O)}}else if(w&&!y){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",V.log("Setting video transceiver to sendonly:",c)}catch(O){V.error(O)}}else if(!w&&y)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",V.log("Setting video transceiver to recvonly:",c)}catch(O){V.error(O)}else c=r.pc.addTransceiver("video",{direction:"recvonly"}),V.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",V.log("Setting video transceiver to inactive:",c)}catch(O){V.error(O)}}else i="firefox"===V.webRTCAdapter.browserDetails.browser||"edge"===V.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:q(t),offerToReceiveVideo:H(t)}:{mandatory:{OfferToReceiveAudio:q(t),OfferToReceiveVideo:H(t)}};V.debug(i);var S=G(t);if(S&&o&&"firefox"===V.webRTCAdapter.browserDetails.browser){V.log("Enabling Simulcasting for Firefox (RID)");var C=r.pc.getSenders()[1];V.log(C);var E=C.getParameters();V.log(E);var j=b(n.simulcastMaxBitrates);C.setParameters({encodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:j.high},{rid:"m",active:!0,maxBitrate:j.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:j.low,scaleResolutionDownBy:4}]})}r.pc.createAnswer(i).then((function(e){V.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,V.log("Setting local description"),S&&o&&("chrome"===V.webRTCAdapter.browserDetails.browser?V.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==V.webRTCAdapter.browserDetails.browser&&V.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(n.error),r.mediaConstraints=i,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),n.success(e)):V.log("Waiting for all candidates...")}),n.error)}(e,n,a)}),a.error):function(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:V.noop,n.error="function"==typeof n.error?n.error:V.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:V.noop;var a=k[e];if(!a||!a.webrtcStuff)return V.warn("Invalid handle"),void n.error("Invalid handle");var r=a.webrtcStuff,o=!0===n.simulcast;o?V.log("Creating offer (iceDone="+r.iceDone+", simulcast="+o+")"):V.log("Creating offer (iceDone="+r.iceDone+")");var i={};if(V.unifiedPlan){var s=null,c=null,l=r.pc.getTransceivers();if(l&&l.length>0){var d=!0,u=!1,m=void 0;try{for(var f,p=l[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind?s||(s=h):(h.sender&&h.sender.track&&"video"===h.sender.track.kind||h.receiver&&h.receiver.track&&"video"===h.receiver.track.kind)&&(c||(c=h))}}catch(P){u=!0,m=P}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}}var g=J(t),v=q(t);g||v?g&&v?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",V.log("Setting audio transceiver to sendrecv:",s)):g&&!v?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",V.log("Setting audio transceiver to sendonly:",s)):!g&&v&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",V.log("Setting audio transceiver to recvonly:",s)):(s=r.pc.addTransceiver("audio",{direction:"recvonly"}),V.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",V.log("Setting audio transceiver to inactive:",s));var w=G(t),y=H(t);w||y?w&&y?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",V.log("Setting video transceiver to sendrecv:",c)):w&&!y?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",V.log("Setting video transceiver to sendonly:",c)):!w&&y&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",V.log("Setting video transceiver to recvonly:",c)):(c=r.pc.addTransceiver("video",{direction:"recvonly"}),V.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",V.log("Setting video transceiver to inactive:",c))}else i.offerToReceiveAudio=q(t),i.offerToReceiveVideo=H(t);!0===n.iceRestart&&(i.iceRestart=!0);V.debug(i);var S=G(t);if(S&&o&&"firefox"===V.webRTCAdapter.browserDetails.browser){V.log("Enabling Simulcasting for Firefox (RID)");var C=r.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(C){var E=C.getParameters();E||(E={});var j=b(n.simulcastMaxBitrates);E.encodings=n.sendEncodings||[{rid:"h",active:!0,maxBitrate:j.high},{rid:"m",active:!0,maxBitrate:j.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:j.low,scaleResolutionDownBy:4}],C.setParameters(E)}}r.pc.createOffer(i).then((function(e){V.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,V.log("Setting local description"),S&&o&&("chrome"===V.webRTCAdapter.browserDetails.browser||"safari"===V.webRTCAdapter.browserDetails.browser?(V.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),n=!1,a=[-1],r=[-1],o=null,i=null,s=null,c=null,l=-1,d=0;d<t.length;d++){if(m=t[d].match(/m=(\w+) */)){if("video"===m[1]){if(!(a[0]<0)){l=d;break}n=!0}else if(a[0]>-1){l=d;break}}else if(n){var u=t[d].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)a[0]=u[1],r[0]=u[2],t.splice(d,1),d--;else{if(a[0]){if((p=t[d].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(i=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" label:(.+)"))&&(c=p[1]),0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+a[0])){t.splice(d,1),d--;continue}}0!=t[d].length||(t.splice(d,1),d--)}}}if(a[0]<0){l=-1,n=!1;for(d=0;d<t.length;d++){var m;if(m=t[d].match(/m=(\w+) */)){if("video"===m[1]){if(!(a[0]<0)){l=d;break}n=!0}else if(a[0]>-1){l=d;break}}else if(n){if(a[0]<0){var f=t[d].match(/a=ssrc:(\d+)/);if(f){a[0]=f[1],t.splice(d,1),d--;continue}}else{var p;if((p=t[d].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(i=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" label:(.+)"))&&(c=p[1]),0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+a[0])){t.splice(d,1),d--;continue}}0!==t[d].length||(t.splice(d,1),d--)}}}if(a[0]<0)return V.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;l<0&&(l=t.length);a[1]=Math.floor(4294967295*Math.random()),a[2]=Math.floor(4294967295*Math.random()),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random());for(d=0;d<a.length;d++)o&&(t.splice(l,0,"a=ssrc:"+a[d]+" cname:"+o),l++),i&&(t.splice(l,0,"a=ssrc:"+a[d]+" msid:"+i),l++),s&&(t.splice(l,0,"a=ssrc:"+a[d]+" mslabel:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+a[d]+" label:"+c),l++),o&&(t.splice(l,0,"a=ssrc:"+r[d]+" cname:"+o),l++),i&&(t.splice(l,0,"a=ssrc:"+r[d]+" msid:"+i),l++),s&&(t.splice(l,0,"a=ssrc:"+r[d]+" mslabel:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+r[d]+" label:"+c),l++);t.splice(l,0,"a=ssrc-group:FID "+a[2]+" "+r[2]),t.splice(l,0,"a=ssrc-group:FID "+a[1]+" "+r[1]),t.splice(l,0,"a=ssrc-group:FID "+a[0]+" "+r[0]),t.splice(l,0,"a=ssrc-group:SIM "+a[0]+" "+a[1]+" "+a[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==V.webRTCAdapter.browserDetails.browser&&V.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp=e.sdp,r.pc.setLocalDescription(e).catch(n.error),r.mediaConstraints=i,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),n.success(e)):V.log("Waiting for all candidates...")}),n.error)}(e,n,a)}function U(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:V.noop,n.error="function"==typeof n.error?n.error:B;var a=n.jsep;if(t&&a)return V.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!t&&(!a||!a.type||!a.sdp))return V.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media="object"===typeof n.media&&n.media?n.media:{audio:!0,video:!0};var r=n.media,o=k[e];if(!o||!o.webrtcStuff)return V.warn("Invalid handle"),void n.error("Invalid handle");var i,s=o.webrtcStuff;if(s.trickle=(i=n.trickle,V.debug("isTrickleEnabled:",i),!1!==i),s.pc){if(V.log("Updating existing media session"),r.update=!0,n.stream)n.stream!==s.myStream&&V.log("Renegotiation involves a new external stream");else{if(r.addAudio){if(r.keepAudio=!1,r.replaceAudio=!1,r.removeAudio=!1,r.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return V.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else r.removeAudio?(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!1,r.audioSend=!1):r.replaceAudio&&(r.keepAudio=!1,r.addAudio=!1,r.removeAudio=!1,r.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!J(r)||r.removeAudio||r.replaceAudio||(r.keepAudio=!0):(r.replaceAudio&&(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!0,r.audioSend=!0),J(r)&&(r.keepAudio=!1,r.addAudio=!0)),r.addVideo){if(r.keepVideo=!1,r.replaceVideo=!1,r.removeVideo=!1,r.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return V.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else r.removeVideo?(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!1,r.videoSend=!1):r.replaceVideo&&(r.keepVideo=!1,r.addVideo=!1,r.removeVideo=!1,r.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!G(r)||r.removeVideo||r.replaceVideo||(r.keepVideo=!0):(r.replaceVideo&&(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!0,r.videoSend=!0),G(r)&&(r.keepVideo=!1,r.addVideo=!0)),r.addData&&(r.data=!0)}if(J(r)&&r.keepAudio&&G(r)&&r.keepVideo)return o.consentDialog(!1),void M(e,a,r,n,s.myStream)}else r.update=!1,r.keepAudio=!1,r.keepVideo=!1;if(r.update&&!s.streamExternal){if(r.removeAudio||r.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var c=s.myStream.getAudioTracks()[0];V.log("Removing audio track:",c),s.myStream.removeTrack(c);try{c.stop()}catch(F){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var l=!0;if(r.replaceAudio&&V.unifiedPlan&&(l=!1),l){var d=!0,u=!1,m=void 0;try{for(var f,p=s.pc.getSenders()[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;h&&h.track&&"audio"===h.track.kind&&(V.log("Removing audio sender:",h),s.pc.removeTrack(h))}}catch(W){u=!0,m=W}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}}}}if(r.removeVideo||r.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var g=s.myStream.getVideoTracks()[0];V.log("Removing video track:",g),s.myStream.removeTrack(g);try{g.stop()}catch(F){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var v=!0;if(r.replaceVideo&&V.unifiedPlan&&(v=!1),v){var b=!0,w=!1,y=void 0;try{for(var S,C=s.pc.getSenders()[Symbol.iterator]();!(b=(S=C.next()).done);b=!0){var E=S.value;E&&E.track&&"video"===E.track.kind&&(V.log("Removing video sender:",E),s.pc.removeTrack(E))}}catch(W){w=!0,y=W}finally{try{b||null==C.return||C.return()}finally{if(w)throw y}}}}}}if(n.stream){var j=n.stream;return V.log("MediaStream provided by the application"),V.debug(j),r.update&&s.myStream&&s.myStream!==n.stream&&!s.streamExternal&&(V.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,o.consentDialog(!1),void M(e,a,r,n,j)}if(J(r)||G(r)){if(!V.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var O={mandatory:{},optional:[]};o.consentDialog(!0);var T=J(r);T&&r&&"object"===typeof r.audio&&(T=r.audio);var D=G(r);if(D&&r){var I=!0===n.simulcast,x=!0===n.simulcast2;if(!I&&!x||a||r.video||(r.video="hires"),r.video&&"screen"!=r.video&&"window"!=r.video)if("object"===typeof r.video)D=r.video;else{var A=0,R=0;"lowres"===r.video?(R=240,240,A=320):"lowres-16:9"===r.video?(R=180,180,A=320):"hires"===r.video||"hires-16:9"===r.video||"hdres"===r.video?(R=720,720,A=1280):"fhdres"===r.video?(R=1080,1080,A=1920):"4kres"===r.video?(R=2160,2160,A=3840):"stdres"===r.video?(R=480,480,A=640):"stdres-16:9"===r.video?(R=360,360,A=640):(V.log("Default video setting is stdres 4:3"),R=480,480,A=640),V.log("Adding media constraint:",r.video),D={height:{ideal:R},width:{ideal:A}},V.log("Adding video constraint:",D)}else if("screen"===r.video||"window"===r.video){var _=function(t,i){o.consentDialog(!1),t?n.error(t):M(e,a,r,n,i)},P=function(e,t,n){V.log("Adding media constraint (screen capture)"),V.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){e.addTrack(n.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){o.consentDialog(!1),t(e)}))};if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return O.video={},r.screenshareFrameRate&&(O.video.frameRate=r.screenshareFrameRate),r.screenshareHeight&&(O.video.height=r.screenshareHeight),r.screenshareWidth&&(O.video.width=r.screenshareWidth),O.audio=r.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(O).then((function(t){o.consentDialog(!1),J(r)&&!r.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(o){t.addTrack(o.getAudioTracks()[0]),M(e,a,r,n,t)})):M(e,a,r,n,t)}),(function(e){o.consentDialog(!1),n.error(e)}));if("chrome"===V.webRTCAdapter.browserDetails.browser){var U=V.webRTCAdapter.browserDetails.version,L=33;window.navigator.userAgent.match("Linux")&&(L=35),U>=26&&U<=L?(O={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate,chromeMediaSource:"screen"}},audio:J(r)&&!r.keepAudio},P(O,_)):V.extension.getScreen((function(e,t){if(e)return o.consentDialog(!1),n.error(e);(O={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,P(O,_,J(r)&&!r.keepAudio)}))}else if("firefox"===V.webRTCAdapter.browserDetails.browser){if(!(V.webRTCAdapter.browserDetails.version>=33)){var N=new Error("NavigatorUserMediaError");return N.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void n.error(N)}O={video:{mozMediaSource:r.video,mediaSource:r.video},audio:J(r)&&!r.keepAudio},P(O,(function(e,t){if(_(e,t),!e)var n=t.currentTime,a=window.setInterval((function(){t||window.clearInterval(a),t.currentTime==n&&(window.clearInterval(a),t.onended&&t.onended()),n=t.currentTime}),500)}))}return}}r&&"screen"===r.video||navigator.mediaDevices.enumerateDevices().then((function(t){var i=t.some((function(e){return"audioinput"===e.kind})),s=function(e){if(V.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(r)||t.some((function(e){return"videoinput"===e.kind})),c=J(r),l=G(r),d=function(e){return V.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(r),u=function(e){return V.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(r);if(c||l||d||u){var m=!!c&&i,f=!!l&&s;if(!m&&!f)return o.consentDialog(!1),n.error("No capture device found"),!1;if(!m&&d)return o.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!f&&u)return o.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var p={audio:!(!i||r.keepAudio)&&T,video:!(!s||r.keepVideo)&&D};V.debug("getUserMedia constraints",p),p.audio||p.video?navigator.mediaDevices.getUserMedia(p).then((function(t){o.consentDialog(!1),M(e,a,r,n,t)})).catch((function(e){o.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})):(o.consentDialog(!1),M(e,a,r,n,j))})).catch((function(e){o.consentDialog(!1),n.error(e)}))}else M(e,a,r,n)}function L(e,t){(t=t||{}).success="function"==typeof t.success?t.success:V.noop,t.error="function"==typeof t.error?t.error:B;var n=t.jsep,a=k[e];if(!a||!a.webrtcStuff)return V.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff;if(n){if(!r.pc)return V.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");r.pc.setRemoteDescription(n).then((function(){if(V.log("Remote description accepted!"),r.remoteSdp=n.sdp,r.candidates&&r.candidates.length>0){for(var e=0;e<r.candidates.length;e++){var a=r.candidates[e];V.debug("Adding remote candidate:",a),a&&!0!==a.completed?r.pc.addIceCandidate(a):r.pc.addIceCandidate(V.endOfCandidates)}r.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function N(e,t){var n=k[e];if(!n||!n.webrtcStuff)return V.warn("Invalid handle"),0;var a=t?"remote":"local",r=n.webrtcStuff;return r.volume[a]||(r.volume[a]={value:0}),!r.pc.getStats||"chrome"!==V.webRTCAdapter.browserDetails.browser&&"safari"!==V.webRTCAdapter.browserDetails.browser?(V.warn("Getting the "+a+" volume unsupported by browser"),0):t&&!r.remoteStream?(V.warn("Remote stream unavailable"),0):t||r.myStream?r.volume[a].timer?r.volume[a].value:(V.log("Starting "+a+" volume monitor"),r.volume[a].timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(r.volume[a].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(V.warn("Local stream unavailable"),0)}function F(e,t){var n=k[e];if(!n||!n.webrtcStuff)return V.warn("Invalid handle"),!0;var a=n.webrtcStuff;return a.pc?a.myStream?t?a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!a.myStream.getVideoTracks()[0].enabled:(V.warn("No video track"),!0):a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!a.myStream.getAudioTracks()[0].enabled:(V.warn("No audio track"),!0):(V.warn("Invalid local MediaStream"),!0):(V.warn("Invalid PeerConnection"),!0)}function W(e,t,n){var a=k[e];if(!a||!a.webrtcStuff)return V.warn("Invalid handle"),!1;var r=a.webrtcStuff;return r.pc?r.myStream?t?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?(r.myStream.getVideoTracks()[0].enabled=!n,!0):(V.warn("No video track"),!1):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?(r.myStream.getAudioTracks()[0].enabled=!n,!0):(V.warn("No audio track"),!1):(V.warn("Invalid local MediaStream"),!1):(V.warn("Invalid PeerConnection"),!1)}function $(e){var t=k[e];if(!t||!t.webrtcStuff)return V.warn("Invalid handle"),"Invalid handle";var n=t.webrtcStuff;return n.pc?n.pc.getStats?n.bitrate.timer?n.bitrate.value:(V.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var a=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"===V.webRTCAdapter.browserDetails.browser&&(a/=1e3);var r=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/a);"safari"===V.webRTCAdapter.browserDetails.browser&&(r=parseInt(r/1e3)),n.bitrate.value=r+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(V.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function B(e){V.error("WebRTC error:",e)}function z(e,a){V.log("Cleaning WebRTC stuff");var r=k[e];if(r){var o=r.webrtcStuff;if(o){if(!0===a){var i={janus:"hangup",transaction:V.randomString(12)};r.token&&(i.token=r.token),h&&(i.apisecret=h),V.debug("Sending hangup request (handle="+e+"):"),V.debug(i),t?(i.session_id=y,i.handle_id=e,n.send(JSON.stringify(i))):V.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:i})}o.remoteStream=null,o.volume&&(o.volume.local&&o.volume.local.timer&&clearInterval(o.volume.local.timer),o.volume.remote&&o.volume.remote.timer&&clearInterval(o.volume.remote.timer)),o.volume={},o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null,!o.streamExternal&&o.myStream&&(V.log("Stopping local stream tracks"),V.stopAllTracks(o.myStream)),o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(c){}o.pc=null,o.candidates=null,o.mySdp=null,o.remoteSdp=null,o.iceDone=!1,o.dataChannel={},o.dtmfSender=null,o.senderTransforms=null,o.receiverTransforms=null}r.oncleanup()}}function J(e){return V.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function q(e){return V.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function G(e){return V.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function H(e){return V.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}D(e),this.getServer=function(){return s},this.isConnected=function(){return w},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:V.noop,e.error="function"==typeof e.error?e.error:V.noop,e.reconnect=!0,D(e)},this.getSessionId=function(){return y},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:V.noop,e.error="function"==typeof e.error?e.error:V.noop,V.log("Getting info on Janus instance"),!w)return V.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var a=V.randomString(12),r={janus:"info",transaction:a};p&&(r.token=p);h&&(r.apisecret=h);if(t)return E[a]=function(t){V.log("Server info:"),V.debug(t),"server_info"!==t.janus&&V.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},void n.send(JSON.stringify(r));V.httpAPICall(s,{verb:"POST",withCredentials:m,body:r,success:function(t){V.log("Server info:"),V.debug(t),"server_info"!==t.janus&&V.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,n){V.error(t+":",n),""===n?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}(e)},this.destroy=function(o){!function(o){(o=o||{}).success="function"==typeof o.success?o.success:V.noop,o.error="function"==typeof o.error?o.error:V.noop;var i=!0===o.unload,c=!0;void 0!==o.notifyDestroyed&&null!==o.notifyDestroyed&&(c=!0===o.notifyDestroyed);var l=!0===o.cleanupHandles;if(V.log("Destroying session "+y+" (unload="+i+")"),!y)return V.warn("No session to destroy"),o.success(),void(c&&e.destroyed());if(l)for(var d in k)P(d,{noRequest:!0});if(!w)return V.warn("Is the server down? (connected=false)"),y=null,void o.success();var u={janus:"destroy",transaction:V.randomString(12)};p&&(u.token=p);h&&(u.apisecret=h);if(i)return t?(n.onclose=null,n.close(),n=null):navigator.sendBeacon(s+"/"+y,JSON.stringify(u)),V.log("Destroyed session:"),y=null,w=!1,o.success(),void(c&&e.destroyed());if(t){u.session_id=y;var f=function(){for(var e in a)n.removeEventListener(e,a[e]);n.removeEventListener("message",g),n.removeEventListener("error",v),r&&clearTimeout(r),n.close()},g=function(t){var n=JSON.parse(t.data);n.session_id==u.session_id&&n.transaction==u.transaction&&(f(),o.success(),c&&e.destroyed())},v=function(t){f(),o.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return n.addEventListener("message",g),n.addEventListener("error",v),void(1===n.readyState?n.send(JSON.stringify(u)):v())}V.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:m,body:u,success:function(t){V.log("Destroyed session:"),V.debug(t),y=null,w=!1,"success"!==t.janus&&V.error("Ooops: "+t.error.code+" "+t.error.reason),o.success(),c&&e.destroyed()},error:function(t,n){V.error(t+":",n),y=null,w=!1,o.success(),c&&e.destroyed()}})}(o)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:V.noop,e.error="function"==typeof e.error?e.error:V.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:V.noop,e.iceState="function"==typeof e.iceState?e.iceState:V.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:V.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:V.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:V.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:V.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:V.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:V.noop,e.ondata="function"==typeof e.ondata?e.ondata:V.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:V.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:V.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:V.noop,!w)return V.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var a=e.plugin;if(!a)return V.error("Invalid plugin"),void e.error("Invalid plugin");var r=e.opaqueId,o=e.token?e.token:p,i=V.randomString(12),c={janus:"attach",plugin:a,opaque_id:r,transaction:i};o&&(c.token=o);h&&(c.apisecret=h);if(t)return E[i]=function(t){if(V.debug(t),"success"!==t.janus)return V.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var n=t.data.id;V.log("Created handle: "+n);var r={session:S,plugin:a,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return N(n,!0)},getRemoteVolume:function(){return N(n,!0)},getLocalVolume:function(){return N(n,!1)},isAudioMuted:function(){return F(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return F(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return $(n)},send:function(e){I(n,e)},data:function(e){R(n,e)},dtmf:function(e){_(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(n,!0,e)},createAnswer:function(e){U(n,!1,e)},handleRemoteJsep:function(e){L(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){z(n,!0===e)},detach:function(e){P(n,e)}};k[n]=r,e.success(r)},c.session_id=y,void n.send(JSON.stringify(c));V.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:m,body:c,success:function(t){if(V.debug(t),"success"!==t.janus)return V.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var n=t.data.id;V.log("Created handle: "+n);var r={session:S,plugin:a,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return N(n,!0)},getRemoteVolume:function(){return N(n,!0)},getLocalVolume:function(){return N(n,!1)},isAudioMuted:function(){return F(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return F(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return $(n)},send:function(e){I(n,e)},data:function(e){R(n,e)},dtmf:function(e){_(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(n,!0,e)},createAnswer:function(e){U(n,!1,e)},handleRemoteJsep:function(e){L(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){z(n,!0===e)},detach:function(e){P(n,e)}};k[n]=r,e.success(r)},error:function(t,n){V.error(t+":",n),""===n?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}(e)}}V.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,n=e&&e.Promise||Promise,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new a(e,t)},extension:e&&e.extension||M,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||_.a,httpAPICall:function(e,a){var r={method:a.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===a.verb&&(r.headers["Content-Type"]="application/json"),void 0!==a.withCredentials&&(r.credentials=!0===a.withCredentials?"include":a.withCredentials?a.withCredentials:"omit"),a.body&&(r.body=JSON.stringify(a.body));var o=t(e,r).catch((function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})}));if(a.timeout){var i=new n((function(e,t){var n=setTimeout((function(){return clearTimeout(n),t({message:"Request timed out",timeout:a.timeout})}),a.timeout)}));o=n.race([o,i])}return o.then((function(e){return e.ok?typeof a.success===typeof V.noop?e.json().then((function(e){a.success(e)})).catch((function(t){return n.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:n.reject({message:"API call failed",response:e})})).catch((function(e){typeof a.error===typeof V.noop&&a.error(e.message||"<< internal error >>",e)})),o}}},V.useOldDependencies=function(e){var t=e&&e.jQuery||R.a,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||M,webRTCAdapter:e&&e.adapter||_.a,httpAPICall:function(e,n){var a=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},r=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return t.ajax(t.extend(a,r,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){typeof n.success===typeof V.noop&&n.success(e)},error:function(e,t,a){typeof n.error===typeof V.noop&&n.error(t,a)}}))}}},V.noop=function(){},V.dataChanDefaultLabel="JanusDataChannel",V.endOfCandidates=null,V.stopAllTracks=function(e){try{var t=e.getTracks(),n=!0,a=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=o.value;V.log(s),s&&s.stop()}}catch(c){a=!0,r=c}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}}catch(l){}},V.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:V.noop,V.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),V.trace=V.noop,V.debug=V.noop,V.vdebug=V.noop,V.log=V.noop,V.warn=V.noop,V.error=V.noop,!0===e.debug||"all"===e.debug)V.trace=console.trace.bind(console),V.debug=console.debug.bind(console),V.vdebug=console.debug.bind(console),V.log=console.log.bind(console),V.warn=console.warn.bind(console),V.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t=!0,n=!1,a=void 0;try{for(var r,o=e.debug[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;switch(i){case"trace":V.trace=console.trace.bind(console);break;case"debug":V.debug=console.debug.bind(console);break;case"vdebug":V.vdebug=console.debug.bind(console);break;case"log":V.log=console.log.bind(console);break;case"warn":V.warn=console.warn.bind(console);break;case"error":V.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+i+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(b){n=!0,a=b}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}V.log("Initializing library");var s=e.dependencies||V.useDefaultDependencies();V.isArray=s.isArray,V.webRTCAdapter=s.webRTCAdapter,V.httpAPICall=s.httpAPICall,V.newWebSocket=s.newWebSocket,V.extension=s.extension,V.extension.init(),V.listDevices=function(e,t){e="function"==typeof e?e:V.noop,null==t&&(t={audio:!0,video:!0}),V.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){V.debug(n),e(n),V.stopAllTracks(t)}))})).catch((function(t){V.error(t),e([])})):(V.warn("navigator.mediaDevices unavailable"),e([]))},V.attachMediaStream=function(e,t){try{e.srcObject=t}catch(n){try{e.src=URL.createObjectURL(t)}catch(n){V.error("Error attaching stream to element")}}},V.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(n){try{e.src=t.src}catch(n){V.error("Error reattaching stream to element")}}};var c=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",l=window["on"+c];if(window.addEventListener(c,(function(e){for(var t in V.log("Closing window"),V.sessions)V.sessions[t]&&V.sessions[t].destroyOnUnload&&(V.log("Destroying session "+t),V.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));l&&"function"==typeof l&&l()})),V.safariVp8=!1,"safari"===V.webRTCAdapter.browserDetails.browser&&V.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var d=!0,u=!1,m=void 0;try{for(var f,p=RTCRtpSender.getCapabilities("video").codecs[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;if(h&&h.mimeType&&"video/vp8"===h.mimeType.toLowerCase()){V.safariVp8=!0;break}}}catch(b){u=!0,m=b}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}V.safariVp8?V.log("This version of Safari supports VP8"):V.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var g=new RTCPeerConnection({});g.createOffer({offerToReceiveVideo:!0}).then((function(e){V.safariVp8=-1!==e.sdp.indexOf("VP8"),V.safariVp8?V.log("This version of Safari supports VP8"):V.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),g.close(),g=null}))}if(V.unifiedPlan=!1,"firefox"===V.webRTCAdapter.browserDetails.browser&&V.webRTCAdapter.browserDetails.version>=59)V.unifiedPlan=!0;else if("chrome"===V.webRTCAdapter.browserDetails.browser&&V.webRTCAdapter.browserDetails.version>=72)V.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in P.prototype){var v=new RTCPeerConnection;try{v.addTransceiver("audio"),V.unifiedPlan=!0}catch(w){}v.close()}else V.unifiedPlan=!1;V.initDone=!0,e.callback()}},V.isWebrtcSupported=function(){return!!window.RTCPeerConnection},V.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},V.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",a=0;a<e;a++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n};var U,L=V,N=n(7),F=(U={home:"\u062e\u0627\u0646\u0647",name:"\u0646\u0627\u0645 \u0648 \u0646\u0627\u0645 \u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc ",login:"\u0648\u0631\u0648\u062f",username:"\u0646\u0627\u0645 \u06a9\u0627\u0631\u0628\u0631\u06cc ",password:"\u0631\u0645\u0632 \u0639\u0628\u0648\u0631 ",password_confirmation:"\u062a\u06a9\u0631\u0627\u0631 \u0631\u0645\u0632 \u0639\u0628\u0648\u0631",mobile:"\u0634\u0645\u0627\u0631\u0647 \u0645\u0648\u0628\u0627\u06cc\u0644 ",error:"\u062e\u0637\u0627",sign_in:"\u0648\u0631\u0648\u062f ",sign_up:"\u062b\u0628\u062a \u0646\u0627\u0645",back:"\u0628\u0627\u0632\u06af\u0634\u062a",signed_up_already:"\u062a\u0627 \u06a9\u0646\u0648\u0646 \u062b\u0628\u062a \u0646\u0627\u0645 \u0646\u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f\u061f",new_advert:"\u062f\u0631\u062c \u0622\u06af\u0647\u06cc ",title:"\u0639\u0646\u0648\u0627\u0646",abstract:"\u0686\u06a9\u06cc\u062f\u0647",content:"\u0645\u062a\u0646",submit:"\u062b\u0628\u062a ",upload_from_gallery:"\u0627\u0646\u062a\u062e\u0627\u0628 \u0627\u0632 \u06af\u0627\u0644\u0631\u06cc",welcome:"\u062e\u0648\u0634 \u0622\u0645\u062f\u06cc\u062f",sign_out:"\u062e\u0631\u0648\u062c",phone_number:"\u0634\u0645\u0627\u0631\u0647 \u062a\u0644\u0641\u0646",telegram_channel:"\u06a9\u0627\u0646\u0627\u0644 \u062a\u0644\u06af\u0631\u0627\u0645",instagram_page:"\u0635\u0641\u062d\u0647 \u0627\u06cc\u0646\u0633\u062a\u0627\u06af\u0631\u0627\u0645",address:"\u0622\u062f\u0631\u0633 ",email:"\u0627\u06cc\u0645\u06cc\u0644 ",contact_information:"\u0627\u0637\u0644\u0627\u0639\u0627\u062a \u062a\u0645\u0627\u0633 ",search:"\u062c\u0633\u062a\u062c\u0648 ",cancel:"\u0627\u0646\u0635\u0631\u0627\u0641",view:"\u0646\u0645\u0627\u06cc\u0634",edit:"\u0648\u06cc\u0631\u0627\u06cc\u0634",delete:"\u062d\u0630\u0641",adverts_nes:"\u0639\u0646\u0648\u0627\u0646\u060c \u0645\u062a\u0646 \u0648 \u0634\u0645\u0627\u0631\u0647 \u062a\u0644\u0641\u0646 \u0627\u062c\u0628\u0627\u0631\u06cc \u0627\u0633\u062a",my_pins:" \u0646\u0634\u0627\u0646 \u0634\u062f\u0647\u200c\u0647\u0627 ",pin:"\u0646\u0634\u0627\u0646 \u06a9\u0646",pinned:"\u0646\u0634\u0627\u0646 \u0634\u062f\u0647",message_to_seller:"\u0627\u0631\u0633\u0627\u0644 \u067e\u06cc\u0627\u0645",messages:"\u067e\u06cc\u0627\u0645 \u0647\u0627 ",send_message:"\u067e\u06cc\u0627\u0645 \u062e\u0648\u062f \u0631\u0627 \u0628\u0646\u0648\u06cc\u0633\u06cc\u062f",province:"\u0627\u0633\u062a\u0627\u0646",city:"\u0634\u0647\u0631",website:"\u0648\u0628\u0633\u0627\u06cc\u062a",call:"\u062a\u0645\u0627\u0633 \u0628\u06af\u06cc\u0631\u06cc\u062f",ago:" \u0642\u0628\u0644",all_above:"\u0647\u0645\u0647 \u06cc \u0645\u0648\u0627\u0631\u062f \u0641\u0648\u0642",no_result:"\u0645\u0648\u0631\u062f\u06cc \u06cc\u0627\u0641\u062a \u0646\u0634\u062f ",category:"\u062f\u0633\u062a\u0647 \u0628\u0646\u062f\u06cc ",leg:"\u0645\u0633\u06cc\u0631",date:"\u062a\u0627\u0631\u06cc\u062e",time:"\u0632\u0645\u0627\u0646",numberOfPassngers:"\u062a\u0639\u062f\u0627\u062f \u0645\u0633\u0627\u0641\u0631\u0627\u0646 ",surename:"\u0646\u0627\u0645 \u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc",fathername:"\u0646\u0627\u0645 \u067e\u062f\u0631",ssn:"\u06a9\u062f\u0645\u0644\u06cc",birthplace:"\u0645\u062d\u0644 \u062a\u0648\u0644\u062f",pass_no:"\u0634\u0645\u0627\u0631\u0647 \u06af\u0630\u0631\u0646\u0627\u0645\u0647",birthdate:"\u062a\u0627\u0631\u06cc\u062e \u062a\u0648\u0644\u062f",place_of_birth:"\u0645\u062d\u0644 \u062a\u0648\u0644\u062f",required_fields:"\u0641\u06cc\u0644\u062f\u0647\u0627\u06cc \u0627\u062c\u0628\u0627\u0631\u06cc",en_father_name:"\u0646\u0627\u0645 \u067e\u062f\u0631 \u0644\u0627\u062a\u06cc\u0646",en_name:"\u0646\u0627\u0645 \u0644\u0627\u062a\u06cc\u0646",en_surename:"\u0646\u0627\u0645 \u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc \u0644\u0627\u062a\u06cc\u0646 ",passport_no:"\u0634\u0645\u0627\u0631\u0647 \u06af\u0630\u0631\u0646\u0627\u0645\u0647",final_confirm:"\u062a\u0627\u06cc\u06cc\u062f \u0646\u0647\u0627\u06cc\u06cc ",document_form:"\u0641\u0631\u0645 \u0627\u0633\u0646\u0627\u062f ",save:"\u0630\u062e\u06cc\u0631\u0647",documents:"\u0627\u0633\u0646\u0627\u062f ",type:"\u0646\u0648\u0639",string:"\u0645\u062a\u0646 \u06a9\u0648\u062a\u0627\u0647",text:"\u0645\u062a\u0646 \u0628\u0644\u0646\u062f",select:"\u06af\u0632\u06cc\u0646\u0647",multiSelect:"\u0686\u0646\u062f \u06af\u0632\u06cc\u0646\u0647",table:"\u062c\u062f\u0648\u0644"},Object(N.a)(U,"date","\u062a\u0627\u0631\u06cc\u062e"),Object(N.a)(U,"refundable","\u0642\u0627\u0628\u0644 \u0627\u0639\u0627\u062f\u0647"),Object(N.a)(U,"yes","\u0628\u0644\u0647"),Object(N.a)(U,"no","\u062e\u06cc\u0631"),Object(N.a)(U,"commentable","\u0642\u0627\u0628\u0644 \u0646\u0638\u0631\u062f\u0647\u06cc"),Object(N.a)(U,"end_point","\u0646\u0642\u0637\u0647 \u067e\u0627\u06cc\u0627\u0646"),Object(N.a)(U,"start_point","\u0646\u0642\u0637\u0647 \u0634\u0631\u0648\u0639"),Object(N.a)(U,"votable","\u0631\u0627\u06cc \u06af\u06cc\u0631\u06cc"),Object(N.a)(U,"publishable","\u0642\u0627\u0628\u0644 \u0627\u0646\u062a\u0634\u0627\u0631"),Object(N.a)(U,"field_name","\u0646\u0627\u0645 \u0641\u06cc\u0644\u062f"),Object(N.a)(U,"add","\u0627\u0641\u0632\u0648\u062f\u0646 "),Object(N.a)(U,"remove","\u062d\u0630\u0641"),Object(N.a)(U,"auxiliary_tables","\u062c\u062f\u0627\u0648\u0644 \u06a9\u0645\u06a9\u06cc"),Object(N.a)(U,"create_by","\u0627\u06cc\u062c\u0627\u062f \u0634\u062f\u0647 \u062a\u0648\u0633\u0637"),Object(N.a)(U,"list","\u0644\u06cc\u0633\u062a"),Object(N.a)(U,"workflows","\u06af\u0631\u062f\u0634 \u06a9\u0627\u0631\u0647\u0627"),Object(N.a)(U,"auxiliary_records","\u0645\u0642\u0627\u062f\u06cc\u0631 \u06a9\u0645\u06a9\u06cc"),Object(N.a)(U,"basic_table","\u062c\u062f\u0648\u0644 \u067e\u0627\u06cc\u0647"),Object(N.a)(U,"relation_table","\u062c\u062f\u0648\u0644 \u0631\u0627\u0628\u0637\u0647"),Object(N.a)(U,"auxiliary_table_form","\u0641\u0631\u0645 \u062c\u062f\u0648\u0644 \u06a9\u0645\u06a9\u06cc "),Object(N.a)(U,"Basic","\u067e\u0627\u06cc\u0647"),Object(N.a)(U,"Relation","\u0631\u0627\u0628\u0637\u0647 "),Object(N.a)(U,"Divan","\u062f\u06cc\u0648\u0627\u0646"),Object(N.a)(U,"workflow_form","\u0641\u0631\u0645 \u06af\u0631\u062f\u0634 \u06a9\u0627\u0631"),Object(N.a)(U,"submitting","\u062f\u0631 \u062d\u0627\u0644 \u0627\u0631\u0633\u0627\u0644 ... "),Object(N.a)(U,"settings","\u062a\u0646\u0638\u06cc\u0645\u0627\u062a"),Object(N.a)(U,"receiving","\u062f\u0631 \u062d\u0627\u0644 \u062f\u0631\u06cc\u0627\u0641\u062a ..."),Object(N.a)(U,"workflow_tables","\u062c\u062f\u0627\u0648\u0644 \u06a9\u0645\u06a9\u06cc \u06af\u0631\u062f\u0634 \u06a9\u0627\u0631 "),Object(N.a)(U,"auxiliary_table","\u062c\u062f\u0648\u0644 \u06a9\u0645\u06a9\u06cc"),Object(N.a)(U,"workflow","\u06af\u0631\u062f\u0634 \u06a9\u0627\u0631"),Object(N.a)(U,"actions","\u0639\u0645\u0644\u06cc\u0627\u062a"),Object(N.a)(U,"roles","\u0646\u0642\u0634 \u0647\u0627"),Object(N.a)(U,"divan","\u062f\u06cc\u0648\u0627\u0646"),Object(N.a)(U,"enter_your_email","\u0627\u06cc\u0645\u06cc\u0644 \u062e\u0648\u062f \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f"),Object(N.a)(U,"enter_your_password","\u0631\u0645\u0632 \u0639\u0628\u0648\u0631 \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f "),Object(N.a)(U,"enter_your_password_confirmation","\u0631\u0645\u0632 \u0639\u0628\u0648\u0631 \u0631\u0627 \u062a\u06a9\u0631\u0627\u0631 \u06a9\u0646\u06cc\u062f "),Object(N.a)(U,"profiles","\u0627\u0641\u0631\u0627\u062f "),Object(N.a)(U,"firstname","\u0646\u0627\u0645"),Object(N.a)(U,"if_registered","\u0627\u06af\u0631 \u0642\u0628\u0644\u0627 \u062b\u0628\u062a \u0646\u0627\u0645 \u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f"),Object(N.a)(U,"you_can_login","\u0627\u06af\u0631 \u0642\u0628\u0644\u0627 \u062b\u0628\u062a \u0646\u0627\u0645 \u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f\u060c \u0648\u0627\u0631\u062f \u0634\u0648\u06cc\u062f"),Object(N.a)(U,"if_not_registered","\u0627\u06af\u0631 \u062b\u0628\u062a \u0646\u0627\u0645 \u0646\u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f"),Object(N.a)(U,"you_can_sign_up","\u0686\u0646\u0627\u0646\u0686\u0647 \u062b\u0628\u062a \u0646\u0627\u0645 \u0646\u06a9\u0631\u062f\u0647 \u0627\u06cc\u062f\u060c \u0627\u06cc\u0646\u062c\u0627 \u06a9\u0644\u06cc\u06a9 \u06a9\u0646\u06cc\u062f."),Object(N.a)(U,"new_assignment","\u0627\u0639\u0637\u0627\u06cc \u0646\u0642\u0634 \u062c\u062f\u06cc\u062f"),Object(N.a)(U,"posts","\u067e\u0633\u062a \u0647\u0627"),Object(N.a)(U,"bookmark","\u0646\u0634\u0627\u0646"),Object(N.a)(U,"like","\u0639\u0644\u0627\u0642\u0647"),Object(N.a)(U,"follow","\u062f\u0646\u0628\u0627\u0644"),Object(N.a)(U,"share","\u0627\u0634\u062a\u0631\u0627\u06a9"),Object(N.a)(U,"social_acts","\u0639\u0645\u0644\u06af\u0631\u0647\u0627\u06cc \u0627\u062c\u062a\u0645\u0627\u0639\u06cc "),Object(N.a)(U,"channels","\u06a9\u0627\u0646\u0627\u0644 \u0647\u0627"),Object(N.a)(U,"close","\u0628\u0633\u062a\u0646"),Object(N.a)(U,"channel","\u06a9\u0627\u0646\u0627\u0644 "),Object(N.a)(U,"details","\u0634\u0631\u062d"),Object(N.a)(U,"Shoa","\u0634\u0639\u0627\u0639 "),Object(N.a)(U,"role","\u0646\u0642\u0634"),Object(N.a)(U,"Default","\u067e\u06cc\u0634 \u0641\u0631\u0636"),Object(N.a)(U,"NonDefault","\u063a\u06cc\u0631 \u067e\u06cc\u0634 \u0641\u0631\u0636 "),Object(N.a)(U,"value"," \u0645\u0642\u062f\u0627\u0631"),Object(N.a)(U,"true","\u0645\u062b\u0628\u062a"),Object(N.a)(U,"false","\u0645\u0646\u0641\u06cc"),Object(N.a)(U,"access_control_list","\u0644\u06cc\u0633\u062a \u06a9\u0646\u062a\u0631\u0644 \u062f\u0633\u062a\u0631\u0633\u06cc"),Object(N.a)(U,"access_control_form","\u0641\u0631\u0645 \u06a9\u0646\u062a\u0631\u0644 \u062f\u0633\u062a\u0631\u0633\u06cc"),Object(N.a)(U,"assignment_form","\u0641\u0631\u0645 \u0627\u0639\u0637\u0627\u06cc \u0646\u0642\u0634"),Object(N.a)(U,"comment_form","\u0646\u0638\u0631 \u0628\u062f\u0647\u06cc\u062f"),Object(N.a)(U,"post_form","\u0641\u0631\u0645 \u067e\u0633\u062a"),Object(N.a)(U,"metas","\u067e\u06cc\u0634 \u062c\u062f\u0627\u0648\u0644"),Object(N.a)(U,"shoa","\u0634\u0639\u0627\u0639"),Object(N.a)(U,"form","\u0648\u0631\u0648\u062f \u0627\u0637\u0644\u0627\u0639\u0627\u062a"),Object(N.a)(U,"choose_image","\u0627\u0646\u062a\u062e\u0627\u0628 \u0639\u06a9\u0633"),Object(N.a)(U,"logout","\u062e\u0631\u0648\u062c"),Object(N.a)(U,"more","\u0628\u06cc\u0634\u062a\u0631 ..."),Object(N.a)(U,"social","\u0627\u062c\u062a\u0645\u0627\u0639\u06cc"),Object(N.a)(U,"courses","\u062f\u0631\u0648\u0633"),Object(N.a)(U,"discussions","\u06af\u0641\u062a\u06af\u0648 \u0647\u0627"),Object(N.a)(U,"exams","\u0622\u0632\u0645\u0648\u0646 \u0647\u0627 "),Object(N.a)(U,"public","\u0639\u0645\u0648\u0645\u06cc"),Object(N.a)(U,"private","\u062e\u0635\u0648\u0635\u06cc "),Object(N.a)(U,"course_type","\u0646\u0648\u0639 \u062f\u0631\u0633"),Object(N.a)(U,"select_appropriate_title","\u0639\u0646\u0648\u0627\u0646\u06cc \u0645\u0646\u0627\u0633\u0628 \u0627\u0646\u062a\u062e\u0627\u0628 \u06a9\u0646\u06cc\u062f"),Object(N.a)(U,"write_appropriate_description","\u0634\u0631\u062d\u06cc \u0627\u0632 \u0627\u0647\u062f\u0627\u0641 \u0648 \u0631\u0648\u0634 \u0647\u0627 \u0628\u0646\u0648\u06cc\u0633\u06cc\u062f"),Object(N.a)(U,"description","\u0634\u0631\u062d "),Object(N.a)(U,"drag_or_browse","\u0641\u0627\u06cc\u0644 \u0645\u0648\u0631\u062f \u0646\u0638\u0631 \u0631\u0627 \u0627\u06cc\u0646\u062c\u0627 \u0628\u06cc\u0627\u0646\u062f\u0627\u0632\u06cc\u062f \u06cc\u0627 \u06a9\u0644\u06cc\u06a9 \u06a9\u0646\u06cc\u062f"),Object(N.a)(U,"attachment","\u0641\u0627\u06cc\u0644 \u0647\u0627\u06cc \u067e\u06cc\u0648\u0633\u062a"),Object(N.a)(U,"tasks","\u0648\u0638\u0627\u06cc\u0641"),Object(N.a)(U,"start_date","\u062a\u0627\u0631\u06cc\u062e \u0634\u0631\u0648\u0639"),Object(N.a)(U,"deadline","\u0645\u0647\u0644\u062a \u0646\u0647\u0627\u06cc\u06cc"),Object(N.a)(U,"select_a_date","\u06cc\u06a9 \u062a\u0627\u0631\u06cc\u062e \u0627\u0646\u062a\u062e\u0627\u0628 \u06a9\u0646\u06cc\u062f"),Object(N.a)(U,"incomplete_data","\u0647\u0645\u0647 \u06cc \u0645\u0648\u0627\u0631\u062f \u0631\u0627 \u062a\u06a9\u0645\u06cc\u0644 \u06a9\u0646\u06cc\u062f"),Object(N.a)(U,"alert","\u0647\u0634\u062f\u0627\u0631"),Object(N.a)(U,"deadline_time","\u0633\u0627\u0639\u062a"),Object(N.a)(U,"start_time","\u0633\u0627\u0639\u062a"),Object(N.a)(U,"select_a_time","\u0627\u0646\u062a\u062e\u0627\u0628 \u0633\u0627\u0639\u062a"),Object(N.a)(U,"coworkers","\u0647\u0645\u06a9\u0627\u0631\u0627\u0646"),Object(N.a)(U,"works","\u06a9\u0627\u0631\u0647\u0627 "),Object(N.a)(U,"dashboard","\u0645\u06cc\u0632\u06a9\u0627\u0631"),Object(N.a)(U,"tavan","\u062a\u0648\u0627\u0646"),Object(N.a)(U,"statuses","\u0648\u0636\u0639\u06cc\u062a \u0647\u0627"),Object(N.a)(U,"status","\u0648\u0636\u0639\u06cc\u062a"),Object(N.a)(U,"add_stauts","\u062a\u063a\u06cc\u06cc\u0631 \u0648\u0636\u0639\u06cc\u062a"),Object(N.a)(U,"select","\u0627\u0646\u062a\u062e\u0627\u0628"),Object(N.a)(U,"new","\u062c\u062f\u06cc\u062f"),Object(N.a)(U,"task","\u0648\u0638\u06cc\u0641\u0647"),Object(N.a)(U,"attachments","\u067e\u06cc\u0648\u0633\u062a \u0647\u0627"),Object(N.a)(U,"reports","\u0627\u0633\u0646\u0627\u062f \u0648 \u06af\u0632\u0627\u0631\u0634\u0627\u062a"),Object(N.a)(U,"tags","\u0628\u0631\u0686\u0633\u0628 \u0647\u0627"),Object(N.a)(U,"new_tag","\u0628\u0631\u0686\u0633\u0628 \u062c\u062f\u06cc\u062f "),Object(N.a)(U,"recent_tasks","\u0648\u0638\u0627\u06cc\u0641 \u0627\u062e\u06cc\u0631"),Object(N.a)(U,"public_tasks","\u0648\u0638\u0627\u06cc\u0641 \u0639\u0645\u0648\u0645\u06cc"),Object(N.a)(U,"sort_by","\u0645\u0631\u062a\u0628 \u0633\u0627\u0632\u06cc"),Object(N.a)(U,"by_title","\u0639\u0646\u0648\u0627\u0646"),Object(N.a)(U,"by_events","\u0631\u062e\u062f\u0627\u062f"),Object(N.a)(U,"deadline_near","\u0645\u0647\u0644\u062a \u0646\u0647\u0627\u06cc\u06cc \u0646\u0632\u062f\u06cc\u06a9"),Object(N.a)(U,"new_report","\u06af\u0632\u0627\u0631\u0634 \u062c\u062f\u06cc\u062f"),Object(N.a)(U,"new_comments","\u06af\u0641\u062a\u06af\u0648\u06cc \u062c\u062f\u06cc\u062f"),Object(N.a)(U,"Admin","\u0645\u062f\u06cc\u0631"),Object(N.a)(U,"Colleague","\u0647\u0645\u06a9\u0627\u0631"),Object(N.a)(U,"Observer","\u0646\u0627\u0638\u0631"),Object(N.a)(U,"Creator","\u0633\u0627\u0632\u0646\u062f\u0647"),Object(N.a)(U,"verification_code","\u06a9\u062f \u0627\u062d\u0631\u0627\u0632"),Object(N.a)(U,"enter_verification_code","\u06a9\u062f \u0627\u062d\u0631\u0627\u0632 \u0631\u0627 \u0648\u0627\u0631\u062f \u06a9\u0646\u06cc\u062f"),Object(N.a)(U,"your_tasks","\u0648\u0638\u0627\u06cc\u0641 \u0645\u0631\u062a\u0628\u0637 \u0628\u0627 \u0634\u0645\u0627"),Object(N.a)(U,"your_newest_works","\u062c\u062f\u06cc\u062f\u062a\u0631\u06cc\u0646 \u06a9\u0627\u0631\u0647\u0627\u06cc \u0645\u0631\u062a\u0628\u0637 \u0628\u0627 \u0634\u0645\u0627"),Object(N.a)(U,"todo_list","\u062a\u0642\u0633\u06cc\u0645 \u0628\u0646\u062f\u06cc \u06a9\u0627\u0631"),Object(N.a)(U,"todo_participants","\u0627\u0641\u0631\u0627\u062f"),Object(N.a)(U,"new_todo_participants","\u0627\u0641\u0631\u0627\u062f \u062c\u062f\u06cc\u062f"),Object(N.a)(U,"not_found","\u0686\u06cc\u0632\u06cc \u06cc\u0627\u0641\u062a \u0646\u0634\u062f"),Object(N.a)(U,"are_you_sure","\u0645\u0637\u0645\u0626\u0646 \u0647\u0633\u062a\u06cc\u062f\u061f"),Object(N.a)(U,"Confirmer","\u062a\u0627\u06cc\u06cc\u062f \u06a9\u0646\u0646\u062f\u0647"),Object(N.a)(U,"time_sheets","\u06a9\u0627\u0631\u0646\u0645\u0627"),Object(N.a)(U,"morning_report","\u06af\u0632\u0627\u0631\u0634 \u067e\u06cc\u0634 \u0627\u0632 \u0638\u0647\u0631"),Object(N.a)(U,"afternoon_report","\u06af\u0632\u0627\u0631\u0634 \u0628\u0639\u062f \u0627\u0632 \u0638\u0647\u0631"),Object(N.a)(U,"extra_report","\u06af\u0632\u0627\u0631\u0634 \u0627\u0636\u0627\u0641\u0647 \u06a9\u0627\u0631\u06cc"),Object(N.a)(U,"write_appropriate_details","\u0634\u0631\u062d\u06cc \u06a9\u0627\u0645\u0644 \u0628\u0646\u0648\u06cc\u0633\u06cc\u062f"),Object(N.a)(U,"associations","\u0645\u0631\u062a\u0628\u0637 \u0628\u0627"),Object(N.a)(U,"sheet_date","\u062a\u0627\u0631\u06cc\u062e \u062c\u062f\u0648\u0644"),Object(N.a)(U,"recipients","\u062f\u0631\u06cc\u0627\u0641\u062a \u06a9\u0646\u0646\u062f\u06af\u0627\u0646"),Object(N.a)(U,"sent_by_me","\u0627\u0631\u0633\u0627\u0644 \u0634\u062f\u0647 \u0647\u0627"),Object(N.a)(U,"sent_to_me","\u062f\u0631\u06cc\u0627\u0641\u062a \u0634\u062f\u0647 \u0647\u0627"),Object(N.a)(U,"priority","\u0644\u0648\u0644\u0648\u06cc\u062a"),Object(N.a)(U,"normal","\u0639\u0627\u062f\u06cc"),Object(N.a)(U,"high","\u0641\u0648\u0631\u06cc"),Object(N.a)(U,"urgent","\u0628\u0633\u06cc\u0627\u0631 \u0641\u0648\u0631\u06cc"),Object(N.a)(U,"archived","\u0622\u0631\u0634\u06cc\u0648 \u0634\u062f\u0647"),Object(N.a)(U,"write_archive_note","\u0645\u062a\u0646 \u062c\u0645\u0639 \u0628\u0646\u062f\u06cc \u0628\u0647 \u0645\u0646\u0638\u0648\u0631 \u0622\u0631\u0634\u06cc\u0648 \u0633\u0627\u0632\u06cc \u0628\u0646\u0648\u06cc\u0633\u06cc\u062f"),Object(N.a)(U,"user_groups","\u06af\u0631\u0648\u0647 \u0628\u0646\u062f\u06cc \u06a9\u0627\u0631\u0628\u0631\u0627\u0646"),Object(N.a)(U,"user_settings","\u062a\u0646\u0638\u06cc\u0645\u0627\u062a \u0634\u062e\u0635\u06cc"),Object(N.a)(U,"add_involvement_to_tasks","\u0627\u0641\u0632\u0648\u062f\u0646 \u0647\u0645\u06a9\u0627\u0631\u0627\u0646 \u0628\u0647 \u0648\u0638\u0627\u06cc\u0641"),Object(N.a)(U,"remove_involvement_from_tasks","\u062d\u0630\u0641 \u0647\u0645\u06a9\u0627\u0631\u0627\u0646 \u0627\u0632 \u0648\u0638\u0627\u06cc\u0641"),Object(N.a)(U,"change_status_tasks","\u062a\u063a\u06cc\u06cc\u0631 \u0648\u0636\u0639\u06cc\u062a \u0648\u0638\u0627\u06cc\u0641"),Object(N.a)(U,"add_works_to_tasks","\u0627\u0641\u0632\u0648\u062f\u0646 \u06a9\u0627\u0631 \u0628\u0647 \u0648\u0638\u0627\u06cc\u0641"),Object(N.a)(U,"add_reports_to_tasks","\u0627\u0641\u0632\u0648\u062f\u0646 \u06af\u0632\u0627\u0631\u0634 \u0628\u0647 \u0648\u0638\u0627\u06cc\u0641"),Object(N.a)(U,"add_comments_to_tasks","\u0627\u0641\u0632\u0648\u062f\u0646 \u0646\u0638\u0631 \u0628\u0647 \u0648\u0638\u0627\u06cc\u0641"),Object(N.a)(U,"add_involvement_to_works","\u0627\u0641\u0632\u0648\u062f\u0646 \u0647\u0645\u06a9\u0627\u0631\u0627\u0646 \u0628\u0647 \u06a9\u0627\u0631\u0647\u0627"),Object(N.a)(U,"remove_involvement_from_works","\u062d\u0630\u0641 \u0647\u0645\u06a9\u0627\u0631\u0627\u0646 \u0627\u0632 \u06a9\u0627\u0631\u0647\u0627"),Object(N.a)(U,"change_status_works","\u062a\u063a\u06cc\u06cc\u0631 \u0648\u0636\u0639\u06cc\u062a \u06a9\u0627\u0631\u0647\u0627"),Object(N.a)(U,"add_todos_to_works","\u0627\u0641\u0632\u0648\u062f\u0646 \u062a\u0642\u0633\u06cc\u0645 \u06a9\u0627\u0631 \u0628\u0647 \u06a9\u0627\u0631\u0647\u0627"),Object(N.a)(U,"add_reports_to_works","\u0627\u0641\u0632\u0648\u062f\u0646 \u06af\u0632\u0627\u0631\u0634 \u0628\u0647 \u06a9\u0627\u0631\u0647\u0627"),Object(N.a)(U,"add_comments_to_works","\u0627\u0641\u0632\u0648\u062f\u0646 \u0646\u0638\u0631 \u0628\u0647 \u06a9\u0627\u0631\u0647\u0627"),Object(N.a)(U,"add_involvement_to_todos","\u0627\u0641\u0632\u0648\u062f\u0646 \u0647\u0645\u06a9\u0627\u0631 \u0628\u0647 \u062a\u0642\u0633\u06cc\u0645 \u06a9\u0627\u0631"),Object(N.a)(U,"remove_involvement_from_todos","\u062d\u0630\u0641 \u0647\u0645\u06a9\u0627\u0631 \u0627\u0632 \u062a\u0642\u0633\u06cc\u0645 \u06a9\u0627\u0631"),Object(N.a)(U,"add_involvement_to_time_sheets","\u0627\u0641\u0632\u0648\u062f\u0646 \u06af\u06cc\u0631\u0646\u062f\u0647 \u0628\u0647 \u06a9\u0627\u0631\u0646\u0645\u0627"),Object(N.a)(U,"remove_involvement_from_timesheets","\u062d\u0630\u0641 \u06af\u06cc\u0631\u0646\u062f\u0647 \u0627\u0632 \u06a9\u0627\u0631\u0646\u0645\u0627"),Object(N.a)(U,"notification_type","\u0634\u06cc\u0648\u0647 \u0627\u0637\u0644\u0627\u0639 \u0631\u0633\u0627\u0646\u06cc"),Object(N.a)(U,"mail_notification","\u0627\u06cc\u0645\u06cc\u0644"),Object(N.a)(U,"push_notification","\u0622\u06af\u0627\u0647\u0633\u0627\u0632\u06cc \u0648\u0628"),Object(N.a)(U,"sms","\u067e\u06cc\u0627\u0645\u06a9"),Object(N.a)(U,"if_someone_adds_you_youll_be_asked","\u0686\u0646\u0627\u0646\u0686\u0647 \u06a9\u0633\u06cc \u0634\u0645\u0627 \u0631\u0627 \u0628\u0647 \u06cc\u06a9 \u0641\u0639\u0627\u0644\u06cc\u062a \u0628\u06cc\u0627\u0641\u0632\u0627\u06cc\u062f \u0634\u0645\u0627 \u0628\u0627\u06cc\u062f \u062a\u0627\u06cc\u06cc\u062f \u06a9\u0646\u06cc\u062f."),Object(N.a)(U,"previous_attachments","\u067e\u06cc\u0648\u0633\u062a \u0647\u0627\u06cc \u0642\u0628\u0644\u0627 \u0622\u067e\u0644\u0648\u062f \u0634\u062f\u0647"),Object(N.a)(U,"cas","\u0627\u062d\u0631\u0627\u0632 \u0647\u0648\u06cc\u062a \u0645\u0631\u06a9\u0632\u06cc"),Object(N.a)(U,"profile","\u067e\u0631\u0648\u0641\u0627\u06cc\u0644"),Object(N.a)(U,"groups","\u06af\u0631\u0648\u0647\u0628\u0646\u062f\u06cc \u0647\u0645\u06a9\u0627\u0631\u0627\u0646"),Object(N.a)(U,"confirmed","\u062a\u0627\u06cc\u06cc\u062f \u0634\u062f\u0647"),Object(N.a)(U,"not_confirmed","\u062a\u0627\u06cc\u06cc\u062f \u0646\u0634\u062f\u0647"),Object(N.a)(U,"blocked_list","\u06a9\u0627\u0631\u0628\u0631\u0627\u0646 \u0645\u0633\u062f\u0648\u062f \u0634\u062f\u0647"),Object(N.a)(U,"notifications","\u0627\u0637\u0644\u0627\u0639 \u0631\u0633\u0627\u0646\u06cc"),Object(N.a)(U,"privacy","\u062d\u0631\u06cc\u0645 \u062e\u0635\u0648\u0635\u06cc"),Object(N.a)(U,"add_comments_to_reports","\u0627\u0641\u0632\u0648\u062f\u0646 \u0646\u0638\u0631 \u0628\u0647 \u06af\u0632\u0627\u0631\u0634\u0627\u062a"),Object(N.a)(U,"new_notifications","\u0622\u06af\u0627\u0647\u0633\u0627\u0632\u06cc \u0647\u0627\u06cc \u062c\u062f\u06cc\u062f"),Object(N.a)(U,"new_reports","\u0622\u062e\u0631\u06cc\u0646 \u06af\u0632\u0627\u0631\u0634\u0627\u062a"),Object(N.a)(U,"events_calendar","\u062a\u0642\u0648\u06cc\u0645 \u0631\u062e\u062f\u0627\u062f\u0647\u0627"),Object(N.a)(U,"to","\u0628\u0647"),Object(N.a)(U,"statusChanges","\u062a\u063a\u06cc\u06cc\u0631\u0627\u062a \u0648\u0636\u0639\u06cc\u062a \u0647\u0627"),Object(N.a)(U,"in_reply_to","\u062f\u0631 \u067e\u0627\u0633\u062e \u0628\u0647"),Object(N.a)(U,"avarage","\u0645\u06cc\u0627\u0646\u06af\u06cc\u0646 \u062c\u0644\u0633\u0627\u062a \u0627\u062f\u0648\u0628\u06cc"),Object(N.a)(U,"number_of_meetings","\u062a\u0639\u062f\u0627\u062f \u062c\u0644\u0633\u0627\u062a \u0627\u062f\u0648\u0628\u06cc"),Object(N.a)(U,"duration","\u0637\u0648\u0644 \u062c\u0644\u0633\u0647"),Object(N.a)(U,"kian","\u06a9\u06cc\u0627\u0646"),Object(N.a)(U,"attendances","\u062d\u0627\u0636\u0631\u06cc\u0646"),Object(N.a)(U,"attendance_duration","\u062f\u0642\u0627\u06cc\u0642 \u062d\u0636\u0648\u0631"),Object(N.a)(U,"utid","\u0634\u0646\u0627\u0633\u0647"),Object(N.a)(U,"attendance_percentage","\u062f\u0631\u0635\u062f \u062d\u0636\u0648\u0631"),Object(N.a)(U,"faculties","\u062f\u0627\u0646\u0634\u06a9\u062f\u0647 \u0647\u0627"),Object(N.a)(U,"total_assets","\u0645\u062c\u0645\u0648\u0639 \u0641\u0639\u0627\u0644\u06cc\u062a"),Object(N.a)(U,"id","\u0634\u0646\u0627\u0633\u0647"),Object(N.a)(U,"courses_most_quiz","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u0627\u0645\u062a\u062d\u0627\u0646\u0627\u062a"),Object(N.a)(U,"courses_most_resource","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u0645\u0646\u0627\u0628\u0639"),Object(N.a)(U,"courses_most_assignment","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u062a\u0645\u0631\u06cc\u0646 \u0647\u0627"),Object(N.a)(U,"teacher","\u0645\u062f\u0631\u0633"),Object(N.a)(U,"courses_most_occ","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u062a\u0639\u062f\u0627\u062f \u062c\u0644\u0633\u0627\u062a \u0627\u062f\u0648\u0628\u06cc"),Object(N.a)(U,"courses_most_ocd","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u0632\u0645\u0627\u0646 \u062c\u0644\u0633\u0627\u062a \u0627\u062f\u0648\u0628\u06cc"),Object(N.a)(U,"courses_most_activity","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u0645\u062c\u0645\u0648\u0639 \u0641\u0639\u0627\u0644\u06cc\u062a"),Object(N.a)(U,"bb_meetings","\u062c\u0644\u0633\u0627\u062a \u0627\u062a\u0627\u0642 \u062a\u0639\u0627\u0645\u0644"),Object(N.a)(U,"adobe_meetings","\u062c\u0644\u0633\u0627\u062a \u0627\u062f\u0648\u0628\u06cc"),Object(N.a)(U,"number_of_bb_meetings","\u062a\u0639\u062f\u0627\u062f \u062c\u0644\u0633\u0627\u062a \u0627\u062a\u0627\u0642 \u062a\u0639\u0627\u0645\u0644"),Object(N.a)(U,"courses_most_bocc","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u062c\u0644\u0633\u0647 \u062f\u0631 \u0627\u062a\u0627\u0642 \u062a\u0639\u0627\u0645\u0644"),Object(N.a)(U,"courses_most_bocd","\u062f\u0631\u0648\u0633 \u0628\u0627 \u0628\u06cc\u0634\u062a\u0631\u06cc\u0646 \u0632\u0645\u0627\u0646 \u062c\u0644\u0633\u0627\u062a \u0627\u062a\u0627\u0642 \u062a\u0639\u0627\u0645\u0644"),Object(N.a)(U,"person_session","\u0646\u0641\u0631/\u062c\u0644\u0633\u0647"),Object(N.a)(U,"session","\u062c\u0644\u0633\u0647"),Object(N.a)(U,"bb_avarage","\u0645\u06cc\u0627\u0646\u06af\u06cc\u0646 \u062c\u0644\u0633\u0627\u062a \u0627\u062a\u0627\u0642 \u062a\u0639\u0627\u0645\u0644"),Object(N.a)(U,"link","\u0644\u06cc\u0646\u06a9 \u062f\u0631\u0633 \u062f\u0631 \u0627\u06cc\u0644\u0631\u0646"),Object(N.a)(U,"sections","\u067e\u0631\u062f\u06cc\u0633 \u0647\u0627 \u0648 \u062f\u0627\u0646\u0634\u06a9\u062f\u0647 \u0647\u0627"),Object(N.a)(U,"facultyId","\u0634\u0646\u0627\u0633\u0647 \u062f\u0627\u0646\u0634\u06a9\u062f\u0647 "),Object(N.a)(U,"is_typing","\u062f\u0631\u062d\u0627\u0644 \u0646\u0648\u0634\u062a\u0646 \u0627\u0633\u062a"),Object(N.a)(U,"pass","\u0631\u0645\u0632"),Object(N.a)(U,"new_slide","\u0627\u0633\u0644\u0627\u06cc\u062f \u062c\u062f\u06cc\u062f"),Object(N.a)(U,"unshare","\u0639\u062f\u0645 \u0627\u0634\u062a\u0631\u0627\u06a9"),Object(N.a)(U,"start_camera","\u062f\u0648\u0631\u0628\u06cc\u0646 \u0631\u0648\u0634\u0646"),Object(N.a)(U,"end_camera","\u062f\u0648\u0631\u0628\u06cc\u0646 \u062e\u0627\u0645\u0648\u0634"),Object(N.a)(U,"record","\u0636\u0628\u0637 \u062c\u0644\u0633\u0647"),Object(N.a)(U,"recording","\u062f\u0631 \u062d\u0627\u0644 \u0636\u0628\u0637"),Object(N.a)(U,"stop","\u0642\u0637\u0639"),Object(N.a)(U,"send","\u0627\u0631\u0633\u0627\u0644"),Object(N.a)(U,"chat","\u06af\u0641\u062a\u06af\u0648"),Object(N.a)(U,"write_here","\u0627\u06cc\u0646\u062c\u0627 \u0628\u0646\u0648\u06cc\u0633\u06cc\u062f..."),Object(N.a)(U,"frame_link","\u0622\u062f\u0631\u0633"),U),W=(a.Component,n(14)),$=n(46),B=n(224),z=(n(399),function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={image:null},n.handleLoad=function(){n.setState({image:n.image})},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.loadImage()}},{key:"componentDidUpdate",value:function(e){e.src!==this.props.src&&this.loadImage(),e.width!==this.props.width&&this.loadImage(),e.height!==this.props.height&&this.loadImage()}},{key:"componentWillUnmount",value:function(){this.image.removeEventListener("load",this.handleLoad)}},{key:"loadImage",value:function(){this.image=new window.Image,this.image.src=this.props.src,this.image.crossOrigin="anonymous",this.image.addEventListener("load",this.handleLoad)}},{key:"render",value:function(){var e=this;return r.a.createElement($.b,{x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height,image:this.state.image,ref:function(t){e.imageNode=t}})}}]),t}(r.a.Component)),J=n(209),q=n(210),G=n.n(q),H=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleMouseDown=function(e){n.setState({isDrawing:!0});var t=n.getRelativePointerPosition(e.target.getStage()),a=n.state.tool,r=Math.random().toString(36).substring(7),o={tool:a,color:n.state.color,vectorId:r,points:[t.x,t.y]};n.setState({lines:n.state.lines.concat(o),vectorId:n.state.vectorId.concat(r)},(function(){n.throttle(o,"line")}))},n.handleMouseMove=function(e){if(n.state.pointerEnabled&&(n.props.isAdmin||n.props.isPresenter||n.props.isWriter)){var t=n.getRelativePointerPosition(e.target.getStage()),a={uuid:n.props.userUUID,x:t.x,y:t.y};return n.updateMovement(a),void n.throttle(a,"point")}if(n.state.isDrawing&&(n.props.isAdmin||n.props.isPresenter||n.props.isWriter)){e.target.getStage();var r=n.getRelativePointerPosition(e.target.getStage()),o=n.state.lines[n.state.lines.length-1];o.points=o.points.concat([r.x,r.y]),n.state.lines.splice(n.state.lines.length-1,1,o),n.setState({lines:n.state.lines.concat()},(function(){n.throttle(n.state.lines,"line")}))}},n.handleMouseUp=function(){n.setState({isDrawing:!1})},n.handleMouseDown=n.handleMouseDown.bind(Object(f.a)(n)),n.handleMouseMove=n.handleMouseMove.bind(Object(f.a)(n)),n.handleMouseUp=n.handleMouseUp.bind(Object(f.a)(n)),n.fitStageIntoParentContainer=n.fitStageIntoParentContainer.bind(Object(f.a)(n)),n.getRelativePointerPosition=n.getRelativePointerPosition.bind(Object(f.a)(n)),n.stage=r.a.createRef(),n.layer=r.a.createRef(),n.imageLayer=r.a.createRef(),n.throttle=n.throttle.bind(Object(f.a)(n)),n.pointer=n.pointer.bind(Object(f.a)(n)),n.handleClick=n.handleClick.bind(Object(f.a)(n)),n.handleChange=n.handleChange.bind(Object(f.a)(n)),n.handleClose=n.handleClose.bind(Object(f.a)(n)),n.undo=n.undo.bind(Object(f.a)(n)),n.removeLatestLine=n.removeLatestLine.bind(Object(f.a)(n)),n.trash=n.trash.bind(Object(f.a)(n)),n.updateMovement=n.updateMovement.bind(Object(f.a)(n)),n.togglePointer=n.togglePointer.bind(Object(f.a)(n)),n.loadImage=n.loadImage.bind(Object(f.a)(n)),n.recorder=n.recorder.bind(Object(f.a)(n)),n.stopRecording=n.stopRecording.bind(Object(f.a)(n)),n.recordBtn=n.recordBtn.bind(Object(f.a)(n)),n.boardControl=n.boardControl.bind(Object(f.a)(n)),n.arrows=n.arrows.bind(Object(f.a)(n)),n.state={tool:"pen",lines:[],isDrawing:!1,baseWidth:800,baseHeight:600,width:800,height:600,scale:4/3,scaleX:1,scaleY:1,lastTime:Date.now(),pointer:{x:100,y:100},currentPage:0,color:"#22194D",displayColorPicker:!1,upload:null,vectorId:[],pointers:[],pointerEnabled:!0,uploadedHeigth:1e3,ratio:.75,db:null,recording:!1},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this;if(e.line!==this.props.line&&this.setState({lines:this.state.lines.concat(this.props.line)}),e.participants!==this.props.participants&&this.props.participants.map((function(e){var n=t.state.pointers.filter((function(t){return t.uuid===e.uuid}));0!==n.length&&e.userColor===n.userColor||t.setState({pointers:t.state.pointers.concat({uuid:e.uuid,color:e.userColor,x:0,y:0})},(function(){}))})),e.undoVector!==this.props.undoVector&&this.props.undoVector&&(this.removeLatestLine(this.props.undoVector),this.props.revertUndo()),e.trash!==this.props.trash&&this.props.trash&&(this.applyTrash(),this.props.revertTrash()),e.upload!==this.props.upload&&this.props.upload.converted){var n=this.props.upload.dimensions[this.state.currentPage],a=n.h/n.w;this.setState({currentPage:0,upload:this.props.upload,ratio:a}),this.props.uploadedRecently&&(this.throttle({currentPage:this.state.currentPage,uuid:this.props.upload.uuid},"newUpload"),this.props.uploadedRecentlyReset())}e.page!==this.props.page&&(this.props.page.uuid==this.state.upload.uuid?this.setState({currentPage:this.props.page.currentPage}):this.props.recentUpload()),e.currentPoint!==this.props.currentPoint&&this.updateMovement(this.props.currentPoint)}},{key:"updateMovement",value:function(e){for(var t=this.state.pointers,n=0;n<t.length;n++)if(t[n].uuid===e.uuid){var a=Object.assign({},this.state);a.pointers[n]={uuid:t[n].uuid,color:t[n].color,x:e.x,y:e.y},this.setState(a);break}}},{key:"throttle",value:function(e,t){var n=this;Date.now()-this.state.lastTime>300&&this.setState({lastTime:Date.now()},(function(){n.props.wsSend({type:t,c:e})}))}},{key:"pointer",value:function(e,t){return r.a.createElement($.a,{x:e,y:t,radius:2,fill:"green"})}},{key:"componentDidMount",value:function(){this.layer.current.getCanvas()._canvas.id="main-canvas",window.db={},window.db=new J.a("VideosDB"),window.db.version(2).stores({videos:"++id,session,blob"}),window.addEventListener("load",this.fitStageIntoParentContainer),window.addEventListener("resize",this.fitStageIntoParentContainer),this.$$("#board").css({height:this.$$("#uploaded").height()})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.fitStageIntoParentContainer),window.removeEventListener("load",this.fitStageIntoParentContainer)}},{key:"fitStageIntoParentContainer",value:function(){var e=this,t=this.$$("#board").width(),n=this.$$("#board").height(),a=Math.min(t/this.state.width,n/this.state.height);window.innerWidth<1090&&(this.setState({scale:a}),this.setState({width:this.$$("#board").width(),height:this.$$("#board").width()*this.state.ratio},(function(){e.stage.current.width(e.$$("#board").width()),e.stage.current.height(e.$$("#board").width()*e.state.ratio),e.stage.current.scale({x:a,y:a}),e.stage.current.draw()}))),window.innerWidth>1090&&(this.setState({scale:a}),this.setState({width:800,height:800*this.state.ratio},(function(){e.stage.current.width(800),e.stage.current.height(800*e.state.ratio),e.stage.current.scale({x:a,y:a}),e.stage.current.draw()})))}},{key:"getRelativePointerPosition",value:function(e){var t=e.getAbsoluteTransform().copy();t.invert();var n=e.getStage().getPointerPosition();return t.point(n)}},{key:"progress",value:function(){var e=this;if(this.props.isPresenter||this.props.isAdmin)return this.props.progressShow||this.props.upload&&!this.props.upload.converted?r.a.createElement(c.x,{color:"red"}):r.a.createElement("div",{class:"upload-btn"},r.a.createElement("label",{for:"file-input"},r.a.createElement("div",{style:{float:"right"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"}),r.a.createElement("path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"}),r.a.createElement("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),r.a.createElement("line",{x1:"9",y1:"14",x2:"15",y2:"14"})))),r.a.createElement("input",{id:"file-input",className:"file-input",type:"file",name:"resume",accept:"application/pdf",onInput:function(t){e.props.uploader(t.target.files[0]),e.setState({upload:null})}}))}},{key:"uploaded",value:function(){if(this.state.upload)return r.a.createElement("img",{src:"http://localhost:3001/"+this.state.upload.uuid+"/x-"+this.enumerator(this.state.currentPage)+".jpg",class:"b-radius-0 ",id:"uploaded",width:this.state.width+"px"})}},{key:"enumerator",value:function(e){return e<10?"000"+e.toString():10<=e<100?"00"+e.toString():100<=e<1e3?"0"+e.toString():void 0}},{key:"arrows",value:function(){var e=this;if(this.props.upload)return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("a",{onClick:function(){return e.previousPage()}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"20",y1:"12",x2:"10",y2:"12"}),r.a.createElement("line",{x1:"20",y1:"12",x2:"16",y2:"16"}),r.a.createElement("line",{x1:"20",y1:"12",x2:"16",y2:"8"}),r.a.createElement("line",{x1:"4",y1:"4",x2:"4",y2:"20"})))),r.a.createElement("div",{style:{marginTop:"-4px"}},this.state.currentPage+1,"/",this.props.upload.pages),r.a.createElement("div",null,r.a.createElement("a",{onClick:function(){return e.nextPage()}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"4",y1:"12",x2:"14",y2:"12"}),r.a.createElement("line",{x1:"4",y1:"12",x2:"8",y2:"16"}),r.a.createElement("line",{x1:"4",y1:"12",x2:"8",y2:"8"}),r.a.createElement("line",{x1:"20",y1:"4",x2:"20",y2:"20"})))))}},{key:"nextPage",value:function(){var e=this;this.props.upload&&this.props.upload.pages&&this.props.upload.pages>this.state.currentPage&&this.setState({currentPage:this.state.currentPage+1},(function(){e.throttle({currentPage:e.state.currentPage,uuid:e.props.upload.uuid},"page")}))}},{key:"previousPage",value:function(){var e=this;this.props.upload&&this.props.upload.pages&&this.props.upload.pages>this.state.currentPage&&this.state.currentPage>0&&this.setState({currentPage:this.state.currentPage-1},(function(){e.throttle({currentPage:e.state.currentPage,uuid:e.props.upload.uuid},"page")}))}},{key:"handleClick",value:function(e){this.setState({displayColorPicker:!this.state.displayColorPicker})}},{key:"handleClose",value:function(e){this.setState({displayColorPicker:!1})}},{key:"handleChange",value:function(e,t){this.setState({color:e.hex,pointerEnabled:!1})}},{key:"undo",value:function(){var e=this.state.vectorId[this.state.vectorId.length-1];this.throttle(e,"undo"),this.removeLatestLine(e),this.setState({vectorId:this.state.vectorId.filter((function(t){return t!==e}))})}},{key:"removeLatestLine",value:function(e){this.state.lines.length>0&&this.setState({lines:this.state.lines.filter((function(t){return t.vectorId!==e}))})}},{key:"trash",value:function(){this.throttle(null,"trash"),this.setState({lines:[]})}},{key:"applyTrash",value:function(){this.setState({lines:[]})}},{key:"pointers",value:function(){var e=[];return this.state.pointers.map((function(t){e.push(r.a.createElement($.a,{x:t.x,y:t.y,radius:5,fill:t.color}))})),e}},{key:"togglePointer",value:function(){this.setState({pointerEnabled:!this.state.pointerEnabled})}},{key:"loadImage",value:function(){if(this.state.upload)return r.a.createElement(z,{src:"http://localhost:3001/"+this.state.upload.uuid+"/x-"+this.enumerator(this.state.currentPage)+".jpg",width:this.state.width,height:this.state.width*this.state.ratio})}},{key:"recorder",value:function(){var e=this.layer.current.getCanvas()._canvas;window.recorder={};var t=new G.a([this.props.localStream,this.props.remoteStream]),n=new MediaStream([].concat(Object(W.a)(e.captureStream(5).getTracks()),Object(W.a)(t.getMixedStream().getTracks())));window.recorder=new MediaRecorder(n);var a=[];window.recorder.ondataavailable=function(e){e.data.size&&a.push(e.data)},window.recorder.onstop=function(){var e=new Blob(a,{type:"video/mp4"});URL.createObjectURL(e);window.db.videos.add({blob:e}).then((function(){})).catch((function(e){alert("Error: "+(e.stack||e))}))},window.recorder.start(),this.setState({recording:!0})}},{key:"stageDrawer",value:function(){}},{key:"stopRecording",value:function(){window.recorder.stop(),this.setState({recording:!1})}},{key:"recordBtn",value:function(){var e=this;return this.state.recording?r.a.createElement("div",null,r.a.createElement("a",{onClick:function(){return e.stopRecording()}},r.a.createElement("div",{style:{float:"left"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("rect",{x:"5",y:"5",width:"14",height:"14",rx:"2"}))),r.a.createElement("div",{style:{marginTop:"0px",width:"125px"}},r.a.createElement(c.x,{color:"multi",size:15,style:{marginLeft:"2px"}}),F.recording,"...",F.stop))):r.a.createElement("div",null,r.a.createElement("a",{onClick:function(){return e.recorder()}},r.a.createElement("div",{style:{float:"right"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"}),r.a.createElement("circle",{cx:"12",cy:"14",r:"2"}),r.a.createElement("polyline",{points:"14 4 14 8 8 8 8 4"}))),r.a.createElement("div",{style:{marginTop:"0px",width:"90px"}},F.record)))}},{key:"boardControl",value:function(e,t){var n=this;if(this.props.isWriter||this.props.isPresenter||this.props.isAdmin)return r.a.createElement("div",null,r.a.createElement("a",{onClick:function(){return n.togglePointer()}},this.state.pointerEnabled?r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"12",y1:"12",x2:"12",y2:"12.01"}),r.a.createElement("path",{d:"M14.828 9.172a4 4 0 0 1 0 5.656"}),r.a.createElement("path",{d:"M17.657 6.343a8 8 0 0 1 0 11.314"}),r.a.createElement("path",{d:"M9.168 14.828a4 4 0 0 1 0 -5.656"}),r.a.createElement("path",{d:"M6.337 17.657a8 8 0 0 1 0 -11.314"})):r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"3",y1:"3",x2:"21",y2:"21"}),r.a.createElement("path",{d:"M14.828 9.172a4 4 0 0 1 1.172 2.828"}),r.a.createElement("path",{d:"M17.657 6.343a8 8 0 0 1 1.635 8.952"}),r.a.createElement("path",{d:"M9.168 14.828a4 4 0 0 1 0 -5.656"}),r.a.createElement("path",{d:"M6.337 17.657a8 8 0 0 1 0 -11.314"}))),r.a.createElement("a",{onClick:this.handleClick},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"}),r.a.createElement("line",{x1:"13.5",y1:"6.5",x2:"17.5",y2:"10.5"}))),this.state.displayColorPicker?r.a.createElement("div",{style:e},r.a.createElement("div",{style:t,onClick:this.handleClose}),r.a.createElement(B.a,{onChange:this.handleChange})):null,r.a.createElement("a",{onClick:function(){return n.undo()}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M9 13l-4 -4l4 -4m-4 4h11a4 4 0 0 1 0 8h-1"}))),r.a.createElement("a",{onClick:function(){return n.trash()}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"4",y1:"7",x2:"20",y2:"7"}),r.a.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),r.a.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"}),r.a.createElement("path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"}),r.a.createElement("path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"}))))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(c.f,null,r.a.createElement(c.i,null,this.boardControl({position:"absolute",zIndex:"1000"},{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}),this.progress()),r.a.createElement(c.g,{id:"board",className:"flex-center",style:{alignItems:"normal",height:this.state.uploadedHeigth}},r.a.createElement("div",{style:{position:"absolute"}}),r.a.createElement($.e,{width:this.state.width+2,height:this.state.width*this.state.ratio+2,onMouseDown:this.handleMouseDown,onMousemove:this.handleMouseMove,onMouseup:this.handleMouseUp,ref:this.stage},r.a.createElement($.c,{ref:this.layer},this.loadImage(),this.pointers(),this.state.lines.map((function(e,t){return r.a.createElement($.d,{key:t,points:e.points,stroke:e.color,strokeWidth:5,tension:.5,lineCap:"round",globalCompositeOperation:"eraser"===e.tool?"destination-out":"source-over"})}))))),r.a.createElement(c.h,{className:"board-footer"},this.arrows())),r.a.createElement("div",{id:"vid"}))}}]),t}(a.Component),K=n(92),Y=n.n(K),Q=n(129),X=n.n(Q),Z=n(211),ee=n.n(Z),te=(a.Component,n(29)),ne=n(43),ae=(a.Component,n(180),a.Component,n(61)),re=n.n(ae),oe=n(212),ie=(a.Component,a.Component,n(495),function(e){return r.a.createElement(c.u,{id:"main-page"},r.a.createElement(c.t,{title:F.home},r.a.createElement(c.n,{panelOpen:"right"},r.a.createElement(c.m,{f7:"bars"}))),function(){var t="none";return(e.ionActive||e.vActive)&&(t="flex"),r.a.createElement(c.f,{style:{display:t,background:"#5d5d5f",borderRadius:"0"}},r.a.createElement(c.g,{id:"videos",style:{minHeight:"210px",display:"flex",flexWrap:"wrap"}},e.ionVideos(),r.a.createElement("div",{id:"remoteVideos"})))}(),r.a.createElement(H,{wsSend:e.wsSend,line:e.line,currentPoint:e.currentPoint,uploader:e.uploader,progress:e.progress,progressShow:e.progressShow,upload:e.upload,recentUpload:e.recentUpload,page:e.page,undoVector:e.undoVector,revertUndo:e.revertUndo,revertTrash:e.revertTrash,trash:e.trash,userColor:e.userColor,participants:e.participants,userUUID:e.userUUID,uploadedRecently:e.uploadedRecently,uploadedRecentlyReset:e.uploadedRecentlyReset,remoteStream:e.remoteStream,localStream:e.localStream,isAdmin:e.isAdmin,isPresenter:e.isPresenter,isWriter:e.isWriter}),(e.screenActive,r.a.createElement(c.f,{style:{minHeight:"0px",background:"#5d5d5f",borderRadius:"0"}},r.a.createElement("div",{id:"screen",style:{textAlign:"center"}},e.screenVideos(),r.a.createElement("div",{id:"remotes"})))),r.a.createElement("div",{id:"mixedaudio"}))}),se=function(e){function t(t){if(!e.isAdmin&&t.uuid===e.userUUID||e.isAdmin&&t.uuid!==e.userUUID)return r.a.createElement("div",{className:"right-icon-3",style:{marginTop:"3px",marginLeft:"9px"}},r.a.createElement("a",{onClick:function(){return function(t){t.uuid===e.userUUID&&(e.handRaised(t.uuid)?(e.wsSend({type:"handRaise",c:{status:"down",raiserUUID:t.uuid}}),e.handRaise({status:"down",raiserUUID:t.uuid})):(e.wsSend({type:"handRaise",c:{status:"raised",raiserUUID:t.uuid}}),e.handRaise({status:"raised",raiserUUID:t.uuid})))}(t)},style:{color:a(t)}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"15",height:"15",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M8 13v-7.5a1.5 1.5 0 0 1 3 0v6.5"}),r.a.createElement("path",{d:"M11 5.5v-2a1.5 1.5 0 1 1 3 0v8.5"}),r.a.createElement("path",{d:"M14 5.5a1.5 1.5 0 0 1 3 0v6.5"}),r.a.createElement("path",{d:"M17 7.5a1.5 1.5 0 0 1 3 0v8.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7a69.74 69.74 0 0 1 -.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47"}))))}function n(t,n){return e.participantRole(t.uuid)===n?"#8ff597":"#d4b9a3"}function a(t){return e.handRaised(t.uuid)?"#8ff597":"#d4b9a3"}return r.a.createElement(c.u,{onPageAfterIn:e.pageAfterIn()},r.a.createElement("div",{style:{display:"flex",height:"max-content"}},r.a.createElement("div",{className:"icon-bar "},r.a.createElement("div",{className:"icon-circle"},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M7 7h10v6a3 3 0 0 1 -3 3h-4a3 3 0 0 1 -3 -3v-6"}),r.a.createElement("line",{x1:"9",y1:"3",x2:"9",y2:"7"}),r.a.createElement("line",{x1:"15",y1:"3",x2:"15",y2:"7"}),r.a.createElement("path",{d:"M12 16v2a2 2 0 0 0 2 2h3"}))),r.a.createElement("div",{className:"icon-circle"},r.a.createElement("a",null,r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z"}),r.a.createElement("path",{d:"M16 7h4"}),r.a.createElement("path",{d:"M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3"})))),r.a.createElement("div",{className:"icon-circle"},r.a.createElement("a",{className:e.ionActive?"fc-white":""},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z"}),r.a.createElement("rect",{x:"3",y:"6",width:"12",height:"12",rx:"2"})))),r.a.createElement("div",{className:"icon-circle"},r.a.createElement(c.n,{id:"xxx",className:e.screenActive?"fc-white":""},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9"}),r.a.createElement("line",{x1:"7",y1:"20",x2:"17",y2:"20"}),r.a.createElement("line",{x1:"9",y1:"16",x2:"9",y2:"20"}),r.a.createElement("line",{x1:"15",y1:"16",x2:"15",y2:"20"}),r.a.createElement("path",{d:"M17 4h4v4"}),r.a.createElement("path",{d:"M16 9l5 -5"})))),r.a.createElement("div",{className:"icon-circle"},r.a.createElement("a",{className:e.screenActive?"fc-white":""},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("circle",{cx:"12",cy:"12",r:"1"}),r.a.createElement("circle",{cx:"12",cy:"12",r:"5"}),r.a.createElement("line",{x1:"15.9",y1:"20.11",x2:"15.9",y2:"20.12"}),r.a.createElement("line",{x1:"19.04",y1:"17.61",x2:"19.04",y2:"17.62"}),r.a.createElement("line",{x1:"20.77",y1:"14",x2:"20.77",y2:"14.01"}),r.a.createElement("line",{x1:"20.77",y1:"10",x2:"20.77",y2:"10.01"}),r.a.createElement("line",{x1:"19.04",y1:"6.39",x2:"19.04",y2:"6.4"}),r.a.createElement("line",{x1:"15.9",y1:"3.89",x2:"15.9",y2:"3.9"}),r.a.createElement("line",{x1:"12",y1:"3",x2:"12",y2:"3.01"}),r.a.createElement("line",{x1:"8.1",y1:"3.89",x2:"8.1",y2:"3.9"}),r.a.createElement("line",{x1:"4.96",y1:"6.39",x2:"4.96",y2:"6.4"}),r.a.createElement("line",{x1:"3.23",y1:"10",x2:"3.23",y2:"10.01"}),r.a.createElement("line",{x1:"3.23",y1:"14",x2:"3.23",y2:"14.01"}),r.a.createElement("line",{x1:"4.96",y1:"17.61",x2:"4.96",y2:"17.62"}),r.a.createElement("line",{x1:"8.1",y1:"20.11",x2:"8.1",y2:"20.12"}),r.a.createElement("line",{x1:"12",y1:"21",x2:"12",y2:"21.01"})))),r.a.createElement("div",{className:"icon-circle"},r.a.createElement(c.e,{panelOpen:"left",className:e.chatActive?"fc-white mr--5":"mr--5",onClick:function(){return e.chatDeactive()},style:{textOverflow:"clip"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1"}),r.a.createElement("line",{x1:"12",y1:"12",x2:"12",y2:"12.01"}),r.a.createElement("line",{x1:"8",y1:"12",x2:"8",y2:"12.01"}),r.a.createElement("line",{x1:"16",y1:"12",x2:"16",y2:"12.01"})))),r.a.createElement("div",{className:"icon-circle"},r.a.createElement("a",{onClick:function(){return e.logout()},className:"fc-white"},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M5.64 5.632a9 9 0 1 0 6.36 -2.632v7.714"}))))),r.a.createElement("div",{style:{float:"right",width:"230px",minHeight:"100vh"}},r.a.createElement("div",{id:"selfVideos",style:{marginBottom:"10px",minHeight:"80px",marginTop:"20px",textAlign:"center"}}),r.a.createElement(c.o,{className:"fs-13 z-1 "}),r.a.createElement(c.o,{className:"fs-13"},function(){if(e.participants){var a=[];e.participants.map((function(o){o.display&&a.push(r.a.createElement(c.q,null,r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:o.userColor,"stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("circle",{cx:"12",cy:"7",r:"4"}),r.a.createElement("path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"})),r.a.createElement("span",null,o.display,function(t){if(t.uuid===e.userUUID&&e.currentSlot)return"("+e.currentSlot+")"}(o)),function(t){return e.talking[t.id]?r.a.createElement("div",{className:"right-icon-4"},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M18 8a3 3 0 0 1 0 6"}),r.a.createElement("path",{d:"M10 8v11a1 1 0 0 1 -1 1h-1a1 1 0 0 1 -1 -1v-5"}),r.a.createElement("path",{d:"M12 8h0l4.524 -3.77a0.9 .9 0 0 1 1.476 .692v12.156a0.9 .9 0 0 1 -1.476 .692l-4.524 -3.77h-8a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h8"}))):null}(o),function(t){if(t.uuid===e.userUUID&&(e.isPresenter||e.isSpeaker))return e.muted?r.a.createElement("div",{className:"right-icon"},r.a.createElement("a",{onClick:function(){return e.toggleMicrophone()}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"3",y1:"3",x2:"21",y2:"21"}),r.a.createElement("path",{d:"M9 5a3 3 0 0 1 6 0v5a3 3 0 0 1 -.13 .874m-2 2a3 3 0 0 1 -3.87 -2.872v-1"}),r.a.createElement("path",{d:"M5 10a7 7 0 0 0 10.846 5.85m2.002 -2a6.967 6.967 0 0 0 1.152 -3.85"}),r.a.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),r.a.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})))):r.a.createElement("div",{className:"right-icon"},r.a.createElement("a",{onClick:function(){return e.toggleMicrophone()},style:{color:"white"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("rect",{x:"9",y:"2",width:"6",height:"11",rx:"3"}),r.a.createElement("path",{d:"M5 10a7 7 0 0 0 14 0"}),r.a.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),r.a.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"}))))}(o),function(t){if(t.uuid===e.userUUID)return r.a.createElement("div",{className:"right-icon-1"},e.vPublishBtn(),r.a.createElement("div",{id:"videoLoaderIcon",className:"loader",style:{display:"none"}}))}(o),function(t){if(t.uuid===e.userUUID&&e.isPresenter)return r.a.createElement("div",{className:"right-icon-2"},e.screenPublishBtn())}(o),function(t){return t.uuid!==e.userUUID&&e.isAdmin?r.a.createElement("div",{className:"right-icon-1"},r.a.createElement("a",{onClick:function(){return e.toggleRole(t.uuid,"presenter")},style:{color:n(t,"presenter")}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"3",y1:"4",x2:"21",y2:"4"}),r.a.createElement("path",{d:"M4 4v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-10"}),r.a.createElement("line",{x1:"12",y1:"16",x2:"12",y2:"20"}),r.a.createElement("line",{x1:"9",y1:"20",x2:"15",y2:"20"}),r.a.createElement("path",{d:"M8 12l3 -3l2 2l3 -3"})))):null}(o),t(o),function(t){if(t.uuid!==e.userUUID&&e.isPresenter)return r.a.createElement("div",{className:"right-icon-2"},r.a.createElement("a",{onClick:function(){return e.toggleRole(t.uuid,"writer")},style:{color:n(t,"writer")}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4"}),r.a.createElement("line",{x1:"13.5",y1:"6.5",x2:"17.5",y2:"10.5"}))))}(o),function(t){if(t.uuid!==e.userUUID&&e.isPresenter)return r.a.createElement("div",{className:"right-icon"},r.a.createElement("a",{onClick:function(){return e.toggleRole(t.uuid,"speaker")},style:{color:n(t,"speaker")}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("rect",{x:"9",y:"2",width:"6",height:"11",rx:"3"}),r.a.createElement("path",{d:"M5 10a7 7 0 0 0 14 0"}),r.a.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),r.a.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"}))))}(o),function(t){if(t.uuid!==e.userUUID&&e.isAdmin)return r.a.createElement("div",{className:"right-icon-6"},r.a.createElement("a",{onClick:function(){return e.wsSend({type:"joinRoom",c:e.participantRoom[t.uuid]},"all")}},"m"),r.a.createElement("a",{onClick:function(){return e.wsSend({type:"leaveRoom",c:e.participantRoom[t.uuid]},"all")}},"x"))}(o)))}))}return a}()))),r.a.createElement(c.w,{className:"popover-menu"},"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean vel quam et metus dictum auctor. Morbi vestibulum neque mauris, eget egestas lacus congu"))},ce=n(219),le=n(52),de=n.n(le),ue=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).throttle=n.throttle.bind(Object(f.a)(n)),n.send=n.send.bind(Object(f.a)(n)),n.handleChange=n.handleChange.bind(Object(f.a)(n)),n.chatItems=n.chatItems.bind(Object(f.a)(n)),n.state={lastTime:Date.now(),content:null,item:null},n}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidUpdate",value:function(e){e.chats,this.props.chats}},{key:"componentDidMount",value:function(){}},{key:"throttle",value:function(e,t){var n=this;Date.now()-this.state.lastTime>100&&this.setState({lastTime:Date.now()},(function(){n.props.wsSend({type:t,c:e})}))}},{key:"send",value:function(){this.state.item&&(this.throttle(this.state.item,"chat"),this.props.appendChat(this.state.item),this.$$("#chat-form").val(""),this.props.chatDeactive())}},{key:"handleChange",value:function(e){this.setState(e)}},{key:"chatItems",value:function(){var e=[];return this.props.chats.slice(0).reverse().map((function(t){e.push(r.a.createElement("div",{class:"item-content"},r.a.createElement("div",{class:"item-inner"},r.a.createElement("div",{class:"item-title-row"},r.a.createElement("div",{class:"item-title",style:{fontSize:"10px"}},t.name),r.a.createElement("div",{class:"item-after"},r.a.createElement("span",null,de()(t.time).fromNow()))),r.a.createElement("div",{class:"item-text mh-auto",style:{overflow:"auto"}},t.content))))})),e}},{key:"render",value:function(){var e=this;return r.a.createElement(c.u,null,r.a.createElement(c.o,{noHairlinesMd:!0},r.a.createElement(c.p,{inputId:"chat-form",label:F.chat,type:"textarea",placeholder:F.write_here,onChange:function(t){e.handleChange({item:{content:t.target.value,name:e.props.name,time:Date.now(),uuid:Object(ce.v4)()}})}})),r.a.createElement(c.y,null,r.a.createElement(c.k,null),r.a.createElement(c.k,null),r.a.createElement(c.k,null,r.a.createElement(c.e,{fill:!0,onClick:function(){return e.send()}},F.send))),r.a.createElement(c.o,{mediaList:!0},this.chatItems()))}}]),t}(a.Component),me=function(e){function t(t){if(e.signingUp){if("name"==t)return r.a.createElement(c.p,{label:F.name,className:"fs-14",type:"text",placeholder:"Your username",value:e.name,onInput:function(t){e.handleChangeValue({name:t.target.value})}});if("passwordConfirmation"==t)return r.a.createElement(c.p,{label:F.password_confirmation,type:"text",className:"fs-14",placeholder:"Password Confirmation",value:e.passwordConfirmation,onInput:function(t){e.handleChangeValue({passwordConfirmation:t.target.value})}})}}return r.a.createElement(c.u,{loginScreen:!0},r.a.createElement(c.s,null," "),r.a.createElement(c.o,{form:!0},r.a.createElement(c.p,{label:F.email,className:"fs-14",type:"text",placeholder:"Your email",value:e.email,onInput:function(t){e.handleChangeValue({email:t.target.value})}}),t("name"),r.a.createElement(c.p,{label:F.password,type:"text",className:"fs-14",placeholder:"Password",value:e.password,onInput:function(t){e.handleChangeValue({password:t.target.value})}}),t("passwordConfirmation")),r.a.createElement(c.o,null,e.signingUp?r.a.createElement(r.a.Fragment,null,r.a.createElement(c.e,{fill:!0,onClick:e.login},F.sign_up),r.a.createElement(c.c,null,r.a.createElement("a",{onClick:e.loginActive},F.you_can_login))):r.a.createElement(r.a.Fragment,null,r.a.createElement(c.e,{fill:!0,onClick:e.login},F.login),r.a.createElement(c.c,null,r.a.createElement("a",{onClick:e.signUp},F.you_can_sign_up)))),r.a.createElement(c.o,null,r.a.createElement(c.e,{fill:!0,className:"fs-11 external f-color-black bg-teal",href:"https://auth.ut.ac.ir:8443/cas/login?service=https%3A%2F%2Fconnect.ut.ac.ir%2Fusers%2Fservice",animate:!1,ignoreCache:!0},F.cas," ")))},fe=(n(421),function(e){return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.home},r.a.createElement(c.n,{panelOpen:"right"},r.a.createElement(c.m,{f7:"bars"}))),r.a.createElement(c.B,{tabbar:!0,top:!0},r.a.createElement(c.n,{tabLink:"#tab-1",tabLinkActive:!0},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z"}),r.a.createElement("path",{d:"M16 7h4"}),r.a.createElement("path",{d:"M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3"}))),r.a.createElement(c.n,{tabLink:"#tab-2"},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9"}),r.a.createElement("line",{x1:"7",y1:"20",x2:"17",y2:"20"}),r.a.createElement("line",{x1:"9",y1:"16",x2:"9",y2:"20"}),r.a.createElement("line",{x1:"15",y1:"16",x2:"15",y2:"20"}),r.a.createElement("path",{d:"M17 4h4v4"}),r.a.createElement("path",{d:"M16 9l5 -5"}))),r.a.createElement(c.n,{tabLink:"#tab-3"},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z"}),r.a.createElement("rect",{x:"3",y:"6",width:"12",height:"12",rx:"2"})))),r.a.createElement(c.y,null))});var pe=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).getList=e.getList.bind(Object(f.a)(e)),e.state={token:window.localStorage.getItem("token"),bbMeetingHistogram:null,meetingHistogram:null,hourMeetingHistogram:null},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("got_multiple_list",this.getList)}},{key:"componentWillUnmount",value:function(){w.removeListener("got_multiple_list",this.getList)}},{key:"componentDidMount",value:function(){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=Object.keys(n).map((function(e){return e+"="+n[e]})).join("&");k.a.get(C+"/"+e+"?page="+t+"&"+r,{headers:{"Content-Type":"application/json",Authorization:"bearer "+a}}).then((function(e){console.log(e),v.dispatch({type:"MULTIPLE_LIST_MODEL_SUCCESS",list:e.data})})).catch((function(e){console.log(e)}))}("/home",this.state.page,{},this.state.token)}},{key:"getList",value:function(){var e=w.getMutipleList(),t=w.getKlass();e&&"Home"===t&&this.setState({meetingHistogram:e.meeting_histogram,hourMeetingHistogram:e.hour_meeting_histogram,bbMeetingHistogram:e.bb_meeting_histogram})}},{key:"render",value:function(){var e=this.state,t=e.meetingHistogram,n=e.bbMeetingHistogram,a=e.hourMeetingHistogram;return r.a.createElement(fe,{bbMeetingHistogram:n,meetingHistogram:t,hourMeetingHistogram:a})}}]),t}(a.Component),he=(n(425),function(e){return e.profile?(console.log(e),r.a.createElement(r.a.Fragment,null,r.a.createElement(c.o,{className:"fs-12"},r.a.createElement(c.q,{key:"profile-show"+e.profile.id,title:e.profile.fullname,after:""},r.a.createElement("img",{slot:"media",src:e.profile.avatar,width:"27",height:"27"}))),r.a.createElement(c.f,null),r.a.createElement(c.f,null))):null}),ge=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).getInstance=e.getInstance.bind(Object(f.a)(e)),e.state={token:window.localStorage.getItem("token"),profile:null,id:null,actuals:null,metas:null,channels:null},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("got_instance",this.getInstance)}},{key:"componentWillUnmount",value:function(){w.removeListener("got_instance",this.getInstance)}},{key:"componentDidMount",value:function(){O("profiles",this.$f7route.params.profileId,this.state.token)}},{key:"getInstance",value:function(){var e=w.getIntance(),t=w.getKlass();e&&"Profile"===t&&this.setState({profile:e,id:e.id})}},{key:"fab",value:function(){if(this.state.profile)return r.a.createElement(c.l,{href:"/profiles/"+this.state.profile.id+"/edit",target:"#main-view",position:"left-bottom",slot:"fixed",color:"lime"},r.a.createElement(c.m,{ios:"f7:edit",aurora:"f7:edit",md:"material:edit"}),r.a.createElement(c.m,{ios:"f7:close",aurora:"f7:close",md:"material:close"}))}},{key:"render",value:function(){var e=this.state.profile;return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.profiles,backLink:F.back}),this.fab(),r.a.createElement(he,{profile:e}))}}]),t}(a.Component),ve=n(42),be=n.n(ve),we=(n(186),n(187),n(188),function(e){return e.profiles?r.a.createElement(c.o,{mediaList:!0},e.profiles.map((function(e){return r.a.createElement(c.q,{key:be.a.lib.WordArray.random(32),link:"/profiles/"+e.id,title:e.fullname,after:"",subtitle:"",text:""},r.a.createElement("img",{slot:"media",src:e.avatar,width:"40",height:"40"}))}))):r.a.createElement("ul",null)}),ye=function(e){return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.profiles,backLink:F.back},r.a.createElement(c.n,{panelOpen:"right"},r.a.createElement(c.m,{f7:"bars"})),r.a.createElement(c.A,{inner:!1},r.a.createElement(c.z,{disableButtonText:F.cancel,placeholder:F.search,onChange:function(t){e.search({query:t.target.value})}}))),r.a.createElement(c.d,null),r.a.createElement(c.l,{href:"/profiles/new",target:"#main-view",position:"left-bottom",slot:"fixed",color:"deeporange"},r.a.createElement(c.m,{ios:"f7:add",aurora:"f7:add",md:"material:add"}),r.a.createElement(c.m,{ios:"f7:close",aurora:"f7:close",md:"material:close"})),r.a.createElement(we,{profiles:e.profiles}))},ke=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).getList=e.getList.bind(Object(f.a)(e)),e.search=e.search.bind(Object(f.a)(e)),e.state={token:window.localStorage.getItem("token"),profiles:null,query:null},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){w.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){E("profiles",this.state.page,{},this.state.token)}},{key:"search",value:function(e){var t=this;this.setState(e,(function(){E("profiles/search",t.state.page,{q:t.state.query},t.state.token)}))}},{key:"getList",value:function(){var e=w.getList(),t=w.getKlass();e&&"Profile"===t&&this.setState({profiles:e})}},{key:"render",value:function(){var e=this.state.profiles;return r.a.createElement(ye,{profiles:e,search:this.search})}}]),t}(r.a.Component),Se=n(221),Ce=n.n(Se),Ee=function(e){return e.profile?r.a.createElement(r.a.Fragment,null,r.a.createElement(c.f,null,r.a.createElement(c.i,null,F.profile_info),r.a.createElement(c.g,null,r.a.createElement(c.o,null,r.a.createElement(c.p,{label:F.firstname,type:"text",placeholder:"...",defaultValue:e.name,onInput:function(t){e.handleChange({name:t.target.value})}}),r.a.createElement(c.p,{label:F.surename,type:"text",placeholder:"...",defaultValue:e.surename,onInput:function(t){e.handleChange({surename:t.target.value})}}))),r.a.createElement(c.h,null,r.a.createElement(c.n,null),r.a.createElement(c.n,{className:"btn-notice"}),r.a.createElement(c.e,{className:"col btn",fill:!0,onClick:e.submit},F.submit))),r.a.createElement(c.f,null,r.a.createElement(c.i,null,r.a.createElement("img",{src:e.avatar,width:"40",height:"40"})),r.a.createElement(Ce.a,{withIcon:!0,buttonText:F.choose_image,onChange:e.onDrop,buttonClassName:"upload-btn",imgExtension:[".jpg",".jpeg",".png"],maxFileSize:5242880}))):null},je=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).submit=e.submit.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(f.a)(e)),e.handleChangeValueFields=e.handleChangeValueFields.bind(Object(f.a)(e)),e.removeActual=e.removeActual.bind(Object(f.a)(e)),e.getInstance=e.getInstance.bind(Object(f.a)(e)),e.submitFields=e.submitFields.bind(Object(f.a)(e)),e.onDrop=e.onDrop.bind(Object(f.a)(e)),e.getList=e.getList.bind(Object(f.a)(e)),e.getList=e.getList.bind(Object(f.a)(e)),e.state={profile:{},metas:null,token:window.localStorage.getItem("token"),fields:[],name:"dd",surename:"",pictures:[],avatar:null},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("got_instance",this.getInstance),w.on("set_instance",this.getInstance),w.on("deleted_instance",this.getInstance),w.on("got_list",this.getList)}},{key:"componentWillUnmount",value:function(){w.removeListener("got_instance",this.getInstance),w.removeListener("set_instance",this.getInstance),w.removeListener("deleted_instance",this.getInstance),w.removeListener("got_list",this.getList)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){E("metas",this.state.page)}},{key:"onDrop",value:function(e){console.log(e[0]),j("profiles",this.state.id,e[0],this.state.token)}},{key:"submit",value:function(){D("profiles",{id:this.state.id,name:this.state.name,surename:this.state.surename},this.state.token)}},{key:"submitFields",value:function(){T("actuals",{meta_id:this.state.metaId,content:this.state.fields},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"handleChangeValueFields",value:function(e,t,n){var a=this.state.fields;if(a.length>0)for(var r=0;r<a.length;r++)if(a[r].fid&&a[r].fid===e){var o=Object.assign({},this.state);o.fields[r]={fid:e,value:t,metaId:n},this.setState(o)}else this.setState({fields:this.state.fields.concat({fid:e,value:t,metaId:n})});else this.setState({fields:this.state.fields.concat({fid:e,value:t,metaId:n})})}},{key:"setInstance",value:function(){this.$f7router.navigate("/profiles/")}},{key:"getInstance",value:function(){var e=w.getIntance(),t=w.getKlass();e&&"Profile"===t&&this.setState({metas:e.metas,profile:e})}},{key:"removeActual",value:function(e){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=Object.keys(t).map((function(e){return e+"="+t[e]})).join("&");k.a.get(C+"/"+e+"/delete?"+a,{headers:{"Content-Type":"application/json",Authorization:"bearer "+n}}).then((function(e){v.dispatch({type:"DELETE_INSTANCE_SUCCESS",instance:e.data})})).catch((function(e){console.log(e)}))}("actuals",{uuid:e})}},{key:"getList",value:function(){var e=w.getList(),t=w.getKlass();e&&"Meta"===t&&this.setState({metas:e})}},{key:"render",value:function(){var e=this.state,t=(e.profile,e.metas),n=e.name,a=e.avatar,o=e.surename;return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.profile_form,backLink:F.back}),r.a.createElement(c.d,null,F.profile_form),r.a.createElement(Ee,{name:n,avatar:a,surename:o,metas:t,onDrop:this.onDrop,removeActual:this.removeActual,submitFields:this.submitFields,submit:this.submit,editing:!0,handleChangeValueFields:this.handleChangeValueFields,handleChange:this.handleChangeValue}))}}]),t}(a.Component),Oe=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).submit=e.submit.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(f.a)(e)),e.getInstance=e.getInstance.bind(Object(f.a)(e)),e.onDrop=e.onDrop.bind(Object(f.a)(e)),e.state={name:null,surename:null,token:window.localStorage.getItem("token"),profile:null,id:null,pictures:[],avatar:null},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("got_instance",this.getInstance),w.on("set_instance",this.setInstance),w.on("file_posted",this.getInstance)}},{key:"componentWillUnmount",value:function(){w.removeListener("got_instance",this.getInstance),w.removeListener("set_instance",this.setInstance),w.removeListener("file_posted",this.getInstance)}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"loadData",value:function(){this.$f7route.params.profileId&&O("profiles",this.$f7route.params.profileId,this.state.token)}},{key:"onDrop",value:function(e){console.log(e[0]),j("profiles",this.state.id,e[0],this.state.token)}},{key:"submit",value:function(){D("profiles",{id:this.state.id,name:this.state.name,surename:this.state.surename},this.state.token)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"setInstance",value:function(){this.$f7router.navigate("/profiles/")}},{key:"getInstance",value:function(){var e=w.getIntance(),t=w.getKlass();e&&"Profile"===t&&this.setState({id:e.id,profile:e,name:e.name,surename:e.surename,avatar:e.avatar})}},{key:"render",value:function(){var e=this.state,t=e.profile,n=e.name,a=e.surename,o=e.avatar;return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.profile_form,backLink:F.back}),r.a.createElement(c.d,null,F.profile_form),r.a.createElement(Ee,{profile:t,name:n,avatar:o,surename:a,onDrop:this.onDrop,submit:this.submit,editing:!0,handleChange:this.handleChangeValue}))}}]),t}(a.Component);function Te(){var e=this;L.init({debug:"all",callback:function(){var t=new L({server:e.state.server,success:function(){t.attach({plugin:"janus.plugin.audiobridge",opaqueId:e.state.opaqueId,success:function(t){e.setState({mixertest:t}),L.log("Plugin attached! ("+e.state.mixertest.getPlugin()+", id="+e.state.mixertest.getId()+")"),e.registerUsername()},error:function(e){L.error("  -- Error attaching plugin...",e)},consentDialog:function(e){L.debug("Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){L.log("ICE state changed to "+e)},mediaState:function(e,t){L.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){L.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(t,n){L.debug(" ::: Got a message :::",t);var a=t.audiobridge;if(L.debug("Event: "+a),a)if("joined"===a){if(t.id&&(e.setState({myid:t.id}),L.log("Successfully joined room "+t.room+" with ID "+e.state.myid),e.addParticipant(t.id,e.state.fullname+"\xa7"+e.state.userUUID),e.state.webrtcUp||(e.setState({webrtcUp:!0}),e.state.mixertest.createOffer({media:{video:!1,audio:{echoCancellation:!0}},success:function(t){L.debug("Got SDP!",t);e.state.mixertest.send({message:{request:"configure",muted:!1},jsep:t})},error:function(e){L.error("WebRTC error:",e)}}))),t.participants){var r=t.participants;for(var o in L.debug("Got a list of participants:",r),r){var i=r[o].id,s=r[o].display,c=r[o].setup,l=r[o].muted;e.addParticipant(r[o].id,r[o].display)}}}else if("roomchanged"===a){if(e.setState({myid:t.id}),L.log("Moved to room "+t.room+", new ID: "+e.state.myid),t.participants){r=t.participants;for(var o in L.debug("Got a list of participants:",r),r){i=r[o].id,s=r[o].display,c=r[o].setup,l=r[o].muted;e.addParticipant(t.id,e.state.fullname+"\xa7"+e.state.userUUID),L.debug("  >> ["+i+"] "+s+" (setup="+c+", muted="+l+")")}}}else if("destroyed"===a)L.warn("The room has been destroyed!");else if("event"===a){if(t.participants){r=t.participants;for(var o in L.debug("Got a list of participants:",r),r){i=r[o].id,s=r[o].display,c=r[o].setup,l=r[o].muted;L.debug("  >> ["+i+"] "+s+" (setup="+c+", muted="+l+")"),e.addParticipant(r[o].id,r[o].display)}}else if(t.error)return void t.error_code;if(t.leaving){var d=t.leaving;L.log("Participant left: "+d+" elements with ID #rp"+d+")")}}n&&(L.debug("Handling SDP as well...",n),e.state.mixertest.handleRemoteJsep({jsep:n}))},onlocalstream:function(e){L.debug(" ::: Got a local stream :::",e)},onremotestream:function(t){0===e.$$("#roomaudio").length&&(e.$$("#mixedaudio").append('<audio class="rounded centered" id="roomaudio" width="100%" height="100%" autoplay/>'),L.attachMediaStream(document.getElementById("roomaudio"),t))},oncleanup:function(){L.log(" ::: Got a cleanup notification :::")}})},error:function(e){console.log(e)},destroyed:function(){window.location.reload()}})}})}function De(){var e={request:"join",room:1234,display:this.state.fullname+" \xa7"+this.state.userUUID};this.state.mixertest.send({message:e})}function Ie(e,t){console.log("Adding Participants ...",e,t);var n=t.split("\xa7");this.exisitingParticipant(n[1])&&this.setState({participants:this.state.participants.concat({id:e,display:n[0],uuid:n[1],role:"listener"})}),console.log("participant added:",n[1])}function xe(e){return 0===this.state.participants.filter((function(t){return t.uuid===e})).length}var Ae=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).sessionCreate=Te.bind(Object(f.a)(e)),e.registerUsername=De.bind(Object(f.a)(e)),e.pageAfterIn=e.pageAfterIn.bind(Object(f.a)(e)),e.getInstance=e.getInstance.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.addParticipant=Ie.bind(Object(f.a)(e)),e.exisitingParticipant=xe.bind(Object(f.a)(e)),e.state={token:window.localStorage.getItem("token"),shortners:null,server:S.janusServer,janus:null,sfutest:null,opaqueId:"videoroomtest-"+L.randomString(12),roomId:1234,webrtcUp:null,myusername:null,mixertest:null,myid:null,mystream:null,pin:null,userUUID:null,fullname:null,isOwner:!1,muted:!0,participants:[],room:null,notification:{},chats:[],panelOpen:!1},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("got_instance",this.getInstance),w.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){w.removeListener("got_instance",this.getInstance),w.removeListener("set_instance",this.setInstance),window.removeEventListener("beforeunload",this.unPublishData)}},{key:"componentDidMount",value:function(){O("rooms",this.$f7route.params.roomId,this.state.token),window.addEventListener("beforeunload",this.unPublishData),window.innerWidth>960&&(this.setState({panelOpen:!0}),console.log(">960"));var e=this.$f7;console.log("props",e.panel.get("#panel-r"))}},{key:"submitParticipation",value:function(e){T("participations",{room_id:this.state.id,activity:e},this.state.token)}},{key:"getInstance",value:function(){var e=this,t=w.getIntance(),n=w.getKlass();t&&"Room"===n&&this.setState({room:t,id:t.id,roomId:t.room_id,pin:t.pin,fullname:t.user_fullname,title:t.title,isOwner:t.is_owner},(function(){return e.submitParticipation("joined")})),console.log(t)}},{key:"pageAfterIn",value:function(){this.sessionCreate()}},{key:"setInstance",value:function(){var e=this,t=w.getIntance(),n=w.getKlass();t&&"Participation"===n&&this.setState({userUUID:t.uuid},(function(){return e.pageAfterIn()})),console.log(t)}},{key:"render",value:function(){var e=this.state,t=(e.token,e.shortners,e.urls,e.publishedMicrophone,e.publishedCamera,e.publishedDesktop,e.feeds,e.muted,e.lowFeeds,e.requests,e.participants),n=(e.room,e.notification,e.chats,e.isOwner,e.roomId,e.panelOpen);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ie,{participants:t,panelOpen:n}))}}]),t}(r.a.Component),Re=n(222),_e=n.n(Re),Pe=function(e){return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.sign_up},r.a.createElement(c.n,{panelOpen:"right"},r.a.createElement(c.m,{f7:"bars"}))),r.a.createElement(c.f,null,r.a.createElement(c.i,null,F.login),r.a.createElement(c.g,{className:"mh-auto"},r.a.createElement(c.o,null,r.a.createElement(c.p,{label:F.email,type:"text",autofocus:!0,placeholder:F.enter_your_email,value:e.email,onInput:function(t){e.handleChange({email:t.target.value})}}))),r.a.createElement(c.h,null,r.a.createElement(c.n,{href:"/sign_up/",animate:!1,ignoreCache:!0},F.you_can_sign_up," "),r.a.createElement(c.e,{fill:!0,className:"fs-11 external f-color-black bg-teal",href:"https://auth.ut.ac.ir:8443/cas/login?service=https%3A%2F%2Ftavan.ut.ac.ir%2Fusers%2Fservice",animate:!1,ignoreCache:!0},F.cas," "),r.a.createElement(c.n,{className:"btn-notice"}),r.a.createElement(c.e,{className:"col btn",fill:!0,onClick:e.submit},F.login))))},Me=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).submit=e.submit.bind(Object(f.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.state={token:window.localStorage.getItem("token"),email:"",password:""},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){w.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){this.$f7route.params.token&&T("users/validate_token",{},this.$f7route.params.token),this.state.token&&this.state.token.length>10&&T("users/validate_token",{},this.state.token)}},{key:"submit",value:function(){T("users/login",{email:this.state.email,password:this.state.password})}},{key:"setInstance",value:function(){var e=w.getKlass();"Login"===e&&this.$f7router.navigate("/verification/"+this.state.email),"Validate"===e&&(this.$f7router.navigate("/"),window.location.reload()),console.log(e)}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this.state;e.username,e.password;return r.a.createElement(Pe,{submit:this.submit,handleChange:this.handleChangeValue})}}]),t}(r.a.Component),Ve=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).handleChangeValue=e.handleChangeValue.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.state={email:"",password:""},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){w.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){T("users/validate_token",{},this.$f7route.params.token)}},{key:"setInstance",value:function(){var e=w.getIntance();"Validate"===w.getKlass()?(window.localStorage.setItem("token",e.token),this.$f7router.navigate("/"),window.location.reload()):(this.$f7router.navigate("/login_error/"),window.location.reload())}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this.state;e.username,e.password;return r.a.createElement(Pe,{submit:this.submit,handleChange:this.handleChangeValue})}}]),t}(r.a.Component),Ue=function(e){return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.sign_up},r.a.createElement(c.n,{panelOpen:"right"},r.a.createElement(c.m,{f7:"bars"}))),r.a.createElement(c.f,null,r.a.createElement(c.i,null,F.sign_up),r.a.createElement(c.g,null,r.a.createElement(c.o,null,r.a.createElement(c.p,{label:F.firstname+" *",placeholder:F.enter_your_name,type:"text",name:be.a.lib.WordArray.random(32),onInput:function(t){e.handleChange({name:t.target.value})}}),r.a.createElement(c.p,{label:F.surename+" *",placeholder:F.enter_your_surename,type:"text",name:be.a.lib.WordArray.random(32),onInput:function(t){e.handleChange({surename:t.target.value})}}),r.a.createElement(c.p,{label:" * "+F.email,type:"email",validate:!0,placeholder:F.enter_your_email,className:"ltr",value:e.email,onInput:function(t){e.handleChange({email:t.target.value})}}))),r.a.createElement(c.h,null,r.a.createElement(c.n,{href:"/login/"},F.if_registered,"\xa0",F.you_can_login," "),r.a.createElement(c.n,{className:"btn-notice"}),r.a.createElement(c.e,{className:"col btn",fill:!0,onClick:e.submit},F.sign_up))))},Le=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).submit=e.submit.bind(Object(f.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.state={email:"",name:"",surename:""},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){w.removeListener("set_instance",this.setInstance)}},{key:"submit",value:function(){this.$$(".btn").hide(),this.$$(".btn-notice").text(F.submitting);var e={email:this.state.email,name:this.state.name,surename:this.state.surename};if(this.state.email&&this.state.email.length>0&&this.state.name&&this.state.name.length>0&&this.state.surename&&this.state.surename.length>0)T("users/sign_up",e);else{this.$f7.dialog.alert(F.incomplete_data,F.alert)}}},{key:"setInstance",value:function(){"SignUp"===w.getKlass()&&(this.$$(".btn").show(),this.$f7router.navigate("/verification/"+this.state.email))}},{key:"handleChangeValue",value:function(e){this.setState(e),console.log(e)}},{key:"render",value:function(){var e=this.state;e.username,e.password;return r.a.createElement(Ue,{submit:this.submit,handleChange:this.handleChangeValue})}}]),t}(r.a.Component),Ne=function(e){return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:F.verification},r.a.createElement(c.n,{panelOpen:"right"},r.a.createElement(c.m,{f7:"bars"}))),r.a.createElement(c.f,null,r.a.createElement(c.i,null,F.login),r.a.createElement(c.g,null,r.a.createElement(c.o,null,r.a.createElement(c.p,{label:F.email,type:"text",autofocus:!0,placeholder:F.enter_your_email,value:e.email,onInput:function(t){e.handleChange({email:t.target.value})}}),r.a.createElement(c.p,{label:F.verification_code,type:"text",placeholder:F.enter_verification_code,onInput:function(t){e.handleChange({verificationCode:t.target.value})}}))),r.a.createElement(c.h,null,r.a.createElement(c.n,{href:"/sign_up/",animate:!1,ignoreCache:!0},F.you_can_sign_up," "),r.a.createElement(c.n,{className:"btn-notice"}),r.a.createElement(c.e,{className:"col btn",fill:!0,onClick:e.submit},F.login))))},Fe=[{path:"/",component:pe},{path:"/:token",component:pe},{path:"/login/",component:Me},{path:"/sign_up/",component:Le},{path:"/verification/:email",component:function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).submit=e.submit.bind(Object(f.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.state={verificationCode:"",email:""},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){w.on("set_instance",this.setInstance)}},{key:"componentWillUnmount",value:function(){w.removeListener("set_instance",this.setInstance)}},{key:"componentDidMount",value:function(){this.setState({email:this.$f7route.params.email})}},{key:"submit",value:function(){T("users/verify",{verification_code:this.state.verificationCode})}},{key:"setInstance",value:function(){var e=w.getIntance(),t=w.getKlass();e&&"Verify"==t&&(window.localStorage.setItem("token",e.token),this.$f7router.navigate("/"),window.location.reload())}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this.state,t=(e.username,e.email);return r.a.createElement(Ne,{submit:this.submit,email:t,handleChange:this.handleChangeValue})}}]),t}(r.a.Component)},{path:"/login_jwt/:token",component:Ve},{path:"/profiles/",component:ke},{path:"/profiles/:profileId/edit",component:Oe},{path:"/profiles/new",component:je},{path:"/profiles/:profileId",component:ge},{path:"/rooms/",component:_e.a},{path:"/rooms/:roomId",component:Ae},{path:"(.*)",component:function(){return r.a.createElement(c.u,null,r.a.createElement(c.t,{title:"Not found",backLink:"Back"}),r.a.createElement(c.b,{strong:!0},r.a.createElement("p",null,"Sorry"),r.a.createElement("p",null,"Requested content not found.")))}}];function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(n,!0).forEach((function(t){Object(N.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Be(e){var t=this;L.init({debug:"none",callback:function(){var n=new L({server:t.state.server,success:function(){n.attach({plugin:"janus.plugin.audiobridge",opaqueId:t.state.opaqueId,success:function(n){t.setState({mixertest:n}),L.log("Plugin attached! ("+t.state.mixertest.getPlugin()+", id="+t.state.mixertest.getId()+")"),t.registerUsername(e)},error:function(e){L.error("  -- Error attaching plugin...",e)},consentDialog:function(e){L.debug("Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){L.log("ICE state changed to "+e)},mediaState:function(e,t){L.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){L.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(e,n){L.debug(" ::: Got a message :::",e);var a=e.audiobridge;if(L.debug("Event: "+a),a)if("talking"==a&&t.participantChangeStatus(e.id,!0),"stopped-talking"==a&&t.participantChangeStatus(e.id,!1),"joined"===a){if(e.id&&(t.setState({myid:e.id}),L.log("Successfully joined room "+e.room+" with ID "+t.state.myid),t.addParticipant(e.id,t.state.fullname+"\xa7"+t.state.userUUID+"\xa7"+t.state.userColor),t.state.webrtcUp||(t.setState({webrtcUp:!0}),t.state.mixertest.createOffer({media:{video:!1,audio:{echoCancellation:!0}},success:function(e){L.debug("Got SDP!",e);t.state.mixertest.send({message:{request:"configure",muted:!0},jsep:e})},error:function(e){L.error("WebRTC error:",e)}}))),e.participants){var r=e.participants;for(var o in L.debug("Got a list of participants:",r),r){var i=r[o].id,s=r[o].display,c=r[o].setup,l=r[o].muted;t.addParticipant(r[o].id,r[o].display)}}}else if("roomchanged"===a){if(t.setState({myid:e.id}),L.log("Moved to room "+e.room+", new ID: "+t.state.myid),e.participants){r=e.participants;for(var o in L.debug("Got a list of participants:",r),r){i=r[o].id,s=r[o].display,c=r[o].setup,l=r[o].muted;t.addParticipant(e.id,t.state.fullname+"\xa7"+t.state.userUUID+"\xa7"+t.state.userColor),L.debug("  >> ["+i+"] "+s+" (setup="+c+", muted="+l+")")}}}else if("destroyed"===a)L.warn("The room has been destroyed!");else if("event"===a){if(e.participants){r=e.participants;for(var o in L.debug("Got a list of participants:",r),r){i=r[o].id,s=r[o].display,c=r[o].setup,l=r[o].muted,r[o].talking;L.debug("  >> ["+i+"] "+s+" (setup="+c+", muted="+l+")"),l&&t.participantChangeStatus(r[o].id,!1),t.addParticipant(r[o].id,r[o].display)}}else if(e.error)return void e.error_code;if(e.leaving){var d=e.leaving;t.removeParticipant(d),L.log("Participant left: "+d+" elements with ID #rp"+d+")")}}n&&(L.debug("Handling SDP as well...",n),t.state.mixertest.handleRemoteJsep({jsep:n}))},onlocalstream:function(e){L.debug(" ::: Got a local stream :::",e),t.setState({localStream:e})},onremotestream:function(e){0===t.$$("#roomaudio").length&&(t.$$("#mixedaudio").append('<audio class="rounded centered" id="roomaudio" width="100%" height="100%" autoplay/>'),L.attachMediaStream(document.getElementById("roomaudio"),e),t.setState({remoteStream:e}))},oncleanup:function(){L.log(" ::: Got a cleanup notification :::")}})},error:function(e){},destroyed:function(){window.location.reload()}})}})}function ze(e){var t={request:"join",room:e,pin:this.state.pin,display:this.state.fullname+" \xa7"+this.state.userUUID+"\xa7"+this.state.userColor};this.state.mixertest.send({message:t}),this.setState({myId:this.state.mixertest.id})}function Je(e){this.setState({participants:this.state.participants.filter((function(t){return t.id!==e}))})}function qe(e,t){var n=t.split("\xa7");this.exisitingParticipant(n[1])&&this.setState({participants:this.state.participants.concat({id:e,display:n[0],uuid:n[1],userColor:n[2],role:"listener",current:"stopped-talking"})})}function Ge(e){return 0===this.state.participants.filter((function(t){return t.uuid===e})).length}function He(e){var t=this.state.participants.filter((function(t){return t.uuid===e}));return 0===t.length?"":t[0].display}function Ke(e,t){this.setState((function(n){return{talking:$e({},n.talking,Object(N.a)({},e,t))}}))}function Ye(e,t){this.setState((function(n){return{participantRoom:$e({},n.participantRoom,Object(N.a)({},e,t))}}))}function Qe(){this.state.mixertest.send({message:{request:"configure",muted:this.state.muted}}),this.participantChangeStatus(this.state.myId,!1)}function Xe(){this.state.mixertest.send({message:{request:"configure",muted:!0}}),this.participantChangeStatus(this.state.myId,!1)}function Ze(){this.state.mixertest&&this.state.mixertest.send({message:{request:"unpublish"}})}var et=window.RTCRtpTransceiver;nt.sessions={},nt.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||nt.extension.isInstalled()}return!0};var tt={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var n=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var a=new Error("NavigatorUserMediaError");a.name="You cancelled the request for permission, giving up...",n(a)}else n(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function nt(e){if((e=e||{}).success="function"==typeof e.success?e.success:nt.noop,e.error="function"==typeof e.error?e.error:nt.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:nt.noop,!nt.initDone)return e.error("Library not initialized"),{};if(!nt.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(nt.log("Library initialized: "+nt.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,n=null,a={},r=null,o=null,i=0,s=e.server;nt.isArray(s)?(nt.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,o=e.server,nt.debug(o)):0===s.indexOf("ws")?(t=!0,nt.log("Using WebSockets to contact Janus: "+s)):(t=!1,nt.log("Using REST API to contact Janus: "+s));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],l=e.iceTransportPolicy,d=e.bundlePolicy,u=!0===e.ipv6,m=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(m=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var p=null;void 0!==e.token&&null!==e.token&&(p=e.token);var h=null;void 0!==e.apisecret&&null!==e.apisecret&&(h=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var v=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(v=e.longPollTimeout),isNaN(v)&&(v=6e4);var w=!1,y=null,k={},S=this,C=0,E={};function j(){if(null!=y)if(nt.debug("Long poll..."),w){var t=s+"/"+y+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),p&&(t=t+"&token="+encodeURIComponent(p)),h&&(t=t+"&apisecret="+encodeURIComponent(h)),nt.httpAPICall(t,{verb:"GET",withCredentials:m,success:O,timeout:v,error:function(t,n){if(nt.error(t+":",n),++C>3)return w=!1,void e.error("Lost connection to the server (is it down?)");j()}})}else nt.warn("Is the server down? (connected=false)")}function O(e,a){if(C=0,t||void 0===y||null===y||!0===a||j(),t||!nt.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(c=e.sender))return void nt.warn("Missing sender...");if(!(d=k[c]))return void nt.debug("This handle is not attached to this session");var r=e.candidate;nt.debug("Got a trickled candidate on session "+y),nt.debug(r);var o=d.webrtcStuff;o.pc&&o.remoteSdp?(nt.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(nt.endOfCandidates)):(nt.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(r),nt.debug(o.candidates))}else{if("webrtcup"===e.janus)return nt.debug("Got a webrtcup event on session "+y),nt.debug(e),(c=e.sender)?(d=k[c])?void d.webrtcState(!0):void nt.debug("This handle is not attached to this session"):void nt.warn("Missing sender...");if("hangup"===e.janus){if(nt.debug("Got a hangup event on session "+y),nt.debug(e),!(c=e.sender))return void nt.warn("Missing sender...");if(!(d=k[c]))return void nt.debug("This handle is not attached to this session");d.webrtcState(!1,e.reason),d.hangup()}else if("detached"===e.janus){if(nt.debug("Got a detached event on session "+y),nt.debug(e),!(c=e.sender))return void nt.warn("Missing sender...");if(!(d=k[c]))return;d.ondetached(),d.detach()}else if("media"===e.janus){if(nt.debug("Got a media event on session "+y),nt.debug(e),!(c=e.sender))return void nt.warn("Missing sender...");if(!(d=k[c]))return void nt.debug("This handle is not attached to this session");d.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(nt.debug("Got a slowlink event on session "+y),nt.debug(e),!(c=e.sender))return void nt.warn("Missing sender...");if(!(d=k[c]))return void nt.debug("This handle is not attached to this session");d.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var i,s;if(nt.error("Ooops: "+e.error.code+" "+e.error.reason),nt.debug(e),i=e.transaction)(s=E[i])&&s(e),delete E[i];return}if("event"===e.janus){var c;if(nt.debug("Got a plugin event on session "+y),nt.debug(e),!(c=e.sender))return void nt.warn("Missing sender...");var l=e.plugindata;if(!l)return void nt.warn("Missing plugindata...");nt.debug("  -- Event is coming from "+c+" ("+l.plugin+")");var d,u=l.data;if(nt.debug(u),!(d=k[c]))return void nt.warn("This handle is not attached to this session");var m=e.jsep;m&&(nt.debug("Handling SDP as well..."),nt.debug(m));var f=d.onmessage;f?(nt.debug("Notifying application..."),f(u,m)):nt.debug("No provided notification callback")}else{if("timeout"===e.janus)return nt.error("Timeout on session "+y),nt.debug(e),void(t&&n.close(3504,"Gateway timeout"));nt.warn("Unknown message/event  '"+e.janus+"' on session "+y),nt.debug(e)}}}else nt.debug("Got a success on session "+y),nt.debug(e),(i=e.transaction)&&((s=E[i])&&s(e),delete E[i]);else nt.debug("Got an ack on session "+y),nt.debug(e),(i=e.transaction)&&((s=E[i])&&s(e),delete E[i]);else nt.debug("Got info on the Janus instance"),nt.debug(e),(i=e.transaction)&&((s=E[i])&&s(e),delete E[i]);else nt.vdebug("Got a keepalive on session "+y);else for(var p=0;p<e.length;p++)O(e[p],!0)}function T(){if(s&&t&&w){r=setTimeout(T,g);var e={janus:"keepalive",session_id:y,transaction:nt.randomString(12)};p&&(e.token=p),h&&(e.apisecret=h),n.send(JSON.stringify(e))}}function D(c){var l=nt.randomString(12),d={janus:"create",transaction:l};if(c.reconnect&&(w=!1,d.janus="claim",d.session_id=y,n&&(n.onopen=null,n.onerror=null,n.onclose=null,r&&(clearTimeout(r),r=null))),p&&(d.token=p),h&&(d.apisecret=h),!s&&nt.isArray(o)&&(0===(s=o[i]).indexOf("ws")?(t=!0,nt.log("Server #"+(i+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,nt.log("Server #"+(i+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var u in n=nt.newWebSocket(s,"janus-protocol"),a={error:function(){if(nt.error("Error connecting to the Janus WebSockets server... "+s),nt.isArray(o)&&!c.reconnect)return++i===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){D(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){E[l]=function(e){if(nt.debug(e),"success"!==e.janus)return nt.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);r=setTimeout(T,g),w=!0,y=e.session_id?e.session_id:e.data.id,c.reconnect?nt.log("Claimed session: "+y):nt.log("Created session: "+y),nt.sessions[y]=S,c.success()},n.send(JSON.stringify(d))},message:function(e){O(JSON.parse(e.data))},close:function(){s&&w&&(w=!1,e.error("Lost connection to the server (is it down?)"))}})n.addEventListener(u,a[u]);else nt.httpAPICall(s,{verb:"POST",withCredentials:m,body:d,success:function(e){if(nt.debug(e),"success"!==e.janus)return nt.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);w=!0,y=e.session_id?e.session_id:e.data.id,c.reconnect?nt.log("Claimed session: "+y):nt.log("Created session: "+y),nt.sessions[y]=S,j(),c.success()},error:function(e,t){if(nt.error(e+":",t),nt.isArray(o)&&!c.reconnect)return++i===o.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){D(c)}),200));""===t?c.error(e+": Is the server down?"):c.error(e+": "+t)}})}function I(e,a){if((a=a||{}).success="function"==typeof a.success?a.success:nt.noop,a.error="function"==typeof a.error?a.error:nt.noop,!w)return nt.warn("Is the server down? (connected=false)"),void a.error("Is the server down? (connected=false)");var r=k[e];if(!r||!r.webrtcStuff)return nt.warn("Invalid handle"),void a.error("Invalid handle");var o=a.message,i=a.jsep,c=nt.randomString(12),l={janus:"message",body:o,transaction:c};if(r.token&&(l.token=r.token),h&&(l.apisecret=h),i&&(l.jsep={type:i.type,sdp:i.sdp},i.e2ee&&(l.jsep.e2ee=!0),"hml"!==i.rid_order&&"lmh"!==i.rid_order||(l.jsep.rid_order=i.rid_order)),nt.debug("Sending message to plugin (handle="+e+"):"),nt.debug(l),t)return l.session_id=y,l.handle_id=e,E[c]=function(e){if(nt.debug("Message sent!"),nt.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return nt.warn("Request succeeded, but missing plugindata..."),void a.success();nt.log("Synchronous transaction successful ("+t.plugin+")");var n=t.data;return nt.debug(n),void a.success(n)}"ack"===e.janus?a.success():e.error?(nt.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(nt.error("Unknown error"),a.error("Unknown error"))},void n.send(JSON.stringify(l));nt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:l,success:function(e){if(nt.debug("Message sent!"),nt.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return nt.warn("Request succeeded, but missing plugindata..."),void a.success();nt.log("Synchronous transaction successful ("+t.plugin+")");var n=t.data;return nt.debug(n),void a.success(n)}"ack"===e.janus?a.success():e.error?(nt.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(nt.error("Unknown error"),a.error("Unknown error"))},error:function(e,t){nt.error(e+":",t),a.error(e+": "+t)}})}function x(e,a){if(w){var r=k[e];if(r&&r.webrtcStuff){var o={janus:"trickle",candidate:a,transaction:nt.randomString(12)};if(r.token&&(o.token=r.token),h&&(o.apisecret=h),nt.vdebug("Sending trickle candidate (handle="+e+"):"),nt.vdebug(o),t)return o.session_id=y,o.handle_id=e,void n.send(JSON.stringify(o));nt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:o,success:function(e){nt.vdebug("Candidate sent!"),nt.vdebug(e),"ack"===e.janus||nt.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){nt.error(e+":",t)}})}else nt.warn("Invalid handle")}else nt.warn("Is the server down? (connected=false)")}function A(e,t,n,a,r){var o=k[e];if(o&&o.webrtcStuff){var i=o.webrtcStuff;if(i.pc){var s=function(e){nt.log("Received state change on data channel:",e);var t=e.target.label,n=e.target.protocol,a=i.dataChannel[t]?i.dataChannel[t].readyState:"null";if(nt.log("State change on <"+t+"> data channel: "+a),"open"===a){if(i.dataChannel[t].pending&&i.dataChannel[t].pending.length>0){nt.log("Sending pending messages on <"+t+">:",i.dataChannel[t].pending.length);var r=!0,s=!1,c=void 0;try{for(var l,d=i.dataChannel[t].pending[Symbol.iterator]();!(r=(l=d.next()).done);r=!0){var u=l.value;nt.log("Sending data on data channel <"+t+">"),nt.debug(u),i.dataChannel[t].send(u)}}catch(m){s=!0,c=m}finally{try{r||null==d.return||d.return()}finally{if(s)throw c}}i.dataChannel[t].pending=[]}o.ondataopen(t,n)}};if(a)i.dataChannel[t]=a;else{var c={ordered:!0};n&&(c.protocol=n),i.dataChannel[t]=i.pc.createDataChannel(t,c)}i.dataChannel[t].onmessage=function(e){nt.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},i.dataChannel[t].onopen=s,i.dataChannel[t].onclose=s,i.dataChannel[t].onerror=function(e){nt.error("Got error on data channel:",e)},i.dataChannel[t].pending=[],r&&i.dataChannel[t].pending.push(r)}else nt.warn("Invalid PeerConnection")}else nt.warn("Invalid handle")}function R(e,t){(t=t||{}).success="function"==typeof t.success?t.success:nt.noop,t.error="function"==typeof t.error?t.error:nt.noop;var n=k[e];if(!n||!n.webrtcStuff)return nt.warn("Invalid handle"),void t.error("Invalid handle");var a=n.webrtcStuff,r=t.text||t.data;if(!r)return nt.warn("Invalid data"),void t.error("Invalid data");var o=t.label?t.label:nt.dataChanDefaultLabel;return a.dataChannel[o]?"open"!==a.dataChannel[o].readyState?(a.dataChannel[o].pending.push(r),void t.success()):(nt.log("Sending data on data channel <"+o+">"),nt.debug(r),a.dataChannel[o].send(r),void t.success()):(A(e,o,t.protocol,!1,r,t.protocol),void t.success())}function _(e,t){(t=t||{}).success="function"==typeof t.success?t.success:nt.noop,t.error="function"==typeof t.error?t.error:nt.noop;var n=k[e];if(!n||!n.webrtcStuff)return nt.warn("Invalid handle"),void t.error("Invalid handle");var a=n.webrtcStuff;if(!a.dtmfSender){if(a.pc){var r=a.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!r)return nt.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");a.dtmfSender=r.dtmf,a.dtmfSender&&(nt.log("Created DTMF Sender"),a.dtmfSender.ontonechange=function(e){nt.debug("Sent DTMF tone: "+e.tone)})}if(!a.dtmfSender)return nt.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(!o)return nt.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var i=o.tones;if(!i)return nt.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"===typeof o.duration?o.duration:500,c="number"===typeof o.gap?o.gap:50;nt.debug("Sending DTMF string "+i+" (duration "+s+"ms, gap "+c+"ms)"),a.dtmfSender.insertDTMF(i,s,c),t.success()}function P(e,a){(a=a||{}).success="function"==typeof a.success?a.success:nt.noop,a.error="function"==typeof a.error?a.error:nt.noop;var r=!0===a.noRequest;nt.log("Destroying handle "+e+" (only-locally="+r+")"),B(e);var o=k[e];if(!o||o.detached)return delete k[e],void a.success();if(o.detached=!0,r)return delete k[e],void a.success();if(!w)return nt.warn("Is the server down? (connected=false)"),void a.error("Is the server down? (connected=false)");var i={janus:"detach",transaction:nt.randomString(12)};if(o.token&&(i.token=o.token),h&&(i.apisecret=h),t)return i.session_id=y,i.handle_id=e,n.send(JSON.stringify(i)),delete k[e],void a.success();nt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:i,success:function(t){nt.log("Destroyed handle:"),nt.debug(t),"success"!==t.janus&&nt.error("Ooops: "+t.error.code+" "+t.error.reason),delete k[e],a.success()},error:function(t,n){nt.error(t+":",n),delete k[e],a.success()}})}function M(e,t,n,a,r){var o=k[e];if(!o||!o.webrtcStuff)return nt.warn("Invalid handle"),a.stream||nt.stopAllTracks(r),void a.error("Invalid handle");var i=o.webrtcStuff;nt.debug("streamsDone:",r),r&&(nt.debug("  -- Audio tracks:",r.getAudioTracks()),nt.debug("  -- Video tracks:",r.getVideoTracks()));var s=!1;if(i.myStream&&n.update&&(!i.streamExternal||n.replaceAudio||n.replaceVideo)){if((!n.update&&z(n)||n.update&&(n.addAudio||n.replaceAudio))&&r.getAudioTracks()&&r.getAudioTracks().length)if(i.myStream.addTrack(r.getAudioTracks()[0]),nt.unifiedPlan){nt.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]);var m=null;if((w=i.pc.getTransceivers())&&w.length>0){var f=!0,p=!1,h=void 0;try{for(var g,v=w[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){if((T=g.value).sender&&T.sender.track&&"audio"===T.sender.track.kind||T.receiver&&T.receiver.track&&"audio"===T.receiver.track.kind){m=T;break}}}catch(P){p=!0,h=P}finally{try{f||null==v.return||v.return()}finally{if(p)throw h}}}m&&m.sender?m.sender.replaceTrack(r.getAudioTracks()[0]):i.pc.addTrack(r.getAudioTracks()[0],r)}else nt.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",r.getAudioTracks()[0]),i.pc.addTrack(r.getAudioTracks()[0],r);if((!n.update&&q(n)||n.update&&(n.addVideo||n.replaceVideo))&&r.getVideoTracks()&&r.getVideoTracks().length)if(i.myStream.addTrack(r.getVideoTracks()[0]),nt.unifiedPlan){nt.log((n.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]);var w,y=null;if((w=i.pc.getTransceivers())&&w.length>0){var S=!0,C=!1,E=void 0;try{for(var j,O=w[Symbol.iterator]();!(S=(j=O.next()).done);S=!0){var T;if((T=j.value).sender&&T.sender.track&&"video"===T.sender.track.kind||T.receiver&&T.receiver.track&&"video"===T.receiver.track.kind){y=T;break}}}catch(P){C=!0,E=P}finally{try{S||null==O.return||O.return()}finally{if(C)throw E}}}y&&y.sender?y.sender.replaceTrack(r.getVideoTracks()[0]):i.pc.addTrack(r.getVideoTracks()[0],r)}else nt.log((n.replaceVideo?"Replacing":"Adding")+" video track:",r.getVideoTracks()[0]),i.pc.addTrack(r.getVideoTracks()[0],r)}else i.myStream=r,s=!0;if(!i.pc){var D={iceServers:c,iceTransportPolicy:l,bundlePolicy:d};"chrome"===nt.webRTCAdapter.browserDetails.browser&&(D.sdpSemantics=nt.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var I={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&I.optional.push({googIPv6:!0}),a.rtcConstraints&&"object"===typeof a.rtcConstraints)for(var R in nt.debug("Adding custom PeerConnection constraints:",a.rtcConstraints),a.rtcConstraints)I.optional.push(a.rtcConstraints[R]);"edge"===nt.webRTCAdapter.browserDetails.browser&&(D.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(a.senderTransforms||a.receiverTransforms)&&(i.senderTransforms=a.senderTransforms,i.receiverTransforms=a.receiverTransforms,D.forceEncodedAudioInsertableStreams=!0,D.forceEncodedVideoInsertableStreams=!0,D.encodedInsertableStreams=!0),nt.log("Creating PeerConnection"),nt.debug(I),i.pc=new RTCPeerConnection(D,I),nt.debug(i.pc),i.pc.getStats&&(i.volume={},i.bitrate.value="0 kbits/sec"),nt.log("Preparing local SDP and gathering candidates (trickle="+i.trickle+")"),i.pc.oniceconnectionstatechange=function(e){i.pc&&o.iceState(i.pc.iceConnectionState)},i.pc.onicecandidate=function(t){if(!t.candidate||"edge"===nt.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)nt.log("End of candidates."),i.iceDone=!0,!0===i.trickle?x(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:nt.noop,t.error="function"==typeof t.error?t.error:nt.noop;var n=k[e];if(!n||!n.webrtcStuff)return void nt.warn("Invalid handle, not sending anything");var a=n.webrtcStuff;if(nt.log("Sending offer/answer SDP..."),!a.mySdp)return void nt.warn("Local SDP instance is invalid, not sending anything...");a.mySdp={type:a.pc.localDescription.type,sdp:a.pc.localDescription.sdp},!1===a.trickle&&(a.mySdp.trickle=!1);nt.debug(t),a.sdpSent=!0,t.success(a.mySdp)}(e,a);else{var n={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===i.trickle&&x(e,n)}},i.pc.ontrack=function(e){if(nt.log("Handling Remote Track"),nt.debug(e),e.streams&&(i.remoteStream=e.streams[0],o.onremotestream(i.remoteStream),!e.track.onended)){if(i.receiverTransforms){var t=null;RTCRtpSender.prototype.createEncodedStreams?t=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&i.receiverTransforms.audio?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&i.receiverTransforms.video&&(t=e.receiver.createEncodedVideoStreams())),t&&(console.log(t),t.readableStream&&t.writableStream?t.readableStream.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(t.writableStream):t.readable&&t.writable&&t.readable.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(t.writable))}var n=null;nt.log("Adding onended callback to track:",e.track),e.track.onended=function(e){nt.log("Remote track removed:",e),i.remoteStream&&(clearTimeout(n),i.remoteStream.removeTrack(e.target),o.onremotestream(i.remoteStream))},e.track.onmute=function(e){nt.log("Remote track muted:",e),i.remoteStream&&null==n&&(n=setTimeout((function(){nt.log("Removing remote track"),i.remoteStream&&(i.remoteStream.removeTrack(e.target),o.onremotestream(i.remoteStream)),n=null}),2520))},e.track.onunmute=function(e){if(nt.log("Remote track flowing again:",e),null!=n)clearTimeout(n),n=null;else try{i.remoteStream.addTrack(e.target),o.onremotestream(i.remoteStream)}catch(t){nt.error(t)}}}}}if(s&&r){nt.log("Adding local stream");var _=!0===a.simulcast2;r.getTracks().forEach((function(e){nt.log("Adding local track:",e);var t=null;if(_&&"audio"!==e.kind){nt.log("Enabling rid-based simulcasting:",e);var n=b(a.simulcastMaxBitrates),o=i.pc.addTransceiver(e,{direction:"sendrecv",streams:[r],sendEncodings:a.sendEncodings||[{rid:"h",active:!0,maxBitrate:n.high},{rid:"m",active:!0,maxBitrate:n.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:n.low,scaleResolutionDownBy:4}]});o&&(t=o.sender)}else t=i.pc.addTrack(e,r);if(t&&i.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&i.senderTransforms.audio?s=t.createEncodedAudioStreams():"video"===t.track.kind&&i.senderTransforms.video&&(s=t.createEncodedVideoStreams())),s&&(console.log(s),s.readableStream&&s.writableStream?s.readableStream.pipeThrough(i.senderTransforms[t.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(i.senderTransforms[t.track.kind]).pipeTo(s.writable))}}))}(function(e){if(nt.debug("isDataEnabled:",e),"edge"===nt.webRTCAdapter.browserDetails.browser)return nt.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(n)&&!i.dataChannel[nt.dataChanDefaultLabel]&&(nt.log("Creating default data channel"),A(e,nt.dataChanDefaultLabel,null,!1),i.pc.ondatachannel=function(t){nt.log("Data channel created by Janus:",t),A(e,t.channel.label,t.channel.protocol,t.channel)}),i.myStream&&o.onlocalstream(i.myStream),t?i.pc.setRemoteDescription(t).then((function(){if(nt.log("Remote description accepted!"),i.remoteSdp=t.sdp,i.candidates&&i.candidates.length>0){for(var r=0;r<i.candidates.length;r++){var o=i.candidates[r];nt.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(nt.endOfCandidates)}i.candidates=[]}!function(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:nt.noop,n.error="function"==typeof n.error?n.error:nt.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:nt.noop;var a=k[e];if(!a||!a.webrtcStuff)return nt.warn("Invalid handle"),void n.error("Invalid handle");var r=a.webrtcStuff,o=!0===n.simulcast;o?nt.log("Creating answer (iceDone="+r.iceDone+", simulcast="+o+")"):nt.log("Creating answer (iceDone="+r.iceDone+")");var i=null;if(nt.unifiedPlan){i={};var s=null,c=null,l=r.pc.getTransceivers();if(l&&l.length>0){var d=!0,u=!1,m=void 0;try{for(var f,p=l[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind?s||(s=h):(h.sender&&h.sender.track&&"video"===h.sender.track.kind||h.receiver&&h.receiver.track&&"video"===h.receiver.track.kind)&&(c||(c=h))}}catch(P){u=!0,m=P}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}}var g=z(t),v=J(t);if(g||v){if(g&&v){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",nt.log("Setting audio transceiver to sendrecv:",s)}catch(O){nt.error(O)}}else if(g&&!v)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",nt.log("Setting audio transceiver to sendonly:",s))}catch(O){nt.error(O)}else if(!g&&v)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",nt.log("Setting audio transceiver to recvonly:",s)}catch(O){nt.error(O)}else s=r.pc.addTransceiver("audio",{direction:"recvonly"}),nt.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",nt.log("Setting audio transceiver to inactive:",s)}catch(O){nt.error(O)}var w=q(t),y=G(t);if(w||y){if(w&&y){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",nt.log("Setting video transceiver to sendrecv:",c)}catch(O){nt.error(O)}}else if(w&&!y){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",nt.log("Setting video transceiver to sendonly:",c)}catch(O){nt.error(O)}}else if(!w&&y)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",nt.log("Setting video transceiver to recvonly:",c)}catch(O){nt.error(O)}else c=r.pc.addTransceiver("video",{direction:"recvonly"}),nt.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",nt.log("Setting video transceiver to inactive:",c)}catch(O){nt.error(O)}}else i="firefox"===nt.webRTCAdapter.browserDetails.browser||"edge"===nt.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:J(t),offerToReceiveVideo:G(t)}:{mandatory:{OfferToReceiveAudio:J(t),OfferToReceiveVideo:G(t)}};nt.debug(i);var S=q(t);if(S&&o&&"firefox"===nt.webRTCAdapter.browserDetails.browser){nt.log("Enabling Simulcasting for Firefox (RID)");var C=r.pc.getSenders()[1];nt.log(C);var E=C.getParameters();nt.log(E);var j=b(n.simulcastMaxBitrates);C.setParameters({encodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:j.high},{rid:"m",active:!0,maxBitrate:j.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:j.low,scaleResolutionDownBy:4}]})}r.pc.createAnswer(i).then((function(e){nt.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,nt.log("Setting local description"),S&&o&&("chrome"===nt.webRTCAdapter.browserDetails.browser?nt.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==nt.webRTCAdapter.browserDetails.browser&&nt.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp={type:"answer",sdp:e.sdp},r.pc.setLocalDescription(e).catch(n.error),r.mediaConstraints=i,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),n.success(e)):nt.log("Waiting for all candidates...")}),n.error)}(e,n,a)}),a.error):function(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:nt.noop,n.error="function"==typeof n.error?n.error:nt.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:nt.noop;var a=k[e];if(!a||!a.webrtcStuff)return nt.warn("Invalid handle"),void n.error("Invalid handle");var r=a.webrtcStuff,o=!0===n.simulcast;o?nt.log("Creating offer (iceDone="+r.iceDone+", simulcast="+o+")"):nt.log("Creating offer (iceDone="+r.iceDone+")");var i={};if(nt.unifiedPlan){var s=null,c=null,l=r.pc.getTransceivers();if(l&&l.length>0){var d=!0,u=!1,m=void 0;try{for(var f,p=l[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind?s||(s=h):(h.sender&&h.sender.track&&"video"===h.sender.track.kind||h.receiver&&h.receiver.track&&"video"===h.receiver.track.kind)&&(c||(c=h))}}catch(P){u=!0,m=P}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}}var g=z(t),v=J(t);g||v?g&&v?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",nt.log("Setting audio transceiver to sendrecv:",s)):g&&!v?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",nt.log("Setting audio transceiver to sendonly:",s)):!g&&v&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",nt.log("Setting audio transceiver to recvonly:",s)):(s=r.pc.addTransceiver("audio",{direction:"recvonly"}),nt.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",nt.log("Setting audio transceiver to inactive:",s));var w=q(t),y=G(t);w||y?w&&y?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",nt.log("Setting video transceiver to sendrecv:",c)):w&&!y?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",nt.log("Setting video transceiver to sendonly:",c)):!w&&y&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",nt.log("Setting video transceiver to recvonly:",c)):(c=r.pc.addTransceiver("video",{direction:"recvonly"}),nt.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",nt.log("Setting video transceiver to inactive:",c))}else i.offerToReceiveAudio=J(t),i.offerToReceiveVideo=G(t);!0===n.iceRestart&&(i.iceRestart=!0);nt.debug(i);var S=q(t);if(S&&o&&"firefox"===nt.webRTCAdapter.browserDetails.browser){nt.log("Enabling Simulcasting for Firefox (RID)");var C=r.pc.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(C){var E=C.getParameters();E||(E={});var j=b(n.simulcastMaxBitrates);E.encodings=n.sendEncodings||[{rid:"h",active:!0,maxBitrate:j.high},{rid:"m",active:!0,maxBitrate:j.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:j.low,scaleResolutionDownBy:4}],C.setParameters(E)}}r.pc.createOffer(i).then((function(e){nt.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,nt.log("Setting local description"),S&&o&&("chrome"===nt.webRTCAdapter.browserDetails.browser||"safari"===nt.webRTCAdapter.browserDetails.browser?(nt.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),n=!1,a=[-1],r=[-1],o=null,i=null,s=null,c=null,l=-1,d=0;d<t.length;d++){if(m=t[d].match(/m=(\w+) */)){if("video"===m[1]){if(!(a[0]<0)){l=d;break}n=!0}else if(a[0]>-1){l=d;break}}else if(n){if(t[d].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/))return nt.warn("The SDP already contains a SIM attribute, munging will be skipped"),e;var u=t[d].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)a[0]=u[1],r[0]=u[2],t.splice(d,1),d--;else{if(a[0]){if((p=t[d].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(i=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" label:(.+)"))&&(c=p[1]),0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+a[0])){t.splice(d,1),d--;continue}}0!=t[d].length||(t.splice(d,1),d--)}}}if(a[0]<0){l=-1,n=!1;for(d=0;d<t.length;d++){var m;if(m=t[d].match(/m=(\w+) */)){if("video"===m[1]){if(!(a[0]<0)){l=d;break}n=!0}else if(a[0]>-1){l=d;break}}else if(n){if(a[0]<0){var f=t[d].match(/a=ssrc:(\d+)/);if(f){a[0]=f[1],t.splice(d,1),d--;continue}}else{var p;if((p=t[d].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(i=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=p[1]),(p=t[d].match("a=ssrc:"+a[0]+" label:(.+)"))&&(c=p[1]),0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+a[0])){t.splice(d,1),d--;continue}}0!==t[d].length||(t.splice(d,1),d--)}}}if(a[0]<0)return nt.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;l<0&&(l=t.length);a[1]=Math.floor(4294967295*Math.random()),a[2]=Math.floor(4294967295*Math.random()),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random());for(d=0;d<a.length;d++)o&&(t.splice(l,0,"a=ssrc:"+a[d]+" cname:"+o),l++),i&&(t.splice(l,0,"a=ssrc:"+a[d]+" msid:"+i),l++),s&&(t.splice(l,0,"a=ssrc:"+a[d]+" mslabel:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+a[d]+" label:"+c),l++),o&&(t.splice(l,0,"a=ssrc:"+r[d]+" cname:"+o),l++),i&&(t.splice(l,0,"a=ssrc:"+r[d]+" msid:"+i),l++),s&&(t.splice(l,0,"a=ssrc:"+r[d]+" mslabel:"+s),l++),c&&(t.splice(l,0,"a=ssrc:"+r[d]+" label:"+c),l++);t.splice(l,0,"a=ssrc-group:FID "+a[2]+" "+r[2]),t.splice(l,0,"a=ssrc-group:FID "+a[1]+" "+r[1]),t.splice(l,0,"a=ssrc-group:FID "+a[0]+" "+r[0]),t.splice(l,0,"a=ssrc-group:SIM "+a[0]+" "+a[1]+" "+a[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==nt.webRTCAdapter.browserDetails.browser&&nt.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),r.mySdp={type:"offer",sdp:e.sdp},r.pc.setLocalDescription(e).catch(n.error),r.mediaConstraints=i,r.iceDone||r.trickle?((r.senderTransforms||r.receiverTransforms)&&(e.e2ee=!0),n.success(e)):nt.log("Waiting for all candidates...")}),n.error)}(e,n,a)}function V(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:nt.noop,n.error="function"==typeof n.error?n.error:$;var a=n.jsep;if(t&&a)return nt.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!t&&(!a||!a.type||!a.sdp))return nt.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media="object"===typeof n.media&&n.media?n.media:{audio:!0,video:!0};var r=n.media,o=k[e];if(!o||!o.webrtcStuff)return nt.warn("Invalid handle"),void n.error("Invalid handle");var i,s=o.webrtcStuff;if(s.trickle=(i=n.trickle,nt.debug("isTrickleEnabled:",i),!1!==i),s.pc){if(nt.log("Updating existing media session"),r.update=!0,n.stream)n.stream!==s.myStream&&nt.log("Renegotiation involves a new external stream");else{if(r.addAudio){if(r.keepAudio=!1,r.replaceAudio=!1,r.removeAudio=!1,r.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return nt.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else r.removeAudio?(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!1,r.audioSend=!1):r.replaceAudio&&(r.keepAudio=!1,r.addAudio=!1,r.removeAudio=!1,r.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!z(r)||r.removeAudio||r.replaceAudio||(r.keepAudio=!0):(r.replaceAudio&&(r.keepAudio=!1,r.replaceAudio=!1,r.addAudio=!0,r.audioSend=!0),z(r)&&(r.keepAudio=!1,r.addAudio=!0)),r.addVideo){if(r.keepVideo=!1,r.replaceVideo=!1,r.removeVideo=!1,r.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return nt.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else r.removeVideo?(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!1,r.videoSend=!1):r.replaceVideo&&(r.keepVideo=!1,r.addVideo=!1,r.removeVideo=!1,r.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!q(r)||r.removeVideo||r.replaceVideo||(r.keepVideo=!0):(r.replaceVideo&&(r.keepVideo=!1,r.replaceVideo=!1,r.addVideo=!0,r.videoSend=!0),q(r)&&(r.keepVideo=!1,r.addVideo=!0)),r.addData&&(r.data=!0)}if(z(r)&&r.keepAudio&&q(r)&&r.keepVideo)return o.consentDialog(!1),void M(e,a,r,n,s.myStream)}else r.update=!1,r.keepAudio=!1,r.keepVideo=!1;if(r.update&&(!s.streamExternal||s.streamExternal&&(r.replaceAudio||r.replaceVideo))){if(r.removeAudio||r.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var c=s.myStream.getAudioTracks()[0];nt.log("Removing audio track:",c),s.myStream.removeTrack(c);try{c.stop()}catch(N){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var l=!0;if(r.replaceAudio&&nt.unifiedPlan&&(l=!1),l){var d=!0,u=!1,m=void 0;try{for(var f,p=s.pc.getSenders()[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;h&&h.track&&"audio"===h.track.kind&&(nt.log("Removing audio sender:",h),s.pc.removeTrack(h))}}catch(F){u=!0,m=F}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}}}}if(r.removeVideo||r.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var g=s.myStream.getVideoTracks()[0];nt.log("Removing video track:",g),s.myStream.removeTrack(g);try{g.stop()}catch(N){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var v=!0;if(r.replaceVideo&&nt.unifiedPlan&&(v=!1),v){var b=!0,w=!1,y=void 0;try{for(var S,C=s.pc.getSenders()[Symbol.iterator]();!(b=(S=C.next()).done);b=!0){var E=S.value;E&&E.track&&"video"===E.track.kind&&(nt.log("Removing video sender:",E),s.pc.removeTrack(E))}}catch(F){w=!0,y=F}finally{try{b||null==C.return||C.return()}finally{if(w)throw y}}}}}}if(n.stream){var j=n.stream;return nt.log("MediaStream provided by the application"),nt.debug(j),!r.update||!s.myStream||s.myStream===n.stream||s.streamExternal||r.replaceAudio||r.replaceVideo||(nt.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,o.consentDialog(!1),void M(e,a,r,n,j)}if(z(r)||q(r)){if(!nt.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var O={mandatory:{},optional:[]};o.consentDialog(!0);var T=z(r);T&&r&&"object"===typeof r.audio&&(T=r.audio);var D=q(r);if(D&&r){var I=!0===n.simulcast,x=!0===n.simulcast2;if(!I&&!x||a||r.video||(r.video="hires"),r.video&&"screen"!=r.video&&"window"!=r.video)if("object"===typeof r.video)D=r.video;else{var A=0,R=0;"lowres"===r.video?(R=240,240,A=320):"lowres-16:9"===r.video?(R=180,180,A=320):"hires"===r.video||"hires-16:9"===r.video||"hdres"===r.video?(R=720,720,A=1280):"fhdres"===r.video?(R=1080,1080,A=1920):"4kres"===r.video?(R=2160,2160,A=3840):"stdres"===r.video?(R=480,480,A=640):"stdres-16:9"===r.video?(R=360,360,A=640):(nt.log("Default video setting is stdres 4:3"),R=480,480,A=640),nt.log("Adding media constraint:",r.video),D={height:{ideal:R},width:{ideal:A}},nt.log("Adding video constraint:",D)}else if("screen"===r.video||"window"===r.video){var _=function(t,i){o.consentDialog(!1),t?n.error(t):M(e,a,r,n,i)},P=function(e,t,n){nt.log("Adding media constraint (screen capture)"),nt.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){e.addTrack(n.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){o.consentDialog(!1),t(e)}))};if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return O.video={},r.screenshareFrameRate&&(O.video.frameRate=r.screenshareFrameRate),r.screenshareHeight&&(O.video.height=r.screenshareHeight),r.screenshareWidth&&(O.video.width=r.screenshareWidth),O.audio=r.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(O).then((function(t){o.consentDialog(!1),z(r)&&!r.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(o){t.addTrack(o.getAudioTracks()[0]),M(e,a,r,n,t)})):M(e,a,r,n,t)}),(function(e){o.consentDialog(!1),n.error(e)}));if("chrome"===nt.webRTCAdapter.browserDetails.browser){var V=nt.webRTCAdapter.browserDetails.version,U=33;window.navigator.userAgent.match("Linux")&&(U=35),V>=26&&V<=U?(O={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate,chromeMediaSource:"screen"}},audio:z(r)&&!r.keepAudio},P(O,_)):nt.extension.getScreen((function(e,t){if(e)return o.consentDialog(!1),n.error(e);(O={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:r.screenshareFrameRate,maxFrameRate:r.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,P(O,_,z(r)&&!r.keepAudio)}))}else if("firefox"===nt.webRTCAdapter.browserDetails.browser){if(!(nt.webRTCAdapter.browserDetails.version>=33)){var L=new Error("NavigatorUserMediaError");return L.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void n.error(L)}O={video:{mozMediaSource:r.video,mediaSource:r.video},audio:z(r)&&!r.keepAudio},P(O,(function(e,t){if(_(e,t),!e)var n=t.currentTime,a=window.setInterval((function(){t||window.clearInterval(a),t.currentTime==n&&(window.clearInterval(a),t.onended&&t.onended()),n=t.currentTime}),500)}))}return}}r&&"screen"===r.video||navigator.mediaDevices.enumerateDevices().then((function(t){var i=t.some((function(e){return"audioinput"===e.kind})),s=function(e){if(nt.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(r)||t.some((function(e){return"videoinput"===e.kind})),c=z(r),l=q(r),d=function(e){return nt.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(r),u=function(e){return nt.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(r);if(c||l||d||u){var m=!!c&&i,f=!!l&&s;if(!m&&!f)return o.consentDialog(!1),n.error("No capture device found"),!1;if(!m&&d)return o.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!f&&u)return o.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var p={audio:!(!i||r.keepAudio)&&T,video:!(!s||r.keepVideo)&&D};nt.debug("getUserMedia constraints",p),p.audio||p.video?navigator.mediaDevices.getUserMedia(p).then((function(t){o.consentDialog(!1),M(e,a,r,n,t)})).catch((function(e){o.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})):(o.consentDialog(!1),M(e,a,r,n,j))})).catch((function(e){o.consentDialog(!1),n.error(e)}))}else M(e,a,r,n)}function U(e,t){(t=t||{}).success="function"==typeof t.success?t.success:nt.noop,t.error="function"==typeof t.error?t.error:$,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:nt.noop;var n=t.jsep,a=k[e];if(!a||!a.webrtcStuff)return nt.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff;if(n){if(!r.pc)return nt.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.customizeSdp(n),r.pc.setRemoteDescription(n).then((function(){if(nt.log("Remote description accepted!"),r.remoteSdp=n.sdp,r.candidates&&r.candidates.length>0){for(var e=0;e<r.candidates.length;e++){var a=r.candidates[e];nt.debug("Adding remote candidate:",a),a&&!0!==a.completed?r.pc.addIceCandidate(a):r.pc.addIceCandidate(nt.endOfCandidates)}r.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function L(e,t){var n=k[e];if(!n||!n.webrtcStuff)return nt.warn("Invalid handle"),0;var a=t?"remote":"local",r=n.webrtcStuff;return r.volume[a]||(r.volume[a]={value:0}),!r.pc.getStats||"chrome"!==nt.webRTCAdapter.browserDetails.browser&&"safari"!==nt.webRTCAdapter.browserDetails.browser?(nt.warn("Getting the "+a+" volume unsupported by browser"),0):t&&!r.remoteStream?(nt.warn("Remote stream unavailable"),0):t||r.myStream?r.volume[a].timer?r.volume[a].value:(nt.log("Starting "+a+" volume monitor"),r.volume[a].timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(r.volume[a].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(nt.warn("Local stream unavailable"),0)}function N(e,t){var n=k[e];if(!n||!n.webrtcStuff)return nt.warn("Invalid handle"),!0;var a=n.webrtcStuff;return a.pc?a.myStream?t?a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!a.myStream.getVideoTracks()[0].enabled:(nt.warn("No video track"),!0):a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!a.myStream.getAudioTracks()[0].enabled:(nt.warn("No audio track"),!0):(nt.warn("Invalid local MediaStream"),!0):(nt.warn("Invalid PeerConnection"),!0)}function F(e,t,n){var a=k[e];if(!a||!a.webrtcStuff)return nt.warn("Invalid handle"),!1;var r=a.webrtcStuff;return r.pc?r.myStream?t?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?(r.myStream.getVideoTracks()[0].enabled=!n,!0):(nt.warn("No video track"),!1):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?(r.myStream.getAudioTracks()[0].enabled=!n,!0):(nt.warn("No audio track"),!1):(nt.warn("Invalid local MediaStream"),!1):(nt.warn("Invalid PeerConnection"),!1)}function W(e){var t=k[e];if(!t||!t.webrtcStuff)return nt.warn("Invalid handle"),"Invalid handle";var n=t.webrtcStuff;return n.pc?n.pc.getStats?n.bitrate.timer?n.bitrate.value:(nt.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var a=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"===nt.webRTCAdapter.browserDetails.browser&&(a/=1e3);var r=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/a);"safari"===nt.webRTCAdapter.browserDetails.browser&&(r=parseInt(r/1e3)),n.bitrate.value=r+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(nt.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function $(e){nt.error("WebRTC error:",e)}function B(e,a){nt.log("Cleaning WebRTC stuff");var r=k[e];if(r){var o=r.webrtcStuff;if(o){if(!0===a){var i={janus:"hangup",transaction:nt.randomString(12)};r.token&&(i.token=r.token),h&&(i.apisecret=h),nt.debug("Sending hangup request (handle="+e+"):"),nt.debug(i),t?(i.session_id=y,i.handle_id=e,n.send(JSON.stringify(i))):nt.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:m,body:i})}o.remoteStream=null,o.volume&&(o.volume.local&&o.volume.local.timer&&clearInterval(o.volume.local.timer),o.volume.remote&&o.volume.remote.timer&&clearInterval(o.volume.remote.timer)),o.volume={},o.bitrate.timer&&clearInterval(o.bitrate.timer),o.bitrate.timer=null,o.bitrate.bsnow=null,o.bitrate.bsbefore=null,o.bitrate.tsnow=null,o.bitrate.tsbefore=null,o.bitrate.value=null,!o.streamExternal&&o.myStream&&(nt.log("Stopping local stream tracks"),nt.stopAllTracks(o.myStream)),o.streamExternal=!1,o.myStream=null;try{o.pc.close()}catch(c){}o.pc=null,o.candidates=null,o.mySdp=null,o.remoteSdp=null,o.iceDone=!1,o.dataChannel={},o.dtmfSender=null,o.senderTransforms=null,o.receiverTransforms=null}r.oncleanup()}}function z(e){return nt.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function J(e){return nt.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function q(e){return nt.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function G(e){return nt.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}D(e),this.getServer=function(){return s},this.isConnected=function(){return w},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:nt.noop,e.error="function"==typeof e.error?e.error:nt.noop,e.reconnect=!0,D(e)},this.getSessionId=function(){return y},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:nt.noop,e.error="function"==typeof e.error?e.error:nt.noop,nt.log("Getting info on Janus instance"),!w)return nt.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var a=nt.randomString(12),r={janus:"info",transaction:a};p&&(r.token=p);h&&(r.apisecret=h);if(t)return E[a]=function(t){nt.log("Server info:"),nt.debug(t),"server_info"!==t.janus&&nt.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},void n.send(JSON.stringify(r));nt.httpAPICall(s,{verb:"POST",withCredentials:m,body:r,success:function(t){nt.log("Server info:"),nt.debug(t),"server_info"!==t.janus&&nt.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,n){nt.error(t+":",n),""===n?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}(e)},this.destroy=function(o){!function(o){(o=o||{}).success="function"==typeof o.success?o.success:nt.noop,o.error="function"==typeof o.error?o.error:nt.noop;var i=!0===o.unload,c=!0;void 0!==o.notifyDestroyed&&null!==o.notifyDestroyed&&(c=!0===o.notifyDestroyed);var l=!0===o.cleanupHandles;if(nt.log("Destroying session "+y+" (unload="+i+")"),!y)return nt.warn("No session to destroy"),o.success(),void(c&&e.destroyed());if(l)for(var d in k)P(d,{noRequest:!0});if(!w)return nt.warn("Is the server down? (connected=false)"),y=null,void o.success();var u={janus:"destroy",transaction:nt.randomString(12)};p&&(u.token=p);h&&(u.apisecret=h);if(i)return t?(n.onclose=null,n.close(),n=null):navigator.sendBeacon(s+"/"+y,JSON.stringify(u)),nt.log("Destroyed session:"),y=null,w=!1,o.success(),void(c&&e.destroyed());if(t){u.session_id=y;var f=function(){for(var e in a)n.removeEventListener(e,a[e]);n.removeEventListener("message",g),n.removeEventListener("error",v),r&&clearTimeout(r),n.close()},g=function(t){var n=JSON.parse(t.data);n.session_id==u.session_id&&n.transaction==u.transaction&&(f(),o.success(),c&&e.destroyed())},v=function(t){f(),o.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return n.addEventListener("message",g),n.addEventListener("error",v),void(1===n.readyState?n.send(JSON.stringify(u)):v())}nt.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:m,body:u,success:function(t){nt.log("Destroyed session:"),nt.debug(t),y=null,w=!1,"success"!==t.janus&&nt.error("Ooops: "+t.error.code+" "+t.error.reason),o.success(),c&&e.destroyed()},error:function(t,n){nt.error(t+":",n),y=null,w=!1,o.success(),c&&e.destroyed()}})}(o)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:nt.noop,e.error="function"==typeof e.error?e.error:nt.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:nt.noop,e.iceState="function"==typeof e.iceState?e.iceState:nt.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:nt.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:nt.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:nt.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:nt.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:nt.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:nt.noop,e.ondata="function"==typeof e.ondata?e.ondata:nt.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:nt.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:nt.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:nt.noop,!w)return nt.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var a=e.plugin;if(!a)return nt.error("Invalid plugin"),void e.error("Invalid plugin");var r=e.opaqueId,o=e.token?e.token:p,i=nt.randomString(12),c={janus:"attach",plugin:a,opaque_id:r,transaction:i};o&&(c.token=o);h&&(c.apisecret=h);if(t)return E[i]=function(t){if(nt.debug(t),"success"!==t.janus)return nt.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var n=t.data.id;nt.log("Created handle: "+n);var r={session:S,plugin:a,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return L(n,!0)},getRemoteVolume:function(){return L(n,!0)},getLocalVolume:function(){return L(n,!1)},isAudioMuted:function(){return N(n,!1)},muteAudio:function(){return F(n,!1,!0)},unmuteAudio:function(){return F(n,!1,!1)},isVideoMuted:function(){return N(n,!0)},muteVideo:function(){return F(n,!0,!0)},unmuteVideo:function(){return F(n,!0,!1)},getBitrate:function(){return W(n)},send:function(e){I(n,e)},data:function(e){R(n,e)},dtmf:function(e){_(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){V(n,!0,e)},createAnswer:function(e){V(n,!1,e)},handleRemoteJsep:function(e){U(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){B(n,!0===e)},detach:function(e){P(n,e)}};k[n]=r,e.success(r)},c.session_id=y,void n.send(JSON.stringify(c));nt.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:m,body:c,success:function(t){if(nt.debug(t),"success"!==t.janus)return nt.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var n=t.data.id;nt.log("Created handle: "+n);var r={session:S,plugin:a,id:n,token:o,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return a},getVolume:function(){return L(n,!0)},getRemoteVolume:function(){return L(n,!0)},getLocalVolume:function(){return L(n,!1)},isAudioMuted:function(){return N(n,!1)},muteAudio:function(){return F(n,!1,!0)},unmuteAudio:function(){return F(n,!1,!1)},isVideoMuted:function(){return N(n,!0)},muteVideo:function(){return F(n,!0,!0)},unmuteVideo:function(){return F(n,!0,!1)},getBitrate:function(){return W(n)},send:function(e){I(n,e)},data:function(e){R(n,e)},dtmf:function(e){_(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){V(n,!0,e)},createAnswer:function(e){V(n,!1,e)},handleRemoteJsep:function(e){U(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){B(n,!0===e)},detach:function(e){P(n,e)}};k[n]=r,e.success(r)},error:function(t,n){nt.error(t+":",n),""===n?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}(e)}}nt.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,n=e&&e.Promise||Promise,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new a(e,t)},extension:e&&e.extension||tt,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||_.a,httpAPICall:function(e,a){var r={method:a.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===a.verb&&(r.headers["Content-Type"]="application/json"),void 0!==a.withCredentials&&(r.credentials=!0===a.withCredentials?"include":a.withCredentials?a.withCredentials:"omit"),a.body&&(r.body=JSON.stringify(a.body));var o=t(e,r).catch((function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})}));if(a.timeout){var i=new n((function(e,t){var n=setTimeout((function(){return clearTimeout(n),t({message:"Request timed out",timeout:a.timeout})}),a.timeout)}));o=n.race([o,i])}return o.then((function(e){return e.ok?typeof a.success===typeof nt.noop?e.json().then((function(e){try{a.success(e)}catch(t){nt.error("Unhandled httpAPICall success callback error",t)}}),(function(t){return n.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:n.reject({message:"API call failed",response:e})})).catch((function(e){typeof a.error===typeof nt.noop&&a.error(e.message||"<< internal error >>",e)})),o}}},nt.useOldDependencies=function(e){var t=e&&e.jQuery||R.a,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||tt,webRTCAdapter:e&&e.adapter||_.a,httpAPICall:function(e,n){var a=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},r=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return t.ajax(t.extend(a,r,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){typeof n.success===typeof nt.noop&&n.success(e)},error:function(e,t,a){typeof n.error===typeof nt.noop&&n.error(t,a)}}))}}},nt.noop=function(){},nt.dataChanDefaultLabel="JanusDataChannel",nt.endOfCandidates=null,nt.stopAllTracks=function(e){try{var t=e.getTracks(),n=!0,a=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var s=o.value;nt.log(s),s&&s.stop()}}catch(c){a=!0,r=c}finally{try{n||null==i.return||i.return()}finally{if(a)throw r}}}catch(l){}},nt.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:nt.noop,nt.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),nt.trace=nt.noop,nt.debug=nt.noop,nt.vdebug=nt.noop,nt.log=nt.noop,nt.warn=nt.noop,nt.error=nt.noop,!0===e.debug||"all"===e.debug)nt.trace=console.trace.bind(console),nt.debug=console.debug.bind(console),nt.vdebug=console.debug.bind(console),nt.log=console.log.bind(console),nt.warn=console.warn.bind(console),nt.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t=!0,n=!1,a=void 0;try{for(var r,o=e.debug[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;switch(i){case"trace":nt.trace=console.trace.bind(console);break;case"debug":nt.debug=console.debug.bind(console);break;case"vdebug":nt.vdebug=console.debug.bind(console);break;case"log":nt.log=console.log.bind(console);break;case"warn":nt.warn=console.warn.bind(console);break;case"error":nt.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+i+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(b){n=!0,a=b}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}nt.log("Initializing library");var s=e.dependencies||nt.useDefaultDependencies();nt.isArray=s.isArray,nt.webRTCAdapter=s.webRTCAdapter,nt.httpAPICall=s.httpAPICall,nt.newWebSocket=s.newWebSocket,nt.extension=s.extension,nt.extension.init(),nt.listDevices=function(e,t){e="function"==typeof e?e:nt.noop,null==t&&(t={audio:!0,video:!0}),nt.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){nt.debug(n),e(n),nt.stopAllTracks(t)}))})).catch((function(t){nt.error(t),e([])})):(nt.warn("navigator.mediaDevices unavailable"),e([]))},nt.attachMediaStream=function(e,t){try{e.srcObject=t}catch(n){try{e.src=URL.createObjectURL(t)}catch(n){nt.error("Error attaching stream to element")}}},nt.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(n){try{e.src=t.src}catch(n){nt.error("Error reattaching stream to element")}}};var c=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",l=window["on"+c];if(window.addEventListener(c,(function(e){for(var t in nt.log("Closing window"),nt.sessions)nt.sessions[t]&&nt.sessions[t].destroyOnUnload&&(nt.log("Destroying session "+t),nt.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));l&&"function"==typeof l&&l()})),nt.safariVp8=!1,"safari"===nt.webRTCAdapter.browserDetails.browser&&nt.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var d=!0,u=!1,m=void 0;try{for(var f,p=RTCRtpSender.getCapabilities("video").codecs[Symbol.iterator]();!(d=(f=p.next()).done);d=!0){var h=f.value;if(h&&h.mimeType&&"video/vp8"===h.mimeType.toLowerCase()){nt.safariVp8=!0;break}}}catch(b){u=!0,m=b}finally{try{d||null==p.return||p.return()}finally{if(u)throw m}}nt.safariVp8?nt.log("This version of Safari supports VP8"):nt.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var g=new RTCPeerConnection({});g.createOffer({offerToReceiveVideo:!0}).then((function(e){nt.safariVp8=-1!==e.sdp.indexOf("VP8"),nt.safariVp8?nt.log("This version of Safari supports VP8"):nt.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),g.close(),g=null}))}if(nt.unifiedPlan=!1,"firefox"===nt.webRTCAdapter.browserDetails.browser&&nt.webRTCAdapter.browserDetails.version>=59)nt.unifiedPlan=!0;else if("chrome"===nt.webRTCAdapter.browserDetails.browser&&nt.webRTCAdapter.browserDetails.version>=72)nt.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in et.prototype){var v=new RTCPeerConnection;try{v.addTransceiver("audio"),nt.unifiedPlan=!0}catch(w){}v.close()}else nt.unifiedPlan=!1;nt.initDone=!0,e.callback()}},nt.isWebrtcSupported=function(){return!!window.RTCPeerConnection},nt.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},nt.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",a=0;a<e;a++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n};var at=nt,rt=n(223),ot=n.n(rt).a.connect(S.socketIOServer,{transports:["websocket"],secure:!0,reconnect:!0,rejectUnauthorized:!1});function it(e){var t=this;at.init({debug:"all",callback:function(){var n=new at({server:t.state.server,success:function(){n.attach({plugin:"janus.plugin.videoroom",opaqueId:t.state.opaqueId,success:function(a){t.setState({janus:n}),t.setState({sfutest:a}),at.log("Plugin attached! ("+t.state.sfutest.getPlugin()+", id="+t.state.sfutest.getId()+")"),at.log("  -- This is a publisher/manager"),t.vregisterUsername(e)},error:function(e){at.error("  -- Error attaching plugin...",e)},consentDialog:function(e){at.debug("Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){at.log("ICE state changed to "+e)},mediaState:function(e,t){at.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){at.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(e,n){at.debug(" ::: Got a message (publisher) :::",e);var a=e.videoroom;if(at.debug("Event: "+a),a)if("joined"===a){if(t.setState({myVroomId:e.id,vJoined:!0}),at.log("Successfully joined room "+e.room+" with ID "+e.id),t.addParticipant(e.id,t.state.fullname+"\xa7"+t.state.userUUID),e.publishers){var r=e.publishers;for(var o in at.debug("Got a list of available publishers/feeds:",r),r){var i=r[o].id,s=r[o].display,c=r[o].audio_codec,l=r[o].video_codec;at.debug("  >> ["+i+"] "+s+" (audio: "+c+", video: "+l+")"),t.addParticipant(r[o].id,r[o].display),t.vNewRemoteFeed(i,s,c,l)}}}else if("destroyed"===a)at.warn("The room has been destroyed!");else if("event"===a)if(e.publishers){r=e.publishers;for(var o in at.debug("Got a list of available publishers/feeds:",r),r){i=r[o].id,s=r[o].display,c=r[o].audio_codec,l=r[o].video_codec;at.debug("  >> ["+i+"] "+s+" (audio: "+c+", video: "+l+")"),t.addParticipant(r[o].id,r[o].display),t.vNewRemoteFeed(i,s,c,l)}}else if(e.leaving){var d=e.leaving;console.log("Publisher leaving: "+d),t.setState({feeds:t.state.feeds.filter((function(e){return e.rfid!=d}))},(function(){return console.log("feeds: >>>>",t.state.feeds)})),null!=(u=t.state.feeds.filter((function(e){return e.rfid===d})).shift())&&u.detach(),t.removeParticipant(d)}else if(e.unpublished){var u,m=e.unpublished;if(console.log("Publisher left: "+m),"ok"===m)return t.state.sfutest.hangup(),void t.vStreamDettacher(t.state.sfutest);null!=(u=t.state.feeds.filter((function(e){return e.rfid===m})).shift())&&(u.detach(),t.vStreamDettacher(u)),t.removeParticipant(m),t.setState({feeds:t.state.feeds.filter((function(e){return e.rfid!=m}))})}else e.error&&e.error_code;n&&(at.debug("Handling SDP as well...",n),t.state.sfutest.handleRemoteJsep({jsep:n}))},onlocalstream:function(e){at.debug(" ::: Got a local stream :::",e),console.log(" ::: Got a local stream :::",e),console.log(t.state.sfutest.id),0===t.state.feeds.filter((function(e){return e.id===t.state.sfutest.id})).length&&(t.state.sfutest.rfid=t.state.myVroomId,t.setState({feeds:t.state.feeds.concat(t.state.sfutest)}));var n=e.getVideoTracks();n&&0!==n.length?(console.log(t.state.vparticipants),t.vStreamAttacher(t.state.sfutest)):t.vStreamDettacher(t.state.sfutest)},onremotestream:function(e){},oncleanup:function(){at.log(" ::: Got a cleanup notification: we are unpublished now :::")}})},error:function(e){at.error(e),window.location.reload()},destroyed:function(){window.location.reload()}})}})}function st(e,t,n,a,r){var o=this,i=null;o.state.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.state.opaqueId,success:function(t){(i=t).simulcastStarted=!1,at.log("Plugin attached! ("+i.getPlugin()+", id="+i.getId()+")"),at.log("  -- This is a subscriber");var n={request:"join",room:1234,ptype:"subscriber",pin:o.state.pin,feed:e,private_id:o.state.mypvtid};"safari"!==at.webRTCAdapter.browserDetails.browser||"vp9"!==r&&("vp8"!==r||at.safariVp8)||(r&&(r=r.toUpperCase()),console.log("Publisher is using "+r+", but Safari doesn't support it: disabling video"),n.offer_video=!1)},error:function(e){at.error("  -- Error attaching plugin...",e),window.alert("Error attaching plugin... "+e)},onmessage:function(e,t){at.debug(" ::: Got a message (subscriber) :::",e);var n=e.videoroom;at.log("Event: "+n),e.error?window.alert(e.error):n&&"attached"===n&&(i.rfid=e.id,i.rfdisplay=e.display,o.setState({feeds:o.state.feeds.concat(i)},(function(){return console.log("@@@@",o.state.feeds)})),r||o.vStreamDettacher(i),at.log("Successfully attached to feed "+i.rfid+" ("+i.rfdisplay+") in room "+e.room)),t&&(at.log("Handling SDP as well...",t),i.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!1},success:function(e){at.log("Got SDP!",e);var t={request:"start",room:o.state.roomId};i.send({message:t,jsep:e})},error:function(e){at.log("WebRTC error:",e),window.alert("WebRTC error... "+e.message)}}))},iceState:function(e){at.log("ICE state of this WebRTC PeerConnection (feed #"+i.rfid+") changed to "+e)},webrtcState:function(e){at.log("Janus says this WebRTC PeerConnection (feed #"+i.rfid+") is "+(e?"up":"down")+" now"),"down"===e&&o.vremoveParticipant(i.rfid)},onlocalstream:function(e){console.log(">>>>>>>>>>>",e)},onremotestream:function(e){o.vStreamAttacher(i)},ondata:function(e){},oncleanup:function(){at.log(" ::: Got a cleanup notification (remote feed "+e+") :::")}})}function ct(e){var t={request:"join",room:1234,ptype:"publisher",display:this.state.fullname+" \xa7"+this.state.userUUID+"\xa7"+this.state.userColor+"\xa7"+this.state.slot};this.state.sfutest.send({message:t})}function lt(e){var t={request:"configure",room:1234,ptype:"publisher",display:this.state.fullname+" \xa7"+this.state.userUUID+"\xa7"+this.state.userColor+"\xa7"+this.state.slot};this.state.sfutest.send({message:t})}function dt(e){if(console.log("Attaching "+e.id),console.log(this.$$("#video-"+e.id)),0==this.$$("#video-"+e.id).length){var t=document.createElement("video");t.autoplay=!0,t.muted=!0,t.width="320",t.id="video-"+e.id}R()("#video-"+e.id).show(),e.id&&e.webrtcStuff&&e.webrtcStuff.remoteStream&&(this.setState({vActive:!0}),t&&this.$$("#remoteVideos").append(t),at.attachMediaStream(document.getElementById("video-"+e.id),e.webrtcStuff.remoteStream)),e.id&&e.webrtcStuff&&e.webrtcStuff.myStream&&(t&&this.$$("#selfVideos").append(t),this.$$("#videoLoaderIcon").hide(),this.$$("#disableVideo").show(),at.attachMediaStream(document.getElementById("video-"+e.id),e.webrtcStuff.myStream))}function ut(e){e.id&&(console.log("Dettaching "+e.id),R()("#video-"+e.id).hide())}function mt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=this;t.state.sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,data:!1,videoSend:!0,audioSend:!1,video:{width:180,height:151}},success:function(n){if(at.debug("********* Got publisher SDP!",n),console.log("switching to "+e),n){var a={request:"configure",audio:!1,video:!0,data:!1,bitrate:8e3*e,bitrate_cap:!0};t.state.sfutest.send({message:a,jsep:n})}t.setState({publishedCamera:!0}),t.$$("#disableVideo").show(),console.log("ID: >>>",t.state.sfutest.id),ot.emit("ionSetSlot",{slot:t.state.slot,stream:t.state.sfutest.id});var r=t.state.sfutest.webrtcStuff.myStream.getTracks();console.log(r)},error:function(e){at.error("***** WebRTC error:",e)}})}function ft(){console.log("unPublishing ..");this.state.sfutest.send({message:{request:"unpublish"}}),this.vStreamDettacher(this.state.sfutest),console.log("ID: >>>",this.state.sfutest.id),ot.emit("ionRelSlot",{slot:this.state.slot,stream:this.state.sfutest.id}),this.setState({publishedCamera:!1,videoState:"initial",slot:null})}function pt(){var e=this;return e.state.publishedCamera?r.a.createElement("a",{id:"disableVideo",onClick:function(){return e.unPublishCamera()}},r.a.createElement("div",{style:{float:"right",paddingTop:"1px"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"3",y1:"3",x2:"21",y2:"21"}),r.a.createElement("path",{d:"M15 11v-1l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -.675 .946"}),r.a.createElement("path",{d:"M10 6h3a2 2 0 0 1 2 2v3m0 4v1a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h1"})))):r.a.createElement("a",{id:"enableVideo",fill:!0,onClick:function(){return e.ionRequestRoom()}},r.a.createElement("div",{style:{float:"right",paddingTop:"3px"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"18",height:"18",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z"}),r.a.createElement("rect",{x:"3",y:"6",width:"12",height:"12",rx:"2"}),r.a.createElement("line",{x1:"7",y1:"12",x2:"11",y2:"12"}),r.a.createElement("line",{x1:"9",y1:"10",x2:"9",y2:"14"}))))}function ht(e){var t=this,n=new ne.IonSFUJSONRPCSignal(S.ionSignalServer);t.setState({config:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:sync1.ut.ac.ir:3478",username:"shafiei",credential:"12345678"}]},signal:n},(function(){var n=new te.Client(t.state.signal,t.state.config);0==t.state.clients.filter((function(t){return t.room===e})).length&&t.setState({clients:t.state.clients.concat({room:e,client:n})},(function(){console.log(t.state.clients),t.state.signal.onopen=function(){var n=t.state.clients.filter((function(t){return t.room===e}));n[0].client.join("room"+e),n[0].client.ontrack=function(n,a){console.log("got track",n.id,"for stream",a.id),"video"===n.kind&&a&&(n.onunmute=function(){0==t.state.streams.filter((function(e){return e.id===a.id})).length&&(a.room="room"+e,t.setState({streams:t.state.streams.concat(a),ionActive:!0},(function(){console.log("Streams are ...",t.state.streams)}))),a.onremovetrack=function(){console.log("Stream owner left"),t.setState({streams:t.state.streams.filter((function(e){return e.id!==a.id}))},(function(){0!=t.state.streams.length||t.state.media||t.setState({ionActive:!1})})),t.$$("#remoteVideos").remove(),t.$$("#videos").append("<div id='remoteVideos'></div>")}})}}}))}))}function gt(){var e,t=this,n=this;te.LocalStream.getUserMedia((e={resolution:"vga",codec:"vp8",video:!0},Object(N.a)(e,"video",{width:180,height:180,facingMode:"user",frameRate:{min:15,max:20}}),Object(N.a)(e,"audio",!1),Object(N.a)(e,"simulcast",!1),e)).then((function(e){n.setState({media:e,ionActive:!0});var a=document.createElement("video");a.srcObject=e,a.autoplay=!0,a.muted=!0,a.width="320",n.state.clients.filter((function(e){return e.room===n.state.slot}))[0].client.publish(e),console.log(e),n.$$("#selfVideos").append(a),n.$$("#videoLoaderIcon").hide(),n.$$("#disableVideo").show(),ot.emit("ionSetSlot",{slot:t.state.slot,stream:e.id}),e.getVideoTracks()[0].onended=function(){n.ionUnPublish()}})).catch(console.error)}function vt(){var e=this,t=this;if(this.state.streams)return this.state.streams.map((function(n){if(console.log("Attaching to stream ...",n),t.state.media&&n.id===t.state.media.id);else if(0==e.$$("#"+n.id).length){var a=document.createElement("video");a.srcObject=n,a.autoplay=!0,a.muted=!0,a.width="320",a.id=n.id,console.log("Trying to attach to",n.id),e.$$("#remoteVideos").append(a)}})),[]}function bt(){var e=this;this.state.media.unpublish(),this.state.media.getTracks().forEach((function(e){return e.stop()})),this.$$("#selfVideos").remove(),this.$$("#videos").prepend("<div id='selfVideos'></div>"),ot.emit("ionRelSlot",{stream:this.state.media.id}),this.setState({media:null},(function(){0!=e.state.streams.length||e.state.media||e.setState({ionActive:!1,videoState:"initial"})})),this.setState({videoState:"initial",slot:null}),e.leaveRoom(e.state.slot)}function wt(){var e=this;return e.state.media?r.a.createElement("a",{id:"disableVideo",onClick:function(){return e.ionUnPublish()}},r.a.createElement("div",{style:{float:"right",paddingTop:"1px"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("line",{x1:"3",y1:"3",x2:"21",y2:"21"}),r.a.createElement("path",{d:"M15 11v-1l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -.675 .946"}),r.a.createElement("path",{d:"M10 6h3a2 2 0 0 1 2 2v3m0 4v1a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-8a2 2 0 0 1 2 -2h1"})))):r.a.createElement("a",{id:"enableVideo",fill:!0,onClick:function(){return e.ionRequestRoom()}},r.a.createElement("div",{style:{float:"right",paddingTop:"3px"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"18",height:"18",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z"}),r.a.createElement("rect",{x:"3",y:"6",width:"12",height:"12",rx:"2"}),r.a.createElement("line",{x1:"7",y1:"12",x2:"11",y2:"12"}),r.a.createElement("line",{x1:"9",y1:"10",x2:"9",y2:"14"}))))}function yt(e){var t=this;console.log(e.target.value),this.setState({display:e.target.value},(function(){console.log("Display:"+t.state.display)}))}function kt(e){this.state.clients.filter((function(t){return t.room===e}))[0].client.leave("room"+e),console.log("leaving room "+e);var t=this.state.streams.filter((function(t){return t.room==="room"+e}));console.log(t);for(var n=0;n<t.length;n++)console.log(t[n].id),this.$$("#"+t[n].id).remove();this.setState({streams:this.state.streams.filter((function(t){return t.room!=="room"+e}))}),this.setState({clients:this.state.clients.filter((function(t){return t.room!==e}))})}function St(){var e=this,t=new ne.IonSFUJSONRPCSignal(S.ionSignalServer);e.setState({screenConfig:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:sync1.ut.ac.ir:3478",username:"shafiei",credential:"12345678"}]},screenSignal:t},(function(){var t=new te.Client(e.state.screenSignal,e.state.screenConfig);e.setState({screenClientLocal:t},(function(){e.state.screenSignal.onopen=function(){return e.state.screenClientLocal.join("screen room")},e.state.screenClientLocal.ontrack=function(t,n){console.log("got track",t.id,"for stream",n.id),"video"===t.kind&&(t.onunmute=function(){0==e.state.screenStreams.filter((function(e){return e.id===n.id})).length&&e.setState({screenStreams:e.state.screenStreams.concat(n),screenActive:!0},(function(){})),n.onremovetrack=function(){console.log("Stream owner left"),e.setState({screenStreams:e.state.screenStreams.filter((function(e){return e.id!==n.id}))},(function(){0!=e.state.screenStreams.length||e.state.screenMedia||e.setState({screenActive:!1})})),e.$$("#remotes").remove(),e.$$("#screen").append("<div id='remotes'></div>")}})}}))}))}function Ct(){var e=this,t=this;te.LocalStream.getDisplayMedia({resolution:"vga",frameRate:15,audio:!1}).then((function(n){console.log(n),e.setState({screenMedia:n,screenActive:!0});var a=document.createElement("video");a.srcObject=n,a.autoplay=!0,a.muted=!0,a.width=e.$$("#screen").width()-20,e.state.screenClientLocal.publish(n),e.$$("#remotes").append(a),n.getVideoTracks()[0].onended=function(){t.screenUnPublish()},t.scrollTo("#screen")})).catch(console.error)}function Et(){var e=this,t=this;if(this.state.screenStreams)return this.state.screenStreams.map((function(n){if(0==e.$$("#"+n.id).length){console.log("Going to show",n.id);var a=document.createElement("video");a.srcObject=n,a.autoplay=!0,a.muted=!0,a.width=e.$$("#screen").width()-20,a.id=n.id,e.$$("#remotes").append(a),t.scrollTo("#screen")}})),[]}function jt(){var e=this;this.state.screenMedia.unpublish(),this.state.screenMedia.getTracks().forEach((function(e){return e.stop()})),this.$$("#remotes").remove(this.state.screenMedia.id),this.$$("#screen").append("<div id='remotes'></div>"),this.setState({screenMedia:null},(function(){0!=e.state.screenStreams.length||e.state.screenMedia||e.setState({screenActive:!1})}))}function Ot(){var e=this;return this.state.screenMedia?r.a.createElement("a",{onClick:function(){return e.screenUnPublish()}},r.a.createElement("div",{style:{float:"right",paddingTop:"5px"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9"}),r.a.createElement("line",{x1:"7",y1:"20",x2:"17",y2:"20"}),r.a.createElement("line",{x1:"9",y1:"16",x2:"9",y2:"20"}),r.a.createElement("line",{x1:"15",y1:"16",x2:"15",y2:"20"}),r.a.createElement("path",{d:"M17 8l4 -4m-4 0l4 4"})))):r.a.createElement("a",{fill:!0,onClick:function(){return e.screenStart()}},r.a.createElement("div",{style:{float:"right",paddingTop:"5px"}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",class:"icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r.a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M21 12v3a1 1 0 0 1 -1 1h-16a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h9"}),r.a.createElement("line",{x1:"7",y1:"20",x2:"17",y2:"20"}),r.a.createElement("line",{x1:"9",y1:"16",x2:"9",y2:"20"}),r.a.createElement("line",{x1:"15",y1:"16",x2:"15",y2:"20"}),r.a.createElement("path",{d:"M17 4h4v4"}),r.a.createElement("path",{d:"M16 9l5 -5"}))))}var Tt=new h.w3cwebsocket(S.socketServer),Dt=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).setParticipants=e.setParticipants.bind(Object(f.a)(e)),e.sessionCreate=Be.bind(Object(f.a)(e)),e.registerUsername=ze.bind(Object(f.a)(e)),e.participantChangeStatus=Ke.bind(Object(f.a)(e)),e.participantDisplay=He.bind(Object(f.a)(e)),e.forceMute=Xe.bind(Object(f.a)(e)),e.participantChangeRoom=Ye.bind(Object(f.a)(e)),e.leaveRoom=kt.bind(Object(f.a)(e)),e.vsessionCreate=it.bind(Object(f.a)(e)),e.vregisterUsername=ct.bind(Object(f.a)(e)),e.vNewRemoteFeed=st.bind(Object(f.a)(e)),e.publishCamera=mt.bind(Object(f.a)(e)),e.vPublishBtn=pt.bind(Object(f.a)(e)),e.vStreamAttacher=dt.bind(Object(f.a)(e)),e.vStreamDettacher=ut.bind(Object(f.a)(e)),e.unPublishCamera=ft.bind(Object(f.a)(e)),e.vChangeUsername=lt.bind(Object(f.a)(e)),e.addParticipant=qe.bind(Object(f.a)(e)),e.exisitingParticipant=Ge.bind(Object(f.a)(e)),e.toggleMute=Qe.bind(Object(f.a)(e)),e.getJsonFromUrl=e.getJsonFromUrl.bind(Object(f.a)(e)),e.wsSend=e.wsSend.bind(Object(f.a)(e)),e.ionSessionCreate=ht.bind(Object(f.a)(e)),e.ionStart=gt.bind(Object(f.a)(e)),e.ionVideos=vt.bind(Object(f.a)(e)),e.ionUnPublish=bt.bind(Object(f.a)(e)),e.ionPublishBtn=wt.bind(Object(f.a)(e)),e.ionDisplay=yt.bind(Object(f.a)(e)),e.screenSessionCreate=St.bind(Object(f.a)(e)),e.screenStart=Ct.bind(Object(f.a)(e)),e.screenVideos=Et.bind(Object(f.a)(e)),e.screenUnPublish=jt.bind(Object(f.a)(e)),e.screenPublishBtn=Ot.bind(Object(f.a)(e)),e.handleChangeValue=e.handleChangeValue.bind(Object(f.a)(e)),e.login=e.login.bind(Object(f.a)(e)),e.setInstance=e.setInstance.bind(Object(f.a)(e)),e.newComerReset=e.newComerReset.bind(Object(f.a)(e)),e.toggleMicrophone=e.toggleMicrophone.bind(Object(f.a)(e)),e.uploader=e.uploader.bind(Object(f.a)(e)),e.getInstance=e.getInstance.bind(Object(f.a)(e)),e.recentUpload=e.recentUpload.bind(Object(f.a)(e)),e.revertUndo=e.revertUndo.bind(Object(f.a)(e)),e.revertTrash=e.revertTrash.bind(Object(f.a)(e)),e.exitAudioRoom=Ze.bind(Object(f.a)(e)),e.removeParticipant=Je.bind(Object(f.a)(e)),e.uploadedRecentlyReset=e.uploadedRecentlyReset.bind(Object(f.a)(e)),e.extractAction=e.extractAction.bind(Object(f.a)(e)),e.logout=e.logout.bind(Object(f.a)(e)),e.signUp=e.signUp.bind(Object(f.a)(e)),e.scrollTo=e.scrollTo.bind(Object(f.a)(e)),e.appendChat=e.appendChat.bind(Object(f.a)(e)),e.chatDeactive=e.chatDeactive.bind(Object(f.a)(e)),e.appendLink=e.appendLink.bind(Object(f.a)(e)),e.socketHandle=e.socketHandle.bind(Object(f.a)(e)),e.togglePresenter=e.togglePresenter.bind(Object(f.a)(e)),e.ionRequestRoom=e.ionRequestRoom.bind(Object(f.a)(e)),e.toggleRole=e.toggleRole.bind(Object(f.a)(e)),e.connectSocketRoom=e.connectSocketRoom.bind(Object(f.a)(e)),e.participantRole=e.participantRole.bind(Object(f.a)(e)),e.handRaise=e.handRaise.bind(Object(f.a)(e)),e.handRaised=e.handRaised.bind(Object(f.a)(e)),e.pageAfterIn=e.pageAfterIn.bind(Object(f.a)(e)),e.state={participants:[],vparticipants:[],feeds:[],token:window.localStorage.getItem("token"),shortners:null,server:S.janusServer,janus:null,sfutest:null,opaqueId:"videoroomtest-"+L.randomString(12),roomId:null,pin:"c13eab83262202c2840a",myId:null,myVroomId:null,isAdmin:!1,webrtcUp:null,myusername:null,mixertest:null,fullname:null,userUUID:null,line:null,currentTab:null,currentPoint:null,quillDelta:null,cursorRange:null,newCursor:null,client:null,clients:[],typing:null,loginScreenOpened:!0,username:"",pass:"",name:null,newComerLength:null,contentSync:null,wsConnected:!1,muted:!0,progressShow:!1,progress:null,upload:null,page:null,undoVector:null,trash:!1,userColor:Y()({luminosity:"dark",hue:"random",alpha:.6}),uploadedRecently:!1,remoteStream:null,localStream:null,chats:[],action:null,signingUp:!1,email:null,password:null,passwordConfirmation:null,signal:null,config:null,clientLocal:[],streams:[],media:null,display:1,ionActive:!1,vActive:!1,publishedCamera:!1,vJoined:!1,screenSignal:null,screenConfig:null,screenClientLocal:null,screenStreams:[],screenMedia:null,screenActive:!1,chatActive:!1,srcLink:null,converterCounter:0,presenters:[],roles:[],isPresenter:!1,isSpeaker:!1,isWriter:!1,handRaisings:[],slot:null,videoState:"initial",validationState:null,talking:{},participantRoom:{}},e}return Object(p.a)(t,e),Object(d.a)(t,[{key:"setParticipants",value:function(){}},{key:"toggleMicrophone",value:function(){var e=this;this.setState({muted:!this.state.muted},(function(){e.toggleMute()}))}},{key:"togglePresenter",value:function(e){}},{key:"toggleRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"single";this.participantRole(e)===t&&(t="not"+t);var a={uuid:e,role:t,domain:n};ot.emit("changeRole",a);var r=this.state.roles;if(r.length>0)for(var o=0;o<r.length;o++)if(r[o].uuid&&r[o].uuid===e){var i=Object.assign({},this.state);i.roles[o]=a,this.setState(i)}else this.setState({roles:this.state.roles.concat(a)});else this.setState({roles:this.state.roles.concat(a)})}},{key:"participantRole",value:function(e){var t=this.state.roles.filter((function(t){return t.uuid===e}));return t&&t[0]&&t[0].role?t[0].role:""}},{key:"handRaise",value:function(e){var t={uuid:e.raiserUUID,status:e.status},n=this.state.handRaisings;if(n.length>0)for(var a=0;a<n.length;a++)if(n[a].uuid&&n[a].uuid===e.raiserUUID){var r=Object.assign({},this.state);r.handRaisings[a]=t,this.setState(r)}else this.setState({handRaisings:this.state.handRaisings.concat(t)});else this.setState({handRaisings:this.state.handRaisings.concat(t)})}},{key:"handRaised",value:function(e){for(var t=!1,n=this.state.handRaisings,a=0;a<n.length;a++)if(n[a].uuid&&n[a].uuid===e&&"raised"===n[a].status&&(t=!0),a===n.length-1)return t}},{key:"wsSend",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.userUUID;e.room=this.state.roomId,e.sender=t,ot.emit("message",e)}},{key:"componentDidMount",value:function(){var e=this;O("uploads/recent",1,this.state.token);this.$f7;if(O("rooms/last",1,this.state.token),this.state.token&&this.state.token.length>10)T("users/validate_token",{},this.state.token),this.setState({loginScreenOpened:!1,validationState:"confirm"});else{var t=this.getJsonFromUrl(this.$f7.view[0].history[0]);t&&t.token&&(T("users/validate_token",{},t.token),this.setState({validationState:"start"}),window.localStorage.setItem("token",t.token))}e.screenSessionCreate(),ot.on("connect",(function(){e.state.roomId&&ot.emit("room",{room:e.state.roomId.toString(),uuid:e.state.userUUID})})),ot.on("message",(function(t){t.sender!==e.state.userUUID&&e.socketHandle(t)})),ot.on("ionSlot",(function(t){console.log(t.slot),e.setState({slot:t.slot},(function(){e.state.vJoined?e.vChangeUsername(1234):e.vsessionCreate(1234)})),e.wsSend({type:"joinedRoom",c:t.slot}),setTimeout((function(){return e.publishCamera()}),7e3)})),window.onunload=window.onbeforeunload=function(){e.unPublishCamera()}}},{key:"ionRequestRoom",value:function(){var e=this;this.$$("#videoLoaderIcon").show(),this.$$("#enableVideo").hide(),"initial"==this.state.videoState&&this.setState({videoState:"requested"},(function(){ot.emit("ionReqSlot",{uuid:e.state.userUUID})}))}},{key:"extractAction",value:function(){var e=this.getJsonFromUrl(this.$f7.view[0].history[0]);e&&e.action?this.setState({action:e.action}):this.setState({action:"room"})}},{key:"componentWillUnmount",value:function(){w.removeListener("set_instance",this.setInstance),w.removeListener("got_instance",this.getInstance)}},{key:"newComerReset",value:function(){this.setState({newComerLength:null})}},{key:"uploadedRecentlyReset",value:function(){this.setState({uploadedRecently:!1})}},{key:"logout",value:function(){this.setState({token:null}),this.exitAudioRoom(),setTimeout((function(){window.localStorage.removeItem("token"),window.location.replace("/")}),1e3)}},{key:"uploader",value:function(e){var t=this,n=this;n.setState({progressShow:!0},(function(){return console.log(t.state.progressShow)}));var a={onUploadProgress:function(e){var t=Math.round(100*e.loaded/e.total);n.setState({progress:t})},headers:{"Content-Type":"application/json",Authorization:"bearer "+n.state.token}},r=new FormData;r.append("upload[attached_document]",e),r.append("upload[room_id]",1),k.a.post(S.server+"/uploads",r,a).then((function(e){n.setState({progressShow:!1,uploadedRecently:!0}),O("uploads/recent",1,t.state.token)})).catch((function(e){return n.setState({progressShow:!1})}))}},{key:"recentUpload",value:function(){this.setState({progressShow:!0}),O("uploads/recent",1,this.state.token)}},{key:"revertUndo",value:function(){this.setState({undo:null})}},{key:"revertTrash",value:function(){this.setState({trash:!1})}},{key:"scrollTo",value:function(e){var t=this.$$(e).offset();this.$$(".page-content").scrollTop(t.top,350)}},{key:"appendChat",value:function(e){var t=this.state.chats.filter((function(t){return t.uuid===e.uuid}));t&&0===t.length&&(this.state.chats&&this.state.chats.length>50?this.setState({chats:this.state.chats.slice(1).concat(e)}):this.setState({chats:this.state.chats.concat(e)}),this.state.chatActive||this.setState({chatActive:!0}))}},{key:"chatDeactive",value:function(){this.setState({chatActive:!1})}},{key:"appendLink",value:function(e){this.setState({srcLink:e})}},{key:"componentWillMount",value:function(){w.on("set_instance",this.setInstance),w.on("got_instance",this.getInstance)}},{key:"socketHandle",value:function(e){var t=e;switch(t.type){case"room":this.setState({client:t.c});break;case"presenter":t.c.presenterUUID==this.state.userUUID&&this.setState({isPresenter:!0});break;case"joinedRoom":this.participantChangeRoom(t.sender,t.c);break;case"joinRoom":this.state.slot!==t.c&&this.ionSessionCreate(t.c);break;case"leaveRoom":this.state.slot!==t.c&&this.leaveRoom(t.c);break;case"changeRole":"all"!=t.c.domain&&t.c.roleUUID!=this.state.userUUID||("presenter"==t.c.role&&this.setState({isPresenter:!0,isSpeaker:!1,isWriter:!1}),"speaker"==t.c.role&&this.setState({isSpeaker:!0,isPresenter:!1}),"writer"==t.c.role&&this.setState({isWriter:!0,isPresenter:!1}),"notpresenter"==t.c.role&&this.setState({isPresenter:!1}),"notwriter"==t.c.role&&this.setState({isWriter:!1}),"notspeaker"==t.c.role&&(this.forceMute(),this.setState({isSpeaker:!1})));break;case"handRaise":this.handRaise(t.c);break;case"srcLink":this.appendLink(t.c);break;case"chat":this.appendChat(t.c);break;case"page":this.setState({page:t.c});break;case"undo":this.setState({undoVector:t.c});break;case"trash":this.setState({trash:!0});break;case"newUpload":this.recentUpload();break;case"contentSync":this.setState({contentSync:t.c});break;case"newComer":this.setState({newComerLength:t.c});break;case"newCursor":this.setState({newCursor:t.c});break;case"typing":this.setState({typing:t.c});break;case"point":this.setState({currentPoint:t.c});break;case"quill":this.setState({quillDelta:t.c});break;case"cursor":this.setState({cursorRange:t.c});break;case"line":this.setState({line:t.c});break;case"tab":this.setState({currentTab:t.current})}}},{key:"maintainWS",value:function(){var e=this;Tt.onopen=function(){Tt.send(JSON.stringify({type:"room",id:1234})),e.setState({wsConnected:!0})},Tt.onclose=function(){e.setState({wsConnected:!1})},Tt.onmessage=function(t){var n={};switch(t.data&&t.data.length>0&&(n=JSON.parse(t.data)),n.type){case"room":e.setState({client:n.c});break;case"srcLink":e.appendLink(n.c);break;case"chat":e.appendChat(n.c);break;case"page":e.setState({page:n.c});break;case"undo":e.setState({undoVector:n.c});break;case"trash":e.setState({trash:!0});break;case"newUpload":e.recentUpload();break;case"contentSync":e.setState({contentSync:n.c});break;case"newComer":e.setState({newComerLength:n.c});break;case"newCursor":e.setState({newCursor:n.c});break;case"typing":e.setState({typing:n.c});break;case"point":e.setState({currentPoint:n.c});break;case"quill":e.setState({quillDelta:n.c});break;case"cursor":e.setState({cursorRange:n.c});break;case"line":e.setState({line:n.c});break;case"tab":e.setState({currentTab:n.current})}}}},{key:"getJsonFromUrl",value:function(e){if(!e||!e.split("?")||!e.split("?")[1])return[];var t=e.split("?")[1],n={};return t.split("&").forEach((function(e){var t=e.split("=");n[t[0]]=decodeURIComponent(t[1])})),n}},{key:"handleChangeValue",value:function(e){this.setState(e)}},{key:"login",value:function(){this.$$(".btn").hide(),this.$$(".btn-notice").text(F.submitting);var e={name:this.state.name,user:{email:this.state.email,password:this.state.password}};if(this.state.email&&this.state.email.length>0)this.state.signingUp?T("users/sign_up",e):T("users/login",e);else{this.$f7.dialog.alert(F.incomplete_data,F.alert)}}},{key:"signUp",value:function(){this.setState({signingUp:!0})}},{key:"setInstance",value:function(){var e=this,t=w.getKlass(),n=w.getIntance();!n||"SignUp"!==t&&"Login"!==t||(window.localStorage.setItem("token",n.token),window.location.reload()),"Validate"===t&&("confirm"===this.state.validationState?this.setState({name:n.name,fullname:n.name,userUUID:n.uuid},(function(){e.connectSocketRoom()})):window.location.reload())}},{key:"getInstance",value:function(){var e=this,t=this,n=w.getIntance(),a=w.getKlass();n&&"Upload"===a&&this.setState({model:n},(function(){!n.converted&&t.state.converterCounter<10?(setTimeout((function(){return e.recentUpload()}),1e4),e.setState({converterCounter:t.state.converterCounter+1})):e.setState({progressShow:!1})})),n&&"Room"===a&&this.setState({roomId:n.room_id,pin:n.pin,isAdmin:n.is_admin,isPresenter:n.is_admin},(function(){t.sessionCreate(t.state.roomId),t.connectSocketRoom()}))}},{key:"connectSocketRoom",value:function(){this.state.userUUID&&this.state.roomId&&ot.emit("room",{room:this.state.roomId,uuid:this.state.userUUID})}},{key:"currentPage",value:function(){}},{key:"pageAfterIn",value:function(){}},{key:"render",value:function(){var e=this,t={id:"io.framework7.testapp",name:"Framework7",theme:"aurora",panel:{rightBreakpoint:960},view:{},routes:Fe},n=this.state,a=n.line,o=n.currentTab,i=n.currentPoint,s=n.quillDelta,l=n.cursorRange,d=(n.clients,n.client),u=n.newCursor,m=n.typing,f=n.name,p=n.newComerLength,h=n.contentSync,g=n.muted,v=n.userUUID,b=n.progress,w=n.progressShow,y=n.upload,k=n.page,S=n.undoVector,C=n.trash,E=n.userColor,j=n.participants,O=n.uploadedRecently,T=n.remoteStream,D=n.localStream,I=n.chats,x=n.email,A=n.password,R=n.passwordConfirmation,_=n.signingUp,P=n.ionActive,M=n.screenActive,V=n.srcLink,U=n.isAdmin,L=n.chatActive,N=n.isPresenter,F=n.isSpeaker,W=n.isWriter,$=n.roles,B=n.handRaisings,z=n.slot,J=n.talking,q=n.participantRoom,G=n.vActive;return r.a.createElement(c.a,{params:t},r.a.createElement(c.v,{resizable:!0,left:!0,cover:!0},r.a.createElement(c.C,null,r.a.createElement(ue,{wsSend:this.wsSend,chats:I,appendChat:this.appendChat,userUUID:v,name:f,participantDisplay:this.participantDisplay,isAdmin:U,chatDeactive:this.chatDeactive}))),r.a.createElement(c.v,{resizable:!0,right:!0,themeDark:!0},r.a.createElement(c.C,null,r.a.createElement(se,{participants:j,handleChangeValue:this.handleChangeValue,muted:g,userUUID:v,toggleMicrophone:this.toggleMicrophone,userColor:E,logout:this.logout,scrollTo:this.scrollTo,ionPublishBtn:this.ionPublishBtn,screenPublishBtn:this.screenPublishBtn,ionActive:P,screenActive:M,isAdmin:U,chatActive:L,chatDeactive:this.chatDeactive,togglePresenter:this.togglePresenter,isPresenter:N,toggleRole:this.toggleRole,isSpeaker:F,isWriter:W,roles:$,participantRole:this.participantRole,wsSend:this.wsSend,handRaisings:B,handRaised:this.handRaised,handRaise:this.handRaise,currentSlot:z,talking:J,participantRoom:q,pageAfterIn:this.pageAfterIn,vPublishBtn:this.vPublishBtn}))),r.a.createElement(c.C,{id:"main-view",url:"",pushState:!0,main:!0,className:"safe-areas"},r.a.createElement(ie,{wsSend:this.wsSend,line:a,currentTab:o,currentPoint:i,quillDelta:s,cursorRange:l,client:d,typing:m,newCursor:u,name:f,newComerLength:p,contentSync:h,newComerReset:this.newComerReset,uploader:this.uploader,progress:b,progressShow:w,upload:y,recentUpload:this.recentUpload,page:k,undoVector:S,revertUndo:this.revertUndo,trash:C,revertTrash:this.revertTrash,userColor:E,participants:j,userUUID:v,uploadedRecently:O,uploadedRecentlyReset:this.uploadedRecentlyReset,remoteStream:T,localStream:D,ionVideos:this.ionVideos,ionActive:P,screenVideos:this.screenVideos,screenActive:M,appendLink:this.appendLink,srcLink:V,isAdmin:U,isPresenter:N,isWriter:W,vActive:G}),r.a.createElement(c.r,{className:"demo-login-screen",opened:this.state.loginScreenOpened,onLoginScreenClosed:function(){e.handleChangeValue({loginScreenOpened:!1})}},r.a.createElement(me,{email:x,handleChangeValue:this.handleChangeValue,name:f,password:A,passwordConfirmation:R,login:this.login,signUp:this.signUp,signingUp:_}))))}}]),t}(r.a.Component);n(484),n(485),n(486),n(487),n(488),n(489),n(490),n(491),n(492),n(493),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));"serviceWorker"in navigator&&navigator.serviceWorker.register("./firebase-messaging-sw.js").then((function(e){console.log("Registration successful, scope is:",e.scope)})).catch((function(e){console.log("Service worker registration failed, error:",e)})),s.a.use(c.D),i.a.render(r.a.createElement(Dt),document.getElementById("root"))}},[[225,1,2]]]);
//# sourceMappingURL=main.a470c755.chunk.js.map